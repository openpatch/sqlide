var $s=Object.defineProperty;var Os=(f,e,t)=>e in f?$s(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var w=(f,e,t)=>(Os(f,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var l=(f=>(f[f.identifier=0]="identifier",f[f.integerConstant=1]="integerConstant",f[f.floatingPointConstant=2]="floatingPointConstant",f[f.booleanConstant=3]="booleanConstant",f[f.stringConstant=4]="stringConstant",f[f.charConstant=5]="charConstant",f[f.true=6]="true",f[f.false=7]="false",f[f.keywordRename=8]="keywordRename",f[f.keywordDistinct=9]="keywordDistinct",f[f.keywordTo=10]="keywordTo",f[f.keywordAlter=11]="keywordAlter",f[f.keywordCommit=12]="keywordCommit",f[f.keywordAdd=13]="keywordAdd",f[f.keywordDelete=14]="keywordDelete",f[f.keywordSelect=15]="keywordSelect",f[f.keywordInsert=16]="keywordInsert",f[f.keywordInto=17]="keywordInto",f[f.keywordValues=18]="keywordValues",f[f.keywordUpdate=19]="keywordUpdate",f[f.keywordSet=20]="keywordSet",f[f.keywordNo=21]="keywordNo",f[f.keywordUse=22]="keywordUse",f[f.keywordCreate=23]="keywordCreate",f[f.keywordReferences=24]="keywordReferences",f[f.keywordPrimary=25]="keywordPrimary",f[f.keywordForeign=26]="keywordForeign",f[f.keywordTable=27]="keywordTable",f[f.keywordTables=28]="keywordTables",f[f.keywordColumn=29]="keywordColumn",f[f.keywordDrop=30]="keywordDrop",f[f.keywordUnique=31]="keywordUnique",f[f.keywordKey=32]="keywordKey",f[f.keywordIndex=33]="keywordIndex",f[f.keywordConstraint=34]="keywordConstraint",f[f.keywordModify=35]="keywordModify",f[f.keywordCascade=36]="keywordCascade",f[f.keywordRestrict=37]="keywordRestrict",f[f.keywordAction=38]="keywordAction",f[f.keywordAutoincrement=39]="keywordAutoincrement",f[f.keywordFrom=40]="keywordFrom",f[f.keywordWhere=41]="keywordWhere",f[f.keywordGroup=42]="keywordGroup",f[f.keywordBy=43]="keywordBy",f[f.keywordHaving=44]="keywordHaving",f[f.keywordOrder=45]="keywordOrder",f[f.keywordAscending=46]="keywordAscending",f[f.keywordDescending=47]="keywordDescending",f[f.keywordNulls=48]="keywordNulls",f[f.keywordFirst=49]="keywordFirst",f[f.keywordLast=50]="keywordLast",f[f.keywordIs=51]="keywordIs",f[f.keywordNull=52]="keywordNull",f[f.keywordDatabase=53]="keywordDatabase",f[f.keywordOr=54]="keywordOr",f[f.keywordAnd=55]="keywordAnd",f[f.keywordNot=56]="keywordNot",f[f.keywordJoin=57]="keywordJoin",f[f.keywordNatural=58]="keywordNatural",f[f.keywordLeft=59]="keywordLeft",f[f.keywordCross=60]="keywordCross",f[f.keywordInner=61]="keywordInner",f[f.keywordOuter=62]="keywordOuter",f[f.keywordOn=63]="keywordOn",f[f.keywordAs=64]="keywordAs",f[f.keywordLimit=65]="keywordLimit",f[f.keywordOffset=66]="keywordOffset",f[f.keywordIn=67]="keywordIn",f[f.keywordNotIn=68]="keywordNotIn",f[f.keywordLike=69]="keywordLike",f[f.keywordCollate=70]="keywordCollate",f[f.keywordDefault=71]="keywordDefault",f[f.keywordComment=72]="keywordComment",f[f.keywordEngine=73]="keywordEngine",f[f.keywordCharset=74]="keywordCharset",f[f.keywordCharacter=75]="keywordCharacter",f[f.keywordStart=76]="keywordStart",f[f.keywordTransaction=77]="keywordTransaction",f[f.keywordIf=78]="keywordIf",f[f.keywordExists=79]="keywordExists",f[f.keywordLock=80]="keywordLock",f[f.keywordUnlock=81]="keywordUnlock",f[f.keywordWrite=82]="keywordWrite",f[f.keywordRead=83]="keywordRead",f[f.leftBracket=84]="leftBracket",f[f.rightBracket=85]="rightBracket",f[f.leftSquareBracket=86]="leftSquareBracket",f[f.rightSquareBracket=87]="rightSquareBracket",f[f.leftCurlyBracket=88]="leftCurlyBracket",f[f.rightCurlyBracket=89]="rightCurlyBracket",f[f.leftRightSquareBracket=90]="leftRightSquareBracket",f[f.dot=91]="dot",f[f.modulo=92]="modulo",f[f.minus=93]="minus",f[f.plus=94]="plus",f[f.multiplication=95]="multiplication",f[f.division=96]="division",f[f.singleQuote=97]="singleQuote",f[f.doubleQuote=98]="doubleQuote",f[f.identifierQuote=99]="identifierQuote",f[f.lower=100]="lower",f[f.greater=101]="greater",f[f.lowerOrEqual=102]="lowerOrEqual",f[f.greaterOrEqual=103]="greaterOrEqual",f[f.concatenation=104]="concatenation",f[f.equal=105]="equal",f[f.notEqual=106]="notEqual",f[f.semicolon=107]="semicolon",f[f.colon=108]="colon",f[f.comma=109]="comma",f[f.backslash=110]="backslash",f[f.pipe=111]="pipe",f[f.at=112]="at",f[f.hash=113]="hash",f[f.space=114]="space",f[f.tab=115]="tab",f[f.newline=116]="newline",f[f.linefeed=117]="linefeed",f[f.identifierChar=118]="identifierChar",f[f.comment=119]="comment",f[f.endofSourcecode=120]="endofSourcecode",f[f.constantNode=121]="constantNode",f[f.callMethod=122]="callMethod",f[f.unaryOp=123]="unaryOp",f[f.binaryOp=124]="binaryOp",f[f.table=125]="table",f[f.subquery=126]="subquery",f[f.list=127]="list",f[f.column=128]="column",f[f.columnDef=129]="columnDef",f[f.allColumns=130]="allColumns",f[f.isNull=131]="isNull",f[f.isNot=132]="isNot",f[f.isNotNull=133]="isNotNull",f[f.omittedeStatement=134]="omittedeStatement",f))(l||{}),ge={[0]:"ein Bezeichner",[1]:"eine Integer-Konstante",[2]:"eine Fließkomma-Konstante",[3]:"eine boolesche Konstante",[4]:"eine Zeichenketten-Konstante",[5]:"eine char-Konstante",[6]:"true",[7]:"false",[8]:"rename",[9]:"distinct",[10]:"to",[11]:"alter",[12]:"commit",[13]:"add",[14]:"delete",[15]:"select",[16]:"insert",[17]:"into",[18]:"values",[19]:"update",[20]:"set",[21]:"no",[22]:"use",[23]:"create",[24]:"references",[25]:"primary",[26]:"foreign",[27]:"table",[28]:"tables",[29]:"column",[30]:"drop",[31]:"unique",[32]:"key",[33]:"index",[34]:"constraint",[35]:"modify",[36]:"cascade",[37]:"restrict",[38]:"action",[39]:"autoincrement",[40]:"from",[41]:"where",[42]:"group",[43]:"by",[44]:"having",[45]:"order",[46]:"ascending",[47]:"descending",[48]:"nulls",[49]:"first",[50]:"last",[51]:"is",[52]:"null",[53]:"database",[55]:"and",[54]:"or",[56]:"not",[57]:"join",[58]:"natural",[59]:"left",[60]:"cross",[61]:"inner",[62]:"outer",[63]:"on",[64]:"as",[65]:"limit",[66]:"offset",[67]:"in",[68]:"not in",[69]:"like",[70]:"collate",[71]:"default",[72]:"comment",[73]:"engine",[74]:"charset",[75]:"character",[76]:"start",[77]:"transaction",[78]:"if",[79]:"exists",[80]:"lock",[81]:"unlock",[82]:"write",[83]:"read",[84]:"(",[85]:")",[86]:"[",[87]:"]",[88]:"{",[89]:"}",[90]:"[]",[91]:".",[93]:"-",[92]:"%",[94]:"+",[95]:"*",[96]:"/",[97]:"'",[98]:'"',[99]:"`",[100]:"<",[101]:">",[105]:"=",[102]:"<=",[103]:">=",[104]:"||",[107]:";",[108]:":",[109]:",",[110]:"\\",[112]:"@",[113]:"#",[111]:"|",[114]:"ein Leerzeichen",[115]:"ein Tabulatorzeichen",[116]:"ein Zeilenumbruch",[118]:"eines der Zeichen a..z, A..Z, _",[119]:"ein Kommentar",[120]:"das Ende des Programmes"},Hi={"(":84,")":85,"[":86,"]":87,"{":88,"}":89,".":91,",":109,"-":93,"%":92,"+":94,"*":95,"/":96,"\\":110,"@":112,"#":113,"|":111,"'":97,'"':98,"`":99,"<":100,">":101,"=":105,"<>":106,";":107,":":108," ":114,"	":115,"\n":116,"\r":117},Ns={rename:8,distinct:9,to:10,alter:11,commit:12,add:13,delete:14,select:15,insert:16,into:17,values:18,update:19,set:20,no:21,use:22,create:23,references:24,primary:25,foreign:26,table:27,tables:28,column:29,drop:30,unique:31,key:32,index:33,constraint:34,modify:35,cascade:36,restrict:37,action:38,autoincrement:39,auto_increment:39,from:40,where:41,true:6,false:7,group:42,by:43,having:44,order:45,asc:46,desc:47,nulls:48,first:49,last:50,is:51,null:52,database:53,or:54,and:55,not:56,join:57,natural:58,left:59,cross:60,inner:61,outer:62,on:63,as:64,limit:65,offset:66,in:67,"not in":68,like:69,collate:70,default:71,comment:72,engine:73,charset:74,character:75,start:76,transaction:77,if:78,exists:79,lock:80,unlock:81,write:82,read:83},Qn={n:`
`,r:"\r",t:"	",'"':'"',"'":"'","\\":"\\"},We="►";class Gi{constructor(){w(this,"tokenList");w(this,"nonSpaceLastTokenType");w(this,"nonSpaceLastToken");w(this,"errorList");w(this,"pos");w(this,"line");w(this,"column");w(this,"currentChar");w(this,"nextChar");w(this,"input");w(this,"spaceTokens",[l.space,l.tab,l.newline]);w(this,"bracketStack");w(this,"bracketError");w(this,"correspondingBracket",{});w(this,"tokenTypesToMerge",[{first:l.keywordNotIn,second:l.keywordIn,merged:l.keywordNotIn},{first:l.keywordIs,second:l.keywordNot,merged:l.isNot},{first:l.isNot,second:l.keywordNull,merged:l.isNotNull},{first:l.keywordIs,second:l.keywordNull,merged:l.isNull}]);this.correspondingBracket[l.leftBracket]=l.rightBracket,this.correspondingBracket[l.leftCurlyBracket]=l.rightCurlyBracket,this.correspondingBracket[l.leftSquareBracket]=l.rightSquareBracket,this.correspondingBracket[l.rightBracket]=l.leftBracket,this.correspondingBracket[l.rightCurlyBracket]=l.leftCurlyBracket,this.correspondingBracket[l.rightSquareBracket]=l.leftSquareBracket}lex(e){if(this.input=e.replace(" "," "),this.tokenList=[],this.errorList=[],this.bracketError=null,this.bracketStack=[],this.pos=0,this.line=1,this.column=1,this.nonSpaceLastTokenType=null,this.nonSpaceLastToken=null,e.length==0)return{tokens:this.tokenList,errors:this.errorList,bracketError:null};for(this.currentChar=e.charAt(0),this.nextChar=e.length>1?e.charAt(1):We;this.currentChar!=We;)this.mainState();if(this.bracketStack.length>0){let t=this.bracketStack.pop(),i=this.correspondingBracket[t];this.setBracketError(ge[t]+" "+ge[i])}return{tokens:this.tokenList,errors:this.errorList,bracketError:this.bracketError}}checkClosingBracket(e){if(this.bracketStack.length==0){let r=this.correspondingBracket[e];this.setBracketError(ge[r]+" "+ge[e]);return}let t=this.bracketStack.pop(),i=this.correspondingBracket[t];e!=i&&this.setBracketError(ge[t]+" "+ge[i])}setBracketError(e){this.bracketError==null&&(this.bracketError=e)}next(){this.pos++,this.currentChar=this.nextChar,this.pos+1<this.input.length?this.nextChar=this.input.charAt(this.pos+1):this.nextChar=We,this.column++}mainState(){let e=this.currentChar,t=Hi[e];if(t!=null){switch(t){case l.leftSquareBracket:if(this.nextChar=="]"){this.pushToken(l.leftRightSquareBracket,"[]"),this.next(),this.next();return}else{this.pushToken(l.leftSquareBracket,"["),this.bracketStack.push(t),this.next();return}case l.division:if(this.nextChar=="*"){this.lexMultilineComment();return}this.pushToken(l.division,"/"),this.next();return;case l.pipe:if(this.nextChar=="|"){this.pushToken(l.concatenation,"||"),this.next(),this.next();return}else{this.pushToken(l.pipe,"|"),this.next();return}case l.lower:if(this.nextChar==">"){this.pushToken(l.notEqual,"<>"),this.next(),this.next();return}else if(this.nextChar=="="){this.pushToken(l.lowerOrEqual,"<="),this.next(),this.next();return}else{this.pushToken(l.lower,"<"),this.next();return}case l.greater:if(this.nextChar=="="){this.pushToken(l.greaterOrEqual,">="),this.next(),this.next();return}else{this.pushToken(l.greater,">"),this.next();return}case l.rightSquareBracket:this.checkClosingBracket(t);break;case l.leftBracket:this.bracketStack.push(t);break;case l.rightBracket:this.checkClosingBracket(t);break;case l.leftCurlyBracket:this.bracketStack.push(t);break;case l.rightCurlyBracket:this.checkClosingBracket(t);break;case l.minus:if(this.isDigit(this.nextChar,10)&&!([l.identifier,l.integerConstant,l.floatingPointConstant,l.rightBracket].indexOf(this.nonSpaceLastTokenType)>=0)){this.lexNumber();return}else if(this.nextChar=="-"){this.lexEndofLineComment("--");return}else{this.pushToken(l.minus,"-"),this.next();return}case l.hash:if(this.nonSpaceLastToken==null||this.nonSpaceLastToken.position.line<this.line){this.lexEndofLineComment("#");return}else this.pushToken(l.hash,"#"),this.next();break;case l.singleQuote:this.lexStringConstant("'");return;case l.doubleQuote:this.lexStringConstant('"');return;case l.newline:this.pushToken(l.newline,`
`),this.line++,this.column=0,this.next();return;case l.space:case l.tab:this.lexSpace();return;case l.linefeed:this.next();return;case l.at:this.lexAnnotation();return;case l.identifierQuote:this.lexQuotedIdentifier();return}this.pushToken(t,e),this.next();return}if(this.isDigit(e,10)){this.lexNumber();return}this.lexIdentifierOrKeyword()}lexQuotedIdentifier(){let e=this.line,t=this.column,i="";for(this.next();this.currentChar!="`"&&this.currentChar!=We;)i+=this.currentChar,this.next();this.currentChar==We?this.pushError("Innerhalb eines in `` eingeschlossenen Bezeichners wurde das Ende der Datei erreicht.",i.length+1,"error",e,t):(this.next(),this.pushToken(l.identifier,i,e,t))}pushToken(e,t,i=this.line,r=this.column,o=(""+t).length){let u={tt:e,value:t,position:{column:r,line:i,length:o}};for(let h of this.tokenTypesToMerge)if(e==h.second&&this.nonSpaceLastTokenType==h.first){let b=r-this.nonSpaceLastToken.position.column+o;this.nonSpaceLastToken.tt=h.merged,this.nonSpaceLastToken.position={column:this.nonSpaceLastToken.position.column,line:i,length:b},this.nonSpaceLastToken.value=this.nonSpaceLastToken.value+" "+t,this.nonSpaceLastTokenType=h.merged;return}this.spaceTokens.indexOf(e)>=0||(this.nonSpaceLastTokenType=e,this.nonSpaceLastToken=u),this.tokenList.push(u)}pushError(e,t,i="error",r=this.line,o=this.column){this.errorList.push({text:e,position:{line:r,column:o,length:t},level:i})}isDigit(e,t){var i=e.charCodeAt(0);if(t==10)return i>=48&&i<=57;if(t==2)return i>=48&&i<=49;if(t==8)return i>=48&&i<=55;if(t==16)return i>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70}lexSpace(){let e=this.column,t=this.line,i=this.pos;for(;this.currentChar==" "||this.currentChar=="	";)this.next();let r=this.pos;this.pushToken(l.space,this.input.substring(i,r),t,e)}lexCharacterConstant(){let e=this.column,t=this.line;this.next();let i=this.currentChar;if(i=="\\"){let r=Qn[this.nextChar];r==null?(this.pushError("Die Escape-Sequenz \\"+this.nextChar+" gibt es nicht.",2),this.nextChar!="'"&&(i=this.nextChar,this.next())):(i=r,this.next())}this.next(),this.currentChar!="'"?this.pushError("Das Ende der char-Konstante wird erwartet (').",1):this.next(),this.pushToken(l.charConstant,i,t,e)}lexStringConstant(e){let t=this.line,i=this.column,r="";for(this.next();;){let o=this.currentChar;if(o=="\\"){let u=Qn[this.nextChar];u==null?this.pushError("Die Escape-Sequenz \\"+this.nextChar+" gibt es nicht.",2):(o=u,this.next())}else if(o==e){if(this.next(),this.currentChar!=e)break;r+=e}else if(o==`
`||o==We){this.pushError("Innerhalb einer String-Konstante wurde das Zeilenende erreicht.",r.length+1,"error",t,i);break}r+=o,this.next()}e=="'"?this.pushToken(l.stringConstant,r,t,i,r.length+2):(this.pushToken(l.identifier,r,t,i,r.length+2),this.tokenList[this.tokenList.length-1].isDoubleQuotedIdentifier=!0)}lexMultilineComment(){let e=this.line,t=this.column,i=!1,r="/*";for(this.next(),this.next();;){let o=this.currentChar;if(o=="*"&&this.nextChar=="/"){this.next(),this.next(),r+="*/";break}if(o==We){this.pushError("Innerhalb eines Mehrzeilenkommentars (/*... */) wurde das Dateiende erreicht.",1);break}o==`
`?(this.line++,this.column=0,i=!0,r+=o):i&&o==" "||(r+=o,i=!1),this.next()}this.pushToken(l.comment,r,e,t)}lexEndofLineComment(e){let t=this.line,i=this.column,r=e;for(let o=0;o<e.length;o++)this.next();for(;;){let o=this.currentChar;if(o==`
`||o==We)break;r+=o,this.next()}this.pushToken(l.comment,r,t,i)}lexNumber(){let e=this.line,t=this.column,i=1;this.currentChar=="-"&&(i=-1,this.next());let r=this.pos,o=this.currentChar;this.next();let u=10;for(o=="0"&&["b","x","0","1","2","3","4","5","6","7"].indexOf(this.currentChar)>=0&&(this.currentChar=="x"?(u=16,this.next()):this.currentChar=="b"?(u=2,this.next()):u=8,r=this.pos);this.isDigit(this.currentChar,u);)this.next();let h=l.integerConstant;if(this.currentChar=="."){for(h=l.floatingPointConstant,this.next();this.isDigit(this.currentChar,10);)this.next();u!=10&&this.pushError("Eine float/double-Konstante darf nicht mit 0, 0b oder 0x beginnen.",this.pos-r,"error",this.line,this.column-(this.pos-r))}let b=this.input.substring(r,this.pos);r=this.pos;let k=0;if(this.currentChar=="e"){this.next();let P=this.pos;for(this.currentChar=="-"&&this.next();this.isDigit(this.currentChar,10);)this.next();u!=10&&this.pushError("Eine float/double-Konstante darf nicht mit 0, 0b oder 0x beginnen.",this.pos-r,"error",this.line,this.column-(this.pos-r));let L=this.input.substring(P,this.pos);k=Number.parseInt(L)}(this.currentChar=="d"||this.currentChar=="f")&&(h==l.floatingPointConstant,this.next(),u!=10&&this.pushError("Eine float/double-Konstante darf nicht mit 0, 0b oder 0x beginnen.",this.pos-r,"error",this.line,this.column-(this.pos-r)));let E=h==l.integerConstant?Number.parseInt(b,u):Number.parseFloat(b);E*=i,k!=0&&(E*=Math.pow(10,k)),this.pushToken(h,E,e,t)}lexAnnotation(){let e=this.line,t=this.column-1,i=this.pos,r=this.currentChar;for(this.next();Hi[r]==null&&!this.isSpace(r)&&r!=We;)this.next(),r=this.currentChar;let o=this.pos,u=this.input.substring(i,o);this.pushToken(l.at,u,e,t,u.length+1)}lexIdentifierOrKeyword(){let e=this.line,t=this.column,i=this.pos,r=this.currentChar;for(;Hi[r]==null&&!this.isSpace(r)&&r!=We;)this.next(),r=this.currentChar;let o=this.pos,u=this.input.substring(i,o),h=Ns[u.toLowerCase()];if(h!=null&&typeof h=="number"){switch(h){case l.true:this.pushToken(l.booleanConstant,!0,e,t);break;case l.false:this.pushToken(l.booleanConstant,!1,e,t);break;default:this.pushToken(h,u,e,t);break}return}this.pushToken(l.identifier,u,e,t)}isSpace(e){return e==" "||e==`
`}}class er{constructor(){w(this,"autoFormatTriggerCharacters",[`
`]);w(this,"displayName","Java-Autoformat")}init(){monaco.languages.registerDocumentFormattingEditProvider("myJava",this),monaco.languages.registerOnTypeFormattingEditProvider("myJava",this)}provideOnTypeFormattingEdits(e,t,i,r,o){let u=this.format(e);return Promise.resolve(u)}deleteOverlappingRanges(e){for(let t=0;t<e.length-1;t++){let i=e[t],r=e[t+1];if(!(i.range.endLineNumber<r.range.startLineNumber)&&i.range.endLineNumber==r.range.startLineNumber){if(i.range.endColumn>=r.range.startColumn)e.splice(t+1,1);else if(i.range.endColumn==0&&i.text.length>0&&r.range.startColumn==1&&r.range.endColumn>r.range.startColumn&&r.text==""){let o=i.text.length-(r.range.endColumn-r.range.startColumn);o>0?(i.text=i.text.substr(0,o),e.splice(t+1,1)):o<0?(r.range.endColumn=r.range.startColumn-o,e.splice(t,1),t--):(e.splice(t,2),t--)}}}}provideDocumentFormattingEdits(e,t,i){let r=this.format(e);return Promise.resolve(r)}format(e){let t=[],i=e.getValue(monaco.editor.EndOfLinePreference.LF),r=new Gi().lex(i).tokens;if(r==null)return[];let o=null,u=0,h=3,b=[],k=[],E=0,P=0;for(let L=0;L<r.length;L++){let H=r[L];switch(E--,H.tt){case l.leftCurlyBracket:if(u++,b.push(H.position.line),o!=null){let A=o.tt;(A==l.rightBracket||A==l.identifier||A==l.leftRightSquareBracket)&&this.replaceBetween(o,H,t," ")}if(L<r.length-1){let A=r[L+1];A.tt!=l.newline&&A.tt!=l.space&&this.insertSpaces(t,A.position.line,A.position.column,1)}break;case l.rightCurlyBracket:k[k.length-1]==u&&(k.pop(),u--,this.deleteSpaces(t,H.position.line,1,3)),u--;let z=b.pop();if(z!=null&&z!=H.position.line)o!=null&&o.position.line==H.position.line&&this.replace(t,H.position,H.position,`
`+" ".repeat(u*h));else if(L>0){let A=r[L-1];A.tt!=l.space&&A.tt!=l.newline&&this.insertSpaces(t,H.position.line,H.position.column,1)}break;case l.leftBracket:if(P++,L<r.length-2){let A=r[L+1],K=r[L+2];A.tt==l.space&&K.tt!=l.newline&&(this.deleteSpaces(t,A.position.line,A.position.column,A.position.length),L++,K.tt==l.rightBracket&&(L++,P--))}if(L>1){let A=r[L-1],K=r[L-2];A.tt==l.space&&K.tt!=l.newline&&!this.isBinaryOperator(K.tt)&&A.position.length==1&&this.deleteSpaces(t,A.position.line,A.position.column,1)}break;case l.rightBracket:if(P--,L>1){let A=r[L-1],K=r[L-2];A.tt==l.space&&K.tt!=l.newline&&this.deleteSpaces(t,A.position.line,A.position.column,A.position.length)}break;case l.newline:if(E=2,L<r.length-2){let A=this.isBinaryOperator(o==null?void 0:o.tt),K=this.isBinaryOperator(this.getNextNonSpaceToken(L,r).tt),W=r[L+1],he=r[L+2],ve=0;if(W.tt==l.newline)break;let me=0;if(W.tt==l.space){if(he.tt==l.newline)break;ve=W.position.length,L++,he.tt==l.rightCurlyBracket&&(me=-1)}W.tt==l.rightCurlyBracket&&(me=-1),(K||A)&&(me=1);let it=u+me;P>0&&it++,it<0&&(it=0);let c=it*h;c>ve?this.insertSpaces(t,H.position.line+1,0,c-ve):c<ve&&this.deleteSpaces(t,H.position.line+1,0,ve-c)}break;case l.space:L<r.length-1&&r[L+1].tt!=l.comment&&L>0&&r[L-1].tt!=l.newline&&H.position.length>1&&this.deleteSpaces(t,H.position.line,H.position.column,H.position.length-1);break;case l.comma:case l.semicolon:if(L>1){let A=r[L-1],K=r[L-2];A.tt!=l.newline&&K.tt!=l.newline&&!this.isBinaryOperator(K.tt)&&A.tt==l.space&&A.position.length==1&&this.deleteSpaces(t,A.position.line,A.position.column,1)}if(L<r.length-1){let A=r[L+1];A.tt!=l.comment&&A.tt!=l.space&&A.tt!=l.newline&&this.insertSpaces(t,A.position.line,A.position.column,1)}break;case l.rightSquareBracket:o!=null&&o.tt==l.leftSquareBracket&&this.replaceBetween(o,H,t,"");break}if(this.isBinaryOperator(H.tt)){let z=H.tt==l.lower&&this.lowerBelongsToGenericExpression(L,r),A=H.tt==l.greater&&this.greaterBelongsToGenericExpression(L,r);if(E<=0&&o!=null&&[l.leftBracket,l.comma].indexOf(o.tt)<0){if(L>0){let K=r[L-1],W=z||A?0:1;K.tt==l.space?K.position.length!=W&&this.insertSpaces(t,K.position.line,K.position.column,W-K.position.length):W==1&&this.insertSpaces(t,H.position.line,H.position.column,1)}if(L<r.length-1){let K=r[L+1],W=z?0:1;K.tt==l.space?(A&&L<r.length-2&&r[L+2].tt==l.leftBracket&&(W=0),K.position.length!=W&&this.insertSpaces(t,K.position.line,K.position.column,W-K.position.length)):(A&&K.tt==l.leftBracket&&(W=0),W==1&&this.insertSpaces(t,K.position.line,K.position.column,1))}}}H.tt!=l.space&&H.tt!=l.newline&&(o=H)}return this.deleteOverlappingRanges(t),t}getNextNonSpaceToken(e,t){if(e==t.length-1)return t[e];let i=e+1;for(;i<t.length-1&&t[i].tt==l.space;)i++;return t[i]}lowerBelongsToGenericExpression(e,t){let i=e+1;for(;i<t.length;){let r=t[i].tt;if(r==l.greater)return!0;if([l.space,l.comma,l.identifier].indexOf(r)<0)return!1;i++}return!1}greaterBelongsToGenericExpression(e,t){let i=e-1;for(;i>=0;){let r=t[i].tt;if(r==l.lower)return!0;if([l.space,l.comma,l.identifier].indexOf(r)<0)return!1;i--}return!1}isBinaryOperator(e){return e!=null&&e>=l.modulo&&e<=l.equal}replaceBetween(e,t,i,r){let o={line:e.position.line,column:e.position.column+e.position.length},u={line:t.position.line,column:t.position.column};(o.line!=u.line||u.column-o.column!=r.length)&&this.replace(i,o,u,r)}deleteSpaces(e,t,i,r){e.push({range:{startColumn:i,startLineNumber:t,endColumn:i+r+(i==0?1:0),endLineNumber:t},text:""})}insertSpaces(e,t,i,r){if(r<0){this.deleteSpaces(e,t,i,-r);return}e.push({range:{startColumn:i,startLineNumber:t,endColumn:i,endLineNumber:t},text:" ".repeat(r)})}replace(e,t,i,r){e.push({range:{startColumn:t.column,startLineNumber:t.line,endColumn:i.column,endLineNumber:i.line},text:r})}}class tr{constructor(){w(this,"themes",[]);this.initThemes()}switchTheme(e){for(let t of this.themes)if(t.name==e){this.internalSwitchTheme(t);break}}internalSwitchTheme(e){monaco.editor.setTheme(e.monacoTheme);let t=document.documentElement;for(const i of Object.keys(e.cssColors)){const r=e.cssColors[i];t.style.setProperty(i,r)}}initThemes(){this.themes.push({name:"dark",monacoTheme:"myCustomThemeDark",cssColors:{"--backgroundDark":"#1e1e1e","--backgroundLight":"#252526","--backgroundHeading":"#37373d","--backgroundSelected":"#2a2d2e","--fontColorNormal":"#c2cccc","--fontColorLight":"#e7e7e7","--slider":"#414141","--loginButtonBackgrond":"#59a15d","--loginButtonFontColor":"#000000","--loginMessageColor":"rgb(122, 48, 48)","--loginButtonHover":"#63a867","--loginButtonActive":"#94ffd1","--scrollbar":"#1e1e1e","--scrollbar-thumb":"#3e3e3e","--scrollbar-thumb-hover":"#5e5e5e","--scrollbar-thumb-active":"#7e7e7e","--submenu-hover":"#094771","--submenu-color":"#ffffff","--menuitemsdivider":"#616162","--file-hover":"hsla(0, 0%, 38%, 0.125)","--file-active":"#094771","--file-active-hover":"rgba(9, 71, 113, 0.827)","--file-errorcount":"red","--inplace-editor":"blue","--contextmenu-background":"#3c3c3c","--contextmenu-color":"rgb(212,212,212)","--contextmenu-hover-background":"#094771","--contextmenu-hover-color":"#ffffff","--error-filename":"#2a709e","--error-line-ative":"#094771","--error-line-hover":"rgba(96, 96, 96, 0.125)","--error-position":"#c0802d","--linecolumn":"#14c714","--reveal-error":"rgba(253, 101, 101, 0.745)","--reveal-method":"#2b2b7d2f","--reveal-errorline-background":"red","--reveal-error-whole-line":"rgba(255, 0, 0, 0.555)","--reveal-programpointer":"rgba(111, 214, 27, 0.337)","--reveal-syntaxelement":"rgb(85,85,85)","--margin-breakpoint":"rgba(255, 0, 0, 0.623)","--speedcontrol-bar":"#9d9d9d","--speedcontrol-grip":"#588555","--speedcontrol-grip-hover":"#89d185","--speedcontrol-display-background":"#383838","--speedcontrol-display-border":"#9d9d9d","--editorTooltip-background":"#252526","--editorTooltip-border":"#454545","--renameInput-color":"#ffffff","--bottomdiv-tabheading-hover":"white","--bottomdiv-tabheading-active":"rgb(97,97,255)","--noErrorMessage":"rgb(37, 211, 37)","--console-top-borderbottom":"#c4c4c4","--console-top-background":"#1e1e1e","--consoleEntry-withBorder":"#303030","--consoleEntryValue":"white","--consoleEntryIdentifier":"rgb(156, 156, 235)","--consoleEntryNoValue":"gray","--consoleEntryCaption":"white","--error-Caption":"rgb(166, 165, 176)","--console-error":"rgb(155, 51, 51)","--deIdentifier":"rgb(156, 156, 235)","--deValue":"white","--helper-background-color":"#383838","--helper-border-color":"#d4d4d4","--arrowBoxButtonOuter-background":"#59a15d","--arrowBoxButtonOuter-border":"#3d3d3d","--arrowBoxButtonOuter-color":"black","--arrowBoxButtonOuter-button-hover":"#63a867","--arrowBox-after":"rgba(136, 183, 213, 0)","--arrowBox-before":"rgba(194, 225, 245, 0)","--defaultOutputColor":"#ffffff","--runInputColor":"#ffffff","--runBackgroundColor":"rgba(255, 255, 255, 0.2)","--table-even":"#222","--table-heading":"#202060"}});let e="#8080ff";this.themes.push({name:"light",monacoTheme:"myCustomThemeLight",cssColors:{"--backgroundDark":"white","--backgroundLight":"#f3f3f3","--backgroundHeading":"#dcdcdc","--backgroundSelected":"#e8e8e8","--fontColorNormal":"#000","--fontColorLight":"#303030","--slider":"#b0b0b0","--loginButtonBackgrond":"#59a15d","--loginButtonFontColor":"#000000","--loginMessageColor":"rgb(122, 48, 48)","--loginButtonHover":"#63a867","--loginButtonActive":"#94ffd1","--scrollbar":"#e3e3e3","--scrollbar-thumb":"#bababa","--scrollbar-thumb-hover":"#8e8e8e","--scrollbar-thumb-active":"#616161","--submenu-hover":e,"--submenu-color":"#ffffff","--menuitemsdivider":"#cfcfcf","--file-hover":"#e8e8e8","--file-active":e,"--file-active-hover":"#a0a0ff","--file-errorcount":"red","--inplace-editor":"white","--contextmenu-background":"white","--contextmenu-color":"#756161","--contextmenu-hover-background":e,"--contextmenu-hover-color":"#a0a0ff","--error-filename":"#ff0000","--error-line-ative":"#ffa0a0","--error-line-hover":"#ffc0c0","--error-position":"#804040","--linecolumn":"#14c714","--reveal-error":"rgba(253, 101, 101, 0.745)","--reveal-method":"#babaec80","--reveal-errorline-background":"red","--reveal-error-whole-line":"rgba(255, 0, 0, 0.555)","--reveal-programpointer":"rgba(111, 214, 27, 0.337)","--reveal-syntaxelement":"#c0c0c0","--margin-breakpoint":"rgba(255, 0, 0, 0.623)","--speedcontrol-bar":"#9d9d9d","--speedcontrol-grip":"#588555","--speedcontrol-grip-hover":"#89d185","--speedcontrol-display-background":"#e0e0e0","--speedcontrol-display-border":"#9d9d9d","--editorTooltip-background":"#e0e0e0","--editorTooltip-border":"#9d9d9d","--renameInput-color":"#000000","--bottomdiv-tabheading-hover":"#424242","--bottomdiv-tabheading-active":"#424242","--noErrorMessage":"rgb(17, 180, 17)","--console-top-borderbottom":"#c4c4c4","--console-top-background":"white","--consoleEntry-withBorder":"#303030","--consoleEntryValue":"#0000a0","--consoleEntryIdentifier":"black","--consoleEntryNoValue":"gray","--consoleEntryCaption":"#756161","--error-Caption":"rgb(166, 165, 176)","--console-error":"rgb(155, 21, 21)","--deIdentifier":"black","--deValue":"#0000a0","--helper-background-color":"#f3f3f3","--helper-border-color":"#606060","--arrowBoxButtonOuter-background":"#59a15d","--arrowBoxButtonOuter-border":"#3d3d3d","--arrowBoxButtonOuter-color":"black","--arrowBoxButtonOuter-button-hover":"#63a867","--arrowBox-after":"rgba(136, 183, 213, 0)","--arrowBox-before":"rgba(194, 225, 245, 0)","--defaultOutputColor":"#303030","--runInputColor":"#000000","--runBackgroundColor":"rgba(0, 0, 0, 0.2)","--table-even":"#d1d2e4","--table-heading":"#c3f2b9"}})}}class ir{}const ht=class extends ir{constructor(t,i,r,o,u){super();w(this,"binaryResultTypes",new Map);w(this,"unaryOperators",[]);w(this,"canCastToList");this.name=t,this.parameterDescriptions=i,this.checkFunction=r,this.outputFunction=o,this.canCastToList=u.slice(0);let h=this.canCastToList.indexOf(t);h>=0&&this.canCastToList.splice(h,1)}static fromConstantType(t){switch(t){case l.stringConstant:return this.baseTypeMap.get("text");case l.integerConstant:return this.baseTypeMap.get("integer");case l.floatingPointConstant:return this.baseTypeMap.get("float");case l.charConstant:return this.baseTypeMap.get("text");case l.booleanConstant:return this.baseTypeMap.get("boolean");case l.keywordNull:return this.baseTypeMap.get("null")}}getBaseTypeName(){return this.name}toString(){return this.name}static getBaseType(t){return t!=null&&t.toLocaleLowerCase()=="char"&&(t="varchar"),this.baseTypeMap.get(t.toLocaleLowerCase())}static addBaseTypes(t){ht.baseTypes=ht.baseTypes.concat(t),t.forEach(i=>ht.baseTypeMap.set(i.name,i))}addBinaryOperation(t,i,r,o=!0){Array.isArray(t)||(t=[t]),t.forEach(u=>{let h=this.binaryResultTypes.get(u);h==null&&(h=new Map,this.binaryResultTypes.set(u,h)),h.set(i,r),o&&i!=this&&i.addBinaryOperation(u,this,r,!1)})}canCastTo(t){let i=t instanceof ht?t:t.baseType;return this.canCastToList.indexOf(i.name)>=0||this.name==i.name}getBinaryResultType(t,i){let r=this.binaryResultTypes.get(t);if(r==null)return null;let o=i instanceof ht?i:i.baseType;return r.get(o)}getUnaryResultType(t){if([l.isNull,l.isNotNull].indexOf(t)>=0)return we;if(this.unaryOperators.indexOf(t)>=0)return this}getBinaryResult(t,i,r){switch(t){case l.concatenation:return i!=null&&r!=null?i+r:i??r;case l.plus:return i!=null&&r!=null?i+r:i??r;case l.minus:return i!=null&&r!=null?i-r:i??r;case l.multiplication:return i!=null&&r!=null?i*r:i??r;case l.division:return i!=null&&r!=null?i*r:i??r;case l.keywordAnd:return i!=null&&r!=null?i*r:i??r;case l.keywordOr:return i!=null&&r!=null?Math.max(i,r):i??r;case l.lower:return i!=null&&r!=null?i<r:i==null;case l.greater:return i!=null&&r!=null?i>=r:i==null;case l.lowerOrEqual:return i!=null&&r!=null?i<=r:i==null;case l.greaterOrEqual:return i!=null&&r!=null?i>=r:i==null;case l.equal:return i==r;case l.notEqual:return i!=r}}};let te=ht;w(te,"baseTypes",[]),w(te,"baseTypeMap",new Map);let Ki=[1,10,100,1e3,1e5,1e5,1e6,1e7,1e8,1e9];class Ht extends ir{constructor(t,i){super();w(this,"name");this.baseType=t,this.parameterValues=i;let r=i.join(", ");this.name=t.name+"("+r+")"}toString(){return this.name}getBaseTypeName(){return this.baseType.name}canCastTo(t){let i=t instanceof te?t:t.baseType;return this.baseType.canCastToList.indexOf(i.name)>=0||this.baseType.name==i.name}getBinaryResultType(t,i){let r=this.baseType.binaryResultTypes.get(t);if(r==null)return null;let o=i instanceof te?i:i.baseType,u=r.get(o);if(this.baseType==o&&this.baseType==u&&i instanceof Ht){if(this.baseType.name=="varchar"||t==l.concatenation)return new Ht(this.baseType,[this.parameterValues[0]+i.parameterValues[0]]);if(this.baseType.name=="decimal")return new Ht(this.baseType,[Math.max(this.parameterValues[0],i.parameterValues[0]),Math.max(this.parameterValues[1],i.parameterValues[1])])}return r.get(o)}getUnaryResultType(t){return this.baseType.getUnaryResultType(t)}getBinaryResult(t,i,r){let o=this.baseType.getBinaryResult(t,i,r);return(this.name="varchar")?o==null?null:(""+o).substr(0,this.parameterValues[0]):this.name=="decimal"?o==null?null:Math.round(o*Ki[this.parameterValues[1]])/Ki[this.parameterValues[1]]:o}}let Tt=["varchar","char","text","tinytext","mediumtext","longtext"];var $e=new te("varchar",["Maximale Länge"],(f,e)=>`check(length(${f}) <= ${Math.max(e[0],1)})`,(f,e)=>f.substring(0,Math.max(e[0],1)),Tt),Be=new te("char",["Maximale Länge"],(f,e)=>`check(length(${f}) <= ${Math.max(e[0],1)})`,(f,e)=>f.substring(0,Math.max(e[0],1)),Tt),be=new te("text",["Maximale Länge"],(f,e)=>"",(f,e)=>f,Tt.concat(["time","date","datetime","timestamp"])),Bs=new te("tinyText",[],(f,e)=>"",(f,e)=>f,Tt),Fs=new te("mediumText",[],(f,e)=>"",(f,e)=>f,Tt),Rs=new te("longText",[],(f,e)=>"",(f,e)=>f,Tt);let _t=["decimal","numeric","double","real","float"];var ci=new te("decimal",["Gesamtzahl der Stellen","Nachkommastellen"],(f,e)=>"",(f,e)=>{let t=Math.trunc(f),i=f-t;return""+t+(e[1]>0?"."+Math.round(i*Ki[e[1]]):"")},_t),Ws=new te("numeric",["Gesamtzahl der Stellen","Nachkommastellen"],(f,e)=>"",(f,e)=>""+f,_t),qs=new te("double",["Gesamtzahl der Stellen","Nachkommastellen"],(f,e)=>"",(f,e)=>""+f,_t),Hs=new te("real",[],(f,e)=>"",(f,e)=>""+f,_t),zs=new te("float",[],(f,e)=>"",(f,e)=>""+f,_t);let Us=["int","integer","tinyint","smallint","mediumint","bigint"],Lt=Us.concat(_t);var Ks=new te("int",["Maximale Anzahl der Stellen"],(f,e)=>`check(round(${f}) = ${f})`,(f,e)=>""+Math.round(f),Lt),Vs=new te("integer",["Maximale Anzahl der Stellen"],(f,e)=>`check(round(${f}) = ${f})`,(f,e)=>""+Math.round(f),Lt),Gs=new te("tinyint",["Maximale Anzahl der Stellen"],(f,e)=>`check(round(${f}) = ${f})`,(f,e)=>""+Math.round(f),Lt),Qs=new te("smallint",["Maximale Anzahl der Stellen"],(f,e)=>`check(round(${f}) = ${f})`,(f,e)=>""+Math.round(f),Lt),Xs=new te("mediumint",["Maximale Anzahl der Stellen"],(f,e)=>`check(round(${f}) = ${f})`,(f,e)=>""+Math.round(f),Lt),Js=new te("bigint",["Maximale Anzahl der Stellen"],(f,e)=>`check(round(${f}) = ${f})`,(f,e)=>""+Math.round(f),Lt),nr=new te("time",[],(f,e)=>`check(isTime(${f}))`,(f,e)=>f,[]),rr=new te("date",[],(f,e)=>`check(isDate(${f}))`,(f,e)=>f,[]),sr=new te("datetime",[],(f,e)=>`check(isDateTime(${f}))`,(f,e)=>f,["timestamp"]),or=new te("timestamp",[],(f,e)=>`check(isDateTime(${f}))`,(f,e)=>f,["datetime"]),we=new te("boolean",[],(f,e)=>`check(${f} == 0 or ${f} == 1)`,(f,e)=>f==1?"true":"false",["varchar","text","decimal","numeric"]),Ys=new te("null",[],(f,e)=>"",(f,e)=>f,[]);let Qe=[ci,Ws,qs,Hs,zs,Ks,Vs,Gs,Qs,Xs,Js],ar=[$e,Be,be,Bs,Fs,Rs,nr,rr,sr,or,we,Ys].concat(Qe),qt=[nr,rr,sr,or];te.addBaseTypes(ar);$e.addBinaryOperation(l.concatenation,$e,$e);$e.addBinaryOperation(l.concatenation,Be,$e);$e.addBinaryOperation(l.concatenation,be,be);be.addBinaryOperation(l.concatenation,be,be);$e.addBinaryOperation(l.keywordLike,$e,we);$e.addBinaryOperation(l.keywordLike,be,we);be.addBinaryOperation(l.keywordLike,be,we);Be.addBinaryOperation(l.concatenation,Be,Be);Be.addBinaryOperation(l.concatenation,$e,Be);Be.addBinaryOperation(l.concatenation,be,be);be.addBinaryOperation(l.concatenation,be,be);Be.addBinaryOperation(l.keywordLike,Be,we);Be.addBinaryOperation(l.keywordLike,be,we);be.addBinaryOperation(l.keywordLike,be,we);let lr=[l.plus,l.minus,l.multiplication,l.division,l.modulo],zt=[l.lower,l.lowerOrEqual,l.greater,l.greaterOrEqual,l.equal,l.notEqual];for(let f=0;f<Qe.length;f++){for(let e=f;e<Qe.length;e++)Qe[f].addBinaryOperation(lr,Qe[e],Qe[e]),Qe[f].addBinaryOperation(zt,Qe[e],we);Qe[f].unaryOperators=[l.minus]}ci.addBinaryOperation(lr,ci,ci);let He=[$e,be];for(let f=0;f<He.length;f++)for(let e=f;e<He.length;e++)He[f].addBinaryOperation(l.concatenation,He[e],He[e]),He[f].addBinaryOperation(zt,He[e],we);for(let f=0;f<qt.length;f++){qt[f].addBinaryOperation(zt,qt[f],we);for(let e=0;e<He.length;e++)qt[f].addBinaryOperation(zt,He[e],we),He[e].addBinaryOperation(zt,qt[f],we)}let Zs=[l.keywordAnd,l.keywordOr];we.addBinaryOperation(Zs,we,we);we.unaryOperators=[l.keywordNot];ar.forEach(f=>f.unaryOperators=f.unaryOperators.concat([l.isNull,l.isNotNull]));const St=class{constructor(){w(this,"module");w(this,"pos");w(this,"tokenList");w(this,"errorList");w(this,"lookahead",4);w(this,"ct");w(this,"lastToken");w(this,"cct");w(this,"tt");w(this,"position");w(this,"lastComment");w(this,"endToken",{position:{line:0,column:0,length:1},tt:l.endofSourcecode,value:"das Ende des Programms"});w(this,"beginStatementKeywords",["select","insert into","update","create table","delete from","alter table","drop table"]);w(this,"identifierMap",{year:"int",binary:"varchar",varbinary:"varchar"})}parse(e){if(this.module=e,this.tokenList=e.tokenList,this.errorList=[],e.completionHints=new Map,this.tokenList.length==0){this.module.sqlStatements=[],this.module.errors[1]=this.errorList,this.module.addCompletionHint({line:0,column:0,length:0},{line:2e4,column:100,length:0},!1,!1,this.beginStatementKeywords);return}this.pos=0,this.initializeLookahead();let t=this.tokenList[this.tokenList.length-1];this.endToken.position={line:t.position.line,column:t.position.column+t.position.length,length:1},this.module.sqlStatements=this.parseMain(),this.module.errors[1]=this.errorList}initializeLookahead(){this.ct=[];for(let e=0;e<this.lookahead;e++){let t=this.endToken;for(;!(this.pos>=this.tokenList.length);){let i=this.tokenList[this.pos];if(i.tt==l.comment&&(this.lastComment=i),i.tt!=l.newline&&i.tt!=l.space&&i.tt!=l.comment){t=i,this.lastComment!=null&&(t.commentBefore=this.lastComment,this.lastComment=null);break}this.pos++}this.ct.push(t),e<this.lookahead-1&&this.pos++}this.cct=this.ct[0],this.tt=this.cct.tt,this.position=this.cct.position}nextToken(){let e;for(this.lastToken=this.cct;;){if(this.pos++,this.pos>=this.tokenList.length){e=this.endToken;break}if(e=this.tokenList[this.pos],e.tt==l.comment&&(this.lastComment=e),e.tt!=l.newline&&e.tt!=l.space&&e.tt!=l.comment){e.commentBefore=this.lastComment,this.lastComment=null;break}}for(let t=0;t<this.lookahead-1;t++)this.ct[t]=this.ct[t+1];this.ct[this.lookahead-1]=e,this.cct=this.ct[0],this.tt=this.cct.tt,this.position=this.cct.position}pushError(e,t="error",i,r){i==null&&(i=Object.assign({},this.position)),this.errorList.push({text:e,position:i,quickFix:r,level:t})}skip(e){Array.isArray(e)||(e=[e]),e.indexOf(this.tt)>=0&&this.nextToken()}expect(e,t=!0,i=!1){if(this.tt!=e&&!(Array.isArray(e)&&e.indexOf(this.tt)>=0)){if(e==l.semicolon&&this.tt==l.endofSourcecode)return!0;let r=this.cct.position;e==l.semicolon&&this.lastToken!=null&&this.lastToken.position.line<r.line&&(r={line:this.lastToken.position.line,column:this.lastToken.position.column+this.lastToken.position.length,length:1});let o=null;e==l.semicolon&&this.lastToken.position.line<this.cct.position.line&&!this.isOperatorOrDot(this.lastToken.tt)&&(o={title:"Strichpunkt hier einfügen",editsProvider:h=>[{resource:h,edit:{range:{startLineNumber:r.line,startColumn:r.column,endLineNumber:r.line,endColumn:r.column,message:"",severity:monaco.MarkerSeverity.Error},text:";"}}]},i&&this.module.main.getSemicolonAngel().register(r,this.module));let u;if(Array.isArray(e)){u=e.map(b=>ge[b]);let h=u.join(", ");this.pushError("Erwartet wird eines der folgenden: "+h+" - Gefunden wurde: "+ge[this.tt],"error",r,o)}else u=[ge[e]],this.pushError("Erwartet wird: "+ge[e]+" - Gefunden wurde: "+ge[this.tt],"error",r,o);return!1}return t&&this.nextToken(),!0}getEndOfPosition(e){return{line:e.line,column:e.column+e.length,length:0}}isOperatorOrDot(e){if(e==l.dot)return!0;for(let t of St.operatorPrecedence)for(let i of t)if(e==i)return!0}isEnd(){return this.cct==this.endToken}comesToken(e,t=!1){if(!Array.isArray(e)){let i=this.tt==e;return i&&t&&this.nextToken(),i}return e.indexOf(this.tt)>=0}getCurrentPosition(){return Object.assign({},this.position)}getCurrentPositionPlus(e){if(this.tt==l.endofSourcecode)return{line:this.endToken.position.line,column:100,length:1};let t=0,i=e,r=0;for(;t<this.lookahead-1&&(r=this.ct[t].position.length)<i;)i-=r,t++;let o=this.ct[t].position;return o==null&&(o=this.getCurrentPosition()),{line:o.line,column:o.column+i,length:1}}getEndOfCurrentToken(){let e=this.getCurrentPosition();return e.column=e.column+this.position.length,e.length=0,e}parseMain(){let e=[],t={column:0,line:0,length:0},i=!0;for(this.module.addCompletionHint(t,this.getCurrentPositionPlus(8),!1,!1,this.beginStatementKeywords);!this.isEnd();){let r=this.pos,o=this.errorList.length;for(;[l.space,l.newline,l.comment,l.semicolon].indexOf(this.cct.tt)>=0;)this.nextToken();let u=this.getCurrentPosition(),h=this.parseStatement();for(t={line:this.lastToken.position.line+1,column:0,length:0},i=this.tt==l.semicolon;this.tt==l.semicolon;)this.nextToken();let b=!1;for(let k=o;k<this.errorList.length;k++)this.errorList[k].level=="error"&&(b=!0);if(h!=null&&e.push({ast:h,from:u,to:this.getEndOfPosition(this.lastToken.position),hasErrors:b,acceptedBySQLite:!1}),this.getCurrentPosition(),this.pos==r){let k=[l.keywordSelect,l.keywordUpdate,l.keywordCreate,l.keywordInsert,l.keywordDelete,l.keywordDrop,l.keywordAlter],E=!0;for(;!this.isEnd()&&k.indexOf(this.tt)<0;)[l.space,l.newline].indexOf(this.tt)<0&&E&&(this.pushError("Erwartet wird eines dieser Schlüsselwörter: "+k.map(P=>ge[P]).join(", ")+"; Gefunden wurde: "+this.cct.value),E=!0),this.nextToken()}(i||this.cct.position.line-t.line>0)&&this.module.addCompletionHint(t,this.getCurrentPositionPlus(8),!1,!1,this.beginStatementKeywords)}return this.module.addCompletionHint(t,{line:this.endToken.position.line+1,column:0,length:0},!1,!1,this.beginStatementKeywords),e}parseStatement(e=!0){let t=null;switch(this.tt){case l.keywordSelect:return this.parseSelect();case l.keywordInsert:return this.parseInsert();case l.keywordCreate:return this.parseCreateTableOrDatabase();case l.keywordUpdate:return this.parseUpdate();case l.keywordDelete:return this.parseDelete();case l.keywordDrop:return this.parseDropTable();case l.keywordAlter:return this.parseAlterTable();case l.keywordCommit:return this.pushError("Die Aweisung commit ist unnötig, da jede Anweisung automatisch commited wird.","info"),this.nextToken(),null;case l.keywordSet:return this.parseSet();case l.keywordUse:return this.parseUse();case l.keywordStart:return this.pushError("Die Aweisung 'start transaction' ist unnötig, da jede Anweisung automatisch commited wird.","info"),this.nextToken(),this.expect(l.keywordTransaction,!0),null;case l.keywordLock:case l.keywordUnlock:return this.parseLockUnlock(),null;default:let i=ge[this.tt];i==null&&(i=""),i!=this.cct.value&&(i+="("+this.cct.value+")"),i+=" wird hier nicht erwartet.",this.pushError(i),this.nextToken();break}return t}parseLockUnlock(){this.nextToken(),this.expect(l.keywordTables,!0),this.skip(l.identifier),this.skip([l.keywordWrite,l.keywordRead]),this.skip(l.semicolon)}parseSet(){this.pushError("Das SET-Statement wird von SQLite nicht unterstützt. Diese Anweisung wird daher einfach überlesen.","info");let e={type:l.omittedeStatement,position:this.getCurrentPosition(),endPosition:null,symbolTable:null};return this.nextToken(),this.expect(l.identifier,!0),this.expect(l.equal,!0),this.expect([l.identifier,l.stringConstant,l.integerConstant,l.charConstant,l.booleanConstant,l.floatingPointConstant],!0),e.endPosition=this.getCurrentPosition(),e}parseUse(){this.pushError("Das USE-Statement wird von SQLite nicht unterstützt. Diese Anweisung wird daher einfach überlesen. Sie können eine andere Datenbank auswählen indem Sie in der Datenbankliste links darauf klicken.","info");let e={type:l.omittedeStatement,position:this.getCurrentPosition(),endPosition:null,symbolTable:null};return this.nextToken(),this.expect(l.identifier,!0),e.endPosition=this.getCurrentPosition(),e}parseAlterTable(){let e=this.getCurrentPosition();this.nextToken();let t={type:l.keywordAlter,kind:null,position:e,endPosition:this.getEndOfPosition(this.getCurrentPosition()),symbolTable:null,tableIdentifier:null,tableIdentifierPosition:null};if(this.expect(l.keywordTable,!0)||this.addCompletionHintHere(!1,!1,["table"],1),this.addCompletionHintHere(!1,!0,[],1),!this.expect(l.identifier,!1))return t;switch(t.tableIdentifier=this.cct.value,t.tableIdentifierPosition=this.getCurrentPosition(),this.nextToken(),t.endPosition=this.getCurrentPosition(),this.addCompletionHintHere(!1,!1,["rename to","rename column","add column","drop column"],1),this.tt){case l.keywordRename:this.parseRenameTableOrColumn(t);break;case l.keywordAdd:this.parseAlterTableAdd(t);break;case l.keywordDrop:this.parseDropColumn(t);break;default:this.pushError("Erwartet wird rename to, rename column, add column oder drop column")}return t}parseRenameTableOrColumn(e){switch(this.nextToken(),this.comesToken(l.keywordTo)||this.addCompletionHintHere(e.tableIdentifier,!1,["column","to"],3),e.endPosition=this.getEndOfCurrentToken(),this.tt){case l.keywordTo:this.nextToken(),e.endPosition=this.getEndOfCurrentToken(),e.kind="renameTable",this.comesToken(l.identifier)?(e.newTableName=this.cct.value,this.nextToken(),e.endPosition=this.getEndOfCurrentToken()):this.pushError("Erwartet wird der neue Tabellenname.");return;case l.keywordColumn:if(this.nextToken(),e.endPosition=this.getEndOfCurrentToken(),this.addCompletionHintHere(e.tableIdentifier,!1,[],3),!this.comesToken(l.identifier)){this.pushError("Erwartet wird der Name einer Spalte der Tabelle "+e.tableIdentifier+".");return}if(e.kind="renameColumn",e.oldColumnName=this.cct.value,e.oldColumnPosition=this.getCurrentPosition(),this.nextToken(),this.addCompletionHintHere(!1,!1,["to"],3),e.endPosition=this.getEndOfCurrentToken(),!this.expect(l.keywordTo,!0))return;e.endPosition=this.getEndOfCurrentToken(),this.comesToken(l.identifier)?(e.newColumnName=this.cct.value,this.nextToken(),e.endPosition=this.getEndOfCurrentToken()):this.pushError("Erwartet wird der neue Spaltenname.");return;default:this.pushError("Erwartet wird das Schlüsselwort 'to' (zum Umbenennen der Tabelle) oder das Schlüsselwor 'column' (zum Umbenennen einer Spalte).");return}}parseDropColumn(e){this.nextToken(),this.comesToken(l.keywordColumn,!0),e.oldColumnPosition=this.getCurrentPosition(),this.addCompletionHintHere(e.tableIdentifier,!1,[],3),e.kind="dropColumn",e.endPosition=this.getEndOfCurrentToken(),this.comesToken(l.identifier)?(e.oldColumnName=this.cct.value,this.nextToken()):this.pushError("Erwartet wird der Bezeichner der Spalte, die gelöscht werden soll.")}parseAlterTableAdd(e){do{this.nextToken(),this.comesToken(l.keywordAdd,!0);let t=!1;switch(this.tt){case l.keywordColumn:this.parseAddColumn(e);break;case l.keywordPrimary:this.parseAddPrimaryKey(e);break;case l.keywordUnique:this.nextToken(),t=!0,this.expect([l.keywordIndex,l.keywordKey],!1);case l.keywordKey:case l.keywordIndex:this.parseAddIndex(e,t);break;case l.keywordModify:this.parseModifyColumn(e);break;case l.keywordConstraint:this.parseAddConstraint(e);break}}while(this.tt==l.comma)}parseAddConstraint(e){if(this.nextToken(),!!this.expect(l.identifier)&&this.comesToken(l.keywordForeign)){let t=this.parseForeignKeyDefinition();t!=null&&(e.foreignKeys==null&&(e.foreignKeys=[]),e.foreignKeys.push(t),e.kind="omittedKind")}}parseForeignKeyDefinition(){let e={column:"",referencesTable:"",referencesColumn:"",referencesPosition:this.getCurrentPosition()};if(this.expect(l.keywordForeign)&&this.expect(l.keywordKey)&&this.expect(l.leftBracket)){if(!this.comesToken(l.identifier)){this.pushError("Der Bezeichner der Fremdschlüsselspalte wird erwartet.");return}if(e.column=this.cct.value,this.nextToken(),!!this.expect(l.rightBracket))return this.parseReferences(e),e}}parseReferences(e){if(!this.expect(l.keywordReferences))return;if(this.addCompletionHintHere(!1,!0,[]),!this.comesToken(l.identifier)){this.pushError("Der Bezeichner der referenzierten Tabelle wird erwartet.");return}e.referencesTable=this.cct.value,this.nextToken();let t=this.lastToken.position,i=this.getCurrentPosition();if(this.module.addCompletionHint(this.getEndOfPosition(t),i,e.referencesTable,!1,[]),!!this.expect(l.leftBracket)){if(!this.comesToken(l.identifier)){this.pushError("Der Bezeichner der referenzierten Spalte wird erwartet.");return}if(e.referencesColumn=this.cct.value,this.nextToken(),!!this.expect(l.rightBracket))for(;this.tt==l.keywordOn;){this.nextToken();let r="";switch(this.tt){case l.keywordDelete:r="onDelete";break;case l.keywordUpdate:r="onUpdate";break}switch(r==""?(this.pushError("Nach 'on' wird 'delete' oder 'update' erwartet."),this.comesToken([l.keywordCascade,l.keywordRestrict,l.keywordSet,l.keywordNo])||(this.nextToken(),r="onDelete")):this.nextToken(),this.tt){case l.keywordCascade:case l.keywordRestrict:e[r]=this.cct.value,this.nextToken();break;case l.keywordSet:e[r]="set ",this.nextToken(),[l.keywordNull,l.keywordDefault].indexOf(this.tt)>=0?(e[r]+=this.cct.value,this.nextToken()):this.pushError("Nach 'on delete/update set' wird 'null' oder 'default' erwartet.");break;case l.keywordNo:this.nextToken(),this.expect(l.keywordAction),e[r]="no action";break;default:this.pushError("Nach 'on delete/update' wird 'cascade', 'set null', 'set default' oder 'no action' erwartet.");break}}}}parseModifyColumn(e){this.nextToken();let t=this.parseColumnDefinition(!1);t!=null&&(e.modifyColumnInfo==null&&(e.modifyColumnInfo=[]),e.modifyColumnInfo.push(t))}parseAddPrimaryKey(e){if(this.nextToken(),e.primaryKeys=[],this.expect(l.keywordKey,!0)&&this.expect(l.leftBracket,!1))do this.nextToken(),this.tt==l.identifier&&(e.primaryKeys.push(this.cct.value),this.nextToken());while(this.tt==l.comma);return this.expect(l.rightBracket,!0)?(e.kind="omittedKind",e):null}parseAddIndex(e,t){this.nextToken();let i={index_name:"",column:"",unique:t};if(this.tt==l.identifier)i.index_name=this.cct.value,this.nextToken();else return this.pushError("Erwartet wird der Bezeichner des Index."),null;if(!this.expect(l.leftBracket,!0))return null;if(this.tt==l.identifier)i.column=this.cct.value,this.nextToken(),e.indices==null&&(e.indices=[]),e.indices.push(i);else return this.pushError("Erwartet wird der Bezeichner der Spalte, für die ein Index erstellt werden soll."),null;return e.kind="omittedKind",this.expect(l.rightBracket,!0),null}parseAddColumn(e){e.kind="addColumn",this.comesToken(l.keywordColumn,!0),e.columnDefBegin=this.getCurrentPosition(),e.columnDef=this.parseColumnDefinition(!1)}parseDropTable(){let e=this.getCurrentPosition();this.nextToken();let t={type:l.keywordDrop,position:e,endPosition:this.getEndOfPosition(this.getCurrentPosition()),symbolTable:null,tableIdentifier:null,tableIdentifierPosition:null,ifExists:!1};return this.expect(l.keywordTable,!0)||this.addCompletionHintHere(!1,!1,["table"],1),this.comesToken(l.keywordIf,!0)&&(t.ifExists=!0,this.expect(l.keywordExists,!0)),this.addCompletionHintHere(!1,!0,[],1,"",";"),this.expect(l.identifier,!1)&&(t.tableIdentifier=this.cct.value,t.tableIdentifierPosition=this.getCurrentPosition(),this.nextToken(),t.endPosition=this.getCurrentPosition()),t}parseDelete(){let e=this.getCurrentPosition();this.nextToken();let t={type:l.keywordDelete,position:e,endPosition:this.getEndOfPosition(this.getCurrentPosition()),symbolTable:null,tableIdentifier:null,tableIdentifierPosition:null,whereNode:null,whereNodeBegin:null,whereNodeEnd:null};return this.expect(l.keywordFrom,!0)||this.addCompletionHintHere(!1,!1,["from"],1),this.addCompletionHintHere(!1,!0,[],1,"",` where
	`),!this.expect(l.identifier,!1)||(t.tableIdentifier=this.cct.value,t.tableIdentifierPosition=this.getCurrentPosition(),this.nextToken(),t.endPosition=this.getCurrentPosition(),this.addCompletionHintHere(!1,!1,[`where
	`],1),this.tt!=l.keywordWhere)||(this.nextToken(),t.endPosition=this.getCurrentPosition(),t.whereNodeBegin=this.getEndOfPosition(this.lastToken.position),t.whereNode=this.parseTerm(),t.whereNodeEnd=this.getCurrentPosition(),this.module.addCompletionHint(t.whereNodeBegin,this.getCurrentPositionPlus(3),t.tableIdentifier,!1,[]),t.endPosition=this.getCurrentPosition()),t}parseUpdate(){let e=this.getCurrentPosition();this.nextToken();let t={type:l.keywordUpdate,position:e,endPosition:this.getEndOfPosition(this.getCurrentPosition()),symbolTable:null,tableIdentifier:null,tableIdentifierPosition:null,columnIdentifiers:[],columnIdentifierPositions:[],values:[],valuePosBegin:[],valuePosEnd:[],whereNode:null,whereNodeBegin:null,whereNodeEnd:null};if(this.addCompletionHintHere(!1,!0,[],1,"",` set
	`),!this.expect(l.identifier,!1)||(t.tableIdentifier=this.cct.value,t.tableIdentifierPosition=this.getCurrentPosition(),this.nextToken(),t.endPosition=this.getCurrentPosition(),this.addCompletionHintHere(!1,!1,[`set
	`],1),!this.expect(l.keywordSet)))return t;let i=!0;do{if(this.addCompletionHintHere(t.tableIdentifier,!1,i?[]:["where"],1,null," = "),i=!1,this.tt!=l.identifier){this.pushError("Hier wird der Bezeichner derjenigen Spalte der Tabelle "+t.tableIdentifier+" erwaretet, deren Wert verändert werden soll.","error");break}t.columnIdentifiers.push(this.cct.value),t.columnIdentifierPositions.push(this.getCurrentPosition()),this.nextToken(),this.expect(l.equal,!0),t.valuePosBegin.push(this.getCurrentPosition()),t.values.push(this.parseTerm()),t.valuePosEnd.push(this.getCurrentPosition())}while(this.comesToken(l.comma,!0));if(t.endPosition=this.getCurrentPosition(),this.lastToken.tt!=l.comma||this.comesToken(l.keywordWhere)){if(!this.expect(l.keywordWhere,!0))return t;t.whereNodeBegin=this.getEndOfPosition(this.lastToken.position),t.whereNode=this.parseTerm(),t.whereNodeEnd=this.getCurrentPosition(),this.module.addCompletionHint(t.whereNodeBegin,t.whereNodeEnd,t.tableIdentifier,!1,[]),t.endPosition=this.getCurrentPosition()}else this.comesToken(l.keywordWhere,!0);return t}parseCreateTableOrDatabase(){switch(this.ct[1].tt){case l.keywordDatabase:return this.parseCreateDatabase();case l.keywordTable:return this.parseCreateTable();default:return this.nextToken(),this.pushError("Nach 'create' wird 'table' erwartet."),this.nextToken(),null}}parseCreateDatabase(){let e={type:l.omittedeStatement,position:this.getCurrentPosition(),endPosition:null,symbolTable:null};for(this.nextToken(),this.pushError("Die CREATE-DATABASE-Anweisung wird von der SQLite-Engine nicht unterstützt. Sie können eine neue Datenbank anlegen, indem Sie auf den entsprechenden Button oberhalb der Liste der Datenbanken (linke Seite des Fensters) klicken. Diese Anweisung wird überlesen.","info");this.tt!=l.semicolon&&this.tt!=l.endofSourcecode;)e.endPosition=this.getEndOfCurrentToken(),this.nextToken();return e}parseCreateTable(){let e=this.getCurrentPosition();this.nextToken(),this.expect(l.keywordTable,!0)||this.module.addCompletionHint(e,this.getCurrentPositionPlus(3),!1,!1,["table"]);let t=!1;this.comesToken(l.keywordIf)&&(this.nextToken(),this.expect(l.keywordNot,!0),this.expect(l.keywordExists,!0),t=!0);let i="";if(this.expect(l.identifier,!1)){i=this.cct.value;let h=this.getCurrentPosition(),b=this.getCurrentPositionPlus(i.length+3);this.nextToken(),this.comesToken(l.leftBracket)||this.module.addCompletionHint(h,b,!1,!1,["("])}let r={type:l.keywordCreate,identifier:i,position:e,endPosition:null,columnList:[],symbolTable:null,combinedPrimaryKeyColumns:[],foreignKeyInfoList:[],ifNotExists:t,uniqueConstraints:[]};if(!this.expect(l.leftBracket,!0))return r;let o=!1,u=!0;for(;this.tt!=l.rightBracket;){switch(u||this.expect(l.comma,!0),u=!1,this.comesToken(l.keywordConstraint,!0)&&(this.expect(l.identifier,!0),this.expect([l.keywordForeign,l.keywordPrimary,l.keywordUnique],!1)),this.tt){case l.keywordPrimary:o&&this.pushError("Je Tabelle darf nur ein einziger Primärschlüssel definiert werden.","error",this.getCurrentPosition()),this.parsePrimaryKeyTerm(o,r),o=!0;break;case l.keywordUnique:this.parseUniqueTerm(r);break;case l.keywordForeign:let h=this.parseForeignKeyDefinition();h!=null&&r.foreignKeyInfoList.push(h);break;case l.identifier:let b=this.parseColumnDefinition(o);r.columnList.push(b),o=o||b.isPrimary;break;default:this.pushError(ge[this.tt]+" wird hier nicht erwartet.","error");break}if(!this.comesToken(l.comma))break}for(this.expect(l.rightBracket,!0);[l.keywordAutoincrement,l.keywordEngine,l.keywordDefault,l.keywordCollate].indexOf(this.tt)>=0;)switch(this.tt){case l.keywordCollate:this.nextToken(),this.skip(l.equal),this.expect(l.identifier,!0);break;case l.keywordEngine:this.nextToken(),this.skip(l.equal),this.expect(l.identifier,!0);break;case l.keywordDefault:this.nextToken(),this.expect([l.keywordCharset,l.keywordCharacter],!0),this.skip(l.keywordSet),this.skip(l.equal),this.expect(l.identifier,!0);break;case l.keywordAutoincrement:this.nextToken(),this.expect(l.equal,!0),this.expect(l.integerConstant,!0);break}for(let h of r.columnList)h.isAutoIncrement&&!(h.isPrimary||r.combinedPrimaryKeyColumns.indexOf(h.identifier)>=0)&&this.pushError("autoincrement gibt es nur bei Primärschlüsseln, d.h. es fehlt wahrscheinlich 'primary key'.","warning",r.position);return r.endPosition=this.getCurrentPosition(),r}parsePrimaryKeyTerm(e,t){e&&this.pushError("Die Tabelle kann nur einen einzigen Primärschlüssel haben."),this.nextToken(),this.expect(l.keywordKey,!0);let i=t.columnList.map(r=>r.identifier);if(this.addCompletionHintHere(!1,!1,i),this.comesToken(l.leftBracket)){for(this.addCompletionHintHere(!1,!1,i),this.nextToken();;)if(this.comesToken(l.identifier))if(t.combinedPrimaryKeyColumns.push(this.cct.value),this.nextToken(),this.addCompletionHintHere(!1,!1,i,1),this.comesToken(l.comma))this.nextToken(),this.addCompletionHintHere(!1,!1,i);else break;else{this.pushError("Der Bezeichner einer Spalte wird erwartet. Gefunden wurde: "+this.cct.value);break}this.expect(l.rightBracket,!0)}else this.pushError("( erwartet.")}parseUniqueTerm(e){this.nextToken();let t=e.columnList.map(r=>r.identifier),i=[];if(e.uniqueConstraints.push(i),this.addCompletionHintHere(!1,!1,t),this.comesToken(l.leftBracket)){for(this.addCompletionHintHere(!1,!1,t),this.nextToken();;)if(this.comesToken(l.identifier))if(i.push(this.cct.value),this.nextToken(),this.addCompletionHintHere(!1,!1,t,1),this.comesToken(l.comma))this.nextToken(),this.addCompletionHintHere(!1,!1,t);else break;else{this.pushError("Der Bezeichner einer Spalte wird erwartet. Gefunden wurde: "+this.cct.value);break}this.expect(l.rightBracket,!0)}else this.pushError("( erwartet.")}parseColumnDefinition(e){let t=this.getCurrentPosition(),i=this.cct.value;this.nextToken();let r={type:l.columnDef,identifier:i,isPrimary:!1,isAutoIncrement:!1,position:t,baseType:null,notNull:!1};return this.parseType(r,e),r}addCompletionHintHere(e,t,i,r=0,o="",u=""){let h=this.lastToken.position,b=this.getCurrentPosition();b.column+=1+r,this.module.addCompletionHint(this.getEndOfPosition(h),b,e,t,i,null,o,u)}parseType(e,t){let i=te.baseTypes.map(k=>k.toString());if(this.addCompletionHintHere(!1,!1,i),!this.expect(l.identifier,!1)){this.pushError("Erwartet wird ein Datentyp. Gefunden wurde: "+this.cct.value);return}let r=this.cct.value,o=this.getCurrentPosition(),u=this.identifierMap[r.toLocaleLowerCase()];u!=null&&(r=u);let h=te.getBaseType(r);if(h==null&&this.pushError("Erwartet wird ein Datentyp. Gefunden wurde: "+r),e.baseType=h,this.nextToken(),this.tt==l.leftBracket){for(this.nextToken(),e.parameters=[];this.tt==l.integerConstant&&(e.parameters.push(this.cct.value),this.nextToken(),this.tt==l.comma);)if(this.nextToken(),this.tt!=l.integerConstant){this.pushError("Erwartet wird eine ganze Zahl, gefunden wurde: "+this.cct.value);break}h!=null&&e.parameters.length>h.parameterDescriptions.length&&this.pushError("Der Datentyp "+h.toString()+" hat höchstens "+h.parameterDescriptions.length+" Parameter."),this.expect(l.rightBracket,!0)}if(r!=null&&e.parameters==null)switch(r.toLocaleLowerCase()){case"char":e.parameters=[1];break;case"varchar":e.parameters=[1],this.pushError("Hinter dem Datentyp varchar wird zwingend eine Längenangabe in Klammern erwaretet, also z.B. varchar(30)","error",o);break}this.addCompletionHintHere(!1,!1,["primary key","references","not null"]);let b=[];for(;[l.keywordOn,l.keywordCharacter,l.keywordComment,l.keywordAutoincrement,l.keywordKey,l.keywordPrimary,l.keywordNot,l.keywordReferences,l.keywordCollate,l.keywordDefault].indexOf(this.tt)>=0;)switch(b.indexOf(this.tt)>=0&&this.pushError("Das Schlüsselwort "+ge[this.tt]+" darf bei der Definition einer Spalte nicht öfters als ein Mal vorkommen."),b.push(this.tt),this.tt){case l.keywordAutoincrement:this.nextToken(),e.isAutoIncrement=!0,this.tt==l.equal?(this.nextToken(),this.expect(l.integerConstant)):this.tt==l.comma&&this.ct[1].tt==l.keywordAutoincrement&&this.nextToken();break;case l.keywordPrimary:t&&this.pushError("In einer Tabelle darf es nur einen einzigen primary key geben."),this.nextToken(),this.expect(l.keywordKey,!0)?this.addCompletionHintHere(!1,!1,[`autoincrement, 
`]):this.addCompletionHintHere(!1,!1,["key"]),e.isPrimary=!0;break;case l.keywordReferences:let k={column:e.identifier,referencesColumn:"",referencesTable:"",referencesPosition:this.getCurrentPosition()};e.foreignKeyInfo=k,this.parseReferences(k);break;case l.keywordNot:this.nextToken(),this.expect(l.keywordNull,!0)?this.addCompletionHintHere(!1,!1,["references"]):this.addCompletionHintHere(!1,!1,["null"]),e.notNull=!0;break;case l.keywordCollate:this.nextToken(),e.collate=this.cct.value,this.expect(l.identifier,!0);break;case l.keywordCharacter:this.nextToken(),this.expect(l.keywordSet,!0),this.expect(l.identifier,!0);break;case l.keywordDefault:if(this.nextToken(),this.ct[1].tt==l.leftBracket&&this.ct[2].tt==l.rightBracket){this.nextToken(),this.nextToken(),this.nextToken();break}if(e.defaultValue=this.cct.value,typeof this.cct.value=="string"&&e.defaultValue.toLowerCase()!="null"&&(e.defaultValue="'"+e.defaultValue+"'"),this.tt==l.keywordNull){this.nextToken();break}else[l.identifier,l.integerConstant,l.floatingPointConstant,l.stringConstant].indexOf(this.tt)>=0&&(te.fromConstantType(this.tt).canCastTo(h)||this.pushError("Die Konstante hinter 'default' passt nicht zum Datentyp der Spalte."),this.nextToken());break;case l.keywordComment:this.nextToken(),this.expect(l.stringConstant,!0);break;case l.keywordOn:for(this.nextToken(),this.expect([l.keywordUpdate],!0);!this.comesToken([l.comma,l.endofSourcecode,l.rightBracket]);)this.nextToken();this.lastToken.tt==l.leftBracket&&this.tt==l.rightBracket&&this.nextToken();break}}parseInsert(){let e=this.getCurrentPosition(),t=e;this.nextToken(),this.expect(l.keywordInto,!0);let i={type:l.keywordInsert,position:e,endPosition:this.getCurrentPosition(),valuesPosition:null,columnsPosition:null,symbolTable:null,columnList:[],values:[],table:null};if(this.tt==l.identifier?(i.table={type:l.table,identifier:this.cct.value,alias:null,position:this.getCurrentPosition()},i.columnsPosition={line:i.table.position.line,column:i.table.position.column+i.table.position.length,length:0},this.nextToken()):this.pushError("Hier wird der Bezeichner einer Tabelle erwartet. Gefunden wurde: "+this.cct.value,"error"),this.tt==l.leftBracket){this.nextToken();let r=!0;for(;r||this.tt==l.comma;)r||this.nextToken(),r=!1,this.tt==l.identifier?i.columnList.push({type:l.identifier,identifier:this.cct.value+"",position:this.getCurrentPosition()}):this.pushError("Erwartet wird der Bezeichner einer Spalte. Gefunden wurde: "+this.cct.value,"error"),this.nextToken();t=this.getCurrentPosition(),this.expect(l.rightBracket,!0)}switch(i.valuesPosition=this.getCurrentPosition(),this.tt){case l.keywordValues:this.nextToken(),this.parseValueLists(i.values);break;case l.keywordSelect:case l.leftBracket:if(this.getCurrentPosition().line<=t.line+1){let r=this.parseSelect();i.select=r}break}return i.endPosition=this.getCurrentPosition(),i}parseValueLists(e){let t=[l.keywordNull,l.charConstant,l.stringConstant,l.booleanConstant,l.floatingPointConstant,l.integerConstant],i=!0;for(;i||this.tt==l.comma;){i||this.nextToken(),i=!1;let r=this.getCurrentPosition();if(!this.expect(l.leftBracket,!0))break;let o=[],u=!0;for(;u||this.tt==l.comma;){if(u||this.nextToken(),u=!1,this.tt==l.identifier)if(this.cct.isDoubleQuotedIdentifier)this.tt=l.stringConstant;else{let h=(this.cct.value+"").toLocaleLowerCase();["date","_binary"].indexOf(h)>=0&&this.nextToken()}t.indexOf(this.tt)<0?(this.pushError("Erwartet wird eine Konstante oder null. Gefunden wurde: "+this.cct.value,"error"),this.nextToken()):(o.push({constantType:this.tt,position:this.getCurrentPosition(),constant:this.cct.value,type:l.constantNode}),this.nextToken())}this.expect(l.rightBracket,!0),o.length==0?this.pushError("Eine Zeile kann nur dann in die Tabelle eingefügt werden, wenn sie mindestens einen Spaltenwert besitzt.","error",r):e.push(o)}}parseConstant(){let e={constantType:this.tt,position:this.getCurrentPosition(),constant:this.cct.value,type:l.constantNode};return this.nextToken(),e}parseSelect(){let e=this.getCurrentPosition();this.nextToken();let t={line:e.line,column:e.column+6,length:1},i={type:l.keywordSelect,position:e,endPosition:this.getCurrentPosition(),symbolTable:null,columnList:[],fromNode:null,whereNode:null,parentStatement:null};i.columnList=this.parseColumnList([l.keywordFrom,l.semicolon,l.endofSourcecode],!0);let r=["distinct","as","*","from"];i.columnList.findIndex(k=>k.type==l.allColumns)>=0&&(r=["from"]),this.module.addCompletionHint(t,this.getCurrentPositionPlus(2),!0,!0,r);let o=this.comesToken(l.keywordFrom,!0),u=["where","join","left","right","inner","outer","natural","on","as",", "];if(!o)r.unshift("from");else{i.fromStartPosition={line:this.lastToken.position.line,column:this.lastToken.position.column+this.lastToken.position.length,length:0};let k=[];i.fromNode=this.parseTableOrSubQuery(k),u.splice(u.indexOf(this.lastToken.value+""),1);let E=this.getCurrentPositionPlus(2);this.comesToken(l.semicolon)&&(E=this.getCurrentPosition()),this.module.addCompletionHint(i.fromStartPosition,E,!1,!0,u,k),i.fromEndPosition=this.getCurrentPosition()}let h=["like"];if(this.tt==l.keywordWhere){this.getCurrentPosition();let k=this.getCurrentPosition();this.nextToken(),i.whereNode=this.parseTerm(),this.module.addCompletionHint(k,this.getCurrentPositionPlus(4),!0,!0,h)}else u.push("where");let b=[];if(this.tt==l.keywordGroup){let k=this.getCurrentPosition();i.groupByNode=this.parseGroupBy(),this.module.addCompletionHint(k,this.getCurrentPosition(),!0,!0,b)}else h.push("group by");if(this.tt==l.keywordOrder){let k=this.getCurrentPosition();i.orderByNode=this.parseOrderBy(),this.module.addCompletionHint(k,this.getCurrentPosition(),!0,!0,["asc","desc"])}else h.push("order by"),b.push("order by");return this.tt==l.keywordLimit&&(i.limitNode=this.parseLimit()),i.endPosition=this.getCurrentPosition(),i.endPosition.column+=3,i}parseLimit(){let e=this.getCurrentPosition();this.nextToken();let t=this.parseTerm(),i={type:l.keywordLimit,position:e,numberOfRows:t};return this.tt==l.keywordOffset&&(this.nextToken(),i.offset=this.parseTerm()),i}parseGroupBy(){let e=this.getCurrentPosition();this.expect(l.keywordGroup,!0),this.expect(l.keywordBy,!0);let t={type:l.keywordGroup,columnList:[],position:e},i=[l.keywordHaving,l.keywordSelect,l.keywordOrder,l.keywordLimit,l.rightBracket,l.semicolon];return t.columnList=this.parseColumnList(i,!1).map(r=>r.term),this.tt==l.keywordHaving&&(this.nextToken(),t.having=this.parseTerm()),t}parseOrderBy(){this.expect(l.keywordOrder,!0),this.expect(l.keywordBy,!0);let e=[],t=!0;do{t?t=!1:this.expect(l.comma,!0);let i=this.parseTerm(),r={type:l.keywordOrder,position:this.getCurrentPosition(),column:i};[l.keywordAscending,l.keywordDescending].indexOf(this.tt)>=0&&this.nextToken(),this.tt==l.keywordNulls&&(this.nextToken(),this.expect([l.keywordFirst,l.keywordLast],!0)),e.push(r)}while(this.tt==l.comma);return e}parseTableOrSubQuery(e){let t=this.parseAtomicTableOrSubQuery(e),i=this.getCurrentPosition();for(;this.parseJoinOperator();){let r=this.parseAtomicTableOrSubQuery(e);t={type:l.keywordJoin,firstOperand:t,secondOperand:r,position:i},this.tt==l.keywordOn&&(t.on=this.parseTerm())}return t}parseJoinOperator(){if(this.tt==l.comma)return this.nextToken(),!0;switch(this.tt==l.keywordNatural&&this.nextToken(),this.tt){case l.keywordLeft:return this.nextToken(),this.tt==l.keywordOuter&&this.nextToken(),this.expect(l.keywordJoin,!0);case l.keywordInner:case l.keywordCross:return this.nextToken(),this.expect(l.keywordJoin,!0);case l.keywordJoin:return this.nextToken(),!0;default:return!1}}parseAtomicTableOrSubQuery(e){if(!this.expect([l.identifier,l.leftBracket],!1))return null;if(this.tt==l.leftBracket){this.nextToken();let t;if(this.tt==l.keywordSelect){let i=this.getCurrentPosition(),r=this.parseSelect();t={type:l.subquery,alias:null,position:i,query:r}}else t=this.parseTableOrSubQuery(e);return this.expect(l.rightBracket,!0),this.tt==l.keywordAs&&t.type==l.subquery&&(this.nextToken(),this.expect(l.identifier,!1)&&(t.alias=this.cct.value,this.nextToken(),e.push(t.alias))),t}if(this.tt==l.identifier){let t={type:l.table,identifier:this.cct.value,alias:null,position:this.getCurrentPosition()};return e.push(t.identifier),this.nextToken(),this.tt==l.keywordAs&&(this.nextToken(),this.expect(l.identifier,!1)&&(t.alias=this.cct.value,this.nextToken(),e.push(t.alias))),t}}parseColumnList(e,t){let i=[];for(;[l.stringConstant,l.integerConstant,l.floatingPointConstant,l.booleanConstant,l.identifier,l.multiplication,l.leftBracket,l.keywordDistinct].indexOf(this.tt)>=0;){if(this.tt==l.multiplication)i.push({term:null,alias:null,distinct:!1,position:this.getCurrentPosition(),type:l.allColumns}),this.nextToken();else{let r=this.comesToken(l.keywordDistinct,!0),o=this.parseTerm();if(o!=null){let u={type:l.column,term:o,distinct:r,position:o.position};i.push(u),this.comesToken(l.keywordAs)&&(this.nextToken(),this.expect(l.identifier,!1)&&(u.alias=""+this.cct.value),this.nextToken())}}if(e.indexOf(this.tt)>=0||this.isEnd())break;this.expect(l.comma,!0)}return i.length==0&&this.pushError("Es fehlt die kommaseparierte Liste der gewünschten Spalten.","error"),i}parseTerm(){return this.parseTermBinary(0)}parseTermBinary(e){let t;e<St.operatorPrecedence.length-1?t=this.parseTermBinary(e+1):t=this.parseUnary();let i=St.operatorPrecedence[e];if(t==null||i.indexOf(this.tt)<0)return t;let r=!0;for(;r||i.indexOf(this.tt)>=0;){let o=this.tt;r=!1;let u=this.getCurrentPosition();this.nextToken();let h;e<St.operatorPrecedence.length-1?h=this.parseTermBinary(e+1):h=this.parseUnary(),t={type:l.binaryOp,position:u,operator:o,firstOperand:t,secondOperand:h}}return t}parseUnary(){let e,t=this.getCurrentPosition();switch(this.tt){case l.leftBracket:return this.parseBracket();case l.keywordNot:return t=t,this.nextToken(),e=this.parseTermBinary(2),{type:l.unaryOp,position:t,operand:e,operator:l.keywordNot};case l.minus:t=t;let i=this.tt;return this.nextToken(),e=this.parseUnary(),{type:l.unaryOp,position:t,operand:e,operator:i};case l.integerConstant:case l.charConstant:case l.floatingPointConstant:case l.stringConstant:case l.booleanConstant:e={type:l.constantNode,position:this.getCurrentPosition(),constantType:this.tt,constant:this.cct.value};let r=this.tt==l.stringConstant;return this.nextToken(),r?this.parseDotOrArrayChains(e):e;case l.identifier:let o=this.cct.value,u=this.getCurrentPosition();if(this.nextToken(),this.tt==l.leftBracket){let h=this.parseMethodCallParameters(),b=h.rightBracketPosition;e={type:l.callMethod,position:u,rightBracketPosition:b,operands:h.nodes,identifier:o,commaPositions:h.commaPositions}}else if(e={type:l.identifier,identifier:o,position:t},this.tt==l.dot){let h=this.getCurrentPosition();this.nextToken(),this.expect(l.identifier,!1);let b={type:l.identifier,identifier:this.cct.value,position:this.getCurrentPosition()};this.nextToken(),e={type:l.dot,identifierLeft:e,identifierRight:b,position:h}}else[l.isNull,l.isNotNull].indexOf(this.tt)>=0&&(e={type:l.unaryOp,operand:e,operator:this.tt,position:t},this.nextToken());return e;default:return this.pushError("Erwartet wird eine Variable, ein Methodenaufruf oder eine Konstante. Gefunden wurde: "+this.cct.value),null}}parseList(){let e={type:l.list,position:this.getCurrentPosition(),elements:[]},t=[l.charConstant,l.stringConstant,l.booleanConstant,l.floatingPointConstant,l.integerConstant];for(;t.indexOf(this.tt)>=0&&(e.elements.push({type:l.constantNode,constant:this.cct.value,constantType:this.tt,position:this.cct.position}),this.nextToken(),this.tt==l.comma);)this.nextToken();return e}parseBracket(){this.getCurrentPosition();let e=this.lastToken;if(this.nextToken(),this.tt==l.keywordSelect){let t=this.parseSelect();return this.expect(l.rightBracket,!0),t}else if([l.comma,l.rightBracket].indexOf(this.ct[1].tt)>=0&&[l.keywordIn,l.keywordNotIn].indexOf(e.tt)>=0){let t=this.parseList();return this.expect(l.rightBracket,!0),t}else{let t=this.parseTerm(),i=this.getCurrentPosition();return this.expect(l.rightBracket,!0),{position:i,type:l.rightBracket,termInsideBrackets:t}}}parseMethodCallParameters(){if(this.nextToken(),this.tt==l.rightBracket){let o=this.getCurrentPosition();return this.nextToken(),{rightBracketPosition:o,nodes:[],commaPositions:[]}}let e=[],t=[];for(;;){let o=this.pos;if(this.tt==l.multiplication)this.nextToken(),e.push({type:l.allColumns,position:this.getCurrentPosition()});else{let u=this.parseTerm();u!=null&&e.push(u)}if(this.tt!=l.comma)break;t.push(this.getCurrentPosition()),this.nextToken(),this.pos==o&&this.nextToken()}let i=this.getCurrentPosition();return{rightBracketPosition:this.expect(l.rightBracket,!0)?i:null,nodes:e,commaPositions:t}}parseDotOrArrayChains(e){if(e==null)return null;for(;this.comesToken([l.dot,l.leftSquareBracket]);)if(this.tt==l.dot){if(this.nextToken(),this.tt!=l.identifier)return this.pushError("Erwartet wird der Bezeichner eines Attributs oder einer Methode, gefunden wurde: "+this.cct.value),e;let t=this.cct.value,i=this.getCurrentPosition();if(this.nextToken(),this.tt==l.leftBracket){let r=this.parseMethodCallParameters();e={type:l.callMethod,position:i,rightBracketPosition:r.rightBracketPosition,operands:r.nodes,identifier:t,commaPositions:r.commaPositions}}}return e}};let Ut=St;w(Ut,"operatorPrecedence",[[l.keywordOr],[l.keywordAnd],[l.lower,l.lowerOrEqual,l.greater,l.greaterOrEqual,l.equal,l.notEqual,l.keywordLike],[l.concatenation,l.plus,l.minus],[l.multiplication,l.division,l.modulo],[l.keywordIn,l.keywordNotIn]]);class Kt{constructor(e,t,i,r,o,u,h){w(this,"references");w(this,"fromColumnStructure");w(this,"notNull");this.identifier=e,this.type=t,this.table=i,this.isPrimaryKey=r,this.isNullable=o,this.defaultValue=u,this.isAutoIncrement=h}static fromColumnStructure(e,t){let i=/^(\w*) *(?:\((.*)\))?.*$/,r=e.completeTypeSQL.match(i),o=r[1],u=r[2],h=[];u!=null&&(h=u.split(",").map(E=>parseInt(E.trim())));let b=te.getBaseType(o);h.length>0&&b!=null&&(b=new Ht(b,h));let k=new Kt(e.name,b,t,e.isPrimaryKey,!e.isPrimaryKey,e.defaultValue,e.isAutoIncrement);return k.notNull=e.notNull,k.fromColumnStructure=e,k}}class ft{constructor(e){w(this,"columns",[]);w(this,"size");this.identifier=e}static fromTableStructure(e){let t=new ft(e.name);return t.columns=e.columns.map(i=>Kt.fromColumnStructure(i,t)),t.size=e.size,t}static fromTableStructureList(e){e==null&&(e=[]);let t=e.map(r=>ft.fromTableStructure(r)),i=new Map;for(let r of t)for(let o of r.columns)i.set(o.fromColumnStructure,o);for(let r of t)for(let o of r.columns){let u=o.fromColumnStructure.references;if(u!=null){let h=i.get(u);o.references=h}}return t}}class hi{constructor(e,t,i){w(this,"parent");w(this,"positionFrom");w(this,"positionTo");w(this,"childSymbolTables",[]);w(this,"symbols",new Map);w(this,"symbolList",[]);this.parent=e,this.positionFrom=t,this.positionTo=i,this.parent!=null&&this.parent.childSymbolTables.push(this)}extractDatabaseStructure(e){for(let t of ft.fromTableStructureList(e==null?void 0:e.tables))this.storeTableSymbols(t)}storeTableSymbols(e){this.storeSymbol({identifier:e.identifier,posOfDefinition:null,referencedOnPositions:[],table:e});for(let t of e.columns)this.storeSymbol({identifier:t.identifier,posOfDefinition:null,referencedOnPositions:[],column:t})}storeSymbol(e){let t=this.symbols.get(e.identifier.toLowerCase());t==null?(t=[e],this.symbols.set(e.identifier.toLowerCase(),t)):t.push(e),this.symbolList.push(e)}findTableAtPosition(e,t){if(!this.containsPosition(e,t))return null;let i=null,r=1e7;for(let o of this.childSymbolTables)if(o.containsPosition(e,t)){let u=o.findTableAtPosition(e,t);u.positionTo.line-u.positionFrom.line<r&&(i=u,r=u.positionTo.line-u.positionFrom.line)}return i??this}containsPosition(e,t){return!(e<this.positionFrom.line||e>this.positionTo.line||e==this.positionFrom.line&&t<this.positionFrom.column||e==this.positionTo.line&&t>this.positionTo.column+1)}findTable(e){let t=this.findTables(e);return t.length==0?null:t[0].table}findTables(e){let t=this;for(;t!=null;){let i=t.symbols.get(e.toLowerCase());if(i!=null&&(i=i.filter(r=>r.table!=null),i.length>0))return i;t=t.parent}return[]}findColumn(e){let t=this;for(;t!=null;){let i=t.symbols.get(e.toLowerCase());if(i!=null&&(i=i.filter(r=>r.column!=null),i.length>0))return i;t=t.parent}return[]}}class Xn{constructor(e,t){w(this,"type");this.identifier=e,this.type=te.getBaseType(t)}}class Jn{constructor(e,t,i,r){w(this,"acceptsStarParameter",!1);w(this,"returnType");this.identifier=e,this.isAggregating=t,this.parameters=r,this.returnType=te.getBaseType(i)}}const Zi=class{constructor(){w(this,"methods",[]);this.pushOneParameterMethod("max","integer","integer"),this.pushOneParameterMethod("max","float","float"),this.pushOneParameterMethod("max","date","date"),this.pushOneParameterMethod("max","time","time"),this.pushOneParameterMethod("max","datetime","datetime"),this.pushOneParameterMethod("max","timestamp","timestamp"),this.pushOneParameterMethod("min","integer","integer"),this.pushOneParameterMethod("min","float","float"),this.pushOneParameterMethod("min","date","date"),this.pushOneParameterMethod("min","time","time"),this.pushOneParameterMethod("min","datetime","datetime"),this.pushOneParameterMethod("min","timestamp","timestamp"),this.pushOneParameterMethod("avg","integer","integer"),this.pushOneParameterMethod("avg","float","float"),this.pushOneParameterMethod("sum","float","float"),this.pushOneParameterMethod("sum","integer","integer"),this.pushOneParameterMethod("concat","text","text");let e=new Jn("count",!0,"integer",[new Xn("spalte","text")]);e.acceptsStarParameter=!0,this.methods.push(e)}static getInstance(){return this.instance==null&&(this.instance=new Zi),this.instance}getMethods(e){return this.methods.filter(t=>t.identifier==e.toLowerCase())}pushOneParameterMethod(e,t,i){this.methods.push(new Jn(e,!0,t,[new Xn("spalte",i)]))}};let fi=Zi;w(fi,"instance");function Vt(f){return f.replace(/['"]+/g,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function eo(f){return`${Yn(f.getDate())}.${Yn(f.getMonth())}.${f.getFullYear()}`}function Yn(f){return f<10?"0"+f:""+f}function to(f){let e=f.match(/^(\d{2})\.(\d{2})\.(\d{4}), (\d{2}):(\d{2})$/);return new Date(Number.parseInt(e[3]),Number.parseInt(e[2]),Number.parseInt(e[1]),Number.parseInt(e[4]),Number.parseInt(e[5]))}function io(f){if(f==null||typeof f!="string")return!1;var e=/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/;if(f.match(e)){var t=f.split("/"),i=f.split("-"),r=t.length,o=i.length;if(r>1)var u=f.split("/");else if(o>1)var u=f.split("-");if(u.length!=3)return!1;var h=parseInt(u[2]),b=parseInt(u[1]),k=parseInt(u[0]),E=[31,28,31,30,31,30,31,31,30,31,30,31];if((b==1||b>2)&&h>E[b-1])return!1;if(b==2){var P=!1;return(!(k%4)&&k%100||!(k%400))&&(P=!0),!(P==!1&&h>=29||P==!0&&h>29)}return!0}else return!1}function no(f){if(f==null||typeof f!="string")return!1;var e=/^\d{4}[\-](0[1-9]|1[012])[\-](0[1-9]|[12][0-9]|3[01]) ([01][0-9]|2[0123]):([0-5][0-9]):([0-5][0-9])$/;if(f.match(e)){var t=f.split(" "),i=t[0];if(i.length!=10)return!1;var r=parseInt(i.substring(8,10)),o=parseInt(i.substring(5,7)),u=parseInt(i.substring(0,4)),h=[31,28,31,30,31,30,31,31,30,31,30,31];if((o==1||o>2)&&r>h[o-1])return!1;if(o==2){var b=!1;return(!(u%4)&&u%100||!(u%400))&&(b=!0),!(b==!1&&r>=29||b==!0&&r>29)}return!0}else return!1}function ro(f){if(f==null||typeof f!="string")return!1;var e=/^([01][0-9]|2[0123]):([0-5][0-9]):([0-5][0-9])$/;return f.match(e)!=null}class so{constructor(e){w(this,"symbolTableStack",[]);w(this,"errorList");w(this,"module");w(this,"databaseTool");w(this,"tables");var t;this.databaseTool=e,this.tables=ft.fromTableStructureList((t=e.databaseStructure)==null?void 0:t.tables)}start(e){this.module=e,this.symbolTableStack=[],this.errorList=[],e.mainSymbolTable=new hi(null,{column:0,line:0,length:0},{column:0,line:1e5,length:0}),this.symbolTableStack.push(e.mainSymbolTable);for(let t of this.module.sqlStatements){let i=this.errorList.length,r=t.ast;if(r!=null){switch(r.type){case l.keywordSelect:this.resolveSelect(r),this.symbolTableStack.pop();break;case l.keywordInsert:this.resolveInsert(r),this.symbolTableStack.pop();break;case l.keywordCreate:this.resolveCreateTable(r),this.symbolTableStack.pop();break;case l.keywordUpdate:this.resolveUpdate(r),this.symbolTableStack.pop();break;case l.keywordDelete:this.resolveDelete(r),this.symbolTableStack.pop();break;case l.keywordDrop:this.resolveDropTable(r),this.symbolTableStack.pop();break;case l.keywordAlter:this.resolveAlterTable(r),this.symbolTableStack.pop();break}t.hasErrors=t.hasErrors||this.errorList.length>i}}e.errors[2]=this.errorList}pushError(e,t="error",i,r){this.errorList.push({text:e,position:i,quickFix:r,level:t})}getCurrentSymbolTable(){return this.symbolTableStack[this.symbolTableStack.length-1]}pushNewSymbolTable(e,t){t==null&&(t={line:1e5,column:1,length:1});let i=new hi(this.getCurrentSymbolTable(),e,t);return this.symbolTableStack.push(i),i}resolveSelect(e){let t=new ft(null);e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition);let i=[];this.resolveTableOrSubQuery(e.fromNode,i),e.fromStartPosition!=null&&new hi(this.getCurrentSymbolTable(),e.fromStartPosition,e.fromEndPosition).extractDatabaseStructure(this.databaseTool.databaseStructure);for(let r of e.columnList)if(r.type==l.allColumns)for(let o of i)for(let u of o.columns){let h=new Kt(u.identifier,u.type,t,!1,!0,u.defaultValue,u.isAutoIncrement);t.columns.push(h)}else{this.resolveTerm(r.term);let o=new Kt(r.alias,r.term.sqlType,t,!1,!0,null,!1);t.columns.push(o),o.identifier!=null&&e.symbolTable.storeSymbol({identifier:o.identifier,posOfDefinition:r.term.position,referencedOnPositions:[],column:o})}if(e.whereNode!=null){let r=this.resolveTerm(e.whereNode);r!=null&&r.getBaseTypeName()!="boolean"&&this.pushError("Das Ergebnis des where-Teils einer select-Anweisung muss vom Typ boolean sein.","error",e.whereNode.position)}return t}resolveDropTable(e){e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure),e.tableIdentifier!=null&&(e.ifExists||e.symbolTable.findTable(e.tableIdentifier)==null&&this.pushError("Die Tabelle "+e.tableIdentifier+" ist nicht bekannt.","error",e.tableIdentifierPosition))}resolveDelete(e){if(e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure),e.tableIdentifier==null)return;let t=e.symbolTable.findTable(e.tableIdentifier);if(t==null&&this.pushError("Die Tabelle "+e.tableIdentifier+" ist nicht bekannt.","error",e.tableIdentifierPosition),e.whereNode!=null){let i=this.pushNewSymbolTable(e.whereNodeBegin,e.whereNodeEnd);t!=null&&i.storeTableSymbols(t),this.resolveTerm(e.whereNode),this.symbolTableStack.pop()}}resolveAlterTable(e){if(e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure),e.tableIdentifier==null)return;let t=e.symbolTable.findTable(e.tableIdentifier);t==null&&this.pushError("Die Tabelle "+e.tableIdentifier+" ist nicht bekannt.","error",e.tableIdentifierPosition);let i=null;switch(e.oldColumnName!=null&&(i=t.columns.find(r=>r.identifier.toLocaleLowerCase()==e.oldColumnName.toLocaleLowerCase()),i==null&&this.pushError("Die Tabelle "+e.tableIdentifier+" hat keine Spalte mit dem Bezeichner "+e.oldColumnName,"error",e.oldColumnPosition)),e.kind){case"dropColumn":break;case"addColumn":let r=e.columnDef;if(r==null)break;if(r.foreignKeyInfo!=null&&r.baseType!=null){let o=r.foreignKeyInfo,u=this.getCurrentSymbolTable().findTables(o.referencesTable);if(u.length==1){let h=u[0].table,b=h.columns.find(k=>k.identifier==o.referencesColumn);b!=null&&b.type!=null&&(b.isPrimaryKey||this.pushError("Die referenzierte Spalte "+o.referencesTable+"."+o.referencesColumn+" ist kein Primärschlüssel.","warning",r.referencesPosition),b.type.canCastTo(r.baseType)||this.pushError("Der Datentyp "+r.baseType.toString()+" der Spalte "+r.identifier+" kann nich in den Datentyp "+b.type.toString()+" der referenzierten Spalte "+h.identifier+"."+b.identifier+" umgewandelt werden.","error",r.referencesPosition))}}break}}resolveUpdate(e){if(e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure),e.tableIdentifier==null)return;let t=e.symbolTable.findTable(e.tableIdentifier);t==null&&this.pushError("Die Tabelle "+e.tableIdentifier+" ist nicht bekannt.","error",e.tableIdentifierPosition);for(let i=0;i<e.columnIdentifiers.length;i++){let r=e.columnIdentifiers[i],o=e.columnIdentifierPositions[i],u=e.values[i];if(r==null||(t.columns.find(k=>k.identifier==r)==null&&this.pushError(r+" ist kein Bezeichner einer Spalte der Tabelle "+e.tableIdentifier+".","error",o),u==null))continue;this.pushNewSymbolTable(e.valuePosBegin[i],e.valuePosEnd[i]).storeTableSymbols(t),this.resolveTerm(u),this.symbolTableStack.pop()}e.whereNodeBegin!=null&&this.pushNewSymbolTable(e.whereNodeBegin,e.whereNodeEnd).storeTableSymbols(t),e.whereNode!=null&&this.resolveTerm(e.whereNode),this.symbolTableStack.pop()}resolveCreateTable(e){e.symbolTable=this.pushNewSymbolTable(e.position,e.endPosition),e.symbolTable.extractDatabaseStructure(this.databaseTool.databaseStructure);let t={identifier:e.identifier,columns:null,size:0};t.columns=e.columnList.map(i=>({identifier:i.identifier,isNullable:!1,isPrimaryKey:i.isPrimary,isAutoIncrement:i.isAutoIncrement,notNull:!1,references:null,table:t,type:i.baseType,defaultValue:i.defaultValue})),e.symbolTable.storeTableSymbols(t);for(let i of e.columnList)if(e.columnList.filter(r=>r.identifier.toLocaleLowerCase()==i.identifier.toLocaleLowerCase()).length>1&&this.pushError("Der Spaltenbezeichner "+i.identifier+" darf in einer Tabelle nur ein einziges Mal verwendet werden","error",i.position),i.foreignKeyInfo!=null&&i.baseType!=null){let r=i.foreignKeyInfo,o=this.getCurrentSymbolTable().findTables(r.referencesTable);if(o.length==1){let u=o[0].table,h=u.columns.find(b=>b.identifier==r.referencesColumn);h!=null&&h.type!=null&&(h.isPrimaryKey||this.pushError("Die referenzierte Spalte "+r.referencesTable+"."+r.referencesColumn+" ist kein Primärschlüssel.","warning",i.referencesPosition),h.type.canCastTo(i.baseType)||this.pushError("Der Datentyp "+i.baseType.toString()+" der Spalte "+i.identifier+" kann nich in den Datentyp "+h.type.toString()+" der referenzierten Spalte "+u.identifier+"."+h.identifier+" umgewandelt werden.","error",i.referencesPosition))}}for(let i of e.foreignKeyInfoList){let r=e.columnList.find(u=>u.identifier==i.column);if(r==null)continue;let o=this.getCurrentSymbolTable().findTables(i.referencesTable);if(o.length==1){let u=o[0].table,h=u.columns.find(b=>b.identifier==i.referencesColumn);h!=null&&h.type!=null&&(h.isPrimaryKey||this.pushError("Die referenzierte Spalte "+i.referencesTable+"."+i.referencesColumn+" ist kein Primärschlüssel.","warning",i.referencesPosition),h.type.canCastTo(r.baseType)||this.pushError("Der Datentyp "+r.baseType.toString()+" der Spalte "+r.identifier+" kann nich in den Datentyp "+h.type.toString()+" der referenzierten Spalte "+u.identifier+"."+h.identifier+" umgewandelt werden.","error",i.referencesPosition))}}}resolveTableOrSubQuery(e,t){if(e!=null)switch(e.type){case l.table:let i=this.tables.filter(r=>r.identifier.toLowerCase()==e.identifier.toLowerCase());if(i.length==0)this.pushError(e.identifier+" ist nicht der Name einer Tabelle.","error",e.position);else if(i.length>1)this.pushError("Der Bezeichner "+e.identifier+" ist hier nicht eindeutig.","error",e.position);else{let r=i[0];t.push(r),this.storeTableIntoSymbolTable(r,e.position,e.alias)}break;case l.keywordJoin:this.resolveTableOrSubQuery(e.firstOperand,t),this.resolveTableOrSubQuery(e.secondOperand,t);break;case l.subquery:e.table=this.resolveSelect(e.query),t.push(e.table),e.alias!=null&&(e.table.identifier=e.alias,this.storeTableIntoSymbolTable(e.table,e.position));break}}storeTableIntoSymbolTable(e,t,i){let r=this.getCurrentSymbolTable();r.storeSymbol({identifier:i==null?e.identifier.toLowerCase():i.toLowerCase(),posOfDefinition:t,table:e,referencedOnPositions:[]});for(let o of e.columns)r.storeSymbol({identifier:o.identifier.toLowerCase(),posOfDefinition:null,column:o,tableAlias:i,referencedOnPositions:[]})}resolveTerm(e){if(e==null)return null;switch(e.type){case l.binaryOp:if([l.keywordIn,l.keywordNotIn].indexOf(e.operator)>=0)return this.resolveNotIn(e);let t=this.resolveTerm(e.firstOperand),i=this.resolveTerm(e.secondOperand);if(t!=null&&i!=null){let u=t.getBinaryResultType(e.operator,i);return u==null&&this.pushError("Der Operator "+ge[e.operator]+" ist für die Datentypen "+t.toString()+" und "+i.toString()+" nicht definiert.","error",e.position),e.sqlType=u,u}else return null;case l.unaryOp:let r=this.resolveTerm(e.operand);if(r!=null){let u=r.getUnaryResultType(e.operator);return u==null&&this.pushError("Der Operator "+ge[e.operator]+" ist für einen Operanden des Datentyps "+r.toString()+" nicht definiert.","error",e.position),e.sqlType=u,u}else return null;case l.callMethod:return this.resolveMethodCall(e);case l.constantNode:return e.sqlType=te.fromConstantType(e.constantType),e.sqlType;case l.identifier:return this.resolveIdentifier(e);case l.dot:return this.resolveDot(e);case l.keywordSelect:let o=this.resolveSelect(e);return o.columns.length!=1?(this.pushError("Die Ergebnistabelle einer Unterabfrage an dieser Stelle muss genau eine Spalte besitzen.","error",e.position),null):o.columns[0].type;case l.rightBracket:return e.sqlType=this.resolveTerm(e.termInsideBrackets),e.sqlType;case l.allColumns:this.pushError("Das Zeichen * kann hier nicht verwendet werden.","error",e.position);break;case l.list:this.pushError("Eine Liste wird hier nicht erwartet.","error",e.position);break}}resolveDot(e){let t=this.getCurrentSymbolTable().findTables(e.identifierLeft.identifier);if(t.length==0)return this.pushError("Die Tabelle "+e.identifierLeft.identifier+" kann nicht gefunden werden.","error",e.identifierLeft.position),null;if(t.length>1)return this.pushError("Der Tabellenbezeichner "+e.identifierLeft.identifier+" ist nicht eindeutig.","error",e.identifierLeft.position),null;let r=t[0].table.columns.filter(u=>u.identifier.toLowerCase()==e.identifierRight.identifier.toLowerCase());if(r.length==0){this.pushError("Die Tabelle "+e.identifierLeft.identifier+" hat keine Spalte mit dem Bezeichner "+e.identifierRight.identifier+".","error",e.identifierRight.position);return}if(r.length>1){this.pushError("Die Tabelle "+e.identifierLeft.identifier+" hat mehrere Spalten mit dem Bezeichner "+e.identifierRight.identifier+".","error",e.identifierRight.position);return}let o=r[0];return e.sqlType=o.type,o.type}resolveIdentifier(e){let t=this.getCurrentSymbolTable().findColumn(e.identifier);if(t.length==0)return this.pushError("Der Bezeichner "+e.identifier+" ist an dieser Stelle nicht bekannt.","error",e.position),null;if(t.length>1)return this.pushError("Der Bezeichner "+e.identifier+" ist nicht eindeutig.","error",e.position),null;let i=t[0];return e.sqlType=i.column.type,i.column.type}resolveMethodCall(e){let i=fi.getInstance().getMethods(e.identifier);if(e.identifier.toLocaleLowerCase()=="concat"){if(e.operands.length==0)return this.pushError("Die Methode concat benötigt mindestens einen Parameter.","error",e.position),null;let r=i[0];return e.sqlType=r.returnType,e.sqlType}else{if(i=i.filter(r=>r.parameters.length==e.operands.length),e.operands.length==1&&e.operands[0].type==l.allColumns)return i=i.filter(r=>r.acceptsStarParameter),e.sqlType=i[0].returnType,e.sqlType;if(i.length==0)return this.pushError("Es gibt keine passende Methode mit dem Bezeichner '"+e.identifier+"'.","error",e.position),null;for(let r of e.operands)if(this.resolveTerm(r)==null)return e.sqlType=i[0].returnType,e.sqlType;for(let r of i){let o=!0;for(let u=0;u<r.parameters.length;u++){let h=r.parameters[u];if(!e.operands[u].sqlType.canCastTo(h.type)){o=!1;break}}if(o)return e.sqlType=r.returnType,e.sqlType}return this.pushError("Es gibt keine passende Methode mit dem Bezeichner '"+e.identifier+"'.","error",e.position),null}}resolveNotIn(e){if(e.firstOperand==null||e.secondOperand==null)return null;let t=ge[e.operator];this.resolveTerm(e.firstOperand);let i=e.firstOperand.sqlType;if(i!=null)if(e.secondOperand.type==l.keywordSelect){let r=e.secondOperand;r.columnList.length!=1&&this.pushError("Wenn rechts vom Operator '"+t+"' eine Unterabfrage steht, muss die Ergebnistabelle dieser Unterabfrage genau eine Spalte haben.","error",r.position),this.resolveSelect(r);let o=r.columnList[0].term.sqlType;o.canCastTo(i)||this.pushError("Der Datentyp der Ergebnisspalte der Unterabfrage ist "+o.toString()+". Dieser kann nicht in den Datentyp "+i.toString()+" umgewandelt werden.","error",r.position)}else if(e.secondOperand.type==l.list){let r=e.secondOperand;for(let o of r.elements){let u=te.fromConstantType(o.constantType);o.sqlType=u,u.canCastTo(i)||this.pushError("Der Datentyp des Listenelements "+o.constant+" ist "+u.toString()+". Er kann nicht in den Datentype "+i.toString()+" des Operanden auf der linken Seite des Operators '"+t+"' umgewandelt werden.","error",o.position)}}else this.pushError("Der rechte Operand der Operatoren 'in' und 'not in' muss eine Unterabfrage oder eine Liste sein.","error",e.secondOperand.position);return te.getBaseType("boolean")}resolveInsert(e){let t=null,i=this.pushNewSymbolTable(e.position,e.endPosition);e.table!=null&&(e.table.table=this.tables.find(h=>h.identifier.toLowerCase()==e.table.identifier.toLocaleLowerCase()),e.table.table==null?this.pushError("Die Tabelle "+e.table.identifier+" gibt es nicht.","error",e.table.position):(t=e.table.table,i.storeTableSymbols(t)));let r=e.endPosition;e.valuesPosition!=null&&(r=e.valuesPosition),e.columnsPosition!=null&&(r=e.columnsPosition),this.module.addCompletionHint(e.position,r,!1,!0,["into","values"]),t!=null&&this.module.addCompletionHint(r,e.valuesPosition==null?e.endPosition:e.valuesPosition,!0,!1,["values"]),this.pushNewSymbolTable(e.position,r).extractDatabaseStructure(this.databaseTool.databaseStructure);let u=[];if(e.columnList.length==0)t!=null&&(u=t.columns);else if(t!=null)for(let h of e.columnList){let b=t.columns.find(k=>k.identifier.toLowerCase()==h.identifier.toLowerCase());b==null?this.pushError("Die Tabelle "+t.identifier+" besitzt keine Spalte mit dem Bezeichner "+h.identifier+".","error",h.position):u.push(b)}if(u.length>0)if(e.select!=null){let h=this.resolveSelect(e.select);if((h==null?void 0:h.columns)!=null)if(u.length!=h.columns.length)this.pushError("Die insert-Anweisung erwartet "+u.length+" Werte je Datensatz, die select-Anweisung liefert aber "+h.columns.length+".","error",e.position);else for(let b=0;b<u.length;b++){let k=u[b],E=h.columns[b];k.type!=null&&E.type!=null&&(E.type.canCastTo(k.type)||this.pushError("Der Datentyp "+E.type.toString()+" der "+(b+1)+"-ten Spalte des select-Terms kann nicht in den Datentyp "+k.type.toString()+" der entsprechenden Spalte der insert-Anweisung umgewandelt werden.","error",e.position))}}else for(let h of e.values)if(h.length!=u.length&&h.length>0)this.pushError("Erwartet werden "+u.length+" Elemente, hier stehen aber "+h.length+" Elemente in der Liste.","error",h[0].position);else for(let b=0;b<h.length;b++){let k=h[b],E=u[b];k.sqlType=te.fromConstantType(k.constantType);let P=E.type.toString().toLocaleLowerCase();if(k.constantType==l.keywordNull)(!E.isNullable||E.notNull)&&this.pushError("Die Spalte "+E.identifier+" ist nicht nullable, daher kann null hier nicht eingefügt werden.","error",k.position);else if(k.sqlType.canCastTo(E.type)){if(P=="date"){if(!io(k.constant)){let L=`'${k.constant}' ist kein date-Wert.<br><b>Tipp: </b>Datumswerte haben die Form 'yyyy-mm-dd', also z.B. '2022-06-15'.`;this.pushError(L,"error",k.position)}}else if(P=="datetime"||P=="timestamp"){if(!no(k.constant)){let L=`'${k.constant}' ist kein ${P}-Wert.<br><b>Tipp: </b>Timestamps haben die Form 'yyyy-mm-dd hh:min:ss', also z.B. '2022-06-15 07:56:22'.`;this.pushError(L,"error",k.position)}}else if(P=="time"&&!ro(k.constant)){let L=`'${k.constant}' ist kein ${P}-Wert.<br><b>Tipp: </b>Time-Werte haben die Form 'hh:min:ss', also z.B. '07:56:22'.`;this.pushError(L,"error",k.position)}}else{let L="Der Wert "+k.constant+" vom Datentyp "+k.sqlType.toString()+" kann nicht in den Datentyp "+E.type.toString()+" der Spalte "+E.identifier+" umgewandelt werden.";P=="date"&&(L+="<br><b>Tipp: </b>Datumswerte haben die Form 'yyyy-mm-dd', also z.B. '2022-06-15'."),(P=="datetime"||P=="timestamp")&&(L+="<br><b>Tipp: </b>Timestamps haben die Form 'yyyy-mm-dd hh:min:ss', also z.B. '2022-06-15 07:56:22'."),this.pushError(L,"error",k.position)}}this.symbolTableStack.pop()}}var Gt=(f=>(f[f.compiling=0]="compiling",f[f.error=1]="error",f[f.compiledButNothingToRun=2]="compiledButNothingToRun",f[f.readyToRun=3]="readyToRun",f))(Gt||{});class ur{constructor(e){w(this,"compilerStatus",2);w(this,"atLeastOneModuleIsStartable");this.main=e}compile(e){this.compilerStatus=0;let t=performance.now(),i=new Gi;for(let k of e.getModules(!1)){k.file.dirty=!1,k.clear();let E=i.lex(k.getProgramTextFromMonacoModel());k.errors[0]=E.errors,k.tokenList=E.tokens,k.bracketError=E.bracketError,k.file.name==this.main.getCurrentlyEditedModule().file.name&&this.main.getBottomDiv()!=null&&this.main.getBottomDiv().errorManager.showParenthesisWarning(E.bracketError)}this.main.getSemicolonAngel().startRegistering();let r=new Ut;for(let k of e.getModules(!1))r.parse(k);let o=this.main.getDatabaseTool(),u=new so(o);for(let k of e.getModules(!1))u.start(k);let h=performance.now()-t;h=Math.round(h*100)/100;let b="Compiled in "+h+" ms.";return this.main.getCurrentWorkspace().compilerMessage=b,this.main.getSemicolonAngel().healSemicolons(),this.compilerStatus=3,null}}const Et=class{constructor(e,t){w(this,"file");w(this,"uri");w(this,"model");w(this,"oldErrorDecorations",[]);w(this,"lastSavedVersionId");w(this,"editorState");w(this,"errors",[[],[],[],[]]);w(this,"tokenList");w(this,"sqlStatements");w(this,"mainSymbolTable");w(this,"identifierPositions",{});w(this,"methodCallPositions",{});w(this,"bracketError");w(this,"completionHints",new Map);if(this.main=t,e==null||this.main==null)return;this.file=e;let i=e.name,r=Et.uriMap[i];r==null?r=0:r++,Et.uriMap[i]=r,r>0&&(i+=" ("+r+")"),this.uri=monaco.Uri.from({path:i,scheme:"inmemory"}),this.model=monaco.editor.createModel(e.text,"vscSQL",this.uri),this.model.updateOptions({tabSize:3}),this.lastSavedVersionId=this.model.getAlternativeVersionId();let o=this;this.model.onDidChangeContent(()=>{let u=o.model.getAlternativeVersionId();if(u!=o.lastSavedVersionId&&(o.file.dirty=!0,o.file.saved=!1,o.lastSavedVersionId=u),!o.main.isEmbedded()){let h=t;h.workspacesOwnerId!=h.user.id?(o.file.text_before_revision==null||o.file.student_edited_after_revision)&&(o.file.student_edited_after_revision=!1,o.file.text_before_revision=o.file.text,o.file.saved=!1,h.networkManager.sendUpdates(null,!1),h.bottomDiv.homeworkManager.showHomeWorkRevisionButton(),h.projectExplorer.renderHomeworkButton(o.file)):o.file.student_edited_after_revision=!0}})}addCompletionHint(e,t,i,r,o,u,h="",b=""){let k={fromColumn:e.column,fromLine:e.line,toColumn:t.column,toLine:t.line,hintColumns:typeof i=="boolean"?i:!0,hintColumnsOfTable:typeof i=="string"?i:null,hintTables:r,hintKeywords:o==null?null:o.map(E=>E.toUpperCase()),dontHint:u,praefix:h,suffix:b};for(let E=k.fromLine;E<=k.toLine;E++){let P=this.completionHints.get(E);P==null&&(P=[],this.completionHints.set(E,P)),P.push(k)}}getSQLSTatementsAtSelection(e){let t={line:e.startLineNumber,column:e.startColumn},i={line:e.endLineNumber,column:e.endColumn};return this.sqlStatements==null?[]:this.sqlStatements.filter(r=>!(this.compare(r.to,t)<0||this.compare(r.from,i)>0))}compare(e,t){return e.line>t.line?1:e.line<t.line?-1:e.column>t.column?1:e.column<t.column?-1:0}getSQLStatementAtPosition(e){return this.sqlStatements.find(t=>!(t.from.line>e.lineNumber||t.from.line==e.lineNumber&&t.from.column>e.column||t.to.line<e.lineNumber||t.to.line==e.lineNumber&&t.to.column<e.column))}getCompletionHint(e,t){let i=this.completionHints.get(e);if(i==null||i.length==0)return null;let r=e*1e3+t;if(i=i.filter(h=>r>=h.fromLine*1e3+h.fromColumn&&r<=h.toLine*1e3+h.toColumn),i.length==0)return;let o=i[0],u=(o.toLine-o.fromLine)*1e3+(o.toColumn-o.fromColumn);for(let h=1;h<i.length;h++){let b=i[h],k=(b.toLine-b.fromLine)*1e3+(b.toColumn-b.fromColumn);k<u&&(o=b,u=k)}return o}static restoreFromData(e,t){let i={name:e.name,text:e.text,text_before_revision:e.text_before_revision,submitted_date:e.submitted_date,student_edited_after_revision:!1,dirty:!0,saved:!0,version:e.version,id:e.id};return new Et(i,t)}getFileData(e){let t=this.file;return{id:t.id,name:t.name,text:t.text,text_before_revision:t.text_before_revision,submitted_date:t.submitted_date,student_edited_after_revision:t.student_edited_after_revision,version:t.version,workspace_id:e.id,forceUpdate:!1,file_type:11}}findSymbolTableAtPosition(e,t){return this.mainSymbolTable==null?null:((e>this.mainSymbolTable.positionTo.line||e==this.mainSymbolTable.positionTo.line&&t>this.mainSymbolTable.positionTo.column)&&(e=this.mainSymbolTable.positionTo.line,t=this.mainSymbolTable.positionTo.column-1),this.mainSymbolTable.findTableAtPosition(e,t))}getErrorCount(){let e=0;for(let t of this.errors)t.forEach(i=>e+=i.level=="error"?1:0);return e}getProgramTextFromMonacoModel(){return this.model.getValue(monaco.editor.EndOfLinePreference.LF,!1)}addIdentifierPosition(e,t){let i=this.identifierPositions[e.line];i==null&&(i=[],this.identifierPositions[e.line]=i),i.push({position:e,element:t})}getElementAtPosition(e,t){let i=this.identifierPositions[e];if(i==null)return null;let r=null;for(let o of i)t>=o.position.column&&t<o.position.column+o.position.length&&o.position.length>0&&r==null&&(r=o);return r==null?null:r.element}copy(){let e=new Et(this.file,this.main);return e.model=this.model,e.mainSymbolTable=this.mainSymbolTable,this.mainSymbolTable=null,this.file.dirty=!0,e}clear(){this.identifierPositions={},this.file!=null&&this.file.dirty&&(this.tokenList=null,this.errors[0]=[],this.errors[1]=[]),this.errors[2]=[],this.errors[3]=[],this.mainSymbolTable=new hi(null,{line:1,column:1,length:1},{line:1e5,column:1,length:0}),this.methodCallPositions={}}hasErrors(){for(let e of this.errors)if(e.find(t=>t.level=="error"))return!0;return!1}getSortedAndFilteredErrors(){let e=[];for(let t of this.errors)e=e.concat(t);e.sort((t,i)=>t.position.line>i.position.line?1:i.position.line>t.position.line?-1:t.position.column>=i.position.column?1:-1);for(let t=0;t<e.length-1;t++){let i=e[t],r=e[t+1];i.position.line==r.position.line&&i.position.column+10>r.position.column&&(this.errorLevelCompare(i.level,r.level)==1?e.splice(t+1,1):e.splice(t,1),t--)}return e}errorLevelCompare(e,t){return e=="error"?1:t=="error"?2:e=="warning"?1:t=="warning"?2:1}};let ze=Et;w(ze,"maxUriNumber",0),w(ze,"uriMap",{});class Qi{constructor(e){w(this,"modules",[]);w(this,"moduleMap",new Map);w(this,"dirty",!1);this.main=e}findModuleById(e){for(let t of this.modules)if(t.file.id==e)return t;return null}copy(){let e=new Qi(this.main);for(let t of this.modules)e.putModule(t.copy());return e}findModuleByFile(e){for(let t of this.modules)if(t.file==e)return t;return null}hasErrors(){for(let e of this.modules)if(e.hasErrors())return!0;return!1}getFirstModule(){if(this.modules.length>0)for(let e of this.modules)return e;return null}isDirty(){if(this.dirty)return this.dirty=!1,!0;let e=!1;for(let t of this.modules)if(t.file.dirty){e=!0;break}return e}getModules(e,t){let i=[];for(let r of this.modules)r.file.name!=t&&i.push(r);return i}putModule(e){this.modules.push(e),this.moduleMap[e.file.name]=e}removeModuleWithFile(e){for(let t of this.modules)if(t.file==e){this.removeModule(t);break}}removeModule(e){this.modules.indexOf(e)<0||(this.modules.splice(this.modules.indexOf(e),1),this.moduleMap[e.file.name]=void 0,this.dirty=!0)}getModule(e){return this.moduleMap[e]}}var oo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},y={},ao={get exports(){return y},set exports(f){y=f}};/*!
 * jQuery JavaScript Library v3.6.3
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2022-12-20T21:28Z
 */(function(f){(function(e,t){f.exports=e.document?t(e,!0):function(i){if(!i.document)throw new Error("jQuery requires a window with a document");return t(i)}})(typeof window<"u"?window:oo,function(e,t){var i=[],r=Object.getPrototypeOf,o=i.slice,u=i.flat?function(n){return i.flat.call(n)}:function(n){return i.concat.apply([],n)},h=i.push,b=i.indexOf,k={},E=k.toString,P=k.hasOwnProperty,L=P.toString,H=L.call(Object),z={},A=function(s){return typeof s=="function"&&typeof s.nodeType!="number"&&typeof s.item!="function"},K=function(s){return s!=null&&s===s.window},W=e.document,he={type:!0,src:!0,nonce:!0,noModule:!0};function ve(n,s,a){a=a||W;var d,p,m=a.createElement("script");if(m.text=n,s)for(d in he)p=s[d]||s.getAttribute&&s.getAttribute(d),p&&m.setAttribute(d,p);a.head.appendChild(m).parentNode.removeChild(m)}function me(n){return n==null?n+"":typeof n=="object"||typeof n=="function"?k[E.call(n)]||"object":typeof n}var it="3.6.3",c=function(n,s){return new c.fn.init(n,s)};c.fn=c.prototype={jquery:it,constructor:c,length:0,toArray:function(){return o.call(this)},get:function(n){return n==null?o.call(this):n<0?this[n+this.length]:this[n]},pushStack:function(n){var s=c.merge(this.constructor(),n);return s.prevObject=this,s},each:function(n){return c.each(this,n)},map:function(n){return this.pushStack(c.map(this,function(s,a){return n.call(s,a,s)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(c.grep(this,function(n,s){return(s+1)%2}))},odd:function(){return this.pushStack(c.grep(this,function(n,s){return s%2}))},eq:function(n){var s=this.length,a=+n+(n<0?s:0);return this.pushStack(a>=0&&a<s?[this[a]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:i.sort,splice:i.splice},c.extend=c.fn.extend=function(){var n,s,a,d,p,m,g=arguments[0]||{},S=1,x=arguments.length,_=!1;for(typeof g=="boolean"&&(_=g,g=arguments[S]||{},S++),typeof g!="object"&&!A(g)&&(g={}),S===x&&(g=this,S--);S<x;S++)if((n=arguments[S])!=null)for(s in n)d=n[s],!(s==="__proto__"||g===d)&&(_&&d&&(c.isPlainObject(d)||(p=Array.isArray(d)))?(a=g[s],p&&!Array.isArray(a)?m=[]:!p&&!c.isPlainObject(a)?m={}:m=a,p=!1,g[s]=c.extend(_,m,d)):d!==void 0&&(g[s]=d));return g},c.extend({expando:"jQuery"+(it+Math.random()).replace(/\D/g,""),isReady:!0,error:function(n){throw new Error(n)},noop:function(){},isPlainObject:function(n){var s,a;return!n||E.call(n)!=="[object Object]"?!1:(s=r(n),s?(a=P.call(s,"constructor")&&s.constructor,typeof a=="function"&&L.call(a)===H):!0)},isEmptyObject:function(n){var s;for(s in n)return!1;return!0},globalEval:function(n,s,a){ve(n,{nonce:s&&s.nonce},a)},each:function(n,s){var a,d=0;if(wi(n))for(a=n.length;d<a&&s.call(n[d],d,n[d])!==!1;d++);else for(d in n)if(s.call(n[d],d,n[d])===!1)break;return n},makeArray:function(n,s){var a=s||[];return n!=null&&(wi(Object(n))?c.merge(a,typeof n=="string"?[n]:n):h.call(a,n)),a},inArray:function(n,s,a){return s==null?-1:b.call(s,n,a)},merge:function(n,s){for(var a=+s.length,d=0,p=n.length;d<a;d++)n[p++]=s[d];return n.length=p,n},grep:function(n,s,a){for(var d,p=[],m=0,g=n.length,S=!a;m<g;m++)d=!s(n[m],m),d!==S&&p.push(n[m]);return p},map:function(n,s,a){var d,p,m=0,g=[];if(wi(n))for(d=n.length;m<d;m++)p=s(n[m],m,a),p!=null&&g.push(p);else for(m in n)p=s(n[m],m,a),p!=null&&g.push(p);return u(g)},guid:1,support:z}),typeof Symbol=="function"&&(c.fn[Symbol.iterator]=i[Symbol.iterator]),c.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(n,s){k["[object "+s+"]"]=s.toLowerCase()});function wi(n){var s=!!n&&"length"in n&&n.length,a=me(n);return A(n)||K(n)?!1:a==="array"||s===0||typeof s=="number"&&s>0&&s-1 in n}var nt=function(n){var s,a,d,p,m,g,S,x,_,M,B,j,I,V,ee,U,fe,ce,Te,se="sizzle"+1*new Date,Z=n.document,Ee=0,ne=0,de=oi(),Bt=oi(),ni=oi(),_e=oi(),at=function(v,C){return v===C&&(B=!0),0},lt={}.hasOwnProperty,De=[],Je=De.pop,Ie=De.push,Ye=De.push,Rn=De.slice,ut=function(v,C){for(var D=0,O=v.length;D<O;D++)if(v[D]===C)return D;return-1},$i="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",re="[\\x20\\t\\r\\n\\f]",dt="(?:\\\\[\\da-fA-F]{1,6}"+re+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Wn="\\["+re+"*("+dt+")(?:"+re+"*([*^$|!~]?=)"+re+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+dt+"))|)"+re+"*\\]",Oi=":("+dt+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+Wn+")*)|.*)\\)|)",ks=new RegExp(re+"+","g"),ri=new RegExp("^"+re+"+|((?:^|[^\\\\])(?:\\\\.)*)"+re+"+$","g"),xs=new RegExp("^"+re+"*,"+re+"*"),qn=new RegExp("^"+re+"*([>+~]|"+re+")"+re+"*"),Cs=new RegExp(re+"|>"),Ss=new RegExp(Oi),Es=new RegExp("^"+dt+"$"),si={ID:new RegExp("^#("+dt+")"),CLASS:new RegExp("^\\.("+dt+")"),TAG:new RegExp("^("+dt+"|[*])"),ATTR:new RegExp("^"+Wn),PSEUDO:new RegExp("^"+Oi),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+re+"*(even|odd|(([+-]|)(\\d*)n|)"+re+"*(?:([+-]|)"+re+"*(\\d+)|))"+re+"*\\)|)","i"),bool:new RegExp("^(?:"+$i+")$","i"),needsContext:new RegExp("^"+re+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+re+"*((?:-\\d)?\\d*)"+re+"*\\)|)(?=[^-]|$)","i")},Ds=/HTML$/i,Ts=/^(?:input|select|textarea|button)$/i,_s=/^h\d$/i,Ft=/^[^{]+\{\s*\[native \w/,Ls=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ni=/[+~]/,Ve=new RegExp("\\\\[\\da-fA-F]{1,6}"+re+"?|\\\\([^\\r\\n\\f])","g"),Ge=function(v,C){var D="0x"+v.slice(1)-65536;return C||(D<0?String.fromCharCode(D+65536):String.fromCharCode(D>>10|55296,D&1023|56320))},Hn=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,zn=function(v,C){return C?v==="\0"?"�":v.slice(0,-1)+"\\"+v.charCodeAt(v.length-1).toString(16)+" ":"\\"+v},Un=function(){j()},Ps=li(function(v){return v.disabled===!0&&v.nodeName.toLowerCase()==="fieldset"},{dir:"parentNode",next:"legend"});try{Ye.apply(De=Rn.call(Z.childNodes),Z.childNodes),De[Z.childNodes.length].nodeType}catch{Ye={apply:De.length?function(C,D){Ie.apply(C,Rn.call(D))}:function(C,D){for(var O=C.length,T=0;C[O++]=D[T++];);C.length=O-1}}}function oe(v,C,D,O){var T,N,F,R,q,X,G,Y=C&&C.ownerDocument,ie=C?C.nodeType:9;if(D=D||[],typeof v!="string"||!v||ie!==1&&ie!==9&&ie!==11)return D;if(!O&&(j(C),C=C||I,ee)){if(ie!==11&&(q=Ls.exec(v)))if(T=q[1]){if(ie===9)if(F=C.getElementById(T)){if(F.id===T)return D.push(F),D}else return D;else if(Y&&(F=Y.getElementById(T))&&Te(C,F)&&F.id===T)return D.push(F),D}else{if(q[2])return Ye.apply(D,C.getElementsByTagName(v)),D;if((T=q[3])&&a.getElementsByClassName&&C.getElementsByClassName)return Ye.apply(D,C.getElementsByClassName(T)),D}if(a.qsa&&!_e[v+" "]&&(!U||!U.test(v))&&(ie!==1||C.nodeName.toLowerCase()!=="object")){if(G=v,Y=C,ie===1&&(Cs.test(v)||qn.test(v))){for(Y=Ni.test(v)&&Fi(C.parentNode)||C,(Y!==C||!a.scope)&&((R=C.getAttribute("id"))?R=R.replace(Hn,zn):C.setAttribute("id",R=se)),X=g(v),N=X.length;N--;)X[N]=(R?"#"+R:":scope")+" "+ai(X[N]);G=X.join(",")}try{if(a.cssSupportsSelector&&!CSS.supports("selector(:is("+G+"))"))throw new Error;return Ye.apply(D,Y.querySelectorAll(G)),D}catch{_e(v,!0)}finally{R===se&&C.removeAttribute("id")}}}return x(v.replace(ri,"$1"),C,D,O)}function oi(){var v=[];function C(D,O){return v.push(D+" ")>d.cacheLength&&delete C[v.shift()],C[D+" "]=O}return C}function Ne(v){return v[se]=!0,v}function Ae(v){var C=I.createElement("fieldset");try{return!!v(C)}catch{return!1}finally{C.parentNode&&C.parentNode.removeChild(C),C=null}}function Bi(v,C){for(var D=v.split("|"),O=D.length;O--;)d.attrHandle[D[O]]=C}function Kn(v,C){var D=C&&v,O=D&&v.nodeType===1&&C.nodeType===1&&v.sourceIndex-C.sourceIndex;if(O)return O;if(D){for(;D=D.nextSibling;)if(D===C)return-1}return v?1:-1}function js(v){return function(C){var D=C.nodeName.toLowerCase();return D==="input"&&C.type===v}}function Ms(v){return function(C){var D=C.nodeName.toLowerCase();return(D==="input"||D==="button")&&C.type===v}}function Vn(v){return function(C){return"form"in C?C.parentNode&&C.disabled===!1?"label"in C?"label"in C.parentNode?C.parentNode.disabled===v:C.disabled===v:C.isDisabled===v||C.isDisabled!==!v&&Ps(C)===v:C.disabled===v:"label"in C?C.disabled===v:!1}}function ct(v){return Ne(function(C){return C=+C,Ne(function(D,O){for(var T,N=v([],D.length,C),F=N.length;F--;)D[T=N[F]]&&(D[T]=!(O[T]=D[T]))})})}function Fi(v){return v&&typeof v.getElementsByTagName<"u"&&v}a=oe.support={},m=oe.isXML=function(v){var C=v&&v.namespaceURI,D=v&&(v.ownerDocument||v).documentElement;return!Ds.test(C||D&&D.nodeName||"HTML")},j=oe.setDocument=function(v){var C,D,O=v?v.ownerDocument||v:Z;return O==I||O.nodeType!==9||!O.documentElement||(I=O,V=I.documentElement,ee=!m(I),Z!=I&&(D=I.defaultView)&&D.top!==D&&(D.addEventListener?D.addEventListener("unload",Un,!1):D.attachEvent&&D.attachEvent("onunload",Un)),a.scope=Ae(function(T){return V.appendChild(T).appendChild(I.createElement("div")),typeof T.querySelectorAll<"u"&&!T.querySelectorAll(":scope fieldset div").length}),a.cssSupportsSelector=Ae(function(){return CSS.supports("selector(*)")&&I.querySelectorAll(":is(:jqfake)")&&!CSS.supports("selector(:is(*,:jqfake))")}),a.attributes=Ae(function(T){return T.className="i",!T.getAttribute("className")}),a.getElementsByTagName=Ae(function(T){return T.appendChild(I.createComment("")),!T.getElementsByTagName("*").length}),a.getElementsByClassName=Ft.test(I.getElementsByClassName),a.getById=Ae(function(T){return V.appendChild(T).id=se,!I.getElementsByName||!I.getElementsByName(se).length}),a.getById?(d.filter.ID=function(T){var N=T.replace(Ve,Ge);return function(F){return F.getAttribute("id")===N}},d.find.ID=function(T,N){if(typeof N.getElementById<"u"&&ee){var F=N.getElementById(T);return F?[F]:[]}}):(d.filter.ID=function(T){var N=T.replace(Ve,Ge);return function(F){var R=typeof F.getAttributeNode<"u"&&F.getAttributeNode("id");return R&&R.value===N}},d.find.ID=function(T,N){if(typeof N.getElementById<"u"&&ee){var F,R,q,X=N.getElementById(T);if(X){if(F=X.getAttributeNode("id"),F&&F.value===T)return[X];for(q=N.getElementsByName(T),R=0;X=q[R++];)if(F=X.getAttributeNode("id"),F&&F.value===T)return[X]}return[]}}),d.find.TAG=a.getElementsByTagName?function(T,N){if(typeof N.getElementsByTagName<"u")return N.getElementsByTagName(T);if(a.qsa)return N.querySelectorAll(T)}:function(T,N){var F,R=[],q=0,X=N.getElementsByTagName(T);if(T==="*"){for(;F=X[q++];)F.nodeType===1&&R.push(F);return R}return X},d.find.CLASS=a.getElementsByClassName&&function(T,N){if(typeof N.getElementsByClassName<"u"&&ee)return N.getElementsByClassName(T)},fe=[],U=[],(a.qsa=Ft.test(I.querySelectorAll))&&(Ae(function(T){var N;V.appendChild(T).innerHTML="<a id='"+se+"'></a><select id='"+se+"-\r\\' msallowcapture=''><option selected=''></option></select>",T.querySelectorAll("[msallowcapture^='']").length&&U.push("[*^$]="+re+`*(?:''|"")`),T.querySelectorAll("[selected]").length||U.push("\\["+re+"*(?:value|"+$i+")"),T.querySelectorAll("[id~="+se+"-]").length||U.push("~="),N=I.createElement("input"),N.setAttribute("name",""),T.appendChild(N),T.querySelectorAll("[name='']").length||U.push("\\["+re+"*name"+re+"*="+re+`*(?:''|"")`),T.querySelectorAll(":checked").length||U.push(":checked"),T.querySelectorAll("a#"+se+"+*").length||U.push(".#.+[+~]"),T.querySelectorAll("\\\f"),U.push("[\\r\\n\\f]")}),Ae(function(T){T.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var N=I.createElement("input");N.setAttribute("type","hidden"),T.appendChild(N).setAttribute("name","D"),T.querySelectorAll("[name=d]").length&&U.push("name"+re+"*[*^$|!~]?="),T.querySelectorAll(":enabled").length!==2&&U.push(":enabled",":disabled"),V.appendChild(T).disabled=!0,T.querySelectorAll(":disabled").length!==2&&U.push(":enabled",":disabled"),T.querySelectorAll("*,:x"),U.push(",.*:")})),(a.matchesSelector=Ft.test(ce=V.matches||V.webkitMatchesSelector||V.mozMatchesSelector||V.oMatchesSelector||V.msMatchesSelector))&&Ae(function(T){a.disconnectedMatch=ce.call(T,"*"),ce.call(T,"[s!='']:x"),fe.push("!=",Oi)}),a.cssSupportsSelector||U.push(":has"),U=U.length&&new RegExp(U.join("|")),fe=fe.length&&new RegExp(fe.join("|")),C=Ft.test(V.compareDocumentPosition),Te=C||Ft.test(V.contains)?function(T,N){var F=T.nodeType===9&&T.documentElement||T,R=N&&N.parentNode;return T===R||!!(R&&R.nodeType===1&&(F.contains?F.contains(R):T.compareDocumentPosition&&T.compareDocumentPosition(R)&16))}:function(T,N){if(N){for(;N=N.parentNode;)if(N===T)return!0}return!1},at=C?function(T,N){if(T===N)return B=!0,0;var F=!T.compareDocumentPosition-!N.compareDocumentPosition;return F||(F=(T.ownerDocument||T)==(N.ownerDocument||N)?T.compareDocumentPosition(N):1,F&1||!a.sortDetached&&N.compareDocumentPosition(T)===F?T==I||T.ownerDocument==Z&&Te(Z,T)?-1:N==I||N.ownerDocument==Z&&Te(Z,N)?1:M?ut(M,T)-ut(M,N):0:F&4?-1:1)}:function(T,N){if(T===N)return B=!0,0;var F,R=0,q=T.parentNode,X=N.parentNode,G=[T],Y=[N];if(!q||!X)return T==I?-1:N==I?1:q?-1:X?1:M?ut(M,T)-ut(M,N):0;if(q===X)return Kn(T,N);for(F=T;F=F.parentNode;)G.unshift(F);for(F=N;F=F.parentNode;)Y.unshift(F);for(;G[R]===Y[R];)R++;return R?Kn(G[R],Y[R]):G[R]==Z?-1:Y[R]==Z?1:0}),I},oe.matches=function(v,C){return oe(v,null,null,C)},oe.matchesSelector=function(v,C){if(j(v),a.matchesSelector&&ee&&!_e[C+" "]&&(!fe||!fe.test(C))&&(!U||!U.test(C)))try{var D=ce.call(v,C);if(D||a.disconnectedMatch||v.document&&v.document.nodeType!==11)return D}catch{_e(C,!0)}return oe(C,I,null,[v]).length>0},oe.contains=function(v,C){return(v.ownerDocument||v)!=I&&j(v),Te(v,C)},oe.attr=function(v,C){(v.ownerDocument||v)!=I&&j(v);var D=d.attrHandle[C.toLowerCase()],O=D&&lt.call(d.attrHandle,C.toLowerCase())?D(v,C,!ee):void 0;return O!==void 0?O:a.attributes||!ee?v.getAttribute(C):(O=v.getAttributeNode(C))&&O.specified?O.value:null},oe.escape=function(v){return(v+"").replace(Hn,zn)},oe.error=function(v){throw new Error("Syntax error, unrecognized expression: "+v)},oe.uniqueSort=function(v){var C,D=[],O=0,T=0;if(B=!a.detectDuplicates,M=!a.sortStable&&v.slice(0),v.sort(at),B){for(;C=v[T++];)C===v[T]&&(O=D.push(T));for(;O--;)v.splice(D[O],1)}return M=null,v},p=oe.getText=function(v){var C,D="",O=0,T=v.nodeType;if(T){if(T===1||T===9||T===11){if(typeof v.textContent=="string")return v.textContent;for(v=v.firstChild;v;v=v.nextSibling)D+=p(v)}else if(T===3||T===4)return v.nodeValue}else for(;C=v[O++];)D+=p(C);return D},d=oe.selectors={cacheLength:50,createPseudo:Ne,match:si,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(v){return v[1]=v[1].replace(Ve,Ge),v[3]=(v[3]||v[4]||v[5]||"").replace(Ve,Ge),v[2]==="~="&&(v[3]=" "+v[3]+" "),v.slice(0,4)},CHILD:function(v){return v[1]=v[1].toLowerCase(),v[1].slice(0,3)==="nth"?(v[3]||oe.error(v[0]),v[4]=+(v[4]?v[5]+(v[6]||1):2*(v[3]==="even"||v[3]==="odd")),v[5]=+(v[7]+v[8]||v[3]==="odd")):v[3]&&oe.error(v[0]),v},PSEUDO:function(v){var C,D=!v[6]&&v[2];return si.CHILD.test(v[0])?null:(v[3]?v[2]=v[4]||v[5]||"":D&&Ss.test(D)&&(C=g(D,!0))&&(C=D.indexOf(")",D.length-C)-D.length)&&(v[0]=v[0].slice(0,C),v[2]=D.slice(0,C)),v.slice(0,3))}},filter:{TAG:function(v){var C=v.replace(Ve,Ge).toLowerCase();return v==="*"?function(){return!0}:function(D){return D.nodeName&&D.nodeName.toLowerCase()===C}},CLASS:function(v){var C=de[v+" "];return C||(C=new RegExp("(^|"+re+")"+v+"("+re+"|$)"))&&de(v,function(D){return C.test(typeof D.className=="string"&&D.className||typeof D.getAttribute<"u"&&D.getAttribute("class")||"")})},ATTR:function(v,C,D){return function(O){var T=oe.attr(O,v);return T==null?C==="!=":C?(T+="",C==="="?T===D:C==="!="?T!==D:C==="^="?D&&T.indexOf(D)===0:C==="*="?D&&T.indexOf(D)>-1:C==="$="?D&&T.slice(-D.length)===D:C==="~="?(" "+T.replace(ks," ")+" ").indexOf(D)>-1:C==="|="?T===D||T.slice(0,D.length+1)===D+"-":!1):!0}},CHILD:function(v,C,D,O,T){var N=v.slice(0,3)!=="nth",F=v.slice(-4)!=="last",R=C==="of-type";return O===1&&T===0?function(q){return!!q.parentNode}:function(q,X,G){var Y,ie,ae,J,pe,ye,Le=N!==F?"nextSibling":"previousSibling",le=q.parentNode,Rt=R&&q.nodeName.toLowerCase(),Wt=!G&&!R,Pe=!1;if(le){if(N){for(;Le;){for(J=q;J=J[Le];)if(R?J.nodeName.toLowerCase()===Rt:J.nodeType===1)return!1;ye=Le=v==="only"&&!ye&&"nextSibling"}return!0}if(ye=[F?le.firstChild:le.lastChild],F&&Wt){for(J=le,ae=J[se]||(J[se]={}),ie=ae[J.uniqueID]||(ae[J.uniqueID]={}),Y=ie[v]||[],pe=Y[0]===Ee&&Y[1],Pe=pe&&Y[2],J=pe&&le.childNodes[pe];J=++pe&&J&&J[Le]||(Pe=pe=0)||ye.pop();)if(J.nodeType===1&&++Pe&&J===q){ie[v]=[Ee,pe,Pe];break}}else if(Wt&&(J=q,ae=J[se]||(J[se]={}),ie=ae[J.uniqueID]||(ae[J.uniqueID]={}),Y=ie[v]||[],pe=Y[0]===Ee&&Y[1],Pe=pe),Pe===!1)for(;(J=++pe&&J&&J[Le]||(Pe=pe=0)||ye.pop())&&!((R?J.nodeName.toLowerCase()===Rt:J.nodeType===1)&&++Pe&&(Wt&&(ae=J[se]||(J[se]={}),ie=ae[J.uniqueID]||(ae[J.uniqueID]={}),ie[v]=[Ee,Pe]),J===q)););return Pe-=T,Pe===O||Pe%O===0&&Pe/O>=0}}},PSEUDO:function(v,C){var D,O=d.pseudos[v]||d.setFilters[v.toLowerCase()]||oe.error("unsupported pseudo: "+v);return O[se]?O(C):O.length>1?(D=[v,v,"",C],d.setFilters.hasOwnProperty(v.toLowerCase())?Ne(function(T,N){for(var F,R=O(T,C),q=R.length;q--;)F=ut(T,R[q]),T[F]=!(N[F]=R[q])}):function(T){return O(T,0,D)}):O}},pseudos:{not:Ne(function(v){var C=[],D=[],O=S(v.replace(ri,"$1"));return O[se]?Ne(function(T,N,F,R){for(var q,X=O(T,null,R,[]),G=T.length;G--;)(q=X[G])&&(T[G]=!(N[G]=q))}):function(T,N,F){return C[0]=T,O(C,null,F,D),C[0]=null,!D.pop()}}),has:Ne(function(v){return function(C){return oe(v,C).length>0}}),contains:Ne(function(v){return v=v.replace(Ve,Ge),function(C){return(C.textContent||p(C)).indexOf(v)>-1}}),lang:Ne(function(v){return Es.test(v||"")||oe.error("unsupported lang: "+v),v=v.replace(Ve,Ge).toLowerCase(),function(C){var D;do if(D=ee?C.lang:C.getAttribute("xml:lang")||C.getAttribute("lang"))return D=D.toLowerCase(),D===v||D.indexOf(v+"-")===0;while((C=C.parentNode)&&C.nodeType===1);return!1}}),target:function(v){var C=n.location&&n.location.hash;return C&&C.slice(1)===v.id},root:function(v){return v===V},focus:function(v){return v===I.activeElement&&(!I.hasFocus||I.hasFocus())&&!!(v.type||v.href||~v.tabIndex)},enabled:Vn(!1),disabled:Vn(!0),checked:function(v){var C=v.nodeName.toLowerCase();return C==="input"&&!!v.checked||C==="option"&&!!v.selected},selected:function(v){return v.parentNode&&v.parentNode.selectedIndex,v.selected===!0},empty:function(v){for(v=v.firstChild;v;v=v.nextSibling)if(v.nodeType<6)return!1;return!0},parent:function(v){return!d.pseudos.empty(v)},header:function(v){return _s.test(v.nodeName)},input:function(v){return Ts.test(v.nodeName)},button:function(v){var C=v.nodeName.toLowerCase();return C==="input"&&v.type==="button"||C==="button"},text:function(v){var C;return v.nodeName.toLowerCase()==="input"&&v.type==="text"&&((C=v.getAttribute("type"))==null||C.toLowerCase()==="text")},first:ct(function(){return[0]}),last:ct(function(v,C){return[C-1]}),eq:ct(function(v,C,D){return[D<0?D+C:D]}),even:ct(function(v,C){for(var D=0;D<C;D+=2)v.push(D);return v}),odd:ct(function(v,C){for(var D=1;D<C;D+=2)v.push(D);return v}),lt:ct(function(v,C,D){for(var O=D<0?D+C:D>C?C:D;--O>=0;)v.push(O);return v}),gt:ct(function(v,C,D){for(var O=D<0?D+C:D;++O<C;)v.push(O);return v})}},d.pseudos.nth=d.pseudos.eq;for(s in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[s]=js(s);for(s in{submit:!0,reset:!0})d.pseudos[s]=Ms(s);function Gn(){}Gn.prototype=d.filters=d.pseudos,d.setFilters=new Gn,g=oe.tokenize=function(v,C){var D,O,T,N,F,R,q,X=Bt[v+" "];if(X)return C?0:X.slice(0);for(F=v,R=[],q=d.preFilter;F;){(!D||(O=xs.exec(F)))&&(O&&(F=F.slice(O[0].length)||F),R.push(T=[])),D=!1,(O=qn.exec(F))&&(D=O.shift(),T.push({value:D,type:O[0].replace(ri," ")}),F=F.slice(D.length));for(N in d.filter)(O=si[N].exec(F))&&(!q[N]||(O=q[N](O)))&&(D=O.shift(),T.push({value:D,type:N,matches:O}),F=F.slice(D.length));if(!D)break}return C?F.length:F?oe.error(v):Bt(v,R).slice(0)};function ai(v){for(var C=0,D=v.length,O="";C<D;C++)O+=v[C].value;return O}function li(v,C,D){var O=C.dir,T=C.next,N=T||O,F=D&&N==="parentNode",R=ne++;return C.first?function(q,X,G){for(;q=q[O];)if(q.nodeType===1||F)return v(q,X,G);return!1}:function(q,X,G){var Y,ie,ae,J=[Ee,R];if(G){for(;q=q[O];)if((q.nodeType===1||F)&&v(q,X,G))return!0}else for(;q=q[O];)if(q.nodeType===1||F)if(ae=q[se]||(q[se]={}),ie=ae[q.uniqueID]||(ae[q.uniqueID]={}),T&&T===q.nodeName.toLowerCase())q=q[O]||q;else{if((Y=ie[N])&&Y[0]===Ee&&Y[1]===R)return J[2]=Y[2];if(ie[N]=J,J[2]=v(q,X,G))return!0}return!1}}function Ri(v){return v.length>1?function(C,D,O){for(var T=v.length;T--;)if(!v[T](C,D,O))return!1;return!0}:v[0]}function Is(v,C,D){for(var O=0,T=C.length;O<T;O++)oe(v,C[O],D);return D}function ui(v,C,D,O,T){for(var N,F=[],R=0,q=v.length,X=C!=null;R<q;R++)(N=v[R])&&(!D||D(N,O,T))&&(F.push(N),X&&C.push(R));return F}function Wi(v,C,D,O,T,N){return O&&!O[se]&&(O=Wi(O)),T&&!T[se]&&(T=Wi(T,N)),Ne(function(F,R,q,X){var G,Y,ie,ae=[],J=[],pe=R.length,ye=F||Is(C||"*",q.nodeType?[q]:q,[]),Le=v&&(F||!C)?ui(ye,ae,v,q,X):ye,le=D?T||(F?v:pe||O)?[]:R:Le;if(D&&D(Le,le,q,X),O)for(G=ui(le,J),O(G,[],q,X),Y=G.length;Y--;)(ie=G[Y])&&(le[J[Y]]=!(Le[J[Y]]=ie));if(F){if(T||v){if(T){for(G=[],Y=le.length;Y--;)(ie=le[Y])&&G.push(Le[Y]=ie);T(null,le=[],G,X)}for(Y=le.length;Y--;)(ie=le[Y])&&(G=T?ut(F,ie):ae[Y])>-1&&(F[G]=!(R[G]=ie))}}else le=ui(le===R?le.splice(pe,le.length):le),T?T(null,R,le,X):Ye.apply(R,le)})}function qi(v){for(var C,D,O,T=v.length,N=d.relative[v[0].type],F=N||d.relative[" "],R=N?1:0,q=li(function(Y){return Y===C},F,!0),X=li(function(Y){return ut(C,Y)>-1},F,!0),G=[function(Y,ie,ae){var J=!N&&(ae||ie!==_)||((C=ie).nodeType?q(Y,ie,ae):X(Y,ie,ae));return C=null,J}];R<T;R++)if(D=d.relative[v[R].type])G=[li(Ri(G),D)];else{if(D=d.filter[v[R].type].apply(null,v[R].matches),D[se]){for(O=++R;O<T&&!d.relative[v[O].type];O++);return Wi(R>1&&Ri(G),R>1&&ai(v.slice(0,R-1).concat({value:v[R-2].type===" "?"*":""})).replace(ri,"$1"),D,R<O&&qi(v.slice(R,O)),O<T&&qi(v=v.slice(O)),O<T&&ai(v))}G.push(D)}return Ri(G)}function As(v,C){var D=C.length>0,O=v.length>0,T=function(N,F,R,q,X){var G,Y,ie,ae=0,J="0",pe=N&&[],ye=[],Le=_,le=N||O&&d.find.TAG("*",X),Rt=Ee+=Le==null?1:Math.random()||.1,Wt=le.length;for(X&&(_=F==I||F||X);J!==Wt&&(G=le[J])!=null;J++){if(O&&G){for(Y=0,!F&&G.ownerDocument!=I&&(j(G),R=!ee);ie=v[Y++];)if(ie(G,F||I,R)){q.push(G);break}X&&(Ee=Rt)}D&&((G=!ie&&G)&&ae--,N&&pe.push(G))}if(ae+=J,D&&J!==ae){for(Y=0;ie=C[Y++];)ie(pe,ye,F,R);if(N){if(ae>0)for(;J--;)pe[J]||ye[J]||(ye[J]=Je.call(q));ye=ui(ye)}Ye.apply(q,ye),X&&!N&&ye.length>0&&ae+C.length>1&&oe.uniqueSort(q)}return X&&(Ee=Rt,_=Le),pe};return D?Ne(T):T}return S=oe.compile=function(v,C){var D,O=[],T=[],N=ni[v+" "];if(!N){for(C||(C=g(v)),D=C.length;D--;)N=qi(C[D]),N[se]?O.push(N):T.push(N);N=ni(v,As(T,O)),N.selector=v}return N},x=oe.select=function(v,C,D,O){var T,N,F,R,q,X=typeof v=="function"&&v,G=!O&&g(v=X.selector||v);if(D=D||[],G.length===1){if(N=G[0]=G[0].slice(0),N.length>2&&(F=N[0]).type==="ID"&&C.nodeType===9&&ee&&d.relative[N[1].type]){if(C=(d.find.ID(F.matches[0].replace(Ve,Ge),C)||[])[0],C)X&&(C=C.parentNode);else return D;v=v.slice(N.shift().value.length)}for(T=si.needsContext.test(v)?0:N.length;T--&&(F=N[T],!d.relative[R=F.type]);)if((q=d.find[R])&&(O=q(F.matches[0].replace(Ve,Ge),Ni.test(N[0].type)&&Fi(C.parentNode)||C))){if(N.splice(T,1),v=O.length&&ai(N),!v)return Ye.apply(D,O),D;break}}return(X||S(v,G))(O,C,!ee,D,!C||Ni.test(v)&&Fi(C.parentNode)||C),D},a.sortStable=se.split("").sort(at).join("")===se,a.detectDuplicates=!!B,j(),a.sortDetached=Ae(function(v){return v.compareDocumentPosition(I.createElement("fieldset"))&1}),Ae(function(v){return v.innerHTML="<a href='#'></a>",v.firstChild.getAttribute("href")==="#"})||Bi("type|href|height|width",function(v,C,D){if(!D)return v.getAttribute(C,C.toLowerCase()==="type"?1:2)}),(!a.attributes||!Ae(function(v){return v.innerHTML="<input/>",v.firstChild.setAttribute("value",""),v.firstChild.getAttribute("value")===""}))&&Bi("value",function(v,C,D){if(!D&&v.nodeName.toLowerCase()==="input")return v.defaultValue}),Ae(function(v){return v.getAttribute("disabled")==null})||Bi($i,function(v,C,D){var O;if(!D)return v[C]===!0?C.toLowerCase():(O=v.getAttributeNode(C))&&O.specified?O.value:null}),oe}(e);c.find=nt,c.expr=nt.selectors,c.expr[":"]=c.expr.pseudos,c.uniqueSort=c.unique=nt.uniqueSort,c.text=nt.getText,c.isXMLDoc=nt.isXML,c.contains=nt.contains,c.escapeSelector=nt.escape;var pt=function(n,s,a){for(var d=[],p=a!==void 0;(n=n[s])&&n.nodeType!==9;)if(n.nodeType===1){if(p&&c(n).is(a))break;d.push(n)}return d},tn=function(n,s){for(var a=[];n;n=n.nextSibling)n.nodeType===1&&n!==s&&a.push(n);return a},nn=c.expr.match.needsContext;function je(n,s){return n.nodeName&&n.nodeName.toLowerCase()===s.toLowerCase()}var rn=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function vi(n,s,a){return A(s)?c.grep(n,function(d,p){return!!s.call(d,p,d)!==a}):s.nodeType?c.grep(n,function(d){return d===s!==a}):typeof s!="string"?c.grep(n,function(d){return b.call(s,d)>-1!==a}):c.filter(s,n,a)}c.filter=function(n,s,a){var d=s[0];return a&&(n=":not("+n+")"),s.length===1&&d.nodeType===1?c.find.matchesSelector(d,n)?[d]:[]:c.find.matches(n,c.grep(s,function(p){return p.nodeType===1}))},c.fn.extend({find:function(n){var s,a,d=this.length,p=this;if(typeof n!="string")return this.pushStack(c(n).filter(function(){for(s=0;s<d;s++)if(c.contains(p[s],this))return!0}));for(a=this.pushStack([]),s=0;s<d;s++)c.find(n,p[s],a);return d>1?c.uniqueSort(a):a},filter:function(n){return this.pushStack(vi(this,n||[],!1))},not:function(n){return this.pushStack(vi(this,n||[],!0))},is:function(n){return!!vi(this,typeof n=="string"&&nn.test(n)?c(n):n||[],!1).length}});var sn,Sr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Er=c.fn.init=function(n,s,a){var d,p;if(!n)return this;if(a=a||sn,typeof n=="string")if(n[0]==="<"&&n[n.length-1]===">"&&n.length>=3?d=[null,n,null]:d=Sr.exec(n),d&&(d[1]||!s))if(d[1]){if(s=s instanceof c?s[0]:s,c.merge(this,c.parseHTML(d[1],s&&s.nodeType?s.ownerDocument||s:W,!0)),rn.test(d[1])&&c.isPlainObject(s))for(d in s)A(this[d])?this[d](s[d]):this.attr(d,s[d]);return this}else return p=W.getElementById(d[2]),p&&(this[0]=p,this.length=1),this;else return!s||s.jquery?(s||a).find(n):this.constructor(s).find(n);else{if(n.nodeType)return this[0]=n,this.length=1,this;if(A(n))return a.ready!==void 0?a.ready(n):n(c)}return c.makeArray(n,this)};Er.prototype=c.fn,sn=c(W);var Dr=/^(?:parents|prev(?:Until|All))/,Tr={children:!0,contents:!0,next:!0,prev:!0};c.fn.extend({has:function(n){var s=c(n,this),a=s.length;return this.filter(function(){for(var d=0;d<a;d++)if(c.contains(this,s[d]))return!0})},closest:function(n,s){var a,d=0,p=this.length,m=[],g=typeof n!="string"&&c(n);if(!nn.test(n)){for(;d<p;d++)for(a=this[d];a&&a!==s;a=a.parentNode)if(a.nodeType<11&&(g?g.index(a)>-1:a.nodeType===1&&c.find.matchesSelector(a,n))){m.push(a);break}}return this.pushStack(m.length>1?c.uniqueSort(m):m)},index:function(n){return n?typeof n=="string"?b.call(c(n),this[0]):b.call(this,n.jquery?n[0]:n):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(n,s){return this.pushStack(c.uniqueSort(c.merge(this.get(),c(n,s))))},addBack:function(n){return this.add(n==null?this.prevObject:this.prevObject.filter(n))}});function on(n,s){for(;(n=n[s])&&n.nodeType!==1;);return n}c.each({parent:function(n){var s=n.parentNode;return s&&s.nodeType!==11?s:null},parents:function(n){return pt(n,"parentNode")},parentsUntil:function(n,s,a){return pt(n,"parentNode",a)},next:function(n){return on(n,"nextSibling")},prev:function(n){return on(n,"previousSibling")},nextAll:function(n){return pt(n,"nextSibling")},prevAll:function(n){return pt(n,"previousSibling")},nextUntil:function(n,s,a){return pt(n,"nextSibling",a)},prevUntil:function(n,s,a){return pt(n,"previousSibling",a)},siblings:function(n){return tn((n.parentNode||{}).firstChild,n)},children:function(n){return tn(n.firstChild)},contents:function(n){return n.contentDocument!=null&&r(n.contentDocument)?n.contentDocument:(je(n,"template")&&(n=n.content||n),c.merge([],n.childNodes))}},function(n,s){c.fn[n]=function(a,d){var p=c.map(this,s,a);return n.slice(-5)!=="Until"&&(d=a),d&&typeof d=="string"&&(p=c.filter(d,p)),this.length>1&&(Tr[n]||c.uniqueSort(p),Dr.test(n)&&p.reverse()),this.pushStack(p)}});var Fe=/[^\x20\t\r\n\f]+/g;function _r(n){var s={};return c.each(n.match(Fe)||[],function(a,d){s[d]=!0}),s}c.Callbacks=function(n){n=typeof n=="string"?_r(n):c.extend({},n);var s,a,d,p,m=[],g=[],S=-1,x=function(){for(p=p||n.once,d=s=!0;g.length;S=-1)for(a=g.shift();++S<m.length;)m[S].apply(a[0],a[1])===!1&&n.stopOnFalse&&(S=m.length,a=!1);n.memory||(a=!1),s=!1,p&&(a?m=[]:m="")},_={add:function(){return m&&(a&&!s&&(S=m.length-1,g.push(a)),function M(B){c.each(B,function(j,I){A(I)?(!n.unique||!_.has(I))&&m.push(I):I&&I.length&&me(I)!=="string"&&M(I)})}(arguments),a&&!s&&x()),this},remove:function(){return c.each(arguments,function(M,B){for(var j;(j=c.inArray(B,m,j))>-1;)m.splice(j,1),j<=S&&S--}),this},has:function(M){return M?c.inArray(M,m)>-1:m.length>0},empty:function(){return m&&(m=[]),this},disable:function(){return p=g=[],m=a="",this},disabled:function(){return!m},lock:function(){return p=g=[],!a&&!s&&(m=a=""),this},locked:function(){return!!p},fireWith:function(M,B){return p||(B=B||[],B=[M,B.slice?B.slice():B],g.push(B),s||x()),this},fire:function(){return _.fireWith(this,arguments),this},fired:function(){return!!d}};return _};function mt(n){return n}function Xt(n){throw n}function an(n,s,a,d){var p;try{n&&A(p=n.promise)?p.call(n).done(s).fail(a):n&&A(p=n.then)?p.call(n,s,a):s.apply(void 0,[n].slice(d))}catch(m){a.apply(void 0,[m])}}c.extend({Deferred:function(n){var s=[["notify","progress",c.Callbacks("memory"),c.Callbacks("memory"),2],["resolve","done",c.Callbacks("once memory"),c.Callbacks("once memory"),0,"resolved"],["reject","fail",c.Callbacks("once memory"),c.Callbacks("once memory"),1,"rejected"]],a="pending",d={state:function(){return a},always:function(){return p.done(arguments).fail(arguments),this},catch:function(m){return d.then(null,m)},pipe:function(){var m=arguments;return c.Deferred(function(g){c.each(s,function(S,x){var _=A(m[x[4]])&&m[x[4]];p[x[1]](function(){var M=_&&_.apply(this,arguments);M&&A(M.promise)?M.promise().progress(g.notify).done(g.resolve).fail(g.reject):g[x[0]+"With"](this,_?[M]:arguments)})}),m=null}).promise()},then:function(m,g,S){var x=0;function _(M,B,j,I){return function(){var V=this,ee=arguments,U=function(){var ce,Te;if(!(M<x)){if(ce=j.apply(V,ee),ce===B.promise())throw new TypeError("Thenable self-resolution");Te=ce&&(typeof ce=="object"||typeof ce=="function")&&ce.then,A(Te)?I?Te.call(ce,_(x,B,mt,I),_(x,B,Xt,I)):(x++,Te.call(ce,_(x,B,mt,I),_(x,B,Xt,I),_(x,B,mt,B.notifyWith))):(j!==mt&&(V=void 0,ee=[ce]),(I||B.resolveWith)(V,ee))}},fe=I?U:function(){try{U()}catch(ce){c.Deferred.exceptionHook&&c.Deferred.exceptionHook(ce,fe.stackTrace),M+1>=x&&(j!==Xt&&(V=void 0,ee=[ce]),B.rejectWith(V,ee))}};M?fe():(c.Deferred.getStackHook&&(fe.stackTrace=c.Deferred.getStackHook()),e.setTimeout(fe))}}return c.Deferred(function(M){s[0][3].add(_(0,M,A(S)?S:mt,M.notifyWith)),s[1][3].add(_(0,M,A(m)?m:mt)),s[2][3].add(_(0,M,A(g)?g:Xt))}).promise()},promise:function(m){return m!=null?c.extend(m,d):d}},p={};return c.each(s,function(m,g){var S=g[2],x=g[5];d[g[1]]=S.add,x&&S.add(function(){a=x},s[3-m][2].disable,s[3-m][3].disable,s[0][2].lock,s[0][3].lock),S.add(g[3].fire),p[g[0]]=function(){return p[g[0]+"With"](this===p?void 0:this,arguments),this},p[g[0]+"With"]=S.fireWith}),d.promise(p),n&&n.call(p,p),p},when:function(n){var s=arguments.length,a=s,d=Array(a),p=o.call(arguments),m=c.Deferred(),g=function(S){return function(x){d[S]=this,p[S]=arguments.length>1?o.call(arguments):x,--s||m.resolveWith(d,p)}};if(s<=1&&(an(n,m.done(g(a)).resolve,m.reject,!s),m.state()==="pending"||A(p[a]&&p[a].then)))return m.then();for(;a--;)an(p[a],g(a),m.reject);return m.promise()}});var Lr=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;c.Deferred.exceptionHook=function(n,s){e.console&&e.console.warn&&n&&Lr.test(n.name)&&e.console.warn("jQuery.Deferred exception: "+n.message,n.stack,s)},c.readyException=function(n){e.setTimeout(function(){throw n})};var yi=c.Deferred();c.fn.ready=function(n){return yi.then(n).catch(function(s){c.readyException(s)}),this},c.extend({isReady:!1,readyWait:1,ready:function(n){(n===!0?--c.readyWait:c.isReady)||(c.isReady=!0,!(n!==!0&&--c.readyWait>0)&&yi.resolveWith(W,[c]))}}),c.ready.then=yi.then;function Jt(){W.removeEventListener("DOMContentLoaded",Jt),e.removeEventListener("load",Jt),c.ready()}W.readyState==="complete"||W.readyState!=="loading"&&!W.documentElement.doScroll?e.setTimeout(c.ready):(W.addEventListener("DOMContentLoaded",Jt),e.addEventListener("load",Jt));var Ue=function(n,s,a,d,p,m,g){var S=0,x=n.length,_=a==null;if(me(a)==="object"){p=!0;for(S in a)Ue(n,s,S,a[S],!0,m,g)}else if(d!==void 0&&(p=!0,A(d)||(g=!0),_&&(g?(s.call(n,d),s=null):(_=s,s=function(M,B,j){return _.call(c(M),j)})),s))for(;S<x;S++)s(n[S],a,g?d:d.call(n[S],S,s(n[S],a)));return p?n:_?s.call(n):x?s(n[0],a):m},Pr=/^-ms-/,jr=/-([a-z])/g;function Mr(n,s){return s.toUpperCase()}function Re(n){return n.replace(Pr,"ms-").replace(jr,Mr)}var Pt=function(n){return n.nodeType===1||n.nodeType===9||!+n.nodeType};function jt(){this.expando=c.expando+jt.uid++}jt.uid=1,jt.prototype={cache:function(n){var s=n[this.expando];return s||(s={},Pt(n)&&(n.nodeType?n[this.expando]=s:Object.defineProperty(n,this.expando,{value:s,configurable:!0}))),s},set:function(n,s,a){var d,p=this.cache(n);if(typeof s=="string")p[Re(s)]=a;else for(d in s)p[Re(d)]=s[d];return p},get:function(n,s){return s===void 0?this.cache(n):n[this.expando]&&n[this.expando][Re(s)]},access:function(n,s,a){return s===void 0||s&&typeof s=="string"&&a===void 0?this.get(n,s):(this.set(n,s,a),a!==void 0?a:s)},remove:function(n,s){var a,d=n[this.expando];if(d!==void 0){if(s!==void 0)for(Array.isArray(s)?s=s.map(Re):(s=Re(s),s=s in d?[s]:s.match(Fe)||[]),a=s.length;a--;)delete d[s[a]];(s===void 0||c.isEmptyObject(d))&&(n.nodeType?n[this.expando]=void 0:delete n[this.expando])}},hasData:function(n){var s=n[this.expando];return s!==void 0&&!c.isEmptyObject(s)}};var Q=new jt,xe=new jt,Ir=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ar=/[A-Z]/g;function $r(n){return n==="true"?!0:n==="false"?!1:n==="null"?null:n===+n+""?+n:Ir.test(n)?JSON.parse(n):n}function ln(n,s,a){var d;if(a===void 0&&n.nodeType===1)if(d="data-"+s.replace(Ar,"-$&").toLowerCase(),a=n.getAttribute(d),typeof a=="string"){try{a=$r(a)}catch{}xe.set(n,s,a)}else a=void 0;return a}c.extend({hasData:function(n){return xe.hasData(n)||Q.hasData(n)},data:function(n,s,a){return xe.access(n,s,a)},removeData:function(n,s){xe.remove(n,s)},_data:function(n,s,a){return Q.access(n,s,a)},_removeData:function(n,s){Q.remove(n,s)}}),c.fn.extend({data:function(n,s){var a,d,p,m=this[0],g=m&&m.attributes;if(n===void 0){if(this.length&&(p=xe.get(m),m.nodeType===1&&!Q.get(m,"hasDataAttrs"))){for(a=g.length;a--;)g[a]&&(d=g[a].name,d.indexOf("data-")===0&&(d=Re(d.slice(5)),ln(m,d,p[d])));Q.set(m,"hasDataAttrs",!0)}return p}return typeof n=="object"?this.each(function(){xe.set(this,n)}):Ue(this,function(S){var x;if(m&&S===void 0)return x=xe.get(m,n),x!==void 0||(x=ln(m,n),x!==void 0)?x:void 0;this.each(function(){xe.set(this,n,S)})},null,s,arguments.length>1,null,!0)},removeData:function(n){return this.each(function(){xe.remove(this,n)})}}),c.extend({queue:function(n,s,a){var d;if(n)return s=(s||"fx")+"queue",d=Q.get(n,s),a&&(!d||Array.isArray(a)?d=Q.access(n,s,c.makeArray(a)):d.push(a)),d||[]},dequeue:function(n,s){s=s||"fx";var a=c.queue(n,s),d=a.length,p=a.shift(),m=c._queueHooks(n,s),g=function(){c.dequeue(n,s)};p==="inprogress"&&(p=a.shift(),d--),p&&(s==="fx"&&a.unshift("inprogress"),delete m.stop,p.call(n,g,m)),!d&&m&&m.empty.fire()},_queueHooks:function(n,s){var a=s+"queueHooks";return Q.get(n,a)||Q.access(n,a,{empty:c.Callbacks("once memory").add(function(){Q.remove(n,[s+"queue",a])})})}}),c.fn.extend({queue:function(n,s){var a=2;return typeof n!="string"&&(s=n,n="fx",a--),arguments.length<a?c.queue(this[0],n):s===void 0?this:this.each(function(){var d=c.queue(this,n,s);c._queueHooks(this,n),n==="fx"&&d[0]!=="inprogress"&&c.dequeue(this,n)})},dequeue:function(n){return this.each(function(){c.dequeue(this,n)})},clearQueue:function(n){return this.queue(n||"fx",[])},promise:function(n,s){var a,d=1,p=c.Deferred(),m=this,g=this.length,S=function(){--d||p.resolveWith(m,[m])};for(typeof n!="string"&&(s=n,n=void 0),n=n||"fx";g--;)a=Q.get(m[g],n+"queueHooks"),a&&a.empty&&(d++,a.empty.add(S));return S(),p.promise(s)}});var un=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Mt=new RegExp("^(?:([+-])=|)("+un+")([a-z%]*)$","i"),Ke=["Top","Right","Bottom","Left"],rt=W.documentElement,gt=function(n){return c.contains(n.ownerDocument,n)},Or={composed:!0};rt.getRootNode&&(gt=function(n){return c.contains(n.ownerDocument,n)||n.getRootNode(Or)===n.ownerDocument});var Yt=function(n,s){return n=s||n,n.style.display==="none"||n.style.display===""&&gt(n)&&c.css(n,"display")==="none"};function dn(n,s,a,d){var p,m,g=20,S=d?function(){return d.cur()}:function(){return c.css(n,s,"")},x=S(),_=a&&a[3]||(c.cssNumber[s]?"":"px"),M=n.nodeType&&(c.cssNumber[s]||_!=="px"&&+x)&&Mt.exec(c.css(n,s));if(M&&M[3]!==_){for(x=x/2,_=_||M[3],M=+x||1;g--;)c.style(n,s,M+_),(1-m)*(1-(m=S()/x||.5))<=0&&(g=0),M=M/m;M=M*2,c.style(n,s,M+_),a=a||[]}return a&&(M=+M||+x||0,p=a[1]?M+(a[1]+1)*a[2]:+a[2],d&&(d.unit=_,d.start=M,d.end=p)),p}var cn={};function Nr(n){var s,a=n.ownerDocument,d=n.nodeName,p=cn[d];return p||(s=a.body.appendChild(a.createElement(d)),p=c.css(s,"display"),s.parentNode.removeChild(s),p==="none"&&(p="block"),cn[d]=p,p)}function bt(n,s){for(var a,d,p=[],m=0,g=n.length;m<g;m++)d=n[m],d.style&&(a=d.style.display,s?(a==="none"&&(p[m]=Q.get(d,"display")||null,p[m]||(d.style.display="")),d.style.display===""&&Yt(d)&&(p[m]=Nr(d))):a!=="none"&&(p[m]="none",Q.set(d,"display",a)));for(m=0;m<g;m++)p[m]!=null&&(n[m].style.display=p[m]);return n}c.fn.extend({show:function(){return bt(this,!0)},hide:function(){return bt(this)},toggle:function(n){return typeof n=="boolean"?n?this.show():this.hide():this.each(function(){Yt(this)?c(this).show():c(this).hide()})}});var It=/^(?:checkbox|radio)$/i,hn=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,fn=/^$|^module$|\/(?:java|ecma)script/i;(function(){var n=W.createDocumentFragment(),s=n.appendChild(W.createElement("div")),a=W.createElement("input");a.setAttribute("type","radio"),a.setAttribute("checked","checked"),a.setAttribute("name","t"),s.appendChild(a),z.checkClone=s.cloneNode(!0).cloneNode(!0).lastChild.checked,s.innerHTML="<textarea>x</textarea>",z.noCloneChecked=!!s.cloneNode(!0).lastChild.defaultValue,s.innerHTML="<option></option>",z.option=!!s.lastChild})();var Me={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Me.tbody=Me.tfoot=Me.colgroup=Me.caption=Me.thead,Me.th=Me.td,z.option||(Me.optgroup=Me.option=[1,"<select multiple='multiple'>","</select>"]);function Ce(n,s){var a;return typeof n.getElementsByTagName<"u"?a=n.getElementsByTagName(s||"*"):typeof n.querySelectorAll<"u"?a=n.querySelectorAll(s||"*"):a=[],s===void 0||s&&je(n,s)?c.merge([n],a):a}function ki(n,s){for(var a=0,d=n.length;a<d;a++)Q.set(n[a],"globalEval",!s||Q.get(s[a],"globalEval"))}var Br=/<|&#?\w+;/;function pn(n,s,a,d,p){for(var m,g,S,x,_,M,B=s.createDocumentFragment(),j=[],I=0,V=n.length;I<V;I++)if(m=n[I],m||m===0)if(me(m)==="object")c.merge(j,m.nodeType?[m]:m);else if(!Br.test(m))j.push(s.createTextNode(m));else{for(g=g||B.appendChild(s.createElement("div")),S=(hn.exec(m)||["",""])[1].toLowerCase(),x=Me[S]||Me._default,g.innerHTML=x[1]+c.htmlPrefilter(m)+x[2],M=x[0];M--;)g=g.lastChild;c.merge(j,g.childNodes),g=B.firstChild,g.textContent=""}for(B.textContent="",I=0;m=j[I++];){if(d&&c.inArray(m,d)>-1){p&&p.push(m);continue}if(_=gt(m),g=Ce(B.appendChild(m),"script"),_&&ki(g),a)for(M=0;m=g[M++];)fn.test(m.type||"")&&a.push(m)}return B}var mn=/^([^.]*)(?:\.(.+)|)/;function wt(){return!0}function vt(){return!1}function Fr(n,s){return n===Rr()==(s==="focus")}function Rr(){try{return W.activeElement}catch{}}function xi(n,s,a,d,p,m){var g,S;if(typeof s=="object"){typeof a!="string"&&(d=d||a,a=void 0);for(S in s)xi(n,S,a,d,s[S],m);return n}if(d==null&&p==null?(p=a,d=a=void 0):p==null&&(typeof a=="string"?(p=d,d=void 0):(p=d,d=a,a=void 0)),p===!1)p=vt;else if(!p)return n;return m===1&&(g=p,p=function(x){return c().off(x),g.apply(this,arguments)},p.guid=g.guid||(g.guid=c.guid++)),n.each(function(){c.event.add(this,s,p,d,a)})}c.event={global:{},add:function(n,s,a,d,p){var m,g,S,x,_,M,B,j,I,V,ee,U=Q.get(n);if(Pt(n))for(a.handler&&(m=a,a=m.handler,p=m.selector),p&&c.find.matchesSelector(rt,p),a.guid||(a.guid=c.guid++),(x=U.events)||(x=U.events=Object.create(null)),(g=U.handle)||(g=U.handle=function(fe){return typeof c<"u"&&c.event.triggered!==fe.type?c.event.dispatch.apply(n,arguments):void 0}),s=(s||"").match(Fe)||[""],_=s.length;_--;)S=mn.exec(s[_])||[],I=ee=S[1],V=(S[2]||"").split(".").sort(),I&&(B=c.event.special[I]||{},I=(p?B.delegateType:B.bindType)||I,B=c.event.special[I]||{},M=c.extend({type:I,origType:ee,data:d,handler:a,guid:a.guid,selector:p,needsContext:p&&c.expr.match.needsContext.test(p),namespace:V.join(".")},m),(j=x[I])||(j=x[I]=[],j.delegateCount=0,(!B.setup||B.setup.call(n,d,V,g)===!1)&&n.addEventListener&&n.addEventListener(I,g)),B.add&&(B.add.call(n,M),M.handler.guid||(M.handler.guid=a.guid)),p?j.splice(j.delegateCount++,0,M):j.push(M),c.event.global[I]=!0)},remove:function(n,s,a,d,p){var m,g,S,x,_,M,B,j,I,V,ee,U=Q.hasData(n)&&Q.get(n);if(!(!U||!(x=U.events))){for(s=(s||"").match(Fe)||[""],_=s.length;_--;){if(S=mn.exec(s[_])||[],I=ee=S[1],V=(S[2]||"").split(".").sort(),!I){for(I in x)c.event.remove(n,I+s[_],a,d,!0);continue}for(B=c.event.special[I]||{},I=(d?B.delegateType:B.bindType)||I,j=x[I]||[],S=S[2]&&new RegExp("(^|\\.)"+V.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=m=j.length;m--;)M=j[m],(p||ee===M.origType)&&(!a||a.guid===M.guid)&&(!S||S.test(M.namespace))&&(!d||d===M.selector||d==="**"&&M.selector)&&(j.splice(m,1),M.selector&&j.delegateCount--,B.remove&&B.remove.call(n,M));g&&!j.length&&((!B.teardown||B.teardown.call(n,V,U.handle)===!1)&&c.removeEvent(n,I,U.handle),delete x[I])}c.isEmptyObject(x)&&Q.remove(n,"handle events")}},dispatch:function(n){var s,a,d,p,m,g,S=new Array(arguments.length),x=c.event.fix(n),_=(Q.get(this,"events")||Object.create(null))[x.type]||[],M=c.event.special[x.type]||{};for(S[0]=x,s=1;s<arguments.length;s++)S[s]=arguments[s];if(x.delegateTarget=this,!(M.preDispatch&&M.preDispatch.call(this,x)===!1)){for(g=c.event.handlers.call(this,x,_),s=0;(p=g[s++])&&!x.isPropagationStopped();)for(x.currentTarget=p.elem,a=0;(m=p.handlers[a++])&&!x.isImmediatePropagationStopped();)(!x.rnamespace||m.namespace===!1||x.rnamespace.test(m.namespace))&&(x.handleObj=m,x.data=m.data,d=((c.event.special[m.origType]||{}).handle||m.handler).apply(p.elem,S),d!==void 0&&(x.result=d)===!1&&(x.preventDefault(),x.stopPropagation()));return M.postDispatch&&M.postDispatch.call(this,x),x.result}},handlers:function(n,s){var a,d,p,m,g,S=[],x=s.delegateCount,_=n.target;if(x&&_.nodeType&&!(n.type==="click"&&n.button>=1)){for(;_!==this;_=_.parentNode||this)if(_.nodeType===1&&!(n.type==="click"&&_.disabled===!0)){for(m=[],g={},a=0;a<x;a++)d=s[a],p=d.selector+" ",g[p]===void 0&&(g[p]=d.needsContext?c(p,this).index(_)>-1:c.find(p,this,null,[_]).length),g[p]&&m.push(d);m.length&&S.push({elem:_,handlers:m})}}return _=this,x<s.length&&S.push({elem:_,handlers:s.slice(x)}),S},addProp:function(n,s){Object.defineProperty(c.Event.prototype,n,{enumerable:!0,configurable:!0,get:A(s)?function(){if(this.originalEvent)return s(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[n]},set:function(a){Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:a})}})},fix:function(n){return n[c.expando]?n:new c.Event(n)},special:{load:{noBubble:!0},click:{setup:function(n){var s=this||n;return It.test(s.type)&&s.click&&je(s,"input")&&Zt(s,"click",wt),!1},trigger:function(n){var s=this||n;return It.test(s.type)&&s.click&&je(s,"input")&&Zt(s,"click"),!0},_default:function(n){var s=n.target;return It.test(s.type)&&s.click&&je(s,"input")&&Q.get(s,"click")||je(s,"a")}},beforeunload:{postDispatch:function(n){n.result!==void 0&&n.originalEvent&&(n.originalEvent.returnValue=n.result)}}}};function Zt(n,s,a){if(!a){Q.get(n,s)===void 0&&c.event.add(n,s,wt);return}Q.set(n,s,!1),c.event.add(n,s,{namespace:!1,handler:function(d){var p,m,g=Q.get(this,s);if(d.isTrigger&1&&this[s]){if(g.length)(c.event.special[s]||{}).delegateType&&d.stopPropagation();else if(g=o.call(arguments),Q.set(this,s,g),p=a(this,s),this[s](),m=Q.get(this,s),g!==m||p?Q.set(this,s,!1):m={},g!==m)return d.stopImmediatePropagation(),d.preventDefault(),m&&m.value}else g.length&&(Q.set(this,s,{value:c.event.trigger(c.extend(g[0],c.Event.prototype),g.slice(1),this)}),d.stopImmediatePropagation())}})}c.removeEvent=function(n,s,a){n.removeEventListener&&n.removeEventListener(s,a)},c.Event=function(n,s){if(!(this instanceof c.Event))return new c.Event(n,s);n&&n.type?(this.originalEvent=n,this.type=n.type,this.isDefaultPrevented=n.defaultPrevented||n.defaultPrevented===void 0&&n.returnValue===!1?wt:vt,this.target=n.target&&n.target.nodeType===3?n.target.parentNode:n.target,this.currentTarget=n.currentTarget,this.relatedTarget=n.relatedTarget):this.type=n,s&&c.extend(this,s),this.timeStamp=n&&n.timeStamp||Date.now(),this[c.expando]=!0},c.Event.prototype={constructor:c.Event,isDefaultPrevented:vt,isPropagationStopped:vt,isImmediatePropagationStopped:vt,isSimulated:!1,preventDefault:function(){var n=this.originalEvent;this.isDefaultPrevented=wt,n&&!this.isSimulated&&n.preventDefault()},stopPropagation:function(){var n=this.originalEvent;this.isPropagationStopped=wt,n&&!this.isSimulated&&n.stopPropagation()},stopImmediatePropagation:function(){var n=this.originalEvent;this.isImmediatePropagationStopped=wt,n&&!this.isSimulated&&n.stopImmediatePropagation(),this.stopPropagation()}},c.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},c.event.addProp),c.each({focus:"focusin",blur:"focusout"},function(n,s){c.event.special[n]={setup:function(){return Zt(this,n,Fr),!1},trigger:function(){return Zt(this,n),!0},_default:function(a){return Q.get(a.target,n)},delegateType:s}}),c.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(n,s){c.event.special[n]={delegateType:s,bindType:s,handle:function(a){var d,p=this,m=a.relatedTarget,g=a.handleObj;return(!m||m!==p&&!c.contains(p,m))&&(a.type=g.origType,d=g.handler.apply(this,arguments),a.type=s),d}}}),c.fn.extend({on:function(n,s,a,d){return xi(this,n,s,a,d)},one:function(n,s,a,d){return xi(this,n,s,a,d,1)},off:function(n,s,a){var d,p;if(n&&n.preventDefault&&n.handleObj)return d=n.handleObj,c(n.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if(typeof n=="object"){for(p in n)this.off(p,s,n[p]);return this}return(s===!1||typeof s=="function")&&(a=s,s=void 0),a===!1&&(a=vt),this.each(function(){c.event.remove(this,n,a,s)})}});var Wr=/<script|<style|<link/i,qr=/checked\s*(?:[^=]|=\s*.checked.)/i,Hr=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function gn(n,s){return je(n,"table")&&je(s.nodeType!==11?s:s.firstChild,"tr")&&c(n).children("tbody")[0]||n}function zr(n){return n.type=(n.getAttribute("type")!==null)+"/"+n.type,n}function Ur(n){return(n.type||"").slice(0,5)==="true/"?n.type=n.type.slice(5):n.removeAttribute("type"),n}function bn(n,s){var a,d,p,m,g,S,x;if(s.nodeType===1){if(Q.hasData(n)&&(m=Q.get(n),x=m.events,x)){Q.remove(s,"handle events");for(p in x)for(a=0,d=x[p].length;a<d;a++)c.event.add(s,p,x[p][a])}xe.hasData(n)&&(g=xe.access(n),S=c.extend({},g),xe.set(s,S))}}function Kr(n,s){var a=s.nodeName.toLowerCase();a==="input"&&It.test(n.type)?s.checked=n.checked:(a==="input"||a==="textarea")&&(s.defaultValue=n.defaultValue)}function yt(n,s,a,d){s=u(s);var p,m,g,S,x,_,M=0,B=n.length,j=B-1,I=s[0],V=A(I);if(V||B>1&&typeof I=="string"&&!z.checkClone&&qr.test(I))return n.each(function(ee){var U=n.eq(ee);V&&(s[0]=I.call(this,ee,U.html())),yt(U,s,a,d)});if(B&&(p=pn(s,n[0].ownerDocument,!1,n,d),m=p.firstChild,p.childNodes.length===1&&(p=m),m||d)){for(g=c.map(Ce(p,"script"),zr),S=g.length;M<B;M++)x=p,M!==j&&(x=c.clone(x,!0,!0),S&&c.merge(g,Ce(x,"script"))),a.call(n[M],x,M);if(S)for(_=g[g.length-1].ownerDocument,c.map(g,Ur),M=0;M<S;M++)x=g[M],fn.test(x.type||"")&&!Q.access(x,"globalEval")&&c.contains(_,x)&&(x.src&&(x.type||"").toLowerCase()!=="module"?c._evalUrl&&!x.noModule&&c._evalUrl(x.src,{nonce:x.nonce||x.getAttribute("nonce")},_):ve(x.textContent.replace(Hr,""),x,_))}return n}function wn(n,s,a){for(var d,p=s?c.filter(s,n):n,m=0;(d=p[m])!=null;m++)!a&&d.nodeType===1&&c.cleanData(Ce(d)),d.parentNode&&(a&&gt(d)&&ki(Ce(d,"script")),d.parentNode.removeChild(d));return n}c.extend({htmlPrefilter:function(n){return n},clone:function(n,s,a){var d,p,m,g,S=n.cloneNode(!0),x=gt(n);if(!z.noCloneChecked&&(n.nodeType===1||n.nodeType===11)&&!c.isXMLDoc(n))for(g=Ce(S),m=Ce(n),d=0,p=m.length;d<p;d++)Kr(m[d],g[d]);if(s)if(a)for(m=m||Ce(n),g=g||Ce(S),d=0,p=m.length;d<p;d++)bn(m[d],g[d]);else bn(n,S);return g=Ce(S,"script"),g.length>0&&ki(g,!x&&Ce(n,"script")),S},cleanData:function(n){for(var s,a,d,p=c.event.special,m=0;(a=n[m])!==void 0;m++)if(Pt(a)){if(s=a[Q.expando]){if(s.events)for(d in s.events)p[d]?c.event.remove(a,d):c.removeEvent(a,d,s.handle);a[Q.expando]=void 0}a[xe.expando]&&(a[xe.expando]=void 0)}}}),c.fn.extend({detach:function(n){return wn(this,n,!0)},remove:function(n){return wn(this,n)},text:function(n){return Ue(this,function(s){return s===void 0?c.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=s)})},null,n,arguments.length)},append:function(){return yt(this,arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var s=gn(this,n);s.appendChild(n)}})},prepend:function(){return yt(this,arguments,function(n){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var s=gn(this,n);s.insertBefore(n,s.firstChild)}})},before:function(){return yt(this,arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this)})},after:function(){return yt(this,arguments,function(n){this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling)})},empty:function(){for(var n,s=0;(n=this[s])!=null;s++)n.nodeType===1&&(c.cleanData(Ce(n,!1)),n.textContent="");return this},clone:function(n,s){return n=n??!1,s=s??n,this.map(function(){return c.clone(this,n,s)})},html:function(n){return Ue(this,function(s){var a=this[0]||{},d=0,p=this.length;if(s===void 0&&a.nodeType===1)return a.innerHTML;if(typeof s=="string"&&!Wr.test(s)&&!Me[(hn.exec(s)||["",""])[1].toLowerCase()]){s=c.htmlPrefilter(s);try{for(;d<p;d++)a=this[d]||{},a.nodeType===1&&(c.cleanData(Ce(a,!1)),a.innerHTML=s);a=0}catch{}}a&&this.empty().append(s)},null,n,arguments.length)},replaceWith:function(){var n=[];return yt(this,arguments,function(s){var a=this.parentNode;c.inArray(this,n)<0&&(c.cleanData(Ce(this)),a&&a.replaceChild(s,this))},n)}}),c.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(n,s){c.fn[n]=function(a){for(var d,p=[],m=c(a),g=m.length-1,S=0;S<=g;S++)d=S===g?this:this.clone(!0),c(m[S])[s](d),h.apply(p,d.get());return this.pushStack(p)}});var Ci=new RegExp("^("+un+")(?!px)[a-z%]+$","i"),Si=/^--/,ei=function(n){var s=n.ownerDocument.defaultView;return(!s||!s.opener)&&(s=e),s.getComputedStyle(n)},vn=function(n,s,a){var d,p,m={};for(p in s)m[p]=n.style[p],n.style[p]=s[p];d=a.call(n);for(p in s)n.style[p]=m[p];return d},Vr=new RegExp(Ke.join("|"),"i"),yn="[\\x20\\t\\r\\n\\f]",Gr=new RegExp("^"+yn+"+|((?:^|[^\\\\])(?:\\\\.)*)"+yn+"+$","g");(function(){function n(){if(_){x.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",_.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",rt.appendChild(x).appendChild(_);var M=e.getComputedStyle(_);a=M.top!=="1%",S=s(M.marginLeft)===12,_.style.right="60%",m=s(M.right)===36,d=s(M.width)===36,_.style.position="absolute",p=s(_.offsetWidth/3)===12,rt.removeChild(x),_=null}}function s(M){return Math.round(parseFloat(M))}var a,d,p,m,g,S,x=W.createElement("div"),_=W.createElement("div");_.style&&(_.style.backgroundClip="content-box",_.cloneNode(!0).style.backgroundClip="",z.clearCloneStyle=_.style.backgroundClip==="content-box",c.extend(z,{boxSizingReliable:function(){return n(),d},pixelBoxStyles:function(){return n(),m},pixelPosition:function(){return n(),a},reliableMarginLeft:function(){return n(),S},scrollboxSize:function(){return n(),p},reliableTrDimensions:function(){var M,B,j,I;return g==null&&(M=W.createElement("table"),B=W.createElement("tr"),j=W.createElement("div"),M.style.cssText="position:absolute;left:-11111px;border-collapse:separate",B.style.cssText="border:1px solid",B.style.height="1px",j.style.height="9px",j.style.display="block",rt.appendChild(M).appendChild(B).appendChild(j),I=e.getComputedStyle(B),g=parseInt(I.height,10)+parseInt(I.borderTopWidth,10)+parseInt(I.borderBottomWidth,10)===B.offsetHeight,rt.removeChild(M)),g}}))})();function At(n,s,a){var d,p,m,g,S=Si.test(s),x=n.style;return a=a||ei(n),a&&(g=a.getPropertyValue(s)||a[s],S&&g&&(g=g.replace(Gr,"$1")||void 0),g===""&&!gt(n)&&(g=c.style(n,s)),!z.pixelBoxStyles()&&Ci.test(g)&&Vr.test(s)&&(d=x.width,p=x.minWidth,m=x.maxWidth,x.minWidth=x.maxWidth=x.width=g,g=a.width,x.width=d,x.minWidth=p,x.maxWidth=m)),g!==void 0?g+"":g}function kn(n,s){return{get:function(){if(n()){delete this.get;return}return(this.get=s).apply(this,arguments)}}}var xn=["Webkit","Moz","ms"],Cn=W.createElement("div").style,Sn={};function Qr(n){for(var s=n[0].toUpperCase()+n.slice(1),a=xn.length;a--;)if(n=xn[a]+s,n in Cn)return n}function Ei(n){var s=c.cssProps[n]||Sn[n];return s||(n in Cn?n:Sn[n]=Qr(n)||n)}var Xr=/^(none|table(?!-c[ea]).+)/,Jr={position:"absolute",visibility:"hidden",display:"block"},En={letterSpacing:"0",fontWeight:"400"};function Dn(n,s,a){var d=Mt.exec(s);return d?Math.max(0,d[2]-(a||0))+(d[3]||"px"):s}function Di(n,s,a,d,p,m){var g=s==="width"?1:0,S=0,x=0;if(a===(d?"border":"content"))return 0;for(;g<4;g+=2)a==="margin"&&(x+=c.css(n,a+Ke[g],!0,p)),d?(a==="content"&&(x-=c.css(n,"padding"+Ke[g],!0,p)),a!=="margin"&&(x-=c.css(n,"border"+Ke[g]+"Width",!0,p))):(x+=c.css(n,"padding"+Ke[g],!0,p),a!=="padding"?x+=c.css(n,"border"+Ke[g]+"Width",!0,p):S+=c.css(n,"border"+Ke[g]+"Width",!0,p));return!d&&m>=0&&(x+=Math.max(0,Math.ceil(n["offset"+s[0].toUpperCase()+s.slice(1)]-m-x-S-.5))||0),x}function Tn(n,s,a){var d=ei(n),p=!z.boxSizingReliable()||a,m=p&&c.css(n,"boxSizing",!1,d)==="border-box",g=m,S=At(n,s,d),x="offset"+s[0].toUpperCase()+s.slice(1);if(Ci.test(S)){if(!a)return S;S="auto"}return(!z.boxSizingReliable()&&m||!z.reliableTrDimensions()&&je(n,"tr")||S==="auto"||!parseFloat(S)&&c.css(n,"display",!1,d)==="inline")&&n.getClientRects().length&&(m=c.css(n,"boxSizing",!1,d)==="border-box",g=x in n,g&&(S=n[x])),S=parseFloat(S)||0,S+Di(n,s,a||(m?"border":"content"),g,d,S)+"px"}c.extend({cssHooks:{opacity:{get:function(n,s){if(s){var a=At(n,"opacity");return a===""?"1":a}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(n,s,a,d){if(!(!n||n.nodeType===3||n.nodeType===8||!n.style)){var p,m,g,S=Re(s),x=Si.test(s),_=n.style;if(x||(s=Ei(S)),g=c.cssHooks[s]||c.cssHooks[S],a!==void 0){if(m=typeof a,m==="string"&&(p=Mt.exec(a))&&p[1]&&(a=dn(n,s,p),m="number"),a==null||a!==a)return;m==="number"&&!x&&(a+=p&&p[3]||(c.cssNumber[S]?"":"px")),!z.clearCloneStyle&&a===""&&s.indexOf("background")===0&&(_[s]="inherit"),(!g||!("set"in g)||(a=g.set(n,a,d))!==void 0)&&(x?_.setProperty(s,a):_[s]=a)}else return g&&"get"in g&&(p=g.get(n,!1,d))!==void 0?p:_[s]}},css:function(n,s,a,d){var p,m,g,S=Re(s),x=Si.test(s);return x||(s=Ei(S)),g=c.cssHooks[s]||c.cssHooks[S],g&&"get"in g&&(p=g.get(n,!0,a)),p===void 0&&(p=At(n,s,d)),p==="normal"&&s in En&&(p=En[s]),a===""||a?(m=parseFloat(p),a===!0||isFinite(m)?m||0:p):p}}),c.each(["height","width"],function(n,s){c.cssHooks[s]={get:function(a,d,p){if(d)return Xr.test(c.css(a,"display"))&&(!a.getClientRects().length||!a.getBoundingClientRect().width)?vn(a,Jr,function(){return Tn(a,s,p)}):Tn(a,s,p)},set:function(a,d,p){var m,g=ei(a),S=!z.scrollboxSize()&&g.position==="absolute",x=S||p,_=x&&c.css(a,"boxSizing",!1,g)==="border-box",M=p?Di(a,s,p,_,g):0;return _&&S&&(M-=Math.ceil(a["offset"+s[0].toUpperCase()+s.slice(1)]-parseFloat(g[s])-Di(a,s,"border",!1,g)-.5)),M&&(m=Mt.exec(d))&&(m[3]||"px")!=="px"&&(a.style[s]=d,d=c.css(a,s)),Dn(a,d,M)}}}),c.cssHooks.marginLeft=kn(z.reliableMarginLeft,function(n,s){if(s)return(parseFloat(At(n,"marginLeft"))||n.getBoundingClientRect().left-vn(n,{marginLeft:0},function(){return n.getBoundingClientRect().left}))+"px"}),c.each({margin:"",padding:"",border:"Width"},function(n,s){c.cssHooks[n+s]={expand:function(a){for(var d=0,p={},m=typeof a=="string"?a.split(" "):[a];d<4;d++)p[n+Ke[d]+s]=m[d]||m[d-2]||m[0];return p}},n!=="margin"&&(c.cssHooks[n+s].set=Dn)}),c.fn.extend({css:function(n,s){return Ue(this,function(a,d,p){var m,g,S={},x=0;if(Array.isArray(d)){for(m=ei(a),g=d.length;x<g;x++)S[d[x]]=c.css(a,d[x],!1,m);return S}return p!==void 0?c.style(a,d,p):c.css(a,d)},n,s,arguments.length>1)}});function Se(n,s,a,d,p){return new Se.prototype.init(n,s,a,d,p)}c.Tween=Se,Se.prototype={constructor:Se,init:function(n,s,a,d,p,m){this.elem=n,this.prop=a,this.easing=p||c.easing._default,this.options=s,this.start=this.now=this.cur(),this.end=d,this.unit=m||(c.cssNumber[a]?"":"px")},cur:function(){var n=Se.propHooks[this.prop];return n&&n.get?n.get(this):Se.propHooks._default.get(this)},run:function(n){var s,a=Se.propHooks[this.prop];return this.options.duration?this.pos=s=c.easing[this.easing](n,this.options.duration*n,0,1,this.options.duration):this.pos=s=n,this.now=(this.end-this.start)*s+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),a&&a.set?a.set(this):Se.propHooks._default.set(this),this}},Se.prototype.init.prototype=Se.prototype,Se.propHooks={_default:{get:function(n){var s;return n.elem.nodeType!==1||n.elem[n.prop]!=null&&n.elem.style[n.prop]==null?n.elem[n.prop]:(s=c.css(n.elem,n.prop,""),!s||s==="auto"?0:s)},set:function(n){c.fx.step[n.prop]?c.fx.step[n.prop](n):n.elem.nodeType===1&&(c.cssHooks[n.prop]||n.elem.style[Ei(n.prop)]!=null)?c.style(n.elem,n.prop,n.now+n.unit):n.elem[n.prop]=n.now}}},Se.propHooks.scrollTop=Se.propHooks.scrollLeft={set:function(n){n.elem.nodeType&&n.elem.parentNode&&(n.elem[n.prop]=n.now)}},c.easing={linear:function(n){return n},swing:function(n){return .5-Math.cos(n*Math.PI)/2},_default:"swing"},c.fx=Se.prototype.init,c.fx.step={};var kt,ti,Yr=/^(?:toggle|show|hide)$/,Zr=/queueHooks$/;function Ti(){ti&&(W.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(Ti):e.setTimeout(Ti,c.fx.interval),c.fx.tick())}function _n(){return e.setTimeout(function(){kt=void 0}),kt=Date.now()}function ii(n,s){var a,d=0,p={height:n};for(s=s?1:0;d<4;d+=2-s)a=Ke[d],p["margin"+a]=p["padding"+a]=n;return s&&(p.opacity=p.width=n),p}function Ln(n,s,a){for(var d,p=(Oe.tweeners[s]||[]).concat(Oe.tweeners["*"]),m=0,g=p.length;m<g;m++)if(d=p[m].call(a,s,n))return d}function es(n,s,a){var d,p,m,g,S,x,_,M,B="width"in s||"height"in s,j=this,I={},V=n.style,ee=n.nodeType&&Yt(n),U=Q.get(n,"fxshow");a.queue||(g=c._queueHooks(n,"fx"),g.unqueued==null&&(g.unqueued=0,S=g.empty.fire,g.empty.fire=function(){g.unqueued||S()}),g.unqueued++,j.always(function(){j.always(function(){g.unqueued--,c.queue(n,"fx").length||g.empty.fire()})}));for(d in s)if(p=s[d],Yr.test(p)){if(delete s[d],m=m||p==="toggle",p===(ee?"hide":"show"))if(p==="show"&&U&&U[d]!==void 0)ee=!0;else continue;I[d]=U&&U[d]||c.style(n,d)}if(x=!c.isEmptyObject(s),!(!x&&c.isEmptyObject(I))){B&&n.nodeType===1&&(a.overflow=[V.overflow,V.overflowX,V.overflowY],_=U&&U.display,_==null&&(_=Q.get(n,"display")),M=c.css(n,"display"),M==="none"&&(_?M=_:(bt([n],!0),_=n.style.display||_,M=c.css(n,"display"),bt([n]))),(M==="inline"||M==="inline-block"&&_!=null)&&c.css(n,"float")==="none"&&(x||(j.done(function(){V.display=_}),_==null&&(M=V.display,_=M==="none"?"":M)),V.display="inline-block")),a.overflow&&(V.overflow="hidden",j.always(function(){V.overflow=a.overflow[0],V.overflowX=a.overflow[1],V.overflowY=a.overflow[2]})),x=!1;for(d in I)x||(U?"hidden"in U&&(ee=U.hidden):U=Q.access(n,"fxshow",{display:_}),m&&(U.hidden=!ee),ee&&bt([n],!0),j.done(function(){ee||bt([n]),Q.remove(n,"fxshow");for(d in I)c.style(n,d,I[d])})),x=Ln(ee?U[d]:0,d,j),d in U||(U[d]=x.start,ee&&(x.end=x.start,x.start=0))}}function ts(n,s){var a,d,p,m,g;for(a in n)if(d=Re(a),p=s[d],m=n[a],Array.isArray(m)&&(p=m[1],m=n[a]=m[0]),a!==d&&(n[d]=m,delete n[a]),g=c.cssHooks[d],g&&"expand"in g){m=g.expand(m),delete n[d];for(a in m)a in n||(n[a]=m[a],s[a]=p)}else s[d]=p}function Oe(n,s,a){var d,p,m=0,g=Oe.prefilters.length,S=c.Deferred().always(function(){delete x.elem}),x=function(){if(p)return!1;for(var B=kt||_n(),j=Math.max(0,_.startTime+_.duration-B),I=j/_.duration||0,V=1-I,ee=0,U=_.tweens.length;ee<U;ee++)_.tweens[ee].run(V);return S.notifyWith(n,[_,V,j]),V<1&&U?j:(U||S.notifyWith(n,[_,1,0]),S.resolveWith(n,[_]),!1)},_=S.promise({elem:n,props:c.extend({},s),opts:c.extend(!0,{specialEasing:{},easing:c.easing._default},a),originalProperties:s,originalOptions:a,startTime:kt||_n(),duration:a.duration,tweens:[],createTween:function(B,j){var I=c.Tween(n,_.opts,B,j,_.opts.specialEasing[B]||_.opts.easing);return _.tweens.push(I),I},stop:function(B){var j=0,I=B?_.tweens.length:0;if(p)return this;for(p=!0;j<I;j++)_.tweens[j].run(1);return B?(S.notifyWith(n,[_,1,0]),S.resolveWith(n,[_,B])):S.rejectWith(n,[_,B]),this}}),M=_.props;for(ts(M,_.opts.specialEasing);m<g;m++)if(d=Oe.prefilters[m].call(_,n,M,_.opts),d)return A(d.stop)&&(c._queueHooks(_.elem,_.opts.queue).stop=d.stop.bind(d)),d;return c.map(M,Ln,_),A(_.opts.start)&&_.opts.start.call(n,_),_.progress(_.opts.progress).done(_.opts.done,_.opts.complete).fail(_.opts.fail).always(_.opts.always),c.fx.timer(c.extend(x,{elem:n,anim:_,queue:_.opts.queue})),_}c.Animation=c.extend(Oe,{tweeners:{"*":[function(n,s){var a=this.createTween(n,s);return dn(a.elem,n,Mt.exec(s),a),a}]},tweener:function(n,s){A(n)?(s=n,n=["*"]):n=n.match(Fe);for(var a,d=0,p=n.length;d<p;d++)a=n[d],Oe.tweeners[a]=Oe.tweeners[a]||[],Oe.tweeners[a].unshift(s)},prefilters:[es],prefilter:function(n,s){s?Oe.prefilters.unshift(n):Oe.prefilters.push(n)}}),c.speed=function(n,s,a){var d=n&&typeof n=="object"?c.extend({},n):{complete:a||!a&&s||A(n)&&n,duration:n,easing:a&&s||s&&!A(s)&&s};return c.fx.off?d.duration=0:typeof d.duration!="number"&&(d.duration in c.fx.speeds?d.duration=c.fx.speeds[d.duration]:d.duration=c.fx.speeds._default),(d.queue==null||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){A(d.old)&&d.old.call(this),d.queue&&c.dequeue(this,d.queue)},d},c.fn.extend({fadeTo:function(n,s,a,d){return this.filter(Yt).css("opacity",0).show().end().animate({opacity:s},n,a,d)},animate:function(n,s,a,d){var p=c.isEmptyObject(n),m=c.speed(s,a,d),g=function(){var S=Oe(this,c.extend({},n),m);(p||Q.get(this,"finish"))&&S.stop(!0)};return g.finish=g,p||m.queue===!1?this.each(g):this.queue(m.queue,g)},stop:function(n,s,a){var d=function(p){var m=p.stop;delete p.stop,m(a)};return typeof n!="string"&&(a=s,s=n,n=void 0),s&&this.queue(n||"fx",[]),this.each(function(){var p=!0,m=n!=null&&n+"queueHooks",g=c.timers,S=Q.get(this);if(m)S[m]&&S[m].stop&&d(S[m]);else for(m in S)S[m]&&S[m].stop&&Zr.test(m)&&d(S[m]);for(m=g.length;m--;)g[m].elem===this&&(n==null||g[m].queue===n)&&(g[m].anim.stop(a),p=!1,g.splice(m,1));(p||!a)&&c.dequeue(this,n)})},finish:function(n){return n!==!1&&(n=n||"fx"),this.each(function(){var s,a=Q.get(this),d=a[n+"queue"],p=a[n+"queueHooks"],m=c.timers,g=d?d.length:0;for(a.finish=!0,c.queue(this,n,[]),p&&p.stop&&p.stop.call(this,!0),s=m.length;s--;)m[s].elem===this&&m[s].queue===n&&(m[s].anim.stop(!0),m.splice(s,1));for(s=0;s<g;s++)d[s]&&d[s].finish&&d[s].finish.call(this);delete a.finish})}}),c.each(["toggle","show","hide"],function(n,s){var a=c.fn[s];c.fn[s]=function(d,p,m){return d==null||typeof d=="boolean"?a.apply(this,arguments):this.animate(ii(s,!0),d,p,m)}}),c.each({slideDown:ii("show"),slideUp:ii("hide"),slideToggle:ii("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(n,s){c.fn[n]=function(a,d,p){return this.animate(s,a,d,p)}}),c.timers=[],c.fx.tick=function(){var n,s=0,a=c.timers;for(kt=Date.now();s<a.length;s++)n=a[s],!n()&&a[s]===n&&a.splice(s--,1);a.length||c.fx.stop(),kt=void 0},c.fx.timer=function(n){c.timers.push(n),c.fx.start()},c.fx.interval=13,c.fx.start=function(){ti||(ti=!0,Ti())},c.fx.stop=function(){ti=null},c.fx.speeds={slow:600,fast:200,_default:400},c.fn.delay=function(n,s){return n=c.fx&&c.fx.speeds[n]||n,s=s||"fx",this.queue(s,function(a,d){var p=e.setTimeout(a,n);d.stop=function(){e.clearTimeout(p)}})},function(){var n=W.createElement("input"),s=W.createElement("select"),a=s.appendChild(W.createElement("option"));n.type="checkbox",z.checkOn=n.value!=="",z.optSelected=a.selected,n=W.createElement("input"),n.value="t",n.type="radio",z.radioValue=n.value==="t"}();var Pn,$t=c.expr.attrHandle;c.fn.extend({attr:function(n,s){return Ue(this,c.attr,n,s,arguments.length>1)},removeAttr:function(n){return this.each(function(){c.removeAttr(this,n)})}}),c.extend({attr:function(n,s,a){var d,p,m=n.nodeType;if(!(m===3||m===8||m===2)){if(typeof n.getAttribute>"u")return c.prop(n,s,a);if((m!==1||!c.isXMLDoc(n))&&(p=c.attrHooks[s.toLowerCase()]||(c.expr.match.bool.test(s)?Pn:void 0)),a!==void 0){if(a===null){c.removeAttr(n,s);return}return p&&"set"in p&&(d=p.set(n,a,s))!==void 0?d:(n.setAttribute(s,a+""),a)}return p&&"get"in p&&(d=p.get(n,s))!==null?d:(d=c.find.attr(n,s),d??void 0)}},attrHooks:{type:{set:function(n,s){if(!z.radioValue&&s==="radio"&&je(n,"input")){var a=n.value;return n.setAttribute("type",s),a&&(n.value=a),s}}}},removeAttr:function(n,s){var a,d=0,p=s&&s.match(Fe);if(p&&n.nodeType===1)for(;a=p[d++];)n.removeAttribute(a)}}),Pn={set:function(n,s,a){return s===!1?c.removeAttr(n,a):n.setAttribute(a,a),a}},c.each(c.expr.match.bool.source.match(/\w+/g),function(n,s){var a=$t[s]||c.find.attr;$t[s]=function(d,p,m){var g,S,x=p.toLowerCase();return m||(S=$t[x],$t[x]=g,g=a(d,p,m)!=null?x:null,$t[x]=S),g}});var is=/^(?:input|select|textarea|button)$/i,ns=/^(?:a|area)$/i;c.fn.extend({prop:function(n,s){return Ue(this,c.prop,n,s,arguments.length>1)},removeProp:function(n){return this.each(function(){delete this[c.propFix[n]||n]})}}),c.extend({prop:function(n,s,a){var d,p,m=n.nodeType;if(!(m===3||m===8||m===2))return(m!==1||!c.isXMLDoc(n))&&(s=c.propFix[s]||s,p=c.propHooks[s]),a!==void 0?p&&"set"in p&&(d=p.set(n,a,s))!==void 0?d:n[s]=a:p&&"get"in p&&(d=p.get(n,s))!==null?d:n[s]},propHooks:{tabIndex:{get:function(n){var s=c.find.attr(n,"tabindex");return s?parseInt(s,10):is.test(n.nodeName)||ns.test(n.nodeName)&&n.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),z.optSelected||(c.propHooks.selected={get:function(n){var s=n.parentNode;return s&&s.parentNode&&s.parentNode.selectedIndex,null},set:function(n){var s=n.parentNode;s&&(s.selectedIndex,s.parentNode&&s.parentNode.selectedIndex)}}),c.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){c.propFix[this.toLowerCase()]=this});function st(n){var s=n.match(Fe)||[];return s.join(" ")}function ot(n){return n.getAttribute&&n.getAttribute("class")||""}function _i(n){return Array.isArray(n)?n:typeof n=="string"?n.match(Fe)||[]:[]}c.fn.extend({addClass:function(n){var s,a,d,p,m,g;return A(n)?this.each(function(S){c(this).addClass(n.call(this,S,ot(this)))}):(s=_i(n),s.length?this.each(function(){if(d=ot(this),a=this.nodeType===1&&" "+st(d)+" ",a){for(m=0;m<s.length;m++)p=s[m],a.indexOf(" "+p+" ")<0&&(a+=p+" ");g=st(a),d!==g&&this.setAttribute("class",g)}}):this)},removeClass:function(n){var s,a,d,p,m,g;return A(n)?this.each(function(S){c(this).removeClass(n.call(this,S,ot(this)))}):arguments.length?(s=_i(n),s.length?this.each(function(){if(d=ot(this),a=this.nodeType===1&&" "+st(d)+" ",a){for(m=0;m<s.length;m++)for(p=s[m];a.indexOf(" "+p+" ")>-1;)a=a.replace(" "+p+" "," ");g=st(a),d!==g&&this.setAttribute("class",g)}}):this):this.attr("class","")},toggleClass:function(n,s){var a,d,p,m,g=typeof n,S=g==="string"||Array.isArray(n);return A(n)?this.each(function(x){c(this).toggleClass(n.call(this,x,ot(this),s),s)}):typeof s=="boolean"&&S?s?this.addClass(n):this.removeClass(n):(a=_i(n),this.each(function(){if(S)for(m=c(this),p=0;p<a.length;p++)d=a[p],m.hasClass(d)?m.removeClass(d):m.addClass(d);else(n===void 0||g==="boolean")&&(d=ot(this),d&&Q.set(this,"__className__",d),this.setAttribute&&this.setAttribute("class",d||n===!1?"":Q.get(this,"__className__")||""))}))},hasClass:function(n){var s,a,d=0;for(s=" "+n+" ";a=this[d++];)if(a.nodeType===1&&(" "+st(ot(a))+" ").indexOf(s)>-1)return!0;return!1}});var rs=/\r/g;c.fn.extend({val:function(n){var s,a,d,p=this[0];return arguments.length?(d=A(n),this.each(function(m){var g;this.nodeType===1&&(d?g=n.call(this,m,c(this).val()):g=n,g==null?g="":typeof g=="number"?g+="":Array.isArray(g)&&(g=c.map(g,function(S){return S==null?"":S+""})),s=c.valHooks[this.type]||c.valHooks[this.nodeName.toLowerCase()],(!s||!("set"in s)||s.set(this,g,"value")===void 0)&&(this.value=g))})):p?(s=c.valHooks[p.type]||c.valHooks[p.nodeName.toLowerCase()],s&&"get"in s&&(a=s.get(p,"value"))!==void 0?a:(a=p.value,typeof a=="string"?a.replace(rs,""):a??"")):void 0}}),c.extend({valHooks:{option:{get:function(n){var s=c.find.attr(n,"value");return s??st(c.text(n))}},select:{get:function(n){var s,a,d,p=n.options,m=n.selectedIndex,g=n.type==="select-one",S=g?null:[],x=g?m+1:p.length;for(m<0?d=x:d=g?m:0;d<x;d++)if(a=p[d],(a.selected||d===m)&&!a.disabled&&(!a.parentNode.disabled||!je(a.parentNode,"optgroup"))){if(s=c(a).val(),g)return s;S.push(s)}return S},set:function(n,s){for(var a,d,p=n.options,m=c.makeArray(s),g=p.length;g--;)d=p[g],(d.selected=c.inArray(c.valHooks.option.get(d),m)>-1)&&(a=!0);return a||(n.selectedIndex=-1),m}}}}),c.each(["radio","checkbox"],function(){c.valHooks[this]={set:function(n,s){if(Array.isArray(s))return n.checked=c.inArray(c(n).val(),s)>-1}},z.checkOn||(c.valHooks[this].get=function(n){return n.getAttribute("value")===null?"on":n.value})}),z.focusin="onfocusin"in e;var jn=/^(?:focusinfocus|focusoutblur)$/,Mn=function(n){n.stopPropagation()};c.extend(c.event,{trigger:function(n,s,a,d){var p,m,g,S,x,_,M,B,j=[a||W],I=P.call(n,"type")?n.type:n,V=P.call(n,"namespace")?n.namespace.split("."):[];if(m=B=g=a=a||W,!(a.nodeType===3||a.nodeType===8)&&!jn.test(I+c.event.triggered)&&(I.indexOf(".")>-1&&(V=I.split("."),I=V.shift(),V.sort()),x=I.indexOf(":")<0&&"on"+I,n=n[c.expando]?n:new c.Event(I,typeof n=="object"&&n),n.isTrigger=d?2:3,n.namespace=V.join("."),n.rnamespace=n.namespace?new RegExp("(^|\\.)"+V.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=void 0,n.target||(n.target=a),s=s==null?[n]:c.makeArray(s,[n]),M=c.event.special[I]||{},!(!d&&M.trigger&&M.trigger.apply(a,s)===!1))){if(!d&&!M.noBubble&&!K(a)){for(S=M.delegateType||I,jn.test(S+I)||(m=m.parentNode);m;m=m.parentNode)j.push(m),g=m;g===(a.ownerDocument||W)&&j.push(g.defaultView||g.parentWindow||e)}for(p=0;(m=j[p++])&&!n.isPropagationStopped();)B=m,n.type=p>1?S:M.bindType||I,_=(Q.get(m,"events")||Object.create(null))[n.type]&&Q.get(m,"handle"),_&&_.apply(m,s),_=x&&m[x],_&&_.apply&&Pt(m)&&(n.result=_.apply(m,s),n.result===!1&&n.preventDefault());return n.type=I,!d&&!n.isDefaultPrevented()&&(!M._default||M._default.apply(j.pop(),s)===!1)&&Pt(a)&&x&&A(a[I])&&!K(a)&&(g=a[x],g&&(a[x]=null),c.event.triggered=I,n.isPropagationStopped()&&B.addEventListener(I,Mn),a[I](),n.isPropagationStopped()&&B.removeEventListener(I,Mn),c.event.triggered=void 0,g&&(a[x]=g)),n.result}},simulate:function(n,s,a){var d=c.extend(new c.Event,a,{type:n,isSimulated:!0});c.event.trigger(d,null,s)}}),c.fn.extend({trigger:function(n,s){return this.each(function(){c.event.trigger(n,s,this)})},triggerHandler:function(n,s){var a=this[0];if(a)return c.event.trigger(n,s,a,!0)}}),z.focusin||c.each({focus:"focusin",blur:"focusout"},function(n,s){var a=function(d){c.event.simulate(s,d.target,c.event.fix(d))};c.event.special[s]={setup:function(){var d=this.ownerDocument||this.document||this,p=Q.access(d,s);p||d.addEventListener(n,a,!0),Q.access(d,s,(p||0)+1)},teardown:function(){var d=this.ownerDocument||this.document||this,p=Q.access(d,s)-1;p?Q.access(d,s,p):(d.removeEventListener(n,a,!0),Q.remove(d,s))}}});var Ot=e.location,In={guid:Date.now()},Li=/\?/;c.parseXML=function(n){var s,a;if(!n||typeof n!="string")return null;try{s=new e.DOMParser().parseFromString(n,"text/xml")}catch{}return a=s&&s.getElementsByTagName("parsererror")[0],(!s||a)&&c.error("Invalid XML: "+(a?c.map(a.childNodes,function(d){return d.textContent}).join(`
`):n)),s};var ss=/\[\]$/,An=/\r?\n/g,os=/^(?:submit|button|image|reset|file)$/i,as=/^(?:input|select|textarea|keygen)/i;function Pi(n,s,a,d){var p;if(Array.isArray(s))c.each(s,function(m,g){a||ss.test(n)?d(n,g):Pi(n+"["+(typeof g=="object"&&g!=null?m:"")+"]",g,a,d)});else if(!a&&me(s)==="object")for(p in s)Pi(n+"["+p+"]",s[p],a,d);else d(n,s)}c.param=function(n,s){var a,d=[],p=function(m,g){var S=A(g)?g():g;d[d.length]=encodeURIComponent(m)+"="+encodeURIComponent(S??"")};if(n==null)return"";if(Array.isArray(n)||n.jquery&&!c.isPlainObject(n))c.each(n,function(){p(this.name,this.value)});else for(a in n)Pi(a,n[a],s,p);return d.join("&")},c.fn.extend({serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var n=c.prop(this,"elements");return n?c.makeArray(n):this}).filter(function(){var n=this.type;return this.name&&!c(this).is(":disabled")&&as.test(this.nodeName)&&!os.test(n)&&(this.checked||!It.test(n))}).map(function(n,s){var a=c(this).val();return a==null?null:Array.isArray(a)?c.map(a,function(d){return{name:s.name,value:d.replace(An,`\r
`)}}):{name:s.name,value:a.replace(An,`\r
`)}}).get()}});var ls=/%20/g,us=/#.*$/,ds=/([?&])_=[^&]*/,cs=/^(.*?):[ \t]*([^\r\n]*)$/mg,hs=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,fs=/^(?:GET|HEAD)$/,ps=/^\/\//,$n={},ji={},On="*/".concat("*"),Mi=W.createElement("a");Mi.href=Ot.href;function Nn(n){return function(s,a){typeof s!="string"&&(a=s,s="*");var d,p=0,m=s.toLowerCase().match(Fe)||[];if(A(a))for(;d=m[p++];)d[0]==="+"?(d=d.slice(1)||"*",(n[d]=n[d]||[]).unshift(a)):(n[d]=n[d]||[]).push(a)}}function Bn(n,s,a,d){var p={},m=n===ji;function g(S){var x;return p[S]=!0,c.each(n[S]||[],function(_,M){var B=M(s,a,d);if(typeof B=="string"&&!m&&!p[B])return s.dataTypes.unshift(B),g(B),!1;if(m)return!(x=B)}),x}return g(s.dataTypes[0])||!p["*"]&&g("*")}function Ii(n,s){var a,d,p=c.ajaxSettings.flatOptions||{};for(a in s)s[a]!==void 0&&((p[a]?n:d||(d={}))[a]=s[a]);return d&&c.extend(!0,n,d),n}function ms(n,s,a){for(var d,p,m,g,S=n.contents,x=n.dataTypes;x[0]==="*";)x.shift(),d===void 0&&(d=n.mimeType||s.getResponseHeader("Content-Type"));if(d){for(p in S)if(S[p]&&S[p].test(d)){x.unshift(p);break}}if(x[0]in a)m=x[0];else{for(p in a){if(!x[0]||n.converters[p+" "+x[0]]){m=p;break}g||(g=p)}m=m||g}if(m)return m!==x[0]&&x.unshift(m),a[m]}function gs(n,s,a,d){var p,m,g,S,x,_={},M=n.dataTypes.slice();if(M[1])for(g in n.converters)_[g.toLowerCase()]=n.converters[g];for(m=M.shift();m;)if(n.responseFields[m]&&(a[n.responseFields[m]]=s),!x&&d&&n.dataFilter&&(s=n.dataFilter(s,n.dataType)),x=m,m=M.shift(),m){if(m==="*")m=x;else if(x!=="*"&&x!==m){if(g=_[x+" "+m]||_["* "+m],!g){for(p in _)if(S=p.split(" "),S[1]===m&&(g=_[x+" "+S[0]]||_["* "+S[0]],g)){g===!0?g=_[p]:_[p]!==!0&&(m=S[0],M.unshift(S[1]));break}}if(g!==!0)if(g&&n.throws)s=g(s);else try{s=g(s)}catch(B){return{state:"parsererror",error:g?B:"No conversion from "+x+" to "+m}}}}return{state:"success",data:s}}c.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ot.href,type:"GET",isLocal:hs.test(Ot.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":On,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":c.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(n,s){return s?Ii(Ii(n,c.ajaxSettings),s):Ii(c.ajaxSettings,n)},ajaxPrefilter:Nn($n),ajaxTransport:Nn(ji),ajax:function(n,s){typeof n=="object"&&(s=n,n=void 0),s=s||{};var a,d,p,m,g,S,x,_,M,B,j=c.ajaxSetup({},s),I=j.context||j,V=j.context&&(I.nodeType||I.jquery)?c(I):c.event,ee=c.Deferred(),U=c.Callbacks("once memory"),fe=j.statusCode||{},ce={},Te={},se="canceled",Z={readyState:0,getResponseHeader:function(ne){var de;if(x){if(!m)for(m={};de=cs.exec(p);)m[de[1].toLowerCase()+" "]=(m[de[1].toLowerCase()+" "]||[]).concat(de[2]);de=m[ne.toLowerCase()+" "]}return de==null?null:de.join(", ")},getAllResponseHeaders:function(){return x?p:null},setRequestHeader:function(ne,de){return x==null&&(ne=Te[ne.toLowerCase()]=Te[ne.toLowerCase()]||ne,ce[ne]=de),this},overrideMimeType:function(ne){return x==null&&(j.mimeType=ne),this},statusCode:function(ne){var de;if(ne)if(x)Z.always(ne[Z.status]);else for(de in ne)fe[de]=[fe[de],ne[de]];return this},abort:function(ne){var de=ne||se;return a&&a.abort(de),Ee(0,de),this}};if(ee.promise(Z),j.url=((n||j.url||Ot.href)+"").replace(ps,Ot.protocol+"//"),j.type=s.method||s.type||j.method||j.type,j.dataTypes=(j.dataType||"*").toLowerCase().match(Fe)||[""],j.crossDomain==null){S=W.createElement("a");try{S.href=j.url,S.href=S.href,j.crossDomain=Mi.protocol+"//"+Mi.host!=S.protocol+"//"+S.host}catch{j.crossDomain=!0}}if(j.data&&j.processData&&typeof j.data!="string"&&(j.data=c.param(j.data,j.traditional)),Bn($n,j,s,Z),x)return Z;_=c.event&&j.global,_&&c.active++===0&&c.event.trigger("ajaxStart"),j.type=j.type.toUpperCase(),j.hasContent=!fs.test(j.type),d=j.url.replace(us,""),j.hasContent?j.data&&j.processData&&(j.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(j.data=j.data.replace(ls,"+")):(B=j.url.slice(d.length),j.data&&(j.processData||typeof j.data=="string")&&(d+=(Li.test(d)?"&":"?")+j.data,delete j.data),j.cache===!1&&(d=d.replace(ds,"$1"),B=(Li.test(d)?"&":"?")+"_="+In.guid+++B),j.url=d+B),j.ifModified&&(c.lastModified[d]&&Z.setRequestHeader("If-Modified-Since",c.lastModified[d]),c.etag[d]&&Z.setRequestHeader("If-None-Match",c.etag[d])),(j.data&&j.hasContent&&j.contentType!==!1||s.contentType)&&Z.setRequestHeader("Content-Type",j.contentType),Z.setRequestHeader("Accept",j.dataTypes[0]&&j.accepts[j.dataTypes[0]]?j.accepts[j.dataTypes[0]]+(j.dataTypes[0]!=="*"?", "+On+"; q=0.01":""):j.accepts["*"]);for(M in j.headers)Z.setRequestHeader(M,j.headers[M]);if(j.beforeSend&&(j.beforeSend.call(I,Z,j)===!1||x))return Z.abort();if(se="abort",U.add(j.complete),Z.done(j.success),Z.fail(j.error),a=Bn(ji,j,s,Z),!a)Ee(-1,"No Transport");else{if(Z.readyState=1,_&&V.trigger("ajaxSend",[Z,j]),x)return Z;j.async&&j.timeout>0&&(g=e.setTimeout(function(){Z.abort("timeout")},j.timeout));try{x=!1,a.send(ce,Ee)}catch(ne){if(x)throw ne;Ee(-1,ne)}}function Ee(ne,de,Bt,ni){var _e,at,lt,De,Je,Ie=de;x||(x=!0,g&&e.clearTimeout(g),a=void 0,p=ni||"",Z.readyState=ne>0?4:0,_e=ne>=200&&ne<300||ne===304,Bt&&(De=ms(j,Z,Bt)),!_e&&c.inArray("script",j.dataTypes)>-1&&c.inArray("json",j.dataTypes)<0&&(j.converters["text script"]=function(){}),De=gs(j,De,Z,_e),_e?(j.ifModified&&(Je=Z.getResponseHeader("Last-Modified"),Je&&(c.lastModified[d]=Je),Je=Z.getResponseHeader("etag"),Je&&(c.etag[d]=Je)),ne===204||j.type==="HEAD"?Ie="nocontent":ne===304?Ie="notmodified":(Ie=De.state,at=De.data,lt=De.error,_e=!lt)):(lt=Ie,(ne||!Ie)&&(Ie="error",ne<0&&(ne=0))),Z.status=ne,Z.statusText=(de||Ie)+"",_e?ee.resolveWith(I,[at,Ie,Z]):ee.rejectWith(I,[Z,Ie,lt]),Z.statusCode(fe),fe=void 0,_&&V.trigger(_e?"ajaxSuccess":"ajaxError",[Z,j,_e?at:lt]),U.fireWith(I,[Z,Ie]),_&&(V.trigger("ajaxComplete",[Z,j]),--c.active||c.event.trigger("ajaxStop")))}return Z},getJSON:function(n,s,a){return c.get(n,s,a,"json")},getScript:function(n,s){return c.get(n,void 0,s,"script")}}),c.each(["get","post"],function(n,s){c[s]=function(a,d,p,m){return A(d)&&(m=m||p,p=d,d=void 0),c.ajax(c.extend({url:a,type:s,dataType:m,data:d,success:p},c.isPlainObject(a)&&a))}}),c.ajaxPrefilter(function(n){var s;for(s in n.headers)s.toLowerCase()==="content-type"&&(n.contentType=n.headers[s]||"")}),c._evalUrl=function(n,s,a){return c.ajax({url:n,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(d){c.globalEval(d,s,a)}})},c.fn.extend({wrapAll:function(n){var s;return this[0]&&(A(n)&&(n=n.call(this[0])),s=c(n,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&s.insertBefore(this[0]),s.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(n){return A(n)?this.each(function(s){c(this).wrapInner(n.call(this,s))}):this.each(function(){var s=c(this),a=s.contents();a.length?a.wrapAll(n):s.append(n)})},wrap:function(n){var s=A(n);return this.each(function(a){c(this).wrapAll(s?n.call(this,a):n)})},unwrap:function(n){return this.parent(n).not("body").each(function(){c(this).replaceWith(this.childNodes)}),this}}),c.expr.pseudos.hidden=function(n){return!c.expr.pseudos.visible(n)},c.expr.pseudos.visible=function(n){return!!(n.offsetWidth||n.offsetHeight||n.getClientRects().length)},c.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var bs={0:200,1223:204},Nt=c.ajaxSettings.xhr();z.cors=!!Nt&&"withCredentials"in Nt,z.ajax=Nt=!!Nt,c.ajaxTransport(function(n){var s,a;if(z.cors||Nt&&!n.crossDomain)return{send:function(d,p){var m,g=n.xhr();if(g.open(n.type,n.url,n.async,n.username,n.password),n.xhrFields)for(m in n.xhrFields)g[m]=n.xhrFields[m];n.mimeType&&g.overrideMimeType&&g.overrideMimeType(n.mimeType),!n.crossDomain&&!d["X-Requested-With"]&&(d["X-Requested-With"]="XMLHttpRequest");for(m in d)g.setRequestHeader(m,d[m]);s=function(S){return function(){s&&(s=a=g.onload=g.onerror=g.onabort=g.ontimeout=g.onreadystatechange=null,S==="abort"?g.abort():S==="error"?typeof g.status!="number"?p(0,"error"):p(g.status,g.statusText):p(bs[g.status]||g.status,g.statusText,(g.responseType||"text")!=="text"||typeof g.responseText!="string"?{binary:g.response}:{text:g.responseText},g.getAllResponseHeaders()))}},g.onload=s(),a=g.onerror=g.ontimeout=s("error"),g.onabort!==void 0?g.onabort=a:g.onreadystatechange=function(){g.readyState===4&&e.setTimeout(function(){s&&a()})},s=s("abort");try{g.send(n.hasContent&&n.data||null)}catch(S){if(s)throw S}},abort:function(){s&&s()}}}),c.ajaxPrefilter(function(n){n.crossDomain&&(n.contents.script=!1)}),c.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(n){return c.globalEval(n),n}}}),c.ajaxPrefilter("script",function(n){n.cache===void 0&&(n.cache=!1),n.crossDomain&&(n.type="GET")}),c.ajaxTransport("script",function(n){if(n.crossDomain||n.scriptAttrs){var s,a;return{send:function(d,p){s=c("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",a=function(m){s.remove(),a=null,m&&p(m.type==="error"?404:200,m.type)}),W.head.appendChild(s[0])},abort:function(){a&&a()}}}});var Fn=[],Ai=/(=)\?(?=&|$)|\?\?/;c.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=Fn.pop()||c.expando+"_"+In.guid++;return this[n]=!0,n}}),c.ajaxPrefilter("json jsonp",function(n,s,a){var d,p,m,g=n.jsonp!==!1&&(Ai.test(n.url)?"url":typeof n.data=="string"&&(n.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Ai.test(n.data)&&"data");if(g||n.dataTypes[0]==="jsonp")return d=n.jsonpCallback=A(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,g?n[g]=n[g].replace(Ai,"$1"+d):n.jsonp!==!1&&(n.url+=(Li.test(n.url)?"&":"?")+n.jsonp+"="+d),n.converters["script json"]=function(){return m||c.error(d+" was not called"),m[0]},n.dataTypes[0]="json",p=e[d],e[d]=function(){m=arguments},a.always(function(){p===void 0?c(e).removeProp(d):e[d]=p,n[d]&&(n.jsonpCallback=s.jsonpCallback,Fn.push(d)),m&&A(p)&&p(m[0]),m=p=void 0}),"script"}),z.createHTMLDocument=function(){var n=W.implementation.createHTMLDocument("").body;return n.innerHTML="<form></form><form></form>",n.childNodes.length===2}(),c.parseHTML=function(n,s,a){if(typeof n!="string")return[];typeof s=="boolean"&&(a=s,s=!1);var d,p,m;return s||(z.createHTMLDocument?(s=W.implementation.createHTMLDocument(""),d=s.createElement("base"),d.href=W.location.href,s.head.appendChild(d)):s=W),p=rn.exec(n),m=!a&&[],p?[s.createElement(p[1])]:(p=pn([n],s,m),m&&m.length&&c(m).remove(),c.merge([],p.childNodes))},c.fn.load=function(n,s,a){var d,p,m,g=this,S=n.indexOf(" ");return S>-1&&(d=st(n.slice(S)),n=n.slice(0,S)),A(s)?(a=s,s=void 0):s&&typeof s=="object"&&(p="POST"),g.length>0&&c.ajax({url:n,type:p||"GET",dataType:"html",data:s}).done(function(x){m=arguments,g.html(d?c("<div>").append(c.parseHTML(x)).find(d):x)}).always(a&&function(x,_){g.each(function(){a.apply(this,m||[x.responseText,_,x])})}),this},c.expr.pseudos.animated=function(n){return c.grep(c.timers,function(s){return n===s.elem}).length},c.offset={setOffset:function(n,s,a){var d,p,m,g,S,x,_,M=c.css(n,"position"),B=c(n),j={};M==="static"&&(n.style.position="relative"),S=B.offset(),m=c.css(n,"top"),x=c.css(n,"left"),_=(M==="absolute"||M==="fixed")&&(m+x).indexOf("auto")>-1,_?(d=B.position(),g=d.top,p=d.left):(g=parseFloat(m)||0,p=parseFloat(x)||0),A(s)&&(s=s.call(n,a,c.extend({},S))),s.top!=null&&(j.top=s.top-S.top+g),s.left!=null&&(j.left=s.left-S.left+p),"using"in s?s.using.call(n,j):B.css(j)}},c.fn.extend({offset:function(n){if(arguments.length)return n===void 0?this:this.each(function(p){c.offset.setOffset(this,n,p)});var s,a,d=this[0];if(d)return d.getClientRects().length?(s=d.getBoundingClientRect(),a=d.ownerDocument.defaultView,{top:s.top+a.pageYOffset,left:s.left+a.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var n,s,a,d=this[0],p={top:0,left:0};if(c.css(d,"position")==="fixed")s=d.getBoundingClientRect();else{for(s=this.offset(),a=d.ownerDocument,n=d.offsetParent||a.documentElement;n&&(n===a.body||n===a.documentElement)&&c.css(n,"position")==="static";)n=n.parentNode;n&&n!==d&&n.nodeType===1&&(p=c(n).offset(),p.top+=c.css(n,"borderTopWidth",!0),p.left+=c.css(n,"borderLeftWidth",!0))}return{top:s.top-p.top-c.css(d,"marginTop",!0),left:s.left-p.left-c.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var n=this.offsetParent;n&&c.css(n,"position")==="static";)n=n.offsetParent;return n||rt})}}),c.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,s){var a=s==="pageYOffset";c.fn[n]=function(d){return Ue(this,function(p,m,g){var S;if(K(p)?S=p:p.nodeType===9&&(S=p.defaultView),g===void 0)return S?S[s]:p[m];S?S.scrollTo(a?S.pageXOffset:g,a?g:S.pageYOffset):p[m]=g},n,d,arguments.length)}}),c.each(["top","left"],function(n,s){c.cssHooks[s]=kn(z.pixelPosition,function(a,d){if(d)return d=At(a,s),Ci.test(d)?c(a).position()[s]+"px":d})}),c.each({Height:"height",Width:"width"},function(n,s){c.each({padding:"inner"+n,content:s,"":"outer"+n},function(a,d){c.fn[d]=function(p,m){var g=arguments.length&&(a||typeof p!="boolean"),S=a||(p===!0||m===!0?"margin":"border");return Ue(this,function(x,_,M){var B;return K(x)?d.indexOf("outer")===0?x["inner"+n]:x.document.documentElement["client"+n]:x.nodeType===9?(B=x.documentElement,Math.max(x.body["scroll"+n],B["scroll"+n],x.body["offset"+n],B["offset"+n],B["client"+n])):M===void 0?c.css(x,_,S):c.style(x,_,M,S)},s,g?p:void 0,g)}})}),c.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(n,s){c.fn[s]=function(a){return this.on(s,a)}}),c.fn.extend({bind:function(n,s,a){return this.on(n,null,s,a)},unbind:function(n,s){return this.off(n,null,s)},delegate:function(n,s,a,d){return this.on(s,n,a,d)},undelegate:function(n,s,a){return arguments.length===1?this.off(n,"**"):this.off(s,n||"**",a)},hover:function(n,s){return this.mouseenter(n).mouseleave(s||n)}}),c.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(n,s){c.fn[s]=function(a,d){return arguments.length>0?this.on(s,null,a,d):this.trigger(s)}});var ws=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;c.proxy=function(n,s){var a,d,p;if(typeof s=="string"&&(a=n[s],s=n,n=a),!!A(n))return d=o.call(arguments,2),p=function(){return n.apply(s||this,d.concat(o.call(arguments)))},p.guid=n.guid=n.guid||c.guid++,p},c.holdReady=function(n){n?c.readyWait++:c.ready(!0)},c.isArray=Array.isArray,c.parseJSON=JSON.parse,c.nodeName=je,c.isFunction=A,c.isWindow=K,c.camelCase=Re,c.type=me,c.now=Date.now,c.isNumeric=function(n){var s=c.type(n);return(s==="number"||s==="string")&&!isNaN(n-parseFloat(n))},c.trim=function(n){return n==null?"":(n+"").replace(ws,"$1")};var vs=e.jQuery,ys=e.$;return c.noConflict=function(n){return e.$===c&&(e.$=ys),n&&e.jQuery===c&&(e.jQuery=vs),c},typeof t>"u"&&(e.jQuery=e.$=c),c})})(ao);class dr{constructor(e,t){w(this,"actions",{});w(this,"keyEntries",{});w(this,"buttons",{});this.$mainElement=e,this.main=t}init(){let e=this.$mainElement;e==null&&(e=y(document));let t=this;e.on("keydown",function(i){i!=null&&t.executeKeyDownEvent(i)})}trigger(e){let t=this.actions[e];t!=null&&t.action(e,null,"")}registerAction(e,t,i,r="",o){let u={action:i,identifier:e,keys:t,text:r,active:!0};this.actions[e]=u;for(let h of t)this.keyEntries[h.toLowerCase()]==null&&(this.keyEntries[h.toLowerCase()]=[]),this.keyEntries[h.toLowerCase()].push(u);if(o!=null){this.buttons[e]==null&&(this.buttons[e]=[]),this.buttons[e].push(o);let h=r;t.length>0&&(h+=" ["+t.join(", ")+"]"),o.attr("title",h),o.on("mousedown",()=>{u.active&&i(e,null,"mousedown")})}}isActive(e){let t=this.actions[e];return t==null?!1:t.active}setActive(e,t){let i=this.actions[e];i!=null&&(i.active=t);let r=this.buttons[e];if(r!=null)for(let o of r)t?o.addClass("jo_active"):o.removeClass("jo_active")}executeKeyDownEvent(e){if(document.activeElement.tagName.toLowerCase()=="input"||e.keyCode<=18&&e.keyCode>=16)return;let t="";e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.altKey&&(t+="alt+"),e.key!=null&&(t+=e.key.toLowerCase());let i=this.keyEntries[t];if(i!=null){for(let r of i)if(r.active){e.stopPropagation(),e.preventDefault(),r.action(r.identifier,null,t);break}}}}function cr(f,e,t,i=null){let r=window.PointerEvent?"pointer":"mouse";e==null&&(e=f);let o=y('<input type="text" class="jo_inplaceeditor" spellcheck="false">');o.css({width:e.css("width"),height:e.css("height"),color:e.css("color"),position:e.css("position"),"background-color":e.css("background-color"),"font-size":e.css("font-size"),"font-weight":e.css("font-weight"),"box-sizing":"border-box"}),o.val(f.text()),o.on(r+"down",u=>{u.stopPropagation()}),i!=null&&o[0].setSelectionRange(i.start,i.end),e.after(o),e.hide(),setTimeout(()=>{o.focus()},300),o.on("keydown.me",u=>{if(u.key=="Enter"||u.key=="Escape"){o.off("keydown.me"),o.off("focusout.me"),o.remove(),e.show();let h=Vt(o.val());t(h);return}}),o.on("focusout.me",u=>{o.off("keydown.me"),o.off("focusout.me"),o.remove(),e.show();let h=Vt(o.val());t(h)})}function et(f,e,t){let i=window.PointerEvent?"pointer":"mouse",r=y('<div class="jo_contextmenu"></div>'),o=null,u=null;for(let L of f){let H=L.caption;L.link!=null&&(H=`<a href="${L.link}" target="_blank" class="jo_menulink">${L.caption}</a>`);let z=y("<div>"+H+(L.subMenu!=null?'<span style="float: right"> &nbsp; &nbsp; &gt;</span>':"")+"</div>");if(L.color!=null&&z.css("color",L.color),L.link==null)z.on(i+"up.contextmenu",A=>{A.stopPropagation(),y(".jo_contextmenu").remove(),y(document).off(i+"up.contextmenu"),y(document).off(i+"down.contextmenu"),y(document).off("keydown.contextmenu"),L.callback()}),z.on(i+"down.contextmenu",A=>{A.stopPropagation()});else{let A=z.find("a");A.on(i+"up",K=>{K.stopPropagation(),setTimeout(()=>{z.hide()},500)}),A.on(i+"down",K=>{K.stopPropagation()})}z.on(i+"move.contextmenu",()=>{L!=u&&o!=null&&(o.remove(),u=null,o=null),L.subMenu!=null&&(o=et(L.subMenu,z.offset().left+z.width(),z.offset().top))}),r.append(z)}y(document).on(i+"down.contextmenu",L=>{y(document).off(i+"down.contextmenu"),y(document).off("keydown.contextmenu"),y(".jo_contextmenu").remove()}),y(document).on("keydown.contextmenu",L=>{L.key=="Escape"&&(y(document).off(i+"up.contextmenu"),y(document).off("keydown.contextmenu"),y(".jo_contextmenu").remove())});let h=e>window.innerWidth*.8?"right":"left",b=e>window.innerWidth*.8?window.innerWidth-e:e,k=t>window.innerHeight*.8?"bottom":"top",E=t>window.innerHeight*.8?window.innerHeight-t:t,P={};return P[h]=b+"px",P[k]=E+"px",r.css(P),y("body").append(r),r.show(),r}function Qt(f){let e=f.find(".jo_tabheadings>div").not(".jo_noHeading"),t=f.find(".jo_tabs>div"),i=window.PointerEvent?"pointer":"mouse";e.on(i+"down",r=>{let o=y(r.target);e.removeClass("jo_active"),o.addClass("jo_active");let u=f.find("."+o.data("target"));t.removeClass("jo_active"),t.trigger("myhide"),u.addClass("jo_active"),u.trigger("myshow")})}function xt(f,e="",t="",i){let r="";f!=null&&f!=""&&(r+=` id="${f}"`),e!=null&&e!=""&&(r+=` class="${e}"`);let o=y(`<div${r}></div>`);return i!=null&&o.css(i),t!=null&&t!=""&&o.text(t),o}var pi=!1;function lo(){matchMedia("(pointer:fine)").matches&&(pi=!0)}function Zn(f,e,t,i){let r="rgba("+t[0]+", "+t[1]+", "+t[2]+", ",o=1,u=o/(i/20),h=()=>{f.css(e,r+o+")"),o-=u,o<0?f.css(e,""):setTimeout(h,20)};h()}function uo(f,e,t=!1){var i=t?f:new Blob([JSON.stringify(f)],{type:"text/plain"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(i,e);else{var r=document.createEvent("MouseEvents"),o=document.createElement("a");o.download=e,o.href=window.URL.createObjectURL(i),o.dataset.downloadurl=["text/plain",o.download,o.href].join(":"),r.initEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(r),o.remove()}}function co(f){var e=document.createElement("textarea");e.value=f,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{var t=document.execCommand("copy")}catch(i){console.error("Fallback: Oops, unable to copy",i)}document.body.removeChild(e)}function hr(f){if(!navigator.clipboard){co(f);return}navigator.clipboard.writeText(f).then(function(){},function(e){console.error("Async: Could not copy text: ",e)})}const qe=class{static registerPerformanceEntry(e,t){let i=qe.performanceData.find(o=>o.url==e);i==null&&(i={count:0,sumTime:0,url:e},qe.performanceData.push(i)),i.count++;let r=Math.round(performance.now()-t);i.sumTime+=r,qe.performanceDataCount++}static sendDataToServer(){if(performance.now()-qe.lastTimeSent>3*60*1e3){let e={data:qe.performanceData};qe.performanceData=[],qe.performanceDataCount=0,qe.lastTimeSent=performance.now(),ue("collectPerformanceData",e,()=>{})}}};let Ct=qe;w(Ct,"performanceData",[]),w(Ct,"performanceDataCount",0),w(Ct,"lastTimeSent",performance.now());function ue(f,e,t,i){zi(!0);let r=performance.now();$.ajax({type:"POST",async:!0,data:JSON.stringify(e),contentType:"application/json",url:"servlet/"+f,success:function(o){if(Ct.registerPerformanceEntry(f,r),zi(!1),o.success!=null&&o.success==!1||typeof o=="string"&&o==""){let u="Fehler bei der Bearbeitung der Anfrage";o.message!=null&&(u=o.message),i&&i(u)}else t(o)},error:function(o,u){if(zi(!1),i){let h="Server nicht erreichbar.";o.status!=0&&(h=""+o.status),i(u+": "+h);return}}})}function zi(f){f?y(".jo_network-busy").css("visibility","visible"):y(".jo_network-busy").css("visibility","hidden")}class Xi{constructor(){w(this,"id");w(this,"name");w(this,"templateDump");w(this,"based_on_template_id");w(this,"templateName");w(this,"statements");w(this,"published_to");w(this,"version");w(this,"description");w(this,"owner_id")}static fromDatabaseData(e,t){let i=new Xi;return i.id=e.id,i.name=e.name,i.statements=e.statements,i.published_to=e.published_to,i.version=t,i.description=e.description,i.templateDump=null,i.based_on_template_id=e.based_on_template_id,i.owner_id=e.owner_id,i}}class ho{fetchTemplateFromCache(e,t){if(e==null){t(null);return}let i=this;this.cacheAvailable()||t(null),this.getCache(r=>{r.match(i.databaseIdToCacheIdentifier(e)).then(o=>{o.arrayBuffer().then(u=>t(new Uint8Array(u)))}).catch(()=>t(null))})}saveTemplateToCache(e,t){if(!this.cacheAvailable())return;let i=this;this.getCache(r=>{r.put(i.databaseIdToCacheIdentifier(e),new Response(t))})}cacheAvailable(){return"caches"in self}getCache(e){caches.open("my-cache").then(e)}databaseIdToCacheIdentifier(e){return"/onlineIdeTemplateDb"+e}}class fo{constructor(e,t){w(this,"connection");w(this,"state");w(this,"unsentMessages",[]);this.main=e,this.networkManager=t,this.connect()}connect(){this.state="connecting",ue("getWebSocketToken",{},e=>{let t=(window.location.protocol.startsWith("https")?"wss://":"ws://")+window.location.host+"/servlet/subscriptionwebsocket";this.connection=new WebSocket(t),this.connection.onerror=i=>{this.onError(i)},this.connection.onclose=i=>{this.onClose(i)},this.connection.onmessage=i=>{this.onMessage(i)},this.connection.onopen=i=>{let r={command:1,token:e.token};this.state="connected",this.sendIntern(JSON.stringify(r))},setTimeout(()=>{this.state!="subscribed"&&(this.networkManager.forcedUpdateEvery=1,this.networkManager.counterTillForcedUpdate=1)},7e3)})}disconnect(){let e={command:2};this.state="connected",this.sendIntern(JSON.stringify(e))}sendIntern(e){if(this.state!="disconnected")try{this.connection.send(e)}catch(t){console.log(t)}}onClose(e){this.state="disconnected"}onMessage(e){let t=JSON.parse(e.data);if(t.command!=null)switch(t.command){case 1:this.state="subscribed";break;case 2:this.networkManager.sendUpdates(()=>{},!0);break;case 3:this.state="disconnected";break}}onError(e){console.log("Fehler beim Notifier-Websocket")}}class Ji{uploadCurrentDatabase(e,t,i,r,o=()=>{}){t.waitOverlay.show("Bitte warten, lade Vorlage auf den Server hoch ..."),e>=0?t.getDatabaseTool().export(h=>{h=pako.deflate(h),this.uploadIntern(h,e,r,t,o)},h=>{alert("Fehler beim Exportieren der Datenbank: "+h),t.waitOverlay.hide()}):this.uploadIntern(i,-1,r,t,o)}uploadIntern(e,t,i,r,o){return $.ajax({type:"POST",async:!0,contentType:"application/octet-stream",data:e,processData:!1,headers:{"x-workspaceid":""+t,"x-reason":i},url:"servlet/uploadTemplate",success:function(u){r.waitOverlay.hide(),o(u)},error:function(u,h){alert("message"),r.waitOverlay.hide()}}),e}}class po{constructor(e,t){w(this,"timerhandle");w(this,"ownUpdateFrequencyInSeconds",20);w(this,"teacherUpdateFrequencyInSeconds",5);w(this,"updateFrequencyInSeconds",20);w(this,"forcedUpdateEvery",4);w(this,"counterTillForcedUpdate",2);w(this,"secondsTillNextUpdate",this.updateFrequencyInSeconds);w(this,"errorHappened",!1);w(this,"interval");w(this,"notifierClient");this.main=e,this.$updateTimerDiv=t}initializeTimer(){let e=this;this.$updateTimerDiv.find("svg").attr("width",e.updateFrequencyInSeconds),this.interval!=null&&clearInterval(this.interval),this.interval=setInterval(()=>{if(e.main.user==null)return;if(e.secondsTillNextUpdate--,e.secondsTillNextUpdate<0){e.secondsTillNextUpdate=e.updateFrequencyInSeconds,this.counterTillForcedUpdate--;let i=this.counterTillForcedUpdate==0;i&&(this.counterTillForcedUpdate=this.forcedUpdateEvery),e.sendUpdates(()=>{},i)}let t=this.$updateTimerDiv.find(".jo_updateTimerRect");t.attr("width",e.secondsTillNextUpdate+"px"),e.errorHappened?(t.css("fill","#c00000"),this.$updateTimerDiv.attr("title","Fehler beim letzten Speichervorgang -> Werd's wieder versuchen")):(t.css("fill","#008000"),this.$updateTimerDiv.attr("title",e.secondsTillNextUpdate+" Sekunden bis zum nächsten Speichern"))},1e3)}initializeNotifierClient(){this.notifierClient=new fo(this.main,this)}sendUpdates(e,t=!1){var h;if(this.main.user==null)return;this.main.projectExplorer.writeEditorTextToFile(),this.main.userDataDirty&&(this.main.userDataDirty=!1,this.sendUpdateUserSettings(()=>{}));let i=[],r=[];for(let b of this.main.workspaceList){b.saved||(i.push(b.getWorkspaceData(!1)),b.saved=!0);for(let k of b.moduleStore.getModules(!1))k.file.saved||(k.file.text=k.getProgramTextFromMonacoModel(),r.push(k.getFileData(b)),k.file.saved=!0)}let o={workspacesWithoutFiles:i,files:r,owner_id:this.main.workspacesOwnerId,userId:this.main.user.id,language:1,currentWorkspaceId:(h=this.main.getCurrentWorkspace())==null?void 0:h.id,getModifiedWorkspaces:!1},u=this;if(i.length>0||r.length>0||t)ue("sendUpdates",o,b=>{if(u.errorHappened=!b.success,!u.errorHappened&&(u.updateWorkspaces(o,b),e!=null)){e();return}},()=>{u.errorHappened=!0});else if(e!=null){e();return}}sendCreateWorkspace(e,t,i){if(this.main.user.is_testuser){e.id=Math.round(Math.random()*1e7),i(null);return}let r={type:"create",entity:"workspace",data:e,owner_id:t,userId:this.main.user.id};ue("createOrDeleteFileOrWorkspace",r,o=>{e.id=o.id,i(null)},i)}getDatabaseSettings(e,t){ue("getDatabaseSettings",{workspaceId:e},r=>{t(r)},r=>{alert(r)})}setNewSecret(e,t,i){ue("setNewSecret",{workspaceId:e,secretKind:t},o=>{i(o.secret)},o=>{alert(o)})}setNameAndPublishedTo(e,t,i,r,o){ue("setPublishedTo",{workspaceId:e,databaseName:t,publishedTo:i,description:r},h=>{o()},h=>{alert(h)})}sendCreateFile(e,t,i,r){let u={type:"create",entity:"file",data:e.getFileData(t),owner_id:i,userId:this.main.user.id};ue("createOrDeleteFileOrWorkspace",u,h=>{e.file.id=h.id,r(null)},r)}sendDuplicateWorkspace(e,t){let i={workspace_id:e.id,language:1};ue("duplicateWorkspace",i,r=>{t(r.message,r.workspace)},t)}sendDistributeWorkspace(e,t,i,r){let o=()=>{new Ji().uploadCurrentDatabase(e.id,this.main,null,"distributeWorkspace",u=>{this.sendUpdates(()=>{let h={workspace_id:e.id,database_as_template_id:u.newTemplateId,class_id:t==null?void 0:t.id,student_ids:i};ue("distributeWorkspace",h,b=>{r(b.message)},r)},!1)})};this.main.projectExplorer.setWorkspaceActive(e,o)}sendDeleteWorkspaceOrFile(e,t,i){let r={type:"delete",entity:e,id:t,userId:this.main.user.id};ue("createOrDeleteFileOrWorkspace",r,o=>{o.success?i(null):i("Netzwerkfehler!")},i)}sendUpdateUserSettings(e){var i;let t={settings:this.main.user.settings,userId:this.main.user.id,current_workspace_id:(i=this.main.getCurrentWorkspace())==null?void 0:i.id};ue("updateUserSettings",t,r=>{r.success?e(null):e("Netzwerkfehler!")},e)}getNewStatements(e,t){let i={workspaceId:e.id,version_before:e.database.version};ue("getNewStatements",i,r=>{r.success&&t(r.newStatements,r.firstNewStatementIndex)})}AddDatabaseStatements(e,t,i){let r={workspaceId:e.id,version_before:e.database.version,statements:t};ue("addDatabaseStatements",r,o=>{o.success&&i(o.statements_before,o.new_version)})}fetchDatabase(e,t){let i=new ho,r={workspaceId:e.id};ue("getDatabase",r,o=>{o.success?(e.database=Xi.fromDatabaseData(o.database,o.version),i.fetchTemplateFromCache(e.database.based_on_template_id,u=>{if(u!=null){try{e.database.templateDump=pako.inflate(u)}catch(h){console.log(h),console.log("Dump seems not to be compressed..."),e.database.templateDump=u}t(null);return}else{if(e.database.based_on_template_id==null){t(null);return}this.fetchTemplate(e.id,h=>{if(h!=null){i.saveTemplateToCache(e.database.based_on_template_id,h),e.database.templateDump=pako.inflate(h),t(null);return}else{t("Konnte das Template nicht laden.");return}})}})):t("Netzwerkfehler!")})}fetchTemplate(e,t){let i={workspaceId:e};$.ajax({type:"POST",async:!0,data:JSON.stringify(i),contentType:"application/json",url:"servlet/getTemplate",xhrFields:{responseType:"arraybuffer"},success:function(r){t(new Uint8Array(r))},error:function(r,o){alert("Konnte das Template nicht laden."),t(null)}})}fetchTemplateList(e){let t={user_id:this.main.user.id};ue("getTemplateList",t,i=>{i.success?e(i.templateList):e([])},i=>{alert(i),e([])})}updateWorkspaces(e,t){let i=new Map,r=[];e.files.forEach(u=>r.push(u.id)),t.workspaces.workspaces.forEach(u=>i.set(u.id,u));let o=[];for(let u of t.workspaces.workspaces)this.main.workspaceList.filter(b=>b.id==u.id).length==0&&(o.push(u.name),this.createNewWorkspaceFromWorkspaceData(u));for(let u of this.main.workspaceList){let h=i.get(u.id);if(h!=null){let b=new Map;h.files.forEach(E=>b.set(E.id,E));let k=new Map;for(let E of u.moduleStore.getModules(!1)){let P=E.file.id;k.set(P,E);let L=b.get(P);L==null?(this.main.projectExplorer.fileListPanel.removeElement(E),this.main.currentWorkspace.moduleStore.removeModule(E)):L.version>E.file.version&&((r.indexOf(P)<0||L.forceUpdate)&&(E.file.text=L.text,E.model.setValue(L.text),E.file.saved=!0,E.lastSavedVersionId=E.model.getAlternativeVersionId()),E.file.version=L.version)}for(let E of h.files)k.get(E.id)==null&&this.createFile(u,E)}}if(o.length>0){let u=o.length>1?"Folgende Workspaces hat Deine Lehrkraft Dir gesendet: ":"Folgenden Workspace hat Deine Lehrkraft Dir gesendet: ";u+=o.join(", "),alert(u)}this.main.projectExplorer.workspaceListPanel.sortElements(),this.main.projectExplorer.fileListPanel.sortElements()}createNewWorkspaceFromWorkspaceData(e,t=!1){let i=this.main.createNewWorkspace(e.name,e.owner_id);i.id=e.id,i.sql_history="",i.path=e.path,i.isFolder=e.isFolder,this.main.workspaceList.push(i);let r=e.path.split("/");r.length==1&&r[0]==""&&(r=[]);let o={name:e.name,externalElement:i,iconClass:"workspace",isFolder:e.isFolder,path:r};this.main.projectExplorer.workspaceListPanel.addElement(o,!0),i.panelElement=o;for(let u of e.files)this.createFile(i,u);t&&(this.main.projectExplorer.workspaceListPanel.sortElements(),this.main.projectExplorer.fileListPanel.sortElements())}createFile(e,t){let i=null;e==this.main.currentWorkspace&&(i={name:t.name,externalElement:null},this.main.projectExplorer.fileListPanel.addElement(i,!0));let r={id:t.id,name:t.name,dirty:!1,saved:!0,text:t.text,version:t.version,identical_to_repository_version:!0,workspace_id:e.id,panelElement:i},o=this.main.projectExplorer.getNewModule(r);i!=null&&(i.externalElement=o),e.moduleStore.putModule(o)}rollback(e){let t=this.main.currentWorkspace,i={workspaceId:t.id,version:t.database.version};ue("rollback",i,r=>{r.success?e(null,t.database.version>r.new_version):(alert(r.message),e(r.message,!1))},r=>{alert(r),e(r,!1)})}}class fr{constructor(e,t){w(this,"$dialog");this.main=e,this.workspace=t,this.init()}init(){this.$dialog=y("#dialog"),y("#main").css("visibility","hidden"),this.$dialog.append(y(`<div class="jo_ds_heading">Datenbank-Einstellungen</div>
            <div style="width: 100%; margin-left: 10px">
                <div class="jo_ds_settings" style="margin-left: 0px">
                <div class="jo_ds_settings_caption">Name der Datenbank:</div><div><input class="dialog-input jo_databasename" value="Neue Datenbank"></input></div>
                </div>

                <div class="jo_ds_settings_caption" style="margin-top: 20px">
                Zugriffscodes für andere Benutzer:
                </div>
                                
                <div>
                    <table class="jo_ds_secret_table">
                    <tr>
                        <td>Nur Lesen:</td><td class="jo_ds_secret jo_ds_secret_read"></td><td id="copySecretTdread"></td><td><button class="jo_small_button jo_button_code_read">Neuen Code generieren</button></td>
                    <tr>
                        <td>Lesen und schreiben:</td><td class="jo_ds_secret jo_ds_secret_write"></td><td id="copySecretTdwrite"></td><td><button class="jo_small_button jo_button_code_write">Neuen Code generieren</button></td>
                    </tr>
                    <tr>
                        <td>Lesen, schreiben und Struktur verändern:</td><td class="jo_ds_secret jo_ds_secret_ddl"></td><td id="copySecretTdddl"></td><td><button class="jo_small_button jo_button_code_ddl">Neuen Code generieren</button></td>
                    </tr>
                    </table>
                </div>

                <div class="jo_ds_settings_caption" style="margin-top: 20px">
                Beschreibung:
                </div>
                <div>
                <textarea class="jo_ds_settings_description" maxlength="5000"></textarea>
                </div>

                <div class="jo_ds_settings_caption" style="margin-top: 20px">
                Datenbank freigeben als Vorlage für andere Benutzer:
                </div>

                <fieldset id="jo_ds_publishedTo">
                    <input type="radio" id="b0" name="publishedFilter" value="0" checked="checked"><label for="b0">Keine Freigabe</label>
                    <input type="radio" id="b1" name="publishedFilter" value="1"><label for="b1">Freigabe für meine Klasse(n)</label>
                    <input type="radio" id="b2" name="publishedFilter" value="2" style="visibility: none"><label id="lb2" for="b2" style="visibility: none">Freigabe für meine Schule</label>
                    <input type="radio" id="b3" name="publishedFilter" value="3" style="visibility: none"><label id="lb3" for="b3" style="visibility: none">Freigabe für alle Schulen</label>
                </fieldset>

                <div>
                    <input type="checkbox" id="jo_upload_db" name="jo_upload_db">
                    <label for="jo_upload_db">Aktuellen Zustand der Datenbank als Vorlage hochladen</label>
                </div>
            </div>


             <div class="dialog-buttonRow jo_ds_buttonRow">
                <button id="jo_ds_cancel_button">Abbrechen</button>
                <button id="jo_ds_save_button">Speichern</button>
             </div>
            `));let e=this;this.$dialog.css("visibility","visible"),y("#jo_ds_cancel_button").on("click",()=>{this.showMainWindow()}),y("#jo_ds_save_button").on("click",()=>{this.saveNameAndPublishedTo()}),this.setValues(),["read","write","ddl"].forEach(t=>{y(".jo_button_code_"+t).on("pointerdown",()=>{e.main.networkManager.setNewSecret(e.workspace.id,t,r=>{y(".jo_ds_secret_"+t).text(r)})});let i=y('<button class="jo_small_button jo_copy_secret_button jo_active">Kopieren</button>');y("#copySecretTd"+t).append(i),i.on("pointerdown",()=>{hr(y(".jo_ds_secret_"+t).text())})}),y("#jo_ds_publishedTo>input").on("change",t=>{$("#jo_upload_db").prop("checked",!y("#b0")[0].checked)})}saveNameAndPublishedTo(){let e=0;y("#jo_ds_publishedTo").find("input").each((t,i)=>{let r=y(i);i.checked&&(e=Number.parseInt(r.attr("value")))}),this.main.networkManager.setNameAndPublishedTo(this.workspace.id,y(".jo_databasename").val(),e,y(".jo_ds_settings_description").val(),()=>{$("#jo_upload_db").prop("checked")&&new Ji().uploadCurrentDatabase(this.workspace.id,this.main,null,"publishDatabaseAsTemplate"),this.showMainWindow()})}setValues(){y(".jo_databasename").val(this.workspace.name),this.main.networkManager.getDatabaseSettings(this.workspace.id,e=>{["read","write","ddl"].forEach(t=>{y(".jo_ds_secret_"+t).text(e.secrets[t])}),this.main.user.is_admin&&(y("#b3").css("visibility","visible"),y("#lb3").css("visibility","visible")),this.main.user.is_schooladmin&&(y("#b2").css("visibility","visible"),y("#lb2").css("visibility","visible")),y("#b"+e.publishedTo).prop("checked",!0),y("#jo_upload_db").prop("checked",e.publishedTo!=0),y(".jo_ds_settings_description").val(this.workspace.database.description)})}showMainWindow(){y("#main").css("visibility","visible"),this.$dialog.css("visibility","hidden"),this.$dialog.empty()}}class Dt{constructor(e,t,i){w(this,"name");w(this,"path","");w(this,"isFolder");w(this,"id");w(this,"owner_id");w(this,"version");w(this,"moduleStore");w(this,"panelElement");w(this,"currentlyOpenModule");w(this,"saved",!0);w(this,"compilerMessage");w(this,"databaseId");w(this,"database");w(this,"sql_history");w(this,"permissions");this.main=t,this.name=e,this.owner_id=i,this.moduleStore=new Qi(t),this.sql_history=""}getWorkspaceData(e){let t={name:this.name,id:this.id,owner_id:this.owner_id,currentFileId:this.currentlyOpenModule==null?null:this.currentlyOpenModule.file.id,files:[],sql_history:this.sql_history,path:this.path,isFolder:!1,permissions:this.permissions,database_id:this.databaseId};if(e)for(let i of this.moduleStore.getModules(!1))t.files.push(i.getFileData(this));return t}renderSettingsButton(e){var o;let t=(o=e==null?void 0:e.$htmlFirstLine)==null?void 0:o.find(".jo_additionalButtonSettings");if(t==null)return;let i=y('<div class="jo_settingsButton img_settings jo_button jo_active" title="Datenbank-Einstellungen..."></div>');t.append(i);let r=this;i.on("pointerdown",u=>u.stopPropagation()),i.on("pointerup",u=>{u.stopPropagation(),new fr(r.main,r)}),i[0].addEventListener("contextmenu",u=>{u.preventDefault(),u.stopPropagation()},!1)}static restoreFromData(e,t){let i=new Dt(e.name,t,e.owner_id);i.id=e.id,i.path=e.path,i.isFolder=e.isFolder,i.owner_id=e.owner_id,i.sql_history=e.sql_history,i.permissions=e.permissions,i.databaseId=e.database_id;for(let r of e.files){let o=ze.restoreFromData(r,t);i.moduleStore.putModule(o),r.id==e.currentFileId&&(i.currentlyOpenModule=o)}return i}hasErrors(){return this.moduleStore.hasErrors()}getModuleByMonacoModel(e){for(let t of this.moduleStore.getModules(!1))if(t.model==e)return t;return null}}class mo{constructor(e){w(this,"isConsole");w(this,"triggerCharacters",[".","abcdefghijklmnopqrstuvwxyzäöüß_ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜ"," ",",","("]);w(this,"keywordCompletionItems",new Map);w(this,"first",!0);w(this,"keywordToSnippetMap",{"(":`(
	$0
)`,varchar:"varchar($1) $0",decimal:"decimal($1, $2) $0"});this.main=e,this.setupKeywordCompletionItems()}provideCompletionItems(e,t,i,r){let o=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);return o==null||o.mainSymbolTable==null?null:new Promise((u,h)=>{let b=this,k=function(){o.file.dirty?setTimeout(()=>{k()},100):u(b.provideCompletionItemsIntern(e,t,i,r))};k()})}provideCompletionItemsIntern(e,t,i,r){setTimeout(()=>{let W=this.main.getMonacoEditor()._contentWidgets["editor.widget.suggestWidget"].widget;this.first&&(W.toggleDetails(),this.first=!1)},500);let o=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(o==null||o.mainSymbolTable==null||this.isStringLiteral(o,t))return null;let u=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}),h=e.getValueInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:t.lineNumber+5,endColumn:1}),b=o.mainSymbolTable.findTableAtPosition(t.lineNumber,t.column),k=o.getCompletionHint(t.lineNumber,t.column);k==null&&(k={fromColumn:0,toColumn:0,fromLine:0,toLine:0,hintColumns:!1,hintTables:!1,hintKeywords:[]});let E=[];this.addKeywordCompletionItems(k,E);let P=u.match(/.*\s([\wöäüÖÄÜß]*)(\.)([\wöäüÖÄÜß]*)$/),L=h.match(/^([\wöäüÖÄÜß]*)/),H="";L!=null&&L.length>0&&(H=L[0]),P==null?this.addIdentifierCompletionItems(k,b,E):this.addDotCompletionItems(t,P,H,b,E);let z=e.getWordUntilPosition(t),A={startColumn:z.startColumn,startLineNumber:t.lineNumber,endColumn:z.endColumn,endLineNumber:t.lineNumber},K={startColumn:t.column,startLineNumber:t.lineNumber,endColumn:t.column,endLineNumber:t.lineNumber};for(let W of E)W.range==null&&(W.insertText.startsWith(",")?W.range=K:W.range=A);return k.dontHint!=null&&(E=E.filter(W=>k.dontHint.indexOf(W.insertText)<0)),{suggestions:E}}addDotCompletionItems(e,t,i,r,o){let u=t[3],h=t[1];e.column-u.length-1;let b={startLineNumber:e.lineNumber,startColumn:e.column-u.length,endLineNumber:e.lineNumber,endColumn:e.column+i.length};for(let k of r.symbolList)if(k.table!=null){let E=k.table.identifier;if(k.tableAlias!=null&&(E=k.tableAlias),E.toLowerCase()==h)for(let P of k.table.columns)o.push({label:P.identifier,detail:"Spalte "+P.identifier+" der Tabelle "+k.table.identifier,filterText:P.identifier,insertText:P.identifier,insertTextRules:monaco.languages.CompletionItemInsertTextRule.KeepWhitespace,kind:monaco.languages.CompletionItemKind.Field,range:b})}}addIdentifierCompletionItems(e,t,i){var E,P;let r=e.praefix==null?"":e.praefix,o=e.suffix==null?"":e.suffix;if(!(e.hintTables||e.hintColumns))return;let u={},h=t,b={},k=[];for(;h!=null;){for(let L of h.symbolList)if(L.column!=null){let H=L.column.identifier;b[H]==null?(b[H]=[L],k.push(H)):b[H].push(L)}else if(L.table!=null&&e.hintTables&&!u[L.identifier]){let H=r+L.identifier+o;i.push({label:L.identifier,detail:"Tabelle "+L.table.identifier,filterText:L.identifier,insertText:H,insertTextRules:H.indexOf("$")>=0?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:monaco.languages.CompletionItemInsertTextRule.KeepWhitespace,kind:H.indexOf("$")>=0?monaco.languages.CompletionItemKind.Snippet:monaco.languages.CompletionItemKind.Class,range:void 0,sortText:"aa"+L.identifier}),u[L.identifier]=!0}h=h.parent}if(e.hintColumns)for(let L of k){let H=b[L],z=H.length>1&&e.hintColumnsOfTable==null;for(let A of H){let K=A.identifier;if(z&&A.identifier==A.column.identifier.toLowerCase()&&(K=(A.tableAlias==null?A.column.table.identifier:A.tableAlias)+"."+K),e.hintColumnsOfTable==null||((P=(E=A.column)==null?void 0:E.table)==null?void 0:P.identifier)==e.hintColumnsOfTable){let W=r+K+o;i.push({label:K,detail:"Die Spalte "+A.column.identifier+" der Tabelle "+A.column.table.identifier,filterText:K,insertText:W,insertTextRules:W.indexOf("$")>=0?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:monaco.languages.CompletionItemInsertTextRule.KeepWhitespace,kind:W.indexOf("$")>=0?monaco.languages.CompletionItemKind.Snippet:monaco.languages.CompletionItemKind.Field,range:void 0})}}}}addKeywordCompletionItems(e,t){let i=e.praefix==null?"":e.praefix,r=e.suffix==null?"":e.suffix;for(let o of e.hintKeywords){let u=i+o+r,h=this.keywordToSnippetMap[o],b=this.keywordCompletionItems.get(o);if(b!=null)t.push(b);else if(h!=null){let k=h.replace("$0","").replace("$1","").replace("$2","").replace(/ /g,"").replace(/\n/g,"").replace(/\t/g,"");t.push({label:k,detail:"",filterText:o,insertText:h,insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0})}else t.push({label:o,detail:"",filterText:o,insertText:o,insertTextRules:u.indexOf("$")>=0?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:monaco.languages.CompletionItemInsertTextRule.KeepWhitespace,kind:u.indexOf("$")>=0?monaco.languages.CompletionItemKind.Snippet:monaco.languages.CompletionItemKind.Keyword,range:void 0,sortText:o=="from"?"*":void 0})}}isStringLiteral(e,t){let i=e.tokenList;if(i==null||i.length==0)return!1;let r=0,o=i.length-1,u,h=1e3;for(;;){let b=u;if(u=Math.round((o+r)/2),b==u||(h--,h==0))return!1;let k=i[u],E=k.position;if(E.line<t.lineNumber||E.line==t.lineNumber&&E.column+E.length<t.column){r=u;continue}if(E.line>t.lineNumber||E.line==t.lineNumber&&E.column>t.column){o=u;continue}return k.tt==l.stringConstant}}setupKeywordCompletionItems(){this.keywordCompletionItems.set("delete from",{label:"delete from <Tabelle> where <Bedingung>",detail:"Anweisung zum Löschen von Datensätzen",filterText:"delete from",insertText:"delete from ",command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}),this.keywordCompletionItems.set("drop table",{label:"drop table <Tabelle>",detail:"Anweisung zum Löschen einer Tabelle",filterText:"drop table",insertText:"drop table ",command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}),this.keywordCompletionItems.set("alter",{label:"alter table <Tabelle> <rename to, rename column, add column, drop column>",detail:"Anweisung zum Ändern des Schemas (alter table <Tabelle> <rename to, rename column, add column, drop column>)",filterText:"alter",insertText:"alter table ",command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}),this.keywordCompletionItems.set("select",{label:"select <Spalten> from <Tabellen> where <Bedingung>",detail:"Select-Anweisung",filterText:"select",insertText:`select * from $1
where $0
`,command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}),this.keywordCompletionItems.set("create table",{label:"create table <Tabellenbezeichner> (<Spaltendefinitionen>)",detail:"Create table-Anweisung (Erstellt eine neue Tabelle)",filterText:"create",insertText:`create table $1 (
	$0
);`,command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0})}}class go{constructor(e){w(this,"signatureHelpTriggerCharacters",["(",",",";","<",">","="]);w(this,"signatureHelpRetriggerCharacters",[]);this.main=e}provideSignatureHelp(e,t,i,r){let o=this;return new Promise((u,h)=>{setTimeout(()=>{this.main.compileIfDirty(),u(o.provideSignatureHelpLater(e,t,i,r))},300)})}provideSignatureHelpLater(e,t,i,r){e!=this.main.getMonacoEditor().getModel();let o=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(o==null)return null;let u=o.methodCallPositions[t.lineNumber];if(u==null)return null;let h=null,b=-1;for(let k=u.length-1;k>=0;k--){let E=u[k];E.identifierPosition.column+E.identifierPosition.length<t.column&&E.identifierPosition.column>b&&(E.rightBracketPosition==null||t.lineNumber<=E.rightBracketPosition.line&&t.column<=E.rightBracketPosition.column||t.lineNumber<E.rightBracketPosition.line)&&(h=E,b=E.identifierPosition.column)}return h==null?null:this.getSignatureHelp(h,t)}getSignatureHelp(e,t){let i=0;for(let o of e.commaPositions)(o.line<t.lineNumber||o.line==t.lineNumber&&o.column<t.column)&&i++;let r=[];return Promise.resolve({value:{activeParameter:i,activeSignature:0,signatures:r},dispose:()=>{}})}}const en=class{constructor(e){this.editor=e}provideHover(e,t,i){var h;let r=this.editor.editor.getSelection();if(r!=null&&(r.startLineNumber!=r.endLineNumber||r.startColumn!=r.endColumn)&&(r.startLineNumber<t.lineNumber||r.startLineNumber==t.lineNumber&&r.startColumn<=t.column)&&(r.endLineNumber>t.lineNumber||r.endLineNumber==t.lineNumber&&r.endColumn>=t.column))return;let o=(h=this.editor.main.getCurrentWorkspace())==null?void 0:h.getModuleByMonacoModel(e);if(o==null)return null;for(let b of o.errors)for(let k of b)if(k.position.line==t.lineNumber&&k.position.column<=t.column&&k.position.column+k.position.length>=t.column)return null;if(o.getElementAtPosition(t.lineNumber,t.column)==null){let b=this.getWordUnderCursor(e,t),k=en.keywordDescriptions[b];if(k!=null)return{range:null,contents:[{value:k}]}}}getWordUnderCursor(e,t){let i=e.getValueLengthInRange({startColumn:0,startLineNumber:0,endLineNumber:t.lineNumber,endColumn:t.column}),r=e.getValue(),o="",u=i;for(;u<r.length&&this.isInsideIdentifierOrArrayDescriptor(r.charAt(u));)u++;let h=i;for(;h>0&&this.isInsideIdentifierOrArrayDescriptor(r.charAt(h-1));)h--;if(u-h>1)o=r.substring(h,u);else{for(u=i;u<r.length&&this.isInsideOperator(r.charAt(u));)u++;for(h=i;h>0&&this.isInsideOperator(r.charAt(h-1));)h--;u-h>0&&(o=r.substring(h,u))}return o}widenDeclaration(e,t,i){let r=e.getValueLengthInRange({startColumn:0,startLineNumber:0,endLineNumber:t.lineNumber,endColumn:t.column}),o=e.getValue(),u=r;for(;u<o.length&&this.isInsideIdentifierOrArrayDescriptor(o.charAt(u));)u++;let h=r;for(;h>0&&this.isInsideIdentifierChain(o.charAt(h-1));)h--;return(i==null?void 0:i.length)==null||i.length,u-h>length?o.substring(h,u):i}isInsideIdentifierChain(e){return e.toLocaleLowerCase().match(/[a-z0-9äöüß_\[\]\.]/i)}isInsideOperator(e){return e.toLocaleLowerCase().match(/[!%<>=\+\-\*\/]/i)}isInsideIdentifierOrArrayDescriptor(e){return e.toLocaleLowerCase().match(/[a-z0-9äöüß\[\]]/i)}};let mi=en;w(mi,"keywordDescriptions",{print:"Die Anweisung ```print``` gibt eine Zeichenkette aus.",new:'Das Schlüsselwort ```new``` bewirkt die Instanzierung ("Erschaffung") eines neuen Objektes einer Klasse.',println:"Die Anweisung ```println``` gibt eine Zeichenkette gefolgt von einem Zeilenumbruch aus.",while:"```\nwhile (Bedingung) {Anweisungen}\n```  \nbewirkt die Wiederholung der Anweisungen solange ```Bedingung == true``` ist.",for:"```\nfor(Startanweisung;Solange-Bedingung;Nach_jeder_Wiederholung){Anweisungen}\n```  \nführt zunächst die Startanweisung aus und wiederholt dann die Anweisungen solange ```Bedingung == true``` ist. Am Ende jeder wiederholung wird Nach_jeder_Wiederholung ausgeführt.",if:"```\nif(Bedingung){Anweisungen_1} else {Anweisungen_2}\n```  \nwertet die Bedingung aus und führt Anweisungen_1 nur dann aus, wenn die Bedingung ```true``` ergibt, Anweisungen_2 nur dann, wenn die Bedingung ```false``` ergibt.  \nDer ```else```-Teil kann auch weggelassen werden.",else:"```\nif(Bedingung){Anweisungen_1} else {Anweisungen_2}\n```  \nwertet die Bedingung aus und führt Anweisungen_1 nur dann aus, wenn die Bedingung ```true``` ergibt, Anweisungen_2 nur dann, wenn die Bedingung ```false``` ergibt.",switch:"```\nswitch(Selektor){ case Wert_1: Anweisungen_1; break; case Wert_2: Anweisungen_2; break; default: Default-Anweisungen } \n```  \nwertet den Selektor-Term aus und führt abhängig vom Termwert Anweisungen_1, Anweisungen_2, ... aus. Entspricht der Termwert keinem der Werte Wert_1, Wert_2, ..., so werden die Default-Anweisungen ausgeführt.","%":"```\na % b\n```  \n (sprich: 'a modulo b') berechnet den **Rest** der ganzzahligen Division a/b.","==":"```\na == b\n```  \nergibt genau dann ```true```, wenn ```a``` und ```b``` gleich sind.  \nSind a und b **Objekte**, so ergibt ```a == b``` nur dann ```true```, wenn ```a``` und ```b``` auf das **identische** Objekt zeigen.  \n```==``` nennt man **Vergleichsoperator**.","<=":"```\na <= b\n```  \nergibt genau dann ```true```, wenn der Wert von ```a``` kleiner oder gleich dem Wert von ```b``` ist.",">=":"```\na <= b\n```  \nergibt genau dann ```true```, wenn der Wert von ```a``` größer oder gleich dem Wert von ```b``` ist.","!=":"```\na != b\n```  \nergibt genau dann ```true```, wenn ```a``` und ```b``` **un**gleich sind.  \nSind ```a``` und ```b``` **Objekte**, so ergibt ```a != b``` dann ```true```, wenn ```a``` und ```b``` **nicht** auf das **identische** Objekt zeigen.  \n```!=``` nennt man **Ungleich-Operator**.","+=":"```\na += b\n(Kurzschreibweise für a = a + b)\n```  \nbewirkt, dass der Wert von ```a``` um den Wert von ```b``` **erhöht** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","-=":"```\na -= b\n(Kurzschreibweise für a = a - b)\n```  \nbewirkt, dass der Wert von ```a``` um den Wert von ```b``` **erniedrigt** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","*=":"```\na *= b\n(Kurzschreibweise für a = a * b)\n```  \nbewirkt, dass der Wert von ```a``` mit dem Wert von ```b``` **multipliziert** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","/=":"```\na /= b\n(Kurzschreibweise für a = a / b)\n```  \nbewirkt, dass der Wert von ```a``` durch den Wert von ```b``` **dividiert** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","++":"```\na++\n(Kurzschreibweise für a = a + 1)\n```  \nbewirkt, dass der Wert von ```a``` um eins erhöht wird.","--":"```\na--\n(Kurzschreibweise für a = a - 1)\n```  \nbewirkt, dass der Wert von ```a``` um eins eniedrigt wird.","=":"```\na = Term\n```  \nberechnet den Wert des Terms und weist ihn der Variablen ```a``` zu.  \n**Vorsicht:**  \nVerwechsle ```=```(**Zuweisungsoperator**) nicht mit ```==```(**Vergleichsoperator**)!","!":"```\n!a\n```  \nergibt genau dann ```true```, wenn ```a``` ```false``` ergibt.  \n```!``` spricht man '**nicht**'.",public:"```\npublic\n```  \nAttribute und Methoden, die als ```public``` deklariert werden, sind überall (auch außerhalb der Klasse) sichtbar.",private:"```\nprivate\n```  \nAttribute und Methoden, die als ```private``` deklariert werden, sind nur innerhalb von Methoden derselben Klasse sichtbar.",protected:"```\nprotected\n```  \nAttribute und Methoden, die als ```protected``` deklariert werden, sind nur innerhalb von Methoden derselben Klasse oder innerhalb von Methoden von Kindklassen sichtbar.",return:"```\nreturn Term\n```  \nbewirkt, dass die Methode verlassen wird und der Wert des Terms an die aufrufende Stelle zurückgegeben wird.",break:"```\nbreak;\n```  \ninnerhalb einer Schleife bewirkt, dass die Schleife sofort verlassen und mit den Anweisungen nach der Schleife fortgefahren wird.  \n```break``` innerhalb einer ```switch```-Anweisung bewirkt, dass der Block der ```switch```-Anweisung verlassen wird.",class:"```\nclass\n```  \nMit dem Schlüsselwort ```class``` werden Klassen definiert.",extends:"```\nextends\n```  \n```class A extends B { ... }``` bedeutet, dass die Klasse A Unterklasse der Klasse B ist.",implements:"```\nimplements\n```  \n```class A implements B { ... }``` bedeutet, dass die Klasse A das Interface B implementiert, d.h., dass sie alle Methoden besitzen muss, die in B definiert sind.",this:"```\nthis\n```  \nInnerhalb einer Methodendefinition bezeichnet das Schlüsselwor ```this``` immer dasjenige Objekt, für das die Methode gerade ausgeführt wird."});class bo{constructor(e){this.main=e}provideCodeActions(e,t,i,r){return{actions:i.markers.map(u=>{let h=u.relatedInformation;return h==null?null:{title:h.title,diagnostics:[u],kind:"quickfix",edit:{edits:h.editsProvider(e.uri)},isPreferred:!0}}),dispose:()=>{}}}}class wo{constructor(e){this.main=e}provideReferences(e,t,i,r){let o=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(o==null)return null;let u=o.getElementAtPosition(t.lineNumber,t.column);if(u==null)return;let h=u.usagePositions,b=[];return h.forEach((k,E)=>{if(k!=null)for(let P of k)b.push({uri:E.uri,range:{startColumn:P.column,startLineNumber:P.line,endLineNumber:P.line,endColumn:P.column+P.length}})}),b}}function vo(){monaco.languages.register({id:"vscSQL",extensions:[".sql"]});let f={onEnterRules:[{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,afterText:/^\s*\*\/$/,action:{indentAction:monaco.languages.IndentAction.IndentOutdent,appendText:" * "}},{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,action:{indentAction:monaco.languages.IndentAction.None,appendText:" * "}},{beforeText:/^(\t|(\ \ ))*\ \*(\ ([^\*]|\*(?!\/))*)?$/,action:{indentAction:monaco.languages.IndentAction.None,appendText:"* "}},{beforeText:/^(\t|(\ \ ))*\ \*\/\s*$/,action:{indentAction:monaco.languages.IndentAction.None,removeText:1}},{beforeText:/^(\t|(\ \ ))*\ \*[^/]*\*\/\s*$/,action:{indentAction:monaco.languages.IndentAction.None,removeText:1}}],comments:{lineComment:"--",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}]},e={defaultToken:"",tokenPostfix:".sql",ignoreCase:!0,brackets:[{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"}],escapes:/\\(?:[abfnrtv\\"'])/,keywords:["ABORT","ACTION","ADD","AFTER","ALL","ALTER","ANALYZE","AND","AS","ASC","ATTACH","AUTOINCREMENT","BEFORE","BEGIN","BETWEEN","BY","CASCADE","CASE","CAST","CHECK","COLLATE","COLUMN","COMMIT","CONFLICT","CONSTRAINT","CREATE","CROSS","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","DATABASE","DEFAULT","DEFERRABLE","DEFERRED","DELETE","DESC","DETACH","DISTINCT","DROP","EACH","ELSE","END","ESCAPE","EXCEPT","EXCLUSIVE","EXISTS","EXPLAIN","FAIL","FOR","FOREIGN","FROM","FULL","GLOB","GROUP","HAVING","IF","IGNORE","IMMEDIATE","IN","INDEX","INDEXED","INITIALLY","INNER","INSERT","INSTEAD","INTERSECT","INTO","IS","ISNULL","JOIN","KEY","LEFT","LIKE","LIMIT","MATCH","NATURAL","NO","NOT","NOTNULL","NULL","OF","OFFSET","ON","OR","ORDER","OUTER","PLAN","PRAGMA","PRIMARY","QUERY","RAISE","RECURSIVE","REFERENCES","REGEXP","REINDEX","RELEASE","RENAME","REPLACE","RESTRICT","RIGHT","ROLLBACK","ROW","SAVEPOINT","SELECT","SET","TABLE","TEMP","TEMPORARY","THEN","TO","TRANSACTION","TRIGGER","UNION","UNIQUE","UPDATE","USING","VACUUM","VALUES","VIEW","VIRTUAL","WHEN","WHERE","WITH","WITHOUT","ENGINE","CHARSET"],operators:["AND","BETWEEN","IN","LIKE","NOT","OR","IS","NULL","INTERSECT","UNION","INNER","JOIN","LEFT","OUTER","RIGHT"],builtinFunctions:["abs","changes","char","coalesce","count","glob","hex","ifnull","iif","instr","last_insert_rowid","length","like","likelihood","likely","lower","ltrim","max","min","nullif","quote","random","randomblob","replace","round","rtrim","sign","soundex","sqlite_version","substr","substring","total_changes","trim","typeof","unicode","unlikely","upper","zeroblob"],builtinVariables:[],pseudoColumns:[],tokenizer:{root:[{include:"@comments"},{include:"@whitespace"},{include:"@pseudoColumns"},{include:"@numbers"},{include:"@strings"},{include:"@complexIdentifiers"},{include:"@scopes"},[/[;,.]/,"delimiter"],[/[()]/,"@brackets"],[/[a-z_$äöü][\w$äöüßÄÖÜ]*(?=\()/,{cases:{"@builtinFunctions":"functions","@keywords":"keyword","@default":"identifier"}}],[/[\w@#$]+/,{cases:{"@keywords":"keyword","@operators":"operator","@builtinVariables":"predefined","@default":"identifier"}}],[/[<>=!%&+\-*/|~^]/,"operator"]],whitespace:[[/\s+/,"white"]],comments:[[/--+.*/,"comment"],[/\/\*/,{token:"comment.quote",next:"@comment"}]],comment:[[/[^*/]+/,"comment"],[/\*\//,{token:"comment.quote",next:"@pop"}],[/./,"comment"]],pseudoColumns:[[/[$][A-Za-z_][\w@#$]*/,{cases:{"@pseudoColumns":"predefined","@default":"identifier"}}]],numbers:[[/0[xX][0-9a-fA-F]*/,"number"],[/[$][+-]*\d*(\.\d*)?/,"number"],[/((\d+(\.\d*)?)|(\.\d+))([eE][\-+]?\d+)?/,"number"]],strings:[[/'/,{token:"string",next:"@string"}]],string:[[/[^\\']+/,"string"],[/\\./,"string.escape.invalid"],[/''/,"string"],[/'/,{token:"string",next:"@pop"}]],complexIdentifiers:[[/"/,{token:"identifier.quote",next:"@quotedIdentifier"}]],quotedIdentifier:[[/[^"]+/,"identifier"],[/""/,"identifier"],[/"/,{token:"identifier.quote",next:"@pop"}]],scopes:[]}};monaco.languages.setLanguageConfiguration("vscSQL",f),monaco.languages.setMonarchTokensProvider("vscSQL",e)}class tt{static openHelper(e,t,i){let r=y(".jo_arrow_box");r.removeClass(["jo_arrow_box_left","jo_arrow_box_right","jo_arrow_box_top","jo_arrow_box_bottom"]),r.addClass("jo_arrow_box_"+i),r.css({left:"",right:"",top:"",bottom:""});let o=t.offset(),u=y("body"),h=34;switch(i){case"bottom":r.css({left:o.left+t.width()/2-h,bottom:u.height()-o.top+h});break;case"top":r.css({left:o.left+t.width()/2-h,top:o.top+t.height()+26});break;case"left":r.css({left:o.left+t.width()+h,top:o.top+t.height()/2-h});break;case"right":r.css({right:u.width()-o.left,top:o.top+t.height()/2-h});break}r.find("span").html(e);let b=r.find(".jo_button");b.on("click",k=>{k.stopPropagation(),b.off("click"),tt.close()}),r.fadeIn(800)}static close(){y(".jo_arrow_box").fadeOut(800)}static showHelper(e,t,i){let r;if(t instanceof bi)r=t;else return;let o=r.user.settings.helperHistory,u=e+"Done";if(o!=null&&(o[u]==null||!o[u])){o[u]=!0,r.networkManager.sendUpdateUserSettings(()=>{});let h="",b="left";switch(e){case"newDatabaseHelper":h=`Es gibt noch keine Datenbank. <br> Nutzen Sie den Button
                        <span class='img_add-database-dark jo_inline-image'></span> um eine Datenbank anzulegen.
                        `,b="left";break;case"newSQLFileHelper":h=`Es gibt noch keine Datei mit SQL-Anweisungen. <br> Nutzen Sie den Button 
                            <span class='img_add-file-dark jo_inline-image'></span> um eine neue Datei anzulegen.
                            `,b="left";break;case"homeButtonHelper":h="Mit dem Home-Button <span class='img_home-dark jo_inline-image'></span> können Sie wieder zu Ihren eigenen Workspaces wechseln.",b="top",i=y(".img_home-dark");break;case"playButtonHelper":h=`Mit dem "Start-Button"
                        (<span class='img_start-dark jo_inline-image'></span>) 
                        oder der Tastenkombination &lt;Strg&gt;&nbsp;+&nbsp&lt;Enter&gt; 
                        wird die Anweisung ausgeführt, in der der Cursor gerade steht. 
                        <br> Wollen Sie mehrere Anweisungen hintereinander ausführen, so markieren 
                        Sie alle Anweisungen und klicken Sie dann auf <span class='img_start-dark jo_inline-image'></span>
                        oder drücken Sie  &lt;Strg&gt;&nbsp;+&nbsp&lt;Enter&gt;. `,b="top";break;case"consoleHelper":h=`
                        Hier können Sie Anweisungen oder Terme eingeben, die nach Bestätigung mit der Enter-Taste ausgeführt/ausgewertet werden. Das Ergebnis sehen Sie im Bereich über der Eingabezeile. <br>
                        Falls das Programm gerade pausiert (z.B. bei Ausführung in Einzelschritten) können Sie auch auf die Variablen des aktuellen Sichtbarkeitsbereiches zugreifen.
                    `,b="bottom"}h!=""&&i!=null&&i.length>0&&tt.openHelper(h,i,b)}}}class pr{constructor(e,t,i){w(this,"editor");w(this,"cw",null);w(this,"dontPushNextCursorMove",0);w(this,"lastTime",0);w(this,"elementDecoration",[]);this.main=e,this.showMinimap=t,this.isEmbedded=i}initGUI(e){vo(),monaco.editor.defineTheme("myCustomThemeDark",{base:"vs-dark",inherit:!0,rules:[{token:"functions",foreground:"dcdcaa",fontStyle:"italic"},{token:"string.sql",foreground:"3DC9B0"},{token:"number",foreground:"7bef3f"},{token:"type",foreground:"499cd6"},{token:"identifier",foreground:"effefe"},{token:"statement",foreground:"9cdcfe",fontStyle:"bold"},{token:"keyword",foreground:"619ceb",fontStyle:"bold"},{token:"table",foreground:"ff0000",fontStyle:"bold"},{token:"delimiter",foreground:"e8eb38"}],colors:{"editor.background":"#1e1e1e",jo_highlightStatementGreen:"#004000",jo_highlightStatementYellow:"#404000",jo_highlightStatementRed:"#402020"}}),monaco.editor.defineTheme("myCustomThemeLight",{base:"vs",inherit:!0,rules:[{token:"functions",foreground:"694E16",fontStyle:"italic bold"},{token:"string.sql",foreground:"a03030"},{token:"number",foreground:"404040"},{token:"type",foreground:"0000ff",fontStyle:"bold"},{token:"identifier",foreground:"8000e0"},{token:"statement",foreground:"001080",fontStyle:"bold"},{token:"keyword",foreground:"00a000",fontStyle:"bold"},{token:"comment",foreground:"808080",fontStyle:"italic"}],colors:{"editor.background":"#FFFFFF","editor.foreground":"#000000","editor.inactiveSelectionBackground":"#E5EBF1","editorIndentGuide.background":"#D3D3D3","editorIndentGuide.activeBackground":"#939393","editor.selectionHighlightBackground":"#ADD6FF80","editorSuggestWidget.background":"#F3F3F3","activityBarBadge.background":"#007ACC","sideBarTitle.foreground":"#6F6F6F","list.hoverBackground":"#E8E8E8","input.placeholderForeground":"#767676","searchEditor.textInputBorder":"#CECECE","settings.textInputBorder":"#CECECE","settings.numberInputBorder":"#CECECE","statusBarItem.remoteForeground":"#FFF","statusBarItem.remoteBackground":"#16825D",jo_highlightStatementGreen:"#004000",jo_highlightStatementYellow:"#404000",jo_highlightStatementRed:"#400000"}}),this.editor=monaco.editor.create(e[0],{language:"vscSQL",lightbulb:{enabled:!0},lineDecorationsWidth:0,peekWidgetDefaultFocus:"tree",fixedOverflowWidgets:!0,quickSuggestions:!0,quickSuggestionsDelay:10,fontSize:14,fontFamily:"Consolas, Roboto Mono",fontWeight:"500",roundedSelection:!0,selectOnLineNumbers:!1,automaticLayout:!0,scrollBeyondLastLine:!1,occurrencesHighlight:!1,autoIndent:"full",dragAndDrop:!0,formatOnType:!0,formatOnPaste:!0,suggestFontSize:16,suggestLineHeight:22,suggest:{localityBonus:!0,insertMode:"replace"},parameterHints:{enabled:!0,cycle:!0},mouseWheelZoom:this.isEmbedded,minimap:{enabled:this.showMinimap},scrollbar:{vertical:"auto",horizontal:"auto"},theme:"myCustomThemeDark"});let t=this,i=r=>{r.ctrlKey===!0&&(t.changeEditorFontSize(Math.sign(r.deltaY),!0),r.preventDefault())};return this.editor.onDidChangeConfiguration(r=>{r.hasChanged(monaco.editor.EditorOption.fontInfo)&&this.isEmbedded&&this.main.getBottomDiv().errorManager.registerLightbulbOnClickFunctions()}),this.editor.onDidChangeCursorPosition(r=>{t.onDidChangeCursorPosition(r.position)}),this.editor.onDidChangeModel(r=>{let o=e.find(".monaco-editor")[0];if(o.removeEventListener("wheel",i),o.addEventListener("wheel",i,{passive:!1}),this.main.getCurrentWorkspace()==null)return;let u=this.main.getCurrentWorkspace().getModuleByMonacoModel(this.editor.getModel());this.main instanceof bi&&u!=null&&this.main.projectExplorer.setActiveAfterExternalModelSet(u)}),monaco.languages.registerHoverProvider("vscSQL",new mi(this)),monaco.languages.registerCompletionItemProvider("vscSQL",new mo(this.main)),monaco.languages.registerCodeActionProvider("vscSQL",new bo(this.main)),monaco.languages.registerReferenceProvider("vscSQL",new wo(this.main)),monaco.languages.registerSignatureHelpProvider("vscSQL",new go(this.main)),this.editor.onMouseDown(r=>{const o=r.target.detail;r.target.type!==monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN&&r.target.type!==monaco.editor.MouseTargetType.GUTTER_LINE_NUMBERS||o.isAfterLines||t.onMarginMouseDown(r.target.position.lineNumber)}),setTimeout(()=>{monaco.editor.remeasureFonts()},2e3),this.addActions(),this.editor.onDidType(r=>{t.onDidType(r)}),this.editor}onDidType(e){const t=(i,r,o,u)=>{const h=new monaco.Range(i.lineNumber,i.column,i.lineNumber,i.column);this.editor.executeEdits("new-bullets",[{range:h,text:r}]),this.editor.setPosition({lineNumber:o,column:u})};if(e===`
`){const i=this.editor.getModel(),r=this.editor.getPosition(),o=i.getLineContent(r.lineNumber-1);if(o.trim().indexOf("/*")===0&&!o.trimRight().endsWith("*/")&&!(r.lineNumber<i.getLineCount()?i.getLineContent(r.lineNumber+1):"").trim().startsWith("*")){let h=o.substr(0,o.length-o.trimLeft().length);o.trim().indexOf("/**")===0?t(r,`
`+h+" */",r.lineNumber,r.column+3+h.length):t(r,` * 
`+h+" */",r.lineNumber,r.column+3+h.length)}}}setFontSize(e){let t=new Date().getTime();if(t-this.lastTime<150)return;this.lastTime=t;let i=this.editor.getOptions().get(monaco.editor.EditorOption.fontSize);if(this.main instanceof bi&&this.main.viewModeController.saveFontSize(e),e!=i){this.editor.updateOptions({fontSize:e});let o=this.editor.getOptions().get(monaco.editor.EditorOption.fontSize)/e;this.editor.updateOptions({fontSize:e/o})}y(".jo_editorFontSize").css("font-size",e+"px"),y(".jo_editorFontSize").css("line-height",e+2+"px"),document.documentElement.style.setProperty("--breakpoint-size",e+"px"),document.documentElement.style.setProperty("--breakpoint-radius",e/2+"px"),this.main.getBottomDiv().errorManager.registerLightbulbOnClickFunctions()}changeEditorFontSize(e,t=!0){let i=this.editor.getOptions().get(monaco.editor.EditorOption.fontSize);t&&(i<10?e*=1:i<20?e*=2:e*=4);let r=i+e;r>=6&&r<=80&&this.setFontSize(r)}addActions(){let e=this;this.editor.addAction({id:"Find bracket",label:"Finde korrespondierende Klammer",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_K],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(t){return t.getAction("editor.action.jumpToBracket").run(),null}}),this.editor.addAction({id:"Execute statement",label:"SQL-Anweisung ausführen",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1,run:function(t){return e.main.getActionManager().trigger("execute"),null}})}onMarginMouseDown(e){}onDidChangeCursorPosition(e){e==null&&(e=this.editor.getPosition());let t=this.getCurrentlyEditedModule();if(t==null){this.elementDecoration=this.editor.deltaDecorations(this.elementDecoration,[]);return}let i=t.getElementAtPosition(e.lineNumber,e.column),r=[];if(i!=null){let h=i.usagePositions.get(t);if(h!=null)for(let b of h)r.push({range:{startColumn:b.column,startLineNumber:b.line,endColumn:b.column+b.length,endLineNumber:b.line},options:{className:"jo_revealSyntaxElement",isWholeLine:!1,overviewRuler:{color:{id:"editorIndentGuide.background"},darkColor:{id:"editorIndentGuide.activeBackground"},position:monaco.editor.OverviewRulerLane.Left}}})}let o=!1;for(let u of t.getSQLSTatementsAtSelection(this.editor.getSelection())){let h="jo_highlightStatementGreen";u!=null&&(u.hasErrors?(h="jo_highlightStatementRed",u.acceptedBySQLite&&(h="jo_highlightStatementYellow",o=!0)):o=!0,r.push({range:{startColumn:u.from.column,startLineNumber:u.from.line,endColumn:u.to.column,endLineNumber:u.to.line},options:{className:h,isWholeLine:!1,overviewRuler:{color:{id:h},darkColor:{id:h},position:monaco.editor.OverviewRulerLane.Left},minimap:{color:{id:h},position:monaco.editor.MinimapPosition.Inline},zIndex:-100}}))}this.main.getActionManager().setActive("execute",o),o&&!this.main.isEmbedded()&&tt.showHelper("playButtonHelper",this.main,y("div.img_start-dark")),this.elementDecoration=this.editor.deltaDecorations(this.elementDecoration,r)}getCurrentlyEditedModule(){return this.main.getCurrentlyEditedModule()}}function di(f,e){var t=new f.Database(e);return t.create_function("isDate",function(i){if(i==null)return!0;if(typeof i!="string")return!1;var r=/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/;if(i.match(r)){var o=i.split("/"),u=i.split("-"),h=o.length,b=u.length;if(h>1)var k=i.split("/");else if(b>1)var k=i.split("-");if(k.length!=3)return!1;var E=parseInt(k[2]),P=parseInt(k[1]),L=parseInt(k[0]),H=[31,28,31,30,31,30,31,31,30,31,30,31];if((P==1||P>2)&&E>H[P-1])return!1;if(P==2){var z=!1;return(!(L%4)&&L%100||!(L%400))&&(z=!0),!(z==!1&&E>=29||z==!0&&E>29)}return!0}else return!1}),t.create_function("isDateTime",function(i){if(i==null)return!0;if(typeof i!="string")return!1;var r=/^\d{4}[\-](0[1-9]|1[012])[\-](0[1-9]|[12][0-9]|3[01]) ([01][0-9]|2[0123]):([0-5][0-9]):([0-5][0-9])$/;if(i.match(r)){var o=i.split(" "),u=o[0];if(u.length!=10)return!1;var h=parseInt(u.substring(8,10)),b=parseInt(u.substring(5,7)),k=parseInt(u.substring(0,4)),E=[31,28,31,30,31,30,31,31,30,31,30,31];if((b==1||b>2)&&h>E[b-1])return!1;if(b==2){var P=!1;return(!(k%4)&&k%100||!(k%400))&&(P=!0),!(P==!1&&h>=29||P==!0&&h>29)}return!0}else return!1}),t.create_function("isTime",function(i){if(i==null)return!0;if(typeof i!="string")return!1;var r=/^([01][0-9]|2[0123]):([0-5][0-9]):([0-5][0-9])$/;return i.match(r)!=null}),t.create_function("concat",function(){if(console.log("Hier!"),arguments==null)return"";let i="";for(let r=0;r<arguments.length;r++)i+=""+arguments[r];return i}),t}class yo{constructor(){w(this,"initsql",initSqlJs({locateFile:(e,t)=>"https://embed.learn-sql.de/include/lib/sql.js/sql-wasm.wasm"}));w(this,"db");w(this,"SQL");w(this,"onmessage");w(this,"onError")}postMessageToClient(e){this.onmessage({data:e})}postMessage(e){let t=this;t.db==null?t.initsql.then(i=>{t.SQL=i,t.db=di(i,void 0),t.worker(e)}).catch(i=>(console.log(i),t.postMessageToClient({id:this.data.id,error:i.message}))):t.worker(e)}terminate(){}worker(e){var t,i,r=e.config?e.config:{};try{switch(e&&e.action){case"open":return t=e.buffer,this.db=di(this.SQL,t&&new Uint8Array(t)),this.postMessageToClient({id:e.id,ready:!0});case"exec":if(this.db===null&&(this.db=di(this.SQL,void 0)),!e.sql)throw"exec: Missing query string";return this.postMessageToClient({id:e.id,results:this.db.exec(e.sql,e.params,r)});case"each":this.db===null&&(this.db=di(this.SQL,void 0));var o=function(b){return this.postMessage({id:e.id,row:b,finished:!1})},u=function(){return this.postMessage({id:e.id,finished:!0})};return this.db.each(e.sql,e.params,o,u,r);case"export":t=this.db.export(),i={id:e.id,results:[{buffer:t}]};try{return this.postMessageToClient(i)}catch{return this.postMessageToClient(i)}case"close":return this.db&&this.db.close(),this.postMessageToClient({id:e.id});default:throw new Error("Invalid action : "+(e&&e.action))}}catch(h){return this.postMessageToClient({id:e.id,error:h.message})}}}class Xe{constructor(e){w(this,"databaseDirectoryEntries",null);w(this,"worker");w(this,"queryId",0);w(this,"querySuccessCallbacksMap",new Map);w(this,"queryErrorCallbackMap",new Map);w(this,"databaseStructure");this.main=e}initializeWorker(e,t,i,r){this.main.getWaitOverlay().show("Bitte warten, die Datenbank wird initialisiert..."),this.worker!=null&&this.worker.terminate(),performance.now();let o="worker/sqljs-worker.js";this.main.isEmbedded()&&(o=window.javaOnlineDir+o),window.jo_doc?this.worker=new yo:this.worker=new Worker(o);let u=this,h=[];this.worker.onmessage=()=>{u.worker.onmessage=E=>{let P=E.data.id;if(E.data.error==null){let L=u.querySuccessCallbacksMap.get(P);L!=null&&L(E.data.results)}else{let L=u.queryErrorCallbackMap.get(P);L!=null&&L(E.data.error)}this.queryErrorCallbackMap.delete(P),this.querySuccessCallbacksMap.delete(P)},t==null&&(t=[]),t=t.slice(),t.unshift("PRAGMA foreign_keys = OFF;"),t.push("PRAGMA foreign_keys = ON;");let b=t.length,k=()=>{if(t.length>0){this.main.getWaitOverlay().setProgress(`${Math.round((1-t.length/b)*100)+" %"}`);let E=t.shift();u.executeQuery(E,P=>{k()},P=>{h.push("Error while setting up database: "+P+", query: "+E),console.log({error:"Error while setting up database: "+P,query:E}),console.log(),k()})}else i!=null&&i(h),u.retrieveDatabaseStructure(()=>{r&&r(),this.main.getWaitOverlay().hide()})};k()},this.worker.onerror=b=>{h.push("Worker error: "+b.error),console.log("Worker error: "+b.error)},this.worker.postMessage({id:u.queryId++,action:"open",buffer:e})}executeQuery(e,t,i){let r=this.queryId++;this.querySuccessCallbacksMap.set(r,t),this.queryErrorCallbackMap.set(r,i),this.worker.postMessage({id:r,action:"exec",sql:e,params:{}})}export(e,t){let i=this.queryId++;this.querySuccessCallbacksMap.set(i,r=>{e(r[0].buffer)}),this.queryErrorCallbackMap.set(i,t),this.worker.postMessage({id:i,action:"export",params:{}})}getDirectoryEntries(e){this.databaseDirectoryEntries!=null?e(this.databaseDirectoryEntries):y.getJSON("assets/databases/directory.json",function(t){e(t)})}retrieveDatabaseStructure(e){let t="SELECT name, sql FROM sqlite_master WHERE type='table';",i=this;this.executeQuery(t,r=>{var u,h;let o="";(h=(u=r[0])==null?void 0:u.values)==null||h.forEach(b=>o+=`PRAGMA table_info(${b[0]});
PRAGMA foreign_key_list(${b[0]});
select count(*) from ${b[0]};

`),o!=""?this.executeQuery(o,b=>{i.databaseStructure=i.parseDatabaseStructure(r,b),e(i.databaseStructure)},b=>{console.log(b)}):(i.databaseStructure={tables:[]},e(i.databaseStructure))},r=>{console.log(r)})}parseDatabaseStructure(e,t){this.databaseStructure={tables:[]};let i=new Map,r=0;for(let o=0;o<e[0].values.length;o++){let u=e[0].values[o][0],h=e[0].values[o][1],b={name:u,size:0,completeSQL:h,columns:[]};i.set(u,b),this.databaseStructure.tables.push(b);let k=t[r].values,E=null;t.length>r+1&&t[r+1].columns[0]=="id"&&(E=t[r+1].values,r++),r++;let P=t[r].values[0][0];r++,b.size=P,k.forEach(L=>{L[0];let H=L[1],z=L[2],A=L[3]==1,K=L[4],W=L[5]!=0,he={name:H,isPrimaryKey:W,isAutoIncrement:W&&h.toLowerCase().indexOf("autoincrement")>=0,completeTypeSQL:z,table:b,typeLengths:[],defaultValue:K,notNull:A};if(E!=null){let ve=E.find(me=>me[3].toLocaleLowerCase()==H.toLocaleLowerCase());ve!=null&&(he.referencesRawData=ve)}b.columns.push(he)})}for(let o of this.databaseStructure.tables)for(let u of o.columns)if(u.referencesRawData!=null){let h=i.get(u.referencesRawData[2]);if(h==null)continue;let b=h.columns.find(k=>k.name.toLocaleLowerCase()==u.referencesRawData[4].toLocaleLowerCase());u.references=b}return this.databaseStructure}static getDumpType(e){let t=[83,81,76,105,116,101],i=120,r=!0;for(let o=0;o<t.length;o++)if(t[o]!=e[o]){r=!1;break}return r?"binaryUncompressed":e[0]==i?"binaryCompressed":"other"}}class mr{constructor(){w(this,"MaxRowsPerInsert",300)}clean(e){switch(e.ast.type){case l.keywordCreate:return e.sqlCleaned=this.cleanCreateTableStatement(e.ast),e.sqlCleaned;case l.keywordInsert:return e.ast.select!=null?e.sql:(e.sqlCleaned=this.cleanInsertStatement(e.ast),e.sqlCleaned);default:return e.sql}}cleanInsertStatement(e){let t=`insert into ${e.table.identifier}`;e.columnList!=null&&e.columnList.length>0&&(t+=`(${e.columnList.map(o=>this.escapeIdentifier(o.identifier)).join(", ")})`),t+=`
values
`;let i="",r=[];if(e.values!=null&&e.values.length>0)for(let o of e.values)r.push(`
(${o.map(u=>this.cleanValue(u)).join(", ")})`);for(;r.length>0;)i+=t,i+=r.splice(0,Math.max(this.MaxRowsPerInsert,r.length)).join(`,
`),i+=`;
`;return i}cleanValue(e){if(e.constantType==l.stringConstant){let t=e.constant;return t=t.replace(/'/g,"''"),`'${t}'`}else return e.constant}cleanCreateTableStatement(e){let t=`create table ${e.ifNotExists?" if not exists":""} ${this.escapeIdentifier(e.identifier)}(
   `;t+=e.columnList.map(r=>this.cleanColumnDef(r)).join(`,
   `),e.foreignKeyInfoList!=null&&e.foreignKeyInfoList.length>0&&(t+=`,
   `+e.foreignKeyInfoList.map(r=>this.cleanForeignKeyInfo(r)).join(`,
   `));let i=e.combinedPrimaryKeyColumns.slice().map(r=>r.toLocaleLowerCase());for(let r of e.columnList){let o=r.identifier.toLocaleLowerCase();r.isAutoIncrement&&i.indexOf(o)>=0&&i.splice(i.indexOf(o),1)}return i.length>0&&(t+=`,
   primary key(${this.escapeIdentifiers(i).join(", ")})`),e.uniqueConstraints.length>0&&(t+=`,
   `+e.uniqueConstraints.map(r=>"unique("+this.escapeIdentifiers(r).join(", ")+")").join(`,
   `)),t+=`
);`,t}cleanForeignKeyInfo(e){let t=`foreign key (${this.escapeIdentifier(e.column)}) references ${this.escapeIdentifier(e.referencesTable)}(${this.escapeIdentifier(e.referencesColumn)})`;return e.onDelete&&(t+=" on delete "+e.onDelete),e.onUpdate&&(t+=" on update "+e.onUpdate),t}cleanColumnDef(e){let t=e.baseType.toString();t=="int"&&e.isAutoIncrement&&(t="integer");let i=`${this.escapeIdentifier(e.identifier)} ${t}`;if(e.parameters!=null&&e.parameters.length>0&&!e.isAutoIncrement&&(i+=`(${e.parameters.join(", ")})`),e.notNull&&(i+=" not null"),e.defaultValue!=null&&(i+=" default "+e.defaultValue),(e.isPrimary||e.isAutoIncrement)&&(i+=" primary key"),e.isAutoIncrement&&(i+=" autoincrement"),e.foreignKeyInfo!=null){let u=e.foreignKeyInfo,h=u.referencesColumn;u.referencesTable&&(h=this.escapeIdentifier(u.referencesTable)+"("+this.escapeIdentifier(h)+")"),i+=" references "+h}if(e.collate!=null){let u=e.collate.toLocaleLowerCase();["binary","nocase","rtrim"].indexOf(u)>=0&&(i+=" collate "+u)}let r=e.parameters?e.parameters:[0,0],o=e.baseType.checkFunction(this.escapeIdentifier(e.identifier),r);return o!=""&&(i+=" "+o),i}escapeIdentifier(e){return'"'+e+'"'}escapeIdentifiers(e){return e.map(this.escapeIdentifier)}}class gr{constructor(e){w(this,"createTableNodes");w(this,"insertNodes");w(this,"tableModifyingNodes");this.main=e}async loadFromUrl(e){if(e==null)return;let t=null;return e.endsWith(".zip")?t=await this.unzipURL(e):t=await(await fetch(e)).text(),this.importFromText(t)}async loadFromFile(e){if(e!=null)if(e.name.endsWith(".zip")){let t=await this.unzipFile(e);return this.importFromText(t)}else return new Promise((t,i)=>{var r=new FileReader;r.onload=o=>{let u=o.target.result;t(this.importFromText(u))},r.readAsText(e)})}async unzipURL(e){const t=new zip.ZipReader(new zip.HttpReader(e));return this.unzipIntern(t)}async unzipFile(e){const t=new zip.ZipReader(new zip.BlobReader(e));return this.unzipIntern(t)}async unzipIntern(e){let t=await e.getEntries();t=t.filter(r=>r.filename.endsWith(".sql"));let i="";if(t.length)for(let r of t)i+=await r.getData(new zip.TextWriter,{onprogress:(o,u)=>{}});return await e.close(),i}async importFromText(e){if(e==null)return null;let i=new Gi().lex(e),r=new Ut,o=new ze({dirty:!1,name:"",saved:!0,student_edited_after_revision:!1,submitted_date:null,text:e,text_before_revision:null,version:0},this.main);o.tokenList=i.tokens,r.parse(o),this.createTableNodes=o.sqlStatements.filter(u=>u.ast.type==l.keywordCreate).map(u=>u.ast),this.insertNodes=o.sqlStatements.filter(u=>u.ast.type==l.keywordInsert).map(u=>u.ast),this.tableModifyingNodes=o.sqlStatements.filter(u=>u.ast.type==l.keywordAlter&&u.ast.kind=="omittedKind").map(u=>u.ast);for(let u of this.tableModifyingNodes){let h=this.findCreateTableNode(u.tableIdentifier);if(h!=null){if(u.primaryKeys!=null&&(h.combinedPrimaryKeyColumns=u.primaryKeys,h.columnList.forEach(b=>b.isPrimary=!1)),u.autoIncrementColumn!=null){let b=this.findCreateTableColumnNode(h,u.autoIncrementColumn);b!=null&&(b.isPrimary=!0)}if(u.modifyColumnInfo!=null)for(let b of u.modifyColumnInfo){let k=this.findCreateTableColumnNode(h,b.identifier),E=h.columnList.indexOf(k);h.columnList.splice(E,1,b)}if(u.foreignKeys!=null)for(let b of u.foreignKeys)h.foreignKeyInfoList.push(b);if(u.indices!=null)for(let b of u.indices)o.sqlStatements.push({acceptedBySQLite:!0,from:null,to:null,hasErrors:!1,ast:{type:l.keywordIndex,columnIdentifier:b.column,indexIdentifier:b.index_name,tableIdentifier:u.tableIdentifier,unique:b.unique,position:null,endPosition:null,symbolTable:null},sql:`create ${b.unique?"unique ":""} index ${b.index_name} on ${u.tableIdentifier}(${b.column});`})}}return this.makeDatabase(o.sqlStatements)}findCreateTableNode(e){return e=e.toLocaleLowerCase(),this.createTableNodes.find(t=>t.identifier.toLocaleLowerCase()==e)}findCreateTableColumnNode(e,t){return t=t.toLocaleLowerCase(),e.columnList.find(i=>i.identifier.toLocaleLowerCase()==t)}async makeDatabase(e){let t=new mr,i=e.filter(u=>u.ast.type!=l.omittedeStatement).map(u=>t.clean(u));i.unshift("PRAGMA foreign_keys = OFF;"),i.push("PRAGMA foreign_keys = ON;");let r=new Xe(this.main);return new Promise((u,h)=>{r.initializeWorker(null,i,()=>{r.export(b=>{u({binDump:b})},b=>{h(b)})})})}}class gi{async loadFromFile(e,t){if(e!=null)if(t.getWaitOverlay().show("Lese Datei ein..."),e.name.endsWith(".sql")||e.name.endsWith(".zip")){let r=await new gr(t).loadFromFile(e);return t.getWaitOverlay().hide(),r}else{var i=new FileReader;return new Promise((r,o)=>{i.onload=u=>{let h=u.target.result,b=new Uint8Array(h);Xe.getDumpType(b)=="binaryCompressed"&&(b=pako.inflate(b)),t.getWaitOverlay().hide(),r({binDump:b})},i.readAsArrayBuffer(e)})}}saveToFile(e){e.export(t=>{let i=prompt("Bitte geben Sie den Dateinamen ein","datenbank.sqLite");if(i==null){alert("Der Dateiname ist leer, daher wird nichts gespeichert.");return}i.endsWith(".sqLite")||(i=i+".sqLite"),uo(new Blob([t.buffer]),i,!0)},()=>{})}}class Vi{constructor(e,t,i){w(this,"$dialog");w(this,"database");this.main=e,this.owner_id=t,this.path=i,this.init()}init(){this.$dialog=y("#dialog"),y("#main").css("visibility","hidden"),this.$dialog.append(y(`<div class="jo_ds_heading">Neue Datenbank anlegen</div>

            <div class="jo_ds_settings">
               <div class="jo_ds_settings_caption">Name der Datenbank:</div><div><input class="dialog-input jo_databasename" value="Neue Datenbank"></input></div>
            </div>

             <div class="jo_tabheadings jo_cdtabheading">
             <div class="jo_tabheading" data-target="jo_createEmptyDatabaseTab">Leere Datenbank</div>
             <div class="jo_tabheading jo_active" data-target="jo_createDatabaseFromTemplateTab">Von Vorlage kopieren</div>
             <div class="jo_tabheading" data-target="jo_createDatabaseUseExistingTab">Bestehende Datenbank mitnutzen</div>
             <div class="jo_tabheading" data-target="jo_createDatabaseUseDumpFile">Import aus Dumpfile (SQLite- oder MySQL-Format)</div>
             </div>
             <div class="jo_tabs" style="width: 100%; margin-top: 10px">
                 <div class="jo_createEmptyDatabaseTab">
                    <div class="jo_createDatabaseDescription">
                        Erstellt wird eine leere Datenbank.
                    </div>
                 </div>
                 <div class="jo_createDatabaseFromTemplateTab jo_active">
                    <div class="jo_ds_settings">
                       <div class="jo_ds_settings_caption">Vorlage suchen:</div><div><input class="dialog-input jo_templatename"></input></div>
                    </div>
                    <div class="jo_scrollable jo_templatelist"></div>
                 </div>
                <div class="jo_createDatabaseUseExistingTab">
                    <div class="jo_createDatabaseDescription">Wenn Du die Datenbank einer anderen Nutzerin/eines anderen Nutzers mitnutzen möchtest, brauchst Du einen Zugriffscode von ihr/ihm. Er ist unter Datenbank->Einstellungen zu finden.            
                    </div>
                    <div class="jo_ds_settings">
                       <div class="jo_ds_settings_caption">Zugriffscode:</div><div><input class="dialog-input jo_databasecodeinput"></input></div>
                    </div>
                 </div>
                <div class="jo_createDatabaseUseDumpFile">
                    <div class="jo_createDatabaseDescription">Wähle hier die Datei mit dem Datenbank-Dump aus (Endung .sqLite (SQLite-Datenbankdatei) oder .zip (gepackter MySql-Dump) oder .sql (MySql-Dump)):</div>
                    <input type="file" class="jo_dumpfile" name="dumpfile" style="padding: 10px"/>
                    <div class="jo_databaseimport_dropzone" style="width: 70vw; margin-left: 10px">Alternativ: Datei in dieses Feld ziehen</div>
                    <div class="jo_databaseimport_ok"></div>
                 </div>
             </div>

             <div class="dialog-buttonRow jo_ds_buttonRow">
                <button id="jo_ds_cancel_button">Abbrechen</button>
                <button id="jo_ds_create_database_button">Datenbank anlegen</button>
             </div>
            `)),Qt(this.$dialog);let e=y(".jo_templatelist");this.main.networkManager.fetchTemplateList(r=>{r.forEach(u=>{let h=y('<div class="jo_templateListEntry"></div>');h.append(y(`<div class="jo_tle_firstline">${u.name} <span class="jo_tle_ownername"> (von ${u.ownerName})</span></div>`)),h.append(y(`<div class="jo_tle_secondline">${u.description}</div>`)),h.data("templateId",u.id),h.data("name",u.name),e.append(h),u.$tle=h,h.on("pointerdown",()=>{e.find(".jo_templateListEntry").removeClass("jo_active"),h.addClass("jo_active")})});let o=y(".jo_templatename");o.on("input",()=>{let u=o.val();e.find(".jo_templateListEntry").hide(),r.forEach(h=>{(h.name+h.ownerName+(h.description?h.description:"")).indexOf(u)>=0&&h.$tle.show()})})});let t=y(".jo_databaseimport_dropzone");t.on("dragover",r=>{r.stopPropagation(),r.preventDefault(),r.originalEvent.dataTransfer.dropEffect="copy"}),t.on("drop",r=>{r.stopPropagation(),r.preventDefault();var o=r.originalEvent.dataTransfer.files;this.importFile(o)});let i=y(".jo_dumpfile");i.on("change",r=>{var o=r.originalEvent.target.files;this.importFile(o).then(()=>{i.val(null)})}),this.$dialog.css("visibility","visible"),y("#jo_ds_cancel_button").on("click",()=>{this.showMainWindow()}),y("#jo_ds_create_database_button").on("click",()=>{let r="emptyDatabase";y(".jo_createDatabaseFromTemplateTab").hasClass("jo_active")&&(r="fromTemplate"),y(".jo_createDatabaseUseExistingTab").hasClass("jo_active")&&(r="useExistingDatabase"),y(".jo_createDatabaseUseDumpFile").hasClass("jo_active")&&(r="useDumpFile");let o={id:null,isFolder:!1,name:y(".dialog-input.jo_databasename").val(),path:this.path.join("/")};switch(r){case"emptyDatabase":this.createWorkspace(o);break;case"fromTemplate":let u=y(".jo_templateListEntry.jo_active");if(u.length!=1){alert("Bitte wählen Sie genau eine Vorlage aus.");return}else o.template_database_id=u.data("templateId"),o.name=="Neue Datenbank"&&(o.name=u.data("name")),this.createWorkspace(o);break;case"useExistingDatabase":let h=y(".jo_databasecodeinput").val(),b=h.indexOf("T");if(b==-1){alert("Der Zugriffscode muss das Zeichen T enthalten.");return}o.otherDatabaseId=Number.parseInt(h.substring(0,b)),o.secret=h.substring(b+1),this.createWorkspace(o);break;case"useDumpFile":if(this.database!=null)new Ji().uploadCurrentDatabase(-1,this.main,this.database.binDump,"uploadBaseTemplateForWorkspace",k=>{o.template_id=k.newTemplateId,this.createWorkspace(o)});else{alert("Bitte laden Sie zuerst den Binärdump einer Datenbank hoch.");return}break}})}createWorkspace(e){this.main.networkManager.sendCreateWorkspace(e,this.owner_id,t=>{if(t!=null){alert(t);return}let i=this.main.createNewWorkspace(e.name,this.owner_id);i.path=e.path,i.id=e.id,i.sql_history="";let r=this.main.projectExplorer;this.main.workspaceList.push(i);let o={name:e.name,externalElement:i,iconClass:"workspace",isFolder:!1,path:this.path};r.workspaceListPanel.addElement(o,!0),i.renderSettingsButton(o),r.workspaceListPanel.sortElements(),r.fileListPanel.sortElements(),r.setWorkspaceActive(i),this.showMainWindow()})}async importFile(e){let t=this,r=await new gi().loadFromFile(e[0],this.main),o=!1;if(Xe.getDumpType(r.binDump)=="binaryCompressed"){let h=pako.inflate(r.binDump);Xe.getDumpType(h)=="binaryUncompressed"&&(o=!0)}else Xe.getDumpType(r.binDump)=="binaryUncompressed"&&(r.binDump=pako.deflate(r.binDump),o=!0);o?(t.database=r,y(".jo_databaseimport_ok").html("Die Datenbankdatei wurde erfolgreich von Datei eingelesen. Sie können die Datenbank jetzt durch Klick auf den Button unten erstellen.")):alert("In der Datei befindet sich kein Binärdump einer Datenbank.")}showMainWindow(){y("#main").css("visibility","visible"),this.$dialog.css("visibility","hidden"),this.$dialog.empty()}}class ko{constructor(e){w(this,"currentSubmenu",{});w(this,"openSubmenusOnMousemove",!1);this.main=e}initGUI(e){let t=this,i=this.main.getMonacoEditor(),r={items:[{identifier:"Datei",subMenu:{items:[{identifier:"Speichern und Beenden",action:()=>{y("#buttonLogout").trigger("click")}}]}},{identifier:"Bearbeiten",subMenu:{items:[{identifier:"Rückgängig (Strg + z)",action:()=>{i.trigger(".","undo",{})}},{identifier:"Wiederholen (Strg + y)",action:()=>{i.trigger(".","redo",{})}},{identifier:"-"},{identifier:"Kopieren (Strg + c)",action:()=>{i.getAction("editor.action.clipboardCopyAction").run()}},{identifier:"Ausschneiden (Strg + x)",action:()=>{i.getAction("editor.action.clipboardCutAction").run()}},{identifier:"Nach oben kopieren (Alt + Shift + Pfeil rauf)",action:()=>{i.getAction("editor.action.copyLinesUpAction").run()}},{identifier:"Nach unten kopieren (Alt + Shift + Pfeil runter)",action:()=>{i.getAction("editor.action.copyLinesDownAction").run()}},{identifier:"Nach oben verschieben (Alt + Pfeil rauf)",action:()=>{i.getAction("editor.action.moveLinesUpAction").run()}},{identifier:"Nach unten verschieben (Alt + Pfeil runter)",action:()=>{i.getAction("editor.action.moveLinesDownAction").run()}},{identifier:"-"},{identifier:"Suchen... (Strg + f)",action:()=>{i.getAction("actions.find").run()}},{identifier:"Ersetzen... (Strg + h)",action:()=>{i.getAction("editor.action.startFindReplaceAction").run()}},{identifier:"-"},{identifier:"Aus-/Einkommentieren (Strg + #)",action:()=>{i.getAction("editor.action.commentLine").run()}},{identifier:"Dokument formatieren (Alt + Shift + f)",action:()=>{i.getAction("editor.action.formatDocument").run()}},{identifier:"-"},{identifier:"Finde zugehörige Klammer (Strg + k)",action:()=>{i.getAction("editor.action.jumpToBracket").run()}},{identifier:"-"},{identifier:"Alles zusammenfalten",action:()=>{i.getAction("editor.foldAll").run()}},{identifier:"Alles auffalten",action:()=>{i.getAction("editor.unfoldAll").run()}},{identifier:"-"},{identifier:"Vorschlag auslösen (Strg + Leertaste)",action:()=>{i.focus(),setTimeout(()=>{i.getAction("editor.action.triggerSuggest").run()},200)}},{identifier:"Parameterhilfe (Strg + Shift + Leertaste)",action:()=>{i.getAction("editor.action.triggerParameterHints").run()}},{identifier:"Gehe zur Definition (Strg + Click)",action:()=>{i.focus(),setTimeout(()=>{i.getAction("editor.action.revealDefinition").run()},200)}}]}},{identifier:"Ansicht",subMenu:{items:[{identifier:"Theme",subMenu:{items:[{identifier:"Dark",action:()=>{t.switchTheme("dark")}},{identifier:"Light",action:()=>{t.switchTheme("light")}}]}},{identifier:"-"},{identifier:"Hoher Kontrast im Editor ein/aus",action:()=>{i.getAction("editor.action.toggleHighContrast").run()}},{identifier:"-"},{identifier:"Zoom out (Strg + Mausrad)",action:()=>{this.main.editor.changeEditorFontSize(-4)}},{identifier:"Zoom normal",action:()=>{this.main.editor.setFontSize(14)}},{identifier:"Zoom in (Strg + Mausrad)",action:()=>{this.main.editor.changeEditorFontSize(4)}}]}},{identifier:"Datenbank",subMenu:{items:[{identifier:"Neue Datenbank anlegen...",action:()=>{let o=t.main.user.id;t.main.workspacesOwnerId!=null&&(o=t.main.workspacesOwnerId),new Vi(t.main,o,[])}},{identifier:"Einstellungen...",action:()=>{new fr(this.main,this.main.currentWorkspace)}},{identifier:"Export als Binärdump (.sqLite-File)...",action:()=>{new gi().saveToFile(this.main.getDatabaseTool())}}]}}]};e!=null&&e.is_admin&&r.items[0].subMenu.items.push({identifier:"Shutdown server...",action:()=>{confirm("Server wirklich herunterfahren?")&&ue("shutdown",{},()=>{alert("Server erfolgreich heruntergefahren.")},o=>{alert(o)})}}),y("#mainmenu").empty(),this.initMenu(r,0)}switchTheme(e){this.main.viewModeController.setTheme(e)}initMenu(e,t){e.level=t,t==0?e.$element=y("#mainmenu"):(e.$element=y('<div class="jo_submenu"></div>'),y("body").append(e.$element)),e.$element.data("model",e);for(let r of e.items){if(r.identifier=="-")r.$element=y('<div class="jo_menuitemdivider"></div>');else{if(r.$element=y("<div>"+r.identifier+"</div>"),r.link!=null){let o=y('<a href="'+r.link+'" target="_blank" class="jo_menulink"></a>');o.on("mousedown",u=>{u.stopPropagation(),setTimeout(()=>{e.$element.hide()},500)}),o.append(r.$element),r.$element=o}r.subMenu!=null&&this.initMenu(r.subMenu,t+1),this.initMenuitemCallbacks(e,r),t==0&&r.$element.addClass("jo_mainmenuitem")}e.$element.append(r.$element),r.$element.data("model",r)}let i=this;y(document).on("mousedown",()=>{for(let r=0;r<5;r++)i.currentSubmenu[r]!=null&&(i.currentSubmenu[r].hide(),i.currentSubmenu[r]=null);i.openSubmenusOnMousemove=!1})}initMenuitemCallbacks(e,t){let i=this;t.action!=null&&t.$element.on("mousedown",r=>{t.action(t.identifier)}),t.subMenu!=null?(t.$element.on("mousedown",r=>{i.opensubmenu(t),i.openSubmenusOnMousemove=!0,r.stopPropagation()}),t.$element.on("mousemove.mainmenu",()=>{i.openSubmenusOnMousemove?i.opensubmenu(t):i.currentSubmenu[e.level+1]!=null&&(i.currentSubmenu[e.level+1].hide(),i.currentSubmenu[e.level+1]=null)})):t.$element.on("mousemove.mainmenu",()=>{i.currentSubmenu[e.level+1]!=null&&(i.currentSubmenu[e.level+1].hide(),i.currentSubmenu[e.level+1]=null)})}opensubmenu(e){let t=e.subMenu,i,r;t.level==1?(i=e.$element.position().left,r=30):(i=e.$element.offset().left+e.$element.width(),r=e.$element.offset().top),t.$element.css({top:""+r+"px",left:""+i+"px"}),this.currentSubmenu[t.level]!=null&&this.currentSubmenu[t.level].hide(),t.$element.show(),this.currentSubmenu[t.level]=t.$element}}const ke=class{constructor(e,t,i,r,o,u,h,b,k,E,P){w(this,"elements",[]);w(this,"$captionElement");w(this,"$buttonNew");w(this,"$listElement");w(this,"fixed");w(this,"dontSortElements",!1);w(this,"newFilesElementCallback");w(this,"newDatabaseElementCallback");w(this,"newFolderCallback");w(this,"renameCallback");w(this,"deleteCallback");w(this,"selectCallback");w(this,"addElementActionCallback");w(this,"contextMenuProvider");w(this,"moveCallback");w(this,"dropElementCallback");w(this,"$newFolderAction");this.accordion=e,this.caption=t,this.flexWeight=i,this.newButtonClass=r,this.buttonNewTitle=o,this.defaultIconClass=u,this.withDeleteButton=h,this.withFolders=b,this.kind=k,this.enableDrag=E,this.acceptDropKinds=P,e.addPanel(this);let L=window.PointerEvent?"pointer":"mouse";if(b){let H=this;this.$newFolderAction=y('<div class="img_add-folder-dark jo_button jo_active" style="margin-right: 4px" title="Neuen Ordner auf oberster Ebene anlegen">'),this.$newFolderAction.on(L+"down",A=>{A.stopPropagation(),A.preventDefault();let K=[];this.addFolder("Neuer Ordner",K,W=>{this.newFolderCallback(W,()=>{this.sortElements(),W.$htmlFirstLine[0].scrollIntoView(),Zn(W.$htmlFirstLine.find(".jo_filename"),"background-color",[0,255,0],2e3)})})}),this.addAction(this.$newFolderAction);let z=y('<div class="img_collapse-all-dark jo_button jo_active" style="margin-right: 4px" title="Alle Ordner zusammenfalten">');z.on(L+"down",A=>{A.stopPropagation(),A.preventDefault(),H.collapseAll()}),this.addAction(z)}}collapseAll(){for(let e of this.elements)e.isFolder&&e.$htmlFirstLine.hasClass("jo_expanded")&&(e.$htmlFirstLine.removeClass("jo_expanded"),e.$htmlFirstLine.addClass("jo_collapsed")),e.path.length>0&&e.$htmlFirstLine.slideUp(200)}remove(){this.$captionElement.remove(),this.$listElement.remove()}setFixed(e){this.fixed=e,this.fixed?(this.grow(),this.$captionElement.addClass("jo_fixed")):this.$captionElement.removeClass("jo_fixed")}enableNewButton(e){this.$buttonNew!=null&&(e?this.$buttonNew.show():this.$buttonNew.hide())}getCurrentlySelectedPath(){let e=[],t=this.getSelectedElement();return t!=null&&(e=t.path.slice(0),t.isFolder&&e.push(t.name)),e}compareWithPath(e,t,i,r,o,u){t=t.slice(),t.push(e),e="",o=o.slice(),o.push(r),r="";let h=0;for(;h<t.length&&h<o.length;){let b=t[h].localeCompare(o[h]);if(b!=0)return b;h++}return t.length<o.length?-1:t.length>o.length?1:e.localeCompare(r)}getElementIndex(e,t,i){for(let r=0;r<this.elements.length;r++){let o=this.elements[r];if(this.compareWithPath(e,t,i,o.name,o.path,o.isFolder)<0)return r}return this.elements.length}insertElement(e){let t=this.getElementIndex(e.name,e.path,e.isFolder);this.elements.splice(t,0,e);let i=this.$listElement.find(".jo_file");if(t==0)this.$listElement.prepend(e.$htmlFirstLine);else if(t==i.length)this.$listElement.append(e.$htmlFirstLine);else{let r=i.get(t);y(r).before(e.$htmlFirstLine)}}addFolder(e,t,i){let r={name:e,isFolder:!0,path:t},o=this.renderElement(r,!0);this.insertElement(r),o[0].scrollIntoView(),this.renameElement(r,()=>{i(r)})}renderOuterHtmlElements(e){let t=this;if(this.$captionElement=y(`<div class="jo_leftpanelcaption jo_expanded">
        <div class="jo_captiontext">`+this.caption+'</div><div class="jo_actions"></div></div>'),this.newButtonClass!=null){this.$buttonNew=y('<div class="jo_button jo_active '+this.newButtonClass+'" title="'+this.buttonNewTitle+'">'),this.$captionElement.find(".jo_actions").append(this.$buttonNew);let h=window.PointerEvent?"pointer":"mouse";this.$buttonNew.on(h+"down",b=>{tt.close(),b.stopPropagation();let k=t.getCurrentlySelectedPath(),E={name:"Neu",isFolder:!1,path:k},P=this.getElementIndex("",k,!1);this.elements.splice(P,0,E);let L=this.renderElement(E,!0);if(P==0)this.$listElement.prepend(L);else{let H=this.$listElement.find(".jo_file").get(P-1);y(H).after(L)}L[0].scrollIntoView(),t.renameElement(E,()=>{t.newFilesElementCallback(E,H=>{E.externalElement=H,E.$htmlSecondLine!=null&&E.$htmlSecondLine.insertAfter(L),t.selectCallback!=null&&t.select(E.externalElement)})})})}let i=y('<div id="filelistouter" class="jo_projectexplorerdiv jo_scrollable" data-grow="'+this.flexWeight+'" style="flex-grow: '+this.flexWeight+'"></div>');this.$listElement=y('<div class="jo_filelist"></div>'),i.append(this.$listElement),e.append(this.$captionElement),e.append(i);let r=this.$captionElement,o=this.$listElement.parent(),u=window.PointerEvent?"pointer":"mouse";r.on(u+"down",h=>{if(h.button==0&&!this.fixed){let b=o.data("grow");r.hasClass("jo_expanded")?t.accordion.parts.length>1&&o.animate({"flex-grow":.001},1e3,()=>{r.toggleClass("jo_expanded")}):(r.toggleClass("jo_expanded"),o.animate({"flex-grow":b},1e3))}}),r.on("dragover",h=>{ke.currentlyDraggedElementKind==t.kind&&(r.addClass("jo_file_dragover"),h.preventDefault())}),r.on("dragleave",h=>{r.removeClass("jo_file_dragover")}),r.on("drop",h=>{if(ke.currentlyDraggedElementKind==t.kind){h.preventDefault(),r.removeClass("jo_file_dragover");let b=ke.currentlyDraggedElement;b!=null&&t.moveElement(b,null)}})}grow(){let e=this.$listElement.parent(),t=e.data("grow");e.css("flex-grow",t),this.$captionElement.addClass("jo_expanded")}addElement(e,t){e.$htmlFirstLine=this.renderElement(e,t),this.insertElement(e)}sortElements(){this.dontSortElements||(this.elements.sort((e,t)=>{let i=e.sortName?e.sortName:e.name,r=t.sortName?t.sortName:t.name;return this.compareWithPath(i,e.path,e.isFolder,r,t.path,t.isFolder)}),this.elements.forEach(e=>{this.$listElement.append(e.$htmlFirstLine)}))}setTextAfterFilename(e,t,i){if(e==null)return;let r=e.$htmlFirstLine.find(".jo_textAfterName");r.addClass(i),r.html(t)}addAction(e){this.$captionElement.find(".jo_actions").prepend(e)}renderElement(e,t){let i=window.PointerEvent?"pointer":"mouse",r=this,o="";e.iconClass==null&&(e.iconClass=this.defaultIconClass),e.isFolder&&(e.iconClass="folder",o=t?" jo_expanded":" jo_collapsed");let u="";e.path==null&&(e.path=[]);for(let k=0;k<e.path.length;k++)u+='<div class="jo_folderline"></div>';if(e.$htmlFirstLine=y(`<div class="jo_file jo_${e.iconClass} ${o}">
        <div class="jo_folderlines">${u}</div>
           <div class="jo_fileimage"></div>
           <div class="jo_filename">${Vt(e.name)}</div>
           <div class="jo_textAfterName"></div>
           <div class="jo_additionalButtonSettings"></div>
           ${this.withDeleteButton?'<div class="jo_delete img_delete jo_button jo_active"></div>':""}
           ${pi?"":'<div class="jo_settings_button img_ellipsis-dark jo_button jo_active"></div>'}
           </div>`),!t&&e.path.length>0&&e.$htmlFirstLine.hide(),this.addElementActionCallback!=null){let k=this.addElementActionCallback(e);e.$htmlFirstLine.append(k)}if(this.withFolders&&e.isFolder&&(e.$htmlFirstLine.on("dragover",k=>{ke.currentlyDraggedElementKind==r.kind&&(e.$htmlFirstLine.addClass("jo_file_dragover"),k.preventDefault())}),e.$htmlFirstLine.on("dragleave",k=>{e.$htmlFirstLine.removeClass("jo_file_dragover")}),e.$htmlFirstLine.on("drop",k=>{if(ke.currentlyDraggedElementKind==r.kind){k.preventDefault(),e.$htmlFirstLine.removeClass("jo_file_dragover");let E=ke.currentlyDraggedElement;ke.currentlyDraggedElement=null,E!=null&&r.moveElement(E,e)}})),this.withFolders||this.enableDrag){let k=e.$htmlFirstLine.find(".jo_filename");k.attr("draggable","true"),k.on("dragstart",E=>{ke.currentlyDraggedElement=e,ke.currentlyDraggedElementKind=r.kind,E.originalEvent.dataTransfer.effectAllowed=e.isFolder?"move":"copyMove"})}this.acceptDropKinds!=null&&this.acceptDropKinds.length>0&&(e.isFolder||(e.$htmlFirstLine.on("dragover",k=>{this.acceptDropKinds.indexOf(ke.currentlyDraggedElementKind)>=0&&(e.$htmlFirstLine.addClass("jo_file_dragover"),k.ctrlKey?k.originalEvent.dataTransfer.dropEffect="copy":k.originalEvent.dataTransfer.dropEffect="move",k.preventDefault())}),e.$htmlFirstLine.on("dragleave",k=>{e.$htmlFirstLine.removeClass("jo_file_dragover")}),e.$htmlFirstLine.on("drop",k=>{if(this.acceptDropKinds.indexOf(ke.currentlyDraggedElementKind)>=0){k.preventDefault(),e.$htmlFirstLine.removeClass("jo_file_dragover");let E=ke.currentlyDraggedElement;ke.currentlyDraggedElement=null,E!=null&&r.dropElementCallback!=null&&r.dropElementCallback(e,E,k.ctrlKey?"copy":"move")}}))),e.$htmlFirstLine.on(i+"up",k=>{if(k.button==0&&r.selectCallback!=null){r.selectCallback(e.externalElement);for(let E of r.elements)E!=e&&E.$htmlFirstLine.hasClass("jo_active")&&E.$htmlFirstLine.removeClass("jo_active");if(e.$htmlFirstLine.addClass("jo_active"),e.isFolder){e.$htmlFirstLine.hasClass("jo_expanded")?(e.$htmlFirstLine.removeClass("jo_expanded"),e.$htmlFirstLine.addClass("jo_collapsed")):(e.$htmlFirstLine.addClass("jo_expanded"),e.$htmlFirstLine.removeClass("jo_collapsed"));let E={};for(let P of this.elements)if(P.isFolder){let L=P.path.join("/");L!=""&&(L+="/"),L+=P.name,E[L]=P.$htmlFirstLine.hasClass("jo_collapsed"),E[P.path.join("/")]&&(E[L]=!0)}E[""]=!1;for(let P of this.elements)E[P.path.join("/")]?P.$htmlFirstLine.slideUp(200):P.$htmlFirstLine.slideDown(200)}}});let h=function(k){let E=[];if(r.renameCallback!=null&&E.push({caption:"Umbenennen",callback:()=>{r.renameElement(e)}}),e.isFolder&&(E=E.concat([{caption:"Neuen Unterordner anlegen (unterhalb '"+e.name+"')...",callback:()=>{r.select(e.externalElement);let P=r.getCurrentlySelectedPath();r.addFolder("Neuer Ordner",P,L=>{r.newFolderCallback(L,()=>{r.sortElements(),L.$htmlFirstLine[0].scrollIntoView(),Zn(L.$htmlFirstLine.find(".jo_filename"),"background-color",[0,255,0],2e3)})})}},{caption:"Neue Datenbank...",callback:()=>{r.select(e.externalElement),r.newDatabaseElementCallback(e.path.concat(e.name))}}])),r.contextMenuProvider!=null&&!e.isFolder)for(let P of r.contextMenuProvider(e))E.push({caption:P.caption,callback:()=>{P.callback(e)},color:P.color,subMenu:P.subMenu==null?null:P.subMenu.map(L=>({caption:L.caption,callback:()=>{L.callback(e)},color:L.color}))});E.length>0&&(k.preventDefault(),k.stopPropagation(),et(E,k.pageX,k.pageY))};e.$htmlFirstLine[0].addEventListener("contextmenu",h,!1);let b;return pi||e.$htmlFirstLine.on("pointerup",()=>(clearTimeout(b),!1)).on("pointerdown",k=>(b=window.setTimeout(()=>{h(k)},500),!1)),pi||(e.$htmlFirstLine.find(".jo_settings_button").on("pointerdown",k=>{h(k)}),e.$htmlFirstLine.find(".jo_settings_button").on("mousedown click",k=>{k.preventDefault(),k.stopPropagation()})),r.withDeleteButton&&(e.$htmlFirstLine.find(".jo_delete")[0].addEventListener("contextmenu",k=>{k.preventDefault(),k.stopPropagation()},!1),e.$htmlFirstLine.find(".jo_delete").on(i+"up",k=>{k.preventDefault(),et([{caption:"Abbrechen",callback:()=>{}},{caption:"Ich bin mir sicher: löschen!",color:"#ff6060",callback:()=>{if(e.isFolder&&r.getChildElements(e).length>0){alert("Dieser Ordner kann nicht gelöscht werden, da er nicht leer ist.");return}r.deleteCallback(e.externalElement,()=>{e.$htmlFirstLine.remove(),e.$htmlSecondLine!=null&&e.$htmlSecondLine.remove(),r.elements.splice(r.elements.indexOf(e),1),r.selectCallback!=null&&(r.elements.length>0?r.select(r.elements[0].externalElement):r.select(null))})}}],k.pageX+2,k.pageY+2),k.stopPropagation()})),e.$htmlFirstLine}moveElement(e,t){let i=t==null?[]:t.path.slice(0).concat([t.name]);if(e.isFolder){let r=[e],o=e.path.concat([e.name]).join("/");if(i.join("/").indexOf(o)==0)return;let u=e.path.length;e.path=i.slice(0);for(let h of this.elements)h.path.join("/").startsWith(o)&&(h.path.splice(0,u),h.path=i.concat(h.path),r.push(h));for(let h of r)h.$htmlFirstLine.remove(),this.elements.splice(this.elements.indexOf(h),1);for(let h of r)this.renderElement(h,!0),this.insertElement(h);this.moveCallback(r)}else e.path=i,e.$htmlFirstLine.remove(),this.elements.splice(this.elements.indexOf(e),1),this.renderElement(e,!0),this.insertElement(e),this.select(e.externalElement),e.$htmlFirstLine[0].scrollIntoView(),this.moveCallback(e)}getChildElements(e){let t=e.path.slice(0).concat(e.name).join("/");return this.elements.filter(i=>i.path.join("/").startsWith(t))}renameElement(e,t){let i=this,r=e.$htmlFirstLine.find(".jo_filename"),o=e.name.indexOf("."),u=o==null?null:{start:0,end:o};this.dontSortElements=!0,cr(r,r,h=>{e.externalElement!=null&&(h=i.renameCallback(e.externalElement,h)),e.name=h,r.html(e.name),t!=null&&t(),i.sortElements(),r[0].scrollIntoView(),this.dontSortElements=!1},u)}select(e,t=!0,i=!1){if(e==null)for(let r of this.elements)r.$htmlFirstLine.hasClass("jo_active")&&r.$htmlFirstLine.removeClass("jo_active");else{let r=this.findElement(e);if(r!=null){for(let o of this.elements)o.$htmlFirstLine.hasClass("jo_active")&&o.$htmlFirstLine.removeClass("jo_active");if(r.$htmlFirstLine.addClass("jo_active"),i){let o=r.path.join("/");for(let u of this.elements){let h=u.path.slice(0);o.startsWith(h.join("/"))&&(u.isFolder&&(h.push(u.name),o.startsWith(h.join("/"))&&(u.$htmlFirstLine.removeClass("jo_collapsed"),u.$htmlFirstLine.addClass("jo_expanded"))),u.$htmlFirstLine.show())}r.$htmlFirstLine[0].scrollIntoView()}}}t&&this.selectCallback!=null&&this.selectCallback(e)}getPathString(e){let t=e.path.join("/");return e.isFolder&&(t!=""&&(t+="/"),t+=e.name),t}setElementClass(e,t){var i;e!=null&&((i=e.$htmlFirstLine)==null||i.removeClass("jo_"+e.iconClass).addClass("jo_"+t),e.iconClass=t)}findElement(e){for(let t of this.elements)if(t.externalElement==e)return t;return null}removeElement(e){for(let t of this.elements)if(t.externalElement==e){t.$htmlFirstLine.remove(),t.$htmlSecondLine!=null&&t.$htmlSecondLine.remove(),this.elements.splice(this.elements.indexOf(t),1),this.selectCallback!=null&&(this.elements.length>0?this.select(this.elements[0].externalElement):this.select(null));return}}clear(){this.$listElement.empty(),this.elements=[]}setCaption(e){this.$captionElement.find(".jo_captiontext").html(e)}getSelectedElement(){for(let e of this.elements)if(e.$htmlFirstLine.hasClass("jo_active"))return e;return null}};let Ze=ke;w(Ze,"currentlyDraggedElement"),w(Ze,"currentlyDraggedElementKind");class xo{constructor(e,t){w(this,"parts",[]);w(this,"$html");this.main=e,this.$html=t,t.addClass("jo_leftpanelinner")}addPanel(e){e.renderOuterHtmlElements(this.$html),this.parts.push(e)}}class Co{constructor(e,t,i){w(this,"$dialog");w(this,"$dialogMain");w(this,"studentCount",0);this.classes=e,this.workspace=t,this.main=i,this.init()}init(){this.$dialog=y("#dialog"),y("#main").css("visibility","hidden"),this.$dialog.append(y(`<div class="jo_ds_heading">Austeilen eines Workspace an einzelne Schüler/innen</div>
             <div class="jo_ds_settings">
                <div class="jo_ds_settings_caption">Workspace:</div><div class="jo_ds_workspacename">${this.workspace.name}</div>
                <div class="jo_ds_settings_caption">Liste filtern:</div><div class="jo_ds_filterdiv"><input class="dialog-input"></input></div>
             </div>
             <div class="jo_ds_student_list jo_scrollable">
             </div>
             <div class="jo_ds_selected_message"></div>
             <div class="dialog-buttonRow jo_ds_buttonRow">
                <button id="jo_ds_cancel_button">Abbrechen</button>
                <button id="jo_ds_distribute_button">Austeilen</button>
             </div>
            `));let e=y(".jo_ds_student_list"),t=this;for(let i of this.classes)for(let r of i.students){let o=y('<div class="jo_ds_student_line">'),u=y(`<div class="jo_ds_student_class">${i.name}</div>`),h=y(`<div class="jo_ds_student_name">${r.rufname} ${r.familienname}</div>`);o.append(u,h),e.append(o),o.on("mousedown",()=>{o.toggleClass("jo_active"),t.studentCount+=o.hasClass("jo_active")?1:-1,y(".jo_ds_selected_message").text(`${t.studentCount} Schüler/inn/en selektiert`)}),o.data("student",r),o.data("klass",i)}y(".jo_ds_filterdiv>input").on("input",()=>{let i=y(".jo_ds_filterdiv>input").val();i==null||i==""?$(".jo_ds_student_line").show():$(".jo_ds_student_line").each((r,o)=>{let u=y(o),h=u.data("klass"),b=u.data("student");(h.name+" "+b.rufname+" "+b.familienname).indexOf(i)>=0?u.show():u.hide()})}),this.$dialogMain=this.$dialog.find(".dialog-main"),this.$dialog.css("visibility","visible"),y("#jo_ds_cancel_button").on("click",()=>{t.close()}),y("#jo_ds_distribute_button").on("click",()=>{t.distributeWorkspace()})}distributeWorkspace(){let e=[];$(".jo_ds_student_line").each((t,i)=>{let r=y(i);if(r.hasClass("jo_active")){let o=r.data("student");e.push(o.id)}}),this.close(),this.main.networkManager.sendDistributeWorkspace(this.workspace,null,e,t=>{if(t==null){let i=this.main.networkManager,r=i.updateFrequencyInSeconds*i.forcedUpdateEvery;alert(`Der Workspace ${this.workspace.name} wurde an ${e.length} Schüler/innen ausgeteilt. Er wird in maximal ${r} s bei jedem Schüler ankommen.`)}else alert(t)})}close(){this.$dialog.css("visibility","hidden"),this.$dialog.empty(),y("#main").css("visibility","visible")}}class So{constructor(e,t){w(this,"programPointerModule",null);w(this,"programPointerPosition");w(this,"programPointerDecoration",[]);w(this,"accordion");w(this,"fileListPanel");w(this,"workspaceListPanel");w(this,"$homeAction");w(this,"lastOpenModule",null);this.main=e,this.$projectexplorerDiv=t}initGUI(){this.accordion=new xo(this.main,this.$projectexplorerDiv),this.initFilelistPanel(),this.initWorkspacelistPanel()}initFilelistPanel(){let e=this;this.fileListPanel=new Ze(this.accordion,"Kein Workspace gewählt","1","img_add-file-dark","Neue Datei...","java",!0,!1,"file",!0,[]),this.fileListPanel.newFilesElementCallback=(t,i)=>{if(e.main.currentWorkspace==null)return alert("Bitte wählen Sie zuerst einen Workspace aus."),null;let r={name:t.name,dirty:!1,saved:!0,text:"",text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:1,panelElement:t},o=new ze(r,e.main);e.main.currentWorkspace.moduleStore.putModule(o),e.setModuleActive(o),e.main.networkManager.sendCreateFile(o,e.main.currentWorkspace,e.main.workspacesOwnerId,h=>{h==null?i(o):alert("Der Server ist nicht erreichbar!")})},this.fileListPanel.renameCallback=(t,i)=>{i=i.substr(0,80);let r=t.file;return r.name=i,r.saved=!1,e.main.networkManager.sendUpdates(),i},this.fileListPanel.deleteCallback=(t,i)=>{e.main.networkManager.sendDeleteWorkspaceOrFile("file",t.file.id,r=>{r==null?(e.main.currentWorkspace.moduleStore.removeModule(t),i()):alert("Der Server ist nicht erreichbar!")})},this.fileListPanel.contextMenuProvider=t=>{let i=[];return e.main.user.is_teacher||e.main.user.is_admin||e.main.user.is_schooladmin||t.externalElement.file,i},this.fileListPanel.selectCallback=t=>{e.setModuleActive(t)}}renderHomeworkButton(e){var o,u;let t=(u=(o=e==null?void 0:e.panelElement)==null?void 0:o.$htmlFirstLine)==null?void 0:u.find(".jo_additionalButtonHomework");if(t==null)return;t.find(".jo_homeworkButton").remove();let i=null,r="";if(e.submitted_date!=null&&(i="img_homework",r="Wurde als Hausaufgabe abgegeben: "+e.submitted_date,e.text_before_revision&&(i="img_homework-corrected",r="Korrektur liegt vor.")),i!=null){let h=y(`<div class="jo_homeworkButton ${i}" title="${r}"></div>`);t.prepend(h),i.indexOf("jo_active")>=0&&(h.on("mousedown",b=>b.stopPropagation()),h.on("click",b=>{b.stopPropagation()}))}}initWorkspacelistPanel(){let e=this;this.workspaceListPanel=new Ze(this.accordion,"Datenbanken","3",null,"Neue Datenbank...","workspace",!0,!0,"workspace",!1,["file"]);let t=y('<div class="img_add-database-dark jo_button jo_active" style="margin-right: 4px" title="Neue Datenbank auf oberster Ordnerebene anlegen">'),i=window.PointerEvent?"pointer":"mouse";t.on(i+"down",r=>{r.stopPropagation();let o=e.main.user.id;e.main.workspacesOwnerId!=null&&(o=e.main.workspacesOwnerId),new Vi(e.main,o,this.workspaceListPanel.getCurrentlySelectedPath())}),this.workspaceListPanel.addAction(t),this.workspaceListPanel.$buttonNew!=null&&this.workspaceListPanel.$buttonNew.hide(),this.workspaceListPanel.newDatabaseElementCallback=r=>{let o=e.main.user.id;e.main.workspacesOwnerId!=null&&(o=e.main.workspacesOwnerId),new Vi(e.main,o,r)},this.workspaceListPanel.renameCallback=(r,o)=>(o=o.substr(0,80),r.name=o,r.saved=!1,e.main.networkManager.sendUpdates(),o),this.workspaceListPanel.deleteCallback=(r,o)=>{e.main.networkManager.sendDeleteWorkspaceOrFile("workspace",r.id,u=>{u==null?(e.main.removeWorkspace(r),r.isFolder||(e.fileListPanel.clear(),e.main.databaseExplorer.clear(),e.main.getResultsetPresenter().clear(),e.fileListPanel.enableNewButton(!1),e.main.getMonacoEditor().setModel(null)),o()):alert("Fehler: "+u)})},this.workspaceListPanel.selectCallback=r=>{r.isFolder||r!=this.main.currentWorkspace&&e.main.networkManager.sendUpdates(()=>{e.setWorkspaceActive(r)})},this.workspaceListPanel.newFolderCallback=(r,o)=>{let u=e.main.user.id;e.main.workspacesOwnerId!=null&&(u=e.main.workspacesOwnerId);let h=new Dt(r.name,e.main,u);h.isFolder=!0,h.path=r.path.join("/"),h.panelElement=r,r.externalElement=h,e.main.workspaceList.push(h);let b={id:-1,isFolder:!0,name:h.name,path:h.path};e.main.networkManager.sendCreateWorkspace(b,e.main.workspacesOwnerId,k=>{k==null?(h.id=b.id,o(h)):(alert("Fehler: "+k),e.workspaceListPanel.removeElement(r))})},this.workspaceListPanel.moveCallback=r=>{Array.isArray(r)||(r=[r]);for(let o of r){let u=o.externalElement;u.path=o.path.join("/"),u.saved=!1}this.main.networkManager.sendUpdates()},this.workspaceListPanel.dropElementCallback=(r,o,u)=>{let h=r.externalElement,b=o.externalElement;if(h.moduleStore.getModules(!1).indexOf(b)>=0)return;let k={name:b.file.name,dirty:!0,saved:!1,text:b.file.text,text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:b.file.version,panelElement:null};u=="move"&&(e.main.currentWorkspace.moduleStore.removeModule(b),e.fileListPanel.removeElement(b),e.main.networkManager.sendDeleteWorkspaceOrFile("file",b.file.id,()=>{}));let E=new ze(k,e.main);h.moduleStore.putModule(E),e.main.networkManager.sendCreateFile(E,h,e.main.workspacesOwnerId,L=>{L==null||alert("Der Server ist nicht erreichbar!")})},this.$homeAction=y('<div class="img_home-dark jo_button jo_active" style="margin-right: 4px" title="Meine eigenen Workspaces anzeigen">'),this.$homeAction.on(i+"down",r=>{r.stopPropagation(),e.main.networkManager.sendUpdates(()=>{e.onHomeButtonClicked()}),e.main.bottomDiv.hideHomeworkTab()}),this.workspaceListPanel.addAction(this.$homeAction),this.$homeAction.hide(),this.workspaceListPanel.contextMenuProvider=r=>{let o=[];return this.main.user.is_teacher&&this.main.teacherExplorer.classPanel.elements.length>0&&o.push({caption:"An Klasse austeilen...",callback:u=>{},subMenu:this.main.teacherExplorer.classPanel.elements.map(u=>({caption:u.name,callback:h=>{let b=u.externalElement,k=h.externalElement;this.main.networkManager.sendDistributeWorkspace(k,b,null,E=>{if(E==null){let P=this.main.networkManager,L=P.updateFrequencyInSeconds*P.forcedUpdateEvery;alert("Der Workspace "+k.name+" wurde an die Klasse "+b.name+" ausgeteilt. Er wird in maximal "+L+" s bei jedem Schüler ankommen.")}else alert(E)})}}))},{caption:"An einzelne Schüler/innen austeilen...",callback:u=>{let h=this.main.teacherExplorer.classPanel.elements.map(k=>k.externalElement),b=u.externalElement;new Co(h,b,this.main)}}),o}}onHomeButtonClicked(){this.main.teacherExplorer.restoreOwnWorkspaces(),this.main.networkManager.updateFrequencyInSeconds=this.main.networkManager.ownUpdateFrequencyInSeconds,this.$homeAction.hide(),this.fileListPanel.enableNewButton(this.main.workspaceList.length>0)}renderFiles(e){let t=e==null?"Kein Workspace vorhanden":e.name;if(this.fileListPanel.setCaption(t),this.fileListPanel.clear(),this.main.getCurrentWorkspace()!=null)for(let i of this.main.getCurrentWorkspace().moduleStore.getModules(!1))i.file.panelElement=null;if(e!=null){let i=[];for(let r of e.moduleStore.getModules(!1))i.push(r);i.sort((r,o)=>r.file.name>o.file.name?1:r.file.name<o.file.name?-1:0);for(let r of i)r.file.panelElement={name:r.file.name,externalElement:r,isFolder:!1,path:[]},this.fileListPanel.addElement(r.file.panelElement,!0),this.renderHomeworkButton(r.file);this.fileListPanel.sortElements()}}renderWorkspaces(e){this.fileListPanel.clear(),this.workspaceListPanel.clear();for(let t of e){let i=t.path.split("/");i.length==1&&i[0]==""&&(i=[]),t.panelElement={name:t.name,externalElement:t,iconClass:"workspace",isFolder:t.isFolder,path:i},this.workspaceListPanel.addElement(t.panelElement,!1),t.renderSettingsButton(t.panelElement)}this.workspaceListPanel.sortElements(),this.fileListPanel.enableNewButton(e.length>0)}renderErrorCount(e,t){if(t!=null)for(let i of e.moduleStore.getModules(!1)){let r=t.get(i),o=r==null||r==0?"":"("+r+")";this.fileListPanel.setTextAfterFilename(i.file.panelElement,o,"jo_errorcount")}}setWorkspaceActive(e,t,i=!1){if(e==this.main.getCurrentWorkspace()){t!=null&&t();return}if(e!=null)if(e.isFolder){this.main.currentWorkspace=null,this.main.databaseTool.initializeWorker(null,[],null,()=>{this.main.databaseExplorer.refreshAfterRetrievingDBStructure()}),this.setModuleActive(null);return}else this.fileListPanel.$buttonNew.show();this.workspaceListPanel.select(e,!1,i);let r=o=>{this.initializeDatabaseTool(o,e,t)};e.database==null?(this.main.waitOverlay.show("Bitte warten, hole Datenbank vom Server ..."),this.main.networkManager.fetchDatabase(e,r)):r(null)}initializeDatabaseTool(e,t,i){if(e!=null){alert(e);return}let r=this.main.getDatabaseTool(),o=t.database.statements;o==null&&(o=[]),r.initializeWorker(t.database.templateDump,o,()=>{if(this.main.currentWorkspace=t,this.main.user.id==t.owner_id&&(this.main.user.currentWorkspace_id=t.id),this.renderFiles(t),t!=null){let u=t.moduleStore.getModules(!1);t.currentlyOpenModule!=null?this.setModuleActive(t.currentlyOpenModule):u.length>0?this.setModuleActive(u[0]):this.setModuleActive(null);for(let h of u)h.file.dirty=!0;u.length==0&&tt.showHelper("newSQLFileHelper",this.main,this.fileListPanel.$captionElement),this.main.notifier.connect(t)}else this.setModuleActive(null)},()=>{this.main.databaseExplorer.refreshAfterRetrievingDBStructure(),this.main.getHistoryViewer().clearAndShowStatements(t.database.statements),i!=null&&i()})}writeEditorTextToFile(){let e=this.getCurrentlyEditedModule();e!=null&&(e.file.text=e.getProgramTextFromMonacoModel())}setModuleActive(e){this.main.bottomDiv.homeworkManager.hideRevision(),this.lastOpenModule!=null&&(this.lastOpenModule.file.text=this.lastOpenModule.getProgramTextFromMonacoModel(),this.lastOpenModule.editorState=this.main.getMonacoEditor().saveViewState()),e==null?(this.main.getMonacoEditor().setModel(monaco.editor.createModel("Keine Datei vorhanden.","text")),this.main.getMonacoEditor().updateOptions({readOnly:!0})):(this.main.getMonacoEditor().updateOptions({readOnly:!1}),this.main.getMonacoEditor().setModel(e.model),this.main.getBottomDiv()!=null&&this.main.getBottomDiv().errorManager.showParenthesisWarning(e.bracketError),e.file.text_before_revision!=null?this.main.bottomDiv.homeworkManager.showHomeWorkRevisionButton():this.main.bottomDiv.homeworkManager.hideHomeworkRevisionButton())}setActiveAfterExternalModelSet(e){this.fileListPanel.select(e,!1),this.lastOpenModule=e,e.editorState!=null&&(this.main.editor.dontPushNextCursorMove++,this.main.getMonacoEditor().restoreViewState(e.editorState),this.main.editor.dontPushNextCursorMove--),this.setCurrentlyEditedModule(e),this.showProgramPointer(),setTimeout(()=>{this.main.getMonacoEditor().getOptions().get(monaco.editor.EditorOption.readOnly)||this.main.getMonacoEditor().focus()},300)}showProgramPointer(){if(this.programPointerModule==this.getCurrentlyEditedModule()&&this.getCurrentlyEditedModule()!=null){let e=this.programPointerPosition,t={startColumn:e.column,startLineNumber:e.line,endColumn:e.column+e.length,endLineNumber:e.line};this.main.getMonacoEditor().revealRangeInCenterIfOutsideViewport(t),this.programPointerDecoration=this.main.getMonacoEditor().deltaDecorations(this.programPointerDecoration,[{range:t,options:{className:"jo_revealProgramPointer",isWholeLine:!0,overviewRuler:{color:"#6fd61b",position:monaco.editor.OverviewRulerLane.Center},minimap:{color:"#6fd61b",position:monaco.editor.MinimapPosition.Inline}}},{range:t,options:{beforeContentClassName:"jo_revealProgramPointerBefore"}}])}}showProgramPointerPosition(e,t){if(e==null)return;let i=this.main.currentWorkspace.moduleStore.findModuleByFile(e);i!=null&&(this.programPointerModule=i,this.programPointerPosition=t,i!=this.getCurrentlyEditedModule()?this.setModuleActive(i):this.showProgramPointer())}hideProgramPointerPosition(){this.getCurrentlyEditedModule()==this.programPointerModule&&this.main.getMonacoEditor().deltaDecorations(this.programPointerDecoration,[]),this.programPointerModule=null,this.programPointerDecoration=[]}getCurrentlyEditedModule(){let e=this.main.currentWorkspace;return e==null?null:e.currentlyOpenModule}setCurrentlyEditedModule(e){if(e==null)return;let t=this.main.currentWorkspace;t.currentlyOpenModule!=e&&(t.currentlyOpenModule=e,t.saved=!1,e.file.dirty=!0)}setExplorerColor(e){let t;e==null?(e="transparent",t="Meine Datenbanken"):t="Schüler-DB",this.fileListPanel.$listElement.parent().css("background-color",e),this.workspaceListPanel.$listElement.parent().css("background-color",e),this.workspaceListPanel.setCaption(t)}getNewModule(e){return new ze(e,this.main)}}class br{constructor(e,t){w(this,"isWholePage",!1);w(this,"$tabs");w(this,"$headings");this.main=e,this.$rightDiv=t,this.$tabs=t.find(".jo_tabs"),this.$headings=t.find(".jo_tabheadings"),this.$headings.find(".jo_classDiagramTabHeading").length>0,this.$headings.find(".jo_objectDiagramTabHeading").length>0;let i=this,r="100%";t.find(".jo_whole-window").on("click",()=>{i.isWholePage=!i.isWholePage;let o=y(".jo_whole-window");i.isWholePage?(y("#code").css("display","none"),r=y("#rightdiv").css("width"),y("#rightdiv").css("width","100%"),o.removeClass("img_whole-window"),o.addClass("img_whole-window-back"),y(".jo_control-container").append(y("#controls")),o.attr("title","Auf normale Größe zurückführen"),y(".jo_graphics").trigger("sizeChanged")):(y("#code").css("display","flex"),y("#rightdiv").css("width",r),o.removeClass("img_whole-window-back"),o.addClass("img_whole-window"),y("#controls").insertAfter(y("#view-mode")),o.attr("title","Auf Fenstergröße vergrößern"),y(".jo_graphics").trigger("sizeChanged"))})}initGUI(){Qt(this.$rightDiv)}}class Eo{constructor(e){w(this,"main");this.main=e}initSliders(){let e=this,t=window.PointerEvent?"pointer":"mouse";y("#slider1").on(t+"down",o=>{let u=o.clientX;y(document).on(t+"move.slider1",h=>{let b=h.clientX-u;e.moveLeftPanel(b),u=h.clientX}),y(document).on(t+"up.slider1",()=>{y(document).off(t+"move.slider1"),y(document).off(t+"up.slider1")})}),y("#slider2").on(t+"down",o=>{let u=o.clientY;y(document).on(t+"move.slider2",h=>{let b=h.clientY-u;e.moveBottomDiv(b),u=h.clientY}),y(document).on(t+"up.slider2",()=>{y(document).off(t+"move.slider2"),y(document).off(t+"up.slider2")})}),y("#slider3").on(t+"down",o=>{let u=o.clientX;y(document).on(t+"move.slider3",h=>{let b=h.clientX-u;e.moveRightDiv(b),u=h.clientX,h.stopPropagation()}),y(document).on(t+"up.slider3",()=>{y(document).off(t+"move.slider3"),y(document).off(t+"up.slider3")})});let i=y('<div class="jo_sliderknob img_knob jo_button jo_active" style="left: -8px" draggable="false"></div>');y("#slider2").append(i),i.on(t+"down",o=>{let u=o.clientY,h=o.clientX;o.stopImmediatePropagation(),y(document).on(t+"move.knobleft",b=>{let k=b.clientY-u,E=b.clientX-h;b.stopImmediatePropagation(),e.moveLeftPanel(E),e.moveBottomDiv(k),h+=E,u+=k}),y(document).on(t+"up.knobleft",()=>{y(document).off(t+"move.knobleft"),y(document).off(t+"up.knobleft")})});let r=y('<div class="jo_sliderknob img_knob jo_button jo_active" style="right: -8px" draggable="false"></div>');y("#slider2").append(r),r.on(t+"down",o=>{let u=o.clientY,h=o.clientX;o.stopImmediatePropagation(),y(document).on(t+"move.knobright",b=>{let k=b.clientY-u,E=b.clientX-h;b.stopImmediatePropagation(),e.moveRightDiv(E),e.moveBottomDiv(k),h+=E,u+=k}),y(document).on(t+"up.knobright",()=>{y(document).off(t+"move.knobright"),y(document).off(t+"up.knobright")})})}moveRightDiv(e){let t=y("#editor>.monaco-editor"),i=y("#rightdiv"),r=Number.parseInt(i.css("width").replace("px",""));i.css("width",r-e+"px");let o=Number.parseInt(t.css("width").replace("px",""));t.css("width",o+e+"px"),this.main.getMonacoEditor().layout(),this.main.bottomDiv.homeworkManager.diffEditor!=null&&this.main.bottomDiv.homeworkManager.diffEditor.layout(),y(".jo_graphics").trigger("sizeChanged"),r+=e}moveBottomDiv(e){let t=y("#editor>.monaco-editor"),i=y("#bottomdiv-outer"),r=Number.parseInt(i.css("height").replace("px",""));i.css("height",r-e+"px");let o=Number.parseInt(t.css("height").replace("px",""));t.css("height",o+e+"px"),this.main.getMonacoEditor().layout(),this.main.bottomDiv.homeworkManager.diffEditor!=null&&this.main.bottomDiv.homeworkManager.diffEditor.layout()}moveLeftPanel(e){let t=y("#leftpanel"),i=y("#editor>.monaco-editor"),r=Number.parseInt(t.css("width").replace("px",""));t.css("width",r+e+"px");let o=Number.parseInt(i.css("width").replace("px",""));i.css("width",o-e+"px"),this.main.getMonacoEditor().layout(),this.main.bottomDiv.homeworkManager.diffEditor!=null&&this.main.bottomDiv.homeworkManager.diffEditor.layout()}}class Do{constructor(e,t){w(this,"studentPanel");w(this,"classPanel");w(this,"ownWorkspaces");w(this,"currentOwnWorkspace");this.main=e,this.classData=t}removePanels(){this.classPanel.remove(),this.studentPanel.remove()}initGUI(){this.initStudentPanel(),this.initClassPanel(),this.renderClasses(this.classData)}initStudentPanel(){let e=this;this.studentPanel=new Ze(this.main.projectExplorer.accordion,"Schüler/innen","2",null,"","student",!1,!1,"student",!1,[]),this.studentPanel.selectCallback=t=>{e.main.networkManager.sendUpdates(()=>{let i={ws_userId:t.id,userId:this.main.user.id,language:1};ue("getWorkspaces",i,r=>{r.success==!0&&(e.main.workspacesOwnerId==e.main.user.id&&(e.ownWorkspaces=e.main.workspaceList.slice(),e.currentOwnWorkspace=e.main.currentWorkspace),e.main.restoreWorkspaces(r.workspaces),e.main.workspacesOwnerId=t.id,e.main.projectExplorer.setExplorerColor("rgba(255, 0, 0, 0.2"),e.main.projectExplorer.$homeAction.show(),tt.showHelper("homeButtonHelper",this.main),e.main.bottomDiv.showHomeworkTab(),e.main.bottomDiv.homeworkManager.attachToWorkspaces(e.main.workspaceList)),this.main.networkManager.updateFrequencyInSeconds=this.main.networkManager.teacherUpdateFrequencyInSeconds,this.main.networkManager.secondsTillNextUpdate=this.main.networkManager.teacherUpdateFrequencyInSeconds})})}}restoreOwnWorkspaces(){let e=this.main;e.getMonacoEditor().updateOptions({readOnly:!0}),e.workspaceList=this.ownWorkspaces,e.workspacesOwnerId=e.user.id,e.projectExplorer.setExplorerColor(null),e.projectExplorer.renderWorkspaces(e.workspaceList),e.currentWorkspace==null&&e.workspaceList.length>0&&(e.currentWorkspace=e.workspaceList[0]),this.currentOwnWorkspace!=null&&e.projectExplorer.setWorkspaceActive(this.currentOwnWorkspace),e.currentWorkspace=this.currentOwnWorkspace,this.studentPanel.select(null,!1)}initClassPanel(){let e=this;this.classPanel=new Ze(this.main.projectExplorer.accordion,"Klassen","1",null,"","class",!1,!1,"class",!1,[]),this.classPanel.selectCallback=t=>{e.main.networkManager.sendUpdates(()=>{let i=t;i!=null&&this.renderStudents(i.students)})}}renderStudents(e){this.studentPanel.clear(),e.sort((t,i)=>t.familienname>i.familienname?1:i.familienname>t.familienname?-1:t.rufname>i.rufname?1:i.rufname>t.rufname?-1:0);for(let t of e){let i={name:t.familienname+", "+t.rufname,sortName:t.familienname+" "+t.rufname,externalElement:t,isFolder:!1,path:[]};this.studentPanel.addElement(i,!0)}}renderClasses(e){this.studentPanel.clear(),e.sort((t,i)=>t.name>i.name?1:i.name>t.name?-1:0);for(let t of e){let i={name:t.name,externalElement:t,isFolder:!1,path:[]};this.classPanel.addElement(i,!0)}}}class To{constructor(){w(this,"$dialog");w(this,"$dialogMain")}init(){this.$dialog=y("#dialog"),y("#main").css("visibility","hidden"),this.$dialog.append(y('<div style="flex: 1"></div><div class="dialog-main"></div><div style="flex: 4"></div>')),this.$dialogMain=this.$dialog.find(".dialog-main"),this.$dialog.css("visibility","visible")}heading(e){let t=y('<div class="dialog-heading">'+e+"</div>");return this.$dialogMain.append(t),t}description(e,t){let i=t==null?"":`style="color: ${t}"`,r=y(`<div class="dialog-description" ${i}>${e}</div>`);return this.$dialogMain.append(r),r}input(e,t){let i=y(`<input class="dialog-input" type="${e}" placeholder="${t}"></input>`);return this.$dialogMain.append(i),i}buttons(e){let t=y('<div class="dialog-buttonRow"></div>');this.$dialogMain.append(t);for(let i of e){let r=y(`<button style="background-color: ${i.color};margin-left: 20px">${i.caption}</button>`);r.on("click",()=>{i.callback()}),t.append(r)}}waitMessage(e){let t=y(`<div class="dialog-wait">${e}<img src="assets/projectexplorer/svg-loaders/ball-triangle.svg"></div>`);return this.$dialogMain.append(t),i=>{let r=i?"visible":"hidden";t.css("visibility",r)}}close(){this.$dialog.css("visibility","hidden"),this.$dialog.empty(),y("#main").css("visibility","visible")}}class _o{constructor(e){this.main=e}init(){let e=y("#buttonUserSettings"),t=this;e.on("click",i=>{et([{caption:"Passwort ändern...",callback:()=>{new Lo(t.main).show()}}],e.offset().left,e.offset().top+e.height())})}}class Lo{constructor(e){w(this,"dialog");this.main=e,this.dialog=new To}show(){this.dialog.init(),this.dialog.heading("Passwort ändern"),this.dialog.description("Bitte geben Sie Ihr bisheriges Passwort und darunter zweimal Ihr neues Passwort ein. <br>Das Passwort muss mindestens 8 Zeichen lang sein und sowohl Buchstaben als auch Zahlen oder Sonderzeichen enthalten.");let e=this.dialog.input("password","Altes Passwort"),t=this.dialog.input("password","Neues Passwort"),i=this.dialog.input("password","Neues Passwort wiederholen"),r=this.dialog.description("","red"),o=this.dialog.waitMessage("Bitte warten...");this.dialog.buttons([{caption:"Abbrechen",color:"#a00000",callback:()=>{this.dialog.close()}},{caption:"OK",color:"green",callback:()=>{t.val()!=i.val()?r.text("Die zwei eingegebenen neuen Passwörter stimmen nicht überein."):(o(!0),ue("changePassword",{oldPassword:e.val(),newPassword:t.val()},()=>{o(!1),alert("Das Passwort wurde erfolgreich geändert."),this.dialog.close()},u=>{o(!1),r.text(u)}))}}])}}class Po{constructor(e){this.main=e}initGUI(){let e=this,t=y("#login-spinner>img");y("#login-username").focus(),y("#login-username").on("keydown",r=>{r.key=="Enter"&&y("#login-password").focus()}),y("#login-password").on("keydown",r=>{r.key=="Enter"&&y("#login-button").trigger("click")}),y("#login-password").on("keydown",r=>{r.key=="Tab"&&(r.preventDefault(),y("#login-button").focus(),y("#login-button").addClass("jo_active")),r.key=="Enter"&&y("#login-button").trigger("click")}),y("#login-button").on("keydown",r=>{r.key=="Tab"?(r.preventDefault(),y("#login-username").focus(),y("#login-button").removeClass("jo_active")):y("#login-button").trigger("click")});let i=!1;y("#login-button").on("click",()=>{if(t.show(),i)return;i=!0,setTimeout(()=>{i=!1},1e3);let r={username:y("#login-username").val(),password:y("#login-password").val(),language:1};ue("login",r,o=>{if(!o.success)y("#login-message").html("Fehler: Benutzername und/oder Passwort ist falsch.");else{y("#login").hide(),this.main.waitOverlay.show("Bitte warten...");let u=o.user;(u.settings==null||u.settings.helperHistory==null)&&(u.settings={helperHistory:{},viewModes:null,classDiagram:null}),this.main.waitForGUICallback=()=>{e.main.mainMenu.initGUI(u),e.main.waitOverlay.hide(),t.hide(),y("#menupanel-username").html(Vt(u.rufname)+" "+Vt(u.familienname)),new _o(e.main).init(),u.is_teacher&&e.main.initTeacherExplorer(o.classdata),e.main.user=u,e.main.restoreWorkspaces(o.workspaces),e.main.workspacesOwnerId=u.id,e.main.networkManager.initializeTimer(),e.main.projectExplorer.fileListPanel.setFixed(!u.is_teacher),e.main.projectExplorer.workspaceListPanel.setFixed(!u.is_teacher),e.main.viewModeController.initViewMode(),e.main.bottomDiv.hideHomeworkTab(),e.main.networkManager.initializeNotifierClient()},this.main.startupComplete==0&&(this.main.waitForGUICallback(),this.main.waitForGUICallback=null)}},o=>{y("#login-message").html("Login gescheitert: "+o),y("#login-spinner>img").hide()})}),y("#buttonLogout").on("click",()=>{this.main.waitOverlay.show("Bitte warten, der letzte Bearbeitungsstand wird noch gespeichert ..."),this.main.workspacesOwnerId!=this.main.user.id&&this.main.projectExplorer.onHomeButtonClicked(),this.main.networkManager.sendUpdates(()=>{var o;let r={currentWorkspaceId:(o=this.main.currentWorkspace)==null?void 0:o.id};ue("logout",r,()=>{this.main.networkManager.sendUpdateUserSettings(()=>{}),y("#login").show(),this.main.waitOverlay.hide(),y("#login-message").empty(),this.main.getMonacoEditor().setModel(monaco.editor.createModel("","myJava")),this.main.projectExplorer.fileListPanel.clear(),this.main.projectExplorer.workspaceListPanel.clear(),this.main.databaseExplorer.clear(),this.main.resultsetPresenter.clear(),this.main.user.is_teacher&&(this.main.teacherExplorer.removePanels(),this.main.teacherExplorer=null),this.main.currentWorkspace=null,this.main.user=null})},!0)})}}class jo{constructor(e,t){w(this,"$buttonEditorFullscreen");w(this,"$buttonPresentationMode");w(this,"$buttonMonitorMode");w(this,"$buttonMap",{});w(this,"highContrast",!1);w(this,"editorHasFullWidth",!1);this.$buttonsContainer=e,this.main=t,this.$buttonEditorFullscreen=y('<div title="Editor in voller Breite" class="img_whole-window jo_button jo_active" style="padding: 1px; margin-right: 20px"></div>'),this.$buttonPresentationMode=y('<div title="Präsentation (Beamer)" class="img_presentation-mode jo_button jo_active" syle="padding: 1px"></div>'),this.$buttonMonitorMode=y('<div title="Monitor" class="img_monitor-mode jo_button jo_active" style="margin-left: 5px; padding: 1px"></div>'),e.append(this.$buttonEditorFullscreen,this.$buttonPresentationMode,this.$buttonMonitorMode),this.$buttonMap={presentation:this.$buttonPresentationMode,monitor:this.$buttonMonitorMode};let i=this.main.actionManager;i.registerAction("editor.fullwidth",[],()=>{this.toggleEditorFullwidth()},"Editor auf die volle Breite erweitern",this.$buttonEditorFullscreen),i.registerAction("viewmode.presentation",[],()=>{this.setMode("presentation")},"Präsentationsansicht",this.$buttonPresentationMode),i.registerAction("viewmode.monitor",[],()=>{this.setMode("monitor")},"Monitoransicht",this.$buttonMonitorMode)}toggleEditorFullwidth(){this.editorHasFullWidth?(this.$buttonEditorFullscreen.removeClass("img_whole-window-back"),this.$buttonEditorFullscreen.addClass("img_whole-window"),this.$buttonEditorFullscreen.attr("title","Editor in voller Breite"),y("#rightdiv").show(600),y("#leftpanel").show(600),y("#controls").show()):(this.$buttonEditorFullscreen.removeClass("img_whole-window"),this.$buttonEditorFullscreen.addClass("img_whole-window-back"),this.$buttonEditorFullscreen.attr("title","Editor in normaler Breite"),y("#rightdiv").hide(600),y("#leftpanel").hide(600),y("#controls").hide()),setTimeout(()=>{this.main.getMonacoEditor().layout()},800),this.editorHasFullWidth=!this.editorHasFullWidth}setMode(e,t=!0){let i=e=="presentation"?"monitor":"presentation";this.$buttonMap[e].addClass("jo_pressed"),this.$buttonMap[i].removeClass("jo_pressed");let o=this.main.user.settings.viewModes,u=o[e];o.viewModeChosen=e,this.main.themeManager.switchTheme(u.theme),this.main.editor.setFontSize(u.fontSize),this.highContrast!=u.highContrast&&(this.main.getMonacoEditor().getAction("editor.action.toggleHighContrast").run(),this.highContrast=!this.highContrast),t&&this.saveSettings()}saveFontSize(e){let t=this.getChosenViewMode();t.fontSize=e,this.saveSettings()}setTheme(e){let t=this.getChosenViewMode();t.theme=e,this.main.themeManager.switchTheme(t.theme),this.saveSettings()}toggleHighContrast(){let e=this.getChosenViewMode();e.highContrast=!e.highContrast,this.main.getMonacoEditor().getAction("editor.action.toggleHighContrast").run(),this.saveSettings()}getChosenViewMode(){let e=this.main.user.settings.viewModes;return e[e.viewModeChosen]}saveSettings(){this.main.userDataDirty=!0}initViewMode(){let e=this.main.user.settings;e.viewModes==null&&(e.viewModes={monitor:null,presentation:null,viewModeChosen:"monitor"}),e.viewModes.monitor==null&&(e.viewModes.monitor={fontSize:14,highContrast:!1,theme:"dark"},e.viewModes.presentation={fontSize:18,highContrast:!1,theme:"light"},this.saveSettings()),this.setMode(e.viewModes.viewModeChosen,!1)}}class wr{constructor(e){w(this,"semicolonPositions",[]);w(this,"time");this.main=e}startRegistering(){this.semicolonPositions.forEach(e=>e.isThereAgain=!1),this.time=new Date().getTime()}register(e,t){let i=this.semicolonPositions.find(r=>r.position.line==e.line&&r.position.column==e.column);i?i.isThereAgain=!0:this.semicolonPositions.push({position:e,firstSeenMs:this.time,isThereAgain:!0,module:t})}healSemicolons(){let e=new Date().getTime();this.semicolonPositions=this.semicolonPositions.filter(r=>r.isThereAgain);let t=this.main.getCurrentlyEditedModule(),i=this.main.getMonacoEditor().getPosition().lineNumber;this.semicolonPositions.filter(r=>e-r.firstSeenMs>2e3).forEach(r=>{let o=r.module.file.id!=null&&r.module.file.id==t.file.id,u=[{range:new monaco.Range(r.position.line,r.position.column,r.position.line,r.position.column),text:";",forceMoveMarkers:!0}];if(o&&Math.abs(i-r.position.line)>1){let h=this.main.getMonacoEditor();const b=h.getSelection();h.executeEdits("Semicolon-Angel",u),h.setSelection(b),this.semicolonPositions.splice(this.semicolonPositions.indexOf(r),1)}})}}class vr{constructor(e,t){w(this,"collapsedTables",new Map);this.main=e,this.$mainDiv=t}refresh(){this.main.getDatabaseTool().retrieveDatabaseStructure(t=>{this.refreshAfterRetrievingDBStructure()})}clear(){this.$mainDiv.empty()}refreshAfterRetrievingDBStructure(){let e=this.main.getDatabaseTool(),t=this.main.getCurrentWorkspace();if(t!=null)for(let r of t.moduleStore.getModules(!1))r.file.dirty=!0;let i=ft.fromTableStructureList(e.databaseStructure.tables);this.$mainDiv.empty();for(let r of i)if(r.identifier!="sqlite_sequence"){let o=this.renderTable(r);this.$mainDiv.append(o)}}renderTable(e){let t=this.collapsedTables.get(e.identifier)!=null,i=y(`<div class="jo_table">
           <div class="jo_tableheader">
              <div class="${t?"img_tree-collapsed-dark":"img_tree-expanded-dark"} jo_treeswitch jo_button jo_active"></div>
              <div class="jo_tableheaderlink">
                <div class="img_table"></div>
                <div>${e.identifier}</div></div><div class="jo_tablesize">(${e.size}&nbsp;Datensätze)</div>
              </div>
            </div>
        </div>`);i.find(".jo_tableheader").on("pointerup",()=>{this.main.getResultsetPresenter().showTable(e.identifier)});let r=y('<div class="jo_columnlist"></div>');for(let h of e.columns){let b=h.isPrimaryKey?"img_key":"img_column",k="";h.references!=null&&(k=`<div class="img_foreign_key" style="margin-left: 5px"></div><div class="jo_references">${h.references.table.identifier}.${h.references.identifier}</div>`);let E=h.type==null?"":h.type.toString(),P=h.notNull?'<div class="jo_dbnotnull">not null</div>':"",L=h.defaultValue?`<div class="jo_dbdefault">default ${h.defaultValue}</div>`:"",H=h.isAutoIncrement?'<div class="jo_dbautoincrement">autoincrement</div>':"",z=y(`
            <div class="jo_column">
                <div class="${b}"></div>
                <div>${h.identifier}</div>
                <div class="jo_dbtype">${E}</div>
                ${H}
                ${k}
                ${P}
                ${L}
            </div>
            `);r.append(z)}i.append(r);let o=i.find(".jo_treeswitch"),u=this;return o.on("pointerup",h=>{h.stopPropagation();let b=o.parents(".jo_table").find(".jo_columnlist");o.hasClass("img_tree-collapsed-dark")?(o.removeClass("img_tree-collapsed-dark"),o.addClass("img_tree-expanded-dark"),b.slideDown(300),u.collapsedTables.delete(e.identifier)):(o.removeClass("img_tree-expanded-dark"),o.addClass("img_tree-collapsed-dark"),b.slideUp(300),u.collapsedTables.set(e.identifier,!0))}),i}}class yr{constructor(e,t){w(this,"$buttonStart");w(this,"$buttonRollback");this.main=e,this.$buttonsContainer=t,this.$buttonStart=y('<div title="Start" class="img_start-dark jo_button"></div>'),this.$buttonRollback=y('<div title="Rollback" class="img_undo jo_button"></div>');let i=this.main.getActionManager();i.registerAction("execute",["Strg + Enter"],()=>{i.isActive("execute")&&this.main.getResultsetPresenter().executeSelectedStatements()},"SQL-Statement ausführen",this.$buttonStart),i.setActive("execute",!1),i.registerAction("rollback",["Strg + LeftArrow"],()=>{i.isActive("rollback")&&this.main.getHistoryViewer().rollback()},"Letztes schreibendes SQL-Statement rückgängig machen",this.$buttonRollback),i.setActive("rollback",!1),t.append(this.$buttonStart,this.$buttonRollback)}}class Yi{constructor(e,t){w(this,"$paginationDiv");w(this,"$infoDiv");w(this,"$arrowLeft");w(this,"$arrowRight");w(this,"paginationFrom");w(this,"paginationAll");w(this,"paginationSize",1e3);w(this,"result");w(this,"writeQueryListeners",[]);w(this,"oldErrorDecorations",[]);w(this,"showResultsBusy",!1);w(this,"showResultPending",!1);this.main=e,this.$bottomDiv=t,this.$paginationDiv=t.find(".jo_pagination"),this.$arrowLeft=y('<div class="jo_button img_arrow-left-dark jo_active"></div>'),this.$infoDiv=y('<div class="jo_pagination_info"><span class="jo_pagination_fromto">0001-1000</span>/<span class="jo_pagination_all">5000</span></div>'),this.$arrowRight=y('<div class="jo_button img_arrow-right-dark jo_active"></div>'),this.$paginationDiv.empty(),this.$paginationDiv.append(this.$arrowLeft,this.$infoDiv,this.$arrowRight),this.$paginationDiv.hide();let i=(window.PointerEvent?"pointer":"mouse")+"up",r=this;this.$arrowLeft.on(i,o=>{r.paginationFrom>1&&(r.paginationFrom=Math.max(r.paginationFrom-r.paginationSize,1),r.paginationFrom%1e3!=1&&(r.paginationFrom=(Math.floor(r.paginationFrom/r.paginationSize)+1)*r.paginationSize+1),r.showResults(),r.activateButtons())}),this.$arrowRight.on(i,o=>{r.paginationFrom<this.paginationAll-r.paginationSize+1&&(r.paginationFrom=Math.min(r.paginationFrom+r.paginationSize,r.paginationAll-r.paginationSize+1),r.showResults(),r.activateButtons())})}addWriteQueryListener(e){this.writeQueryListeners.push(e)}activateButtons(){this.$arrowLeft.toggleClass("jo_active",this.paginationFrom>1),this.$arrowRight.toggleClass("jo_active",this.paginationFrom<this.paginationAll-this.paginationSize+1)}executeSelectedStatements(){let e=this.fetchSelectedStatements().filter(u=>u.ast.type!=l.omittedeStatement);if(e.length==0)return;let t=e.some(u=>this.isDDLStatement(u)),i=e.some(u=>this.isWriteStatement(u)),r=this.main.getCurrentWorkspace(),o=r.database;if(t&&r.permissions<=1){alert("Der Benutzer hat keine Berechtigung zum Ändern der Tabellenstruktur.");return}if(i&&r.permissions==0){alert("Der Benutzer hat keine Berechtigung zum Einfügen/Löschen/Ändern von Datensätzen.");return}t||i?this.main.isEmbedded()?this.executeDDLWriteStatementsEmbedded(r,e,o):this.executeDDLWriteStatementsInOnlineIDE(r,e,o):this.executeStatements(e,0,[],()=>{})}executeDDLWriteStatementsEmbedded(e,t,i){let r=[];this.executeStatements(t,0,r,()=>{r.length!=0&&(this.main.getDatabaseExplorer().refresh(),this.writeQueryListeners.forEach(o=>o.notify(r)))})}executeDDLWriteStatementsInOnlineIDE(e,t,i){let r=this.main;r.networkManager.getNewStatements(e,(o,u)=>{r.notifier.executeNewStatements(o,u,()=>{},()=>{let h=[];this.executeStatements(t,0,h,()=>{h.length!=0&&r.networkManager.AddDatabaseStatements(e,h.map(b=>b.sqlCleaned==null?b.sql:b.sqlCleaned),(b,k)=>{b.forEach(P=>i.statements.push(P)),this.main.getHistoryViewer().appendStatements(b);let E=h.map(P=>P.sqlCleaned==null?P.sql:P.sqlCleaned);i.statements=i.statements.concat(E),this.main.getHistoryViewer().appendStatements(E),i.version=k,b.length>0?this.resetDatabase(i):r.getDatabaseExplorer().refresh()})})},!1)})}resetDatabase(e){this.main.getDatabaseTool().initializeWorker(e.templateDump,e.statements,()=>{this.main.getDatabaseExplorer().refresh()})}executeStatementsString(e,t,i){if(e.length==0){i();return}t<e.length?this.main.getDatabaseTool().executeQuery(e[t],r=>{this.executeStatementsString(e,t+1,i)},r=>{console.log("Error when executing statement "+e[t]+`
Error : `+r),this.executeStatementsString(e,t+1,i)}):i()}executeStatements(e,t,i,r,o=[]){if(t>=e.length){this.showErrors(o),r();return}let u=e[t],h=()=>{this.executeStatements(e,t+1,i,r,o)};if(u.ast==null){h();return}if(u.ast.type==l.keywordSelect){let b=!1;for(let k=t+1;k<e.length;k++)b=b||this.isSelectStatement(e[k]);if(b)h();else{if(u.ast.limitNode==null){for(u.sql.trimRight();u.sql.endsWith(";")||u.sql.endsWith(`
`)||u.sql.endsWith("\r");)u.sql=u.sql.substring(0,u.sql.length-1),u.sql.trimRight();u.sql+=" limit 100000"}this.main.getDatabaseTool().executeQuery(u.sql,k=>{this.presentResultsIntern(u.sql,k),h()},k=>{o.push({statement:u,message:k}),h()})}}else{let b=new mr().clean(u);console.log(b),this.main.getDatabaseTool().executeQuery(b,k=>{i.push(u),h()},k=>{o.push({statement:u,message:k}),h()})}}showErrorDecorations(e){let t={error:"#bc1616",warning:"#cca700",info:"#75beff"};this.main.getMonacoEditor();let i=[],r=[];for(let u of e){let h="error",b,k=t[h];switch(h){case"error":b="jo_revealErrorLine";break;case"warning":b="jo_revealWarningLine";break;case"info":b="jo_revealInfoLine";break}let E;switch(h){case"error":E=monaco.MarkerSeverity.Error;break;case"warning":E=monaco.MarkerSeverity.Warning;break;case"info":E=monaco.MarkerSeverity.Info;break}i.push({startLineNumber:u.statement.from.line,startColumn:u.statement.from.column,endLineNumber:u.statement.to.line,endColumn:u.statement.to.column,message:u.message,severity:E}),r.push({range:{startLineNumber:u.statement.from.line,startColumn:u.statement.from.column,endLineNumber:u.statement.to.line,endColumn:u.statement.to.column},options:{linesDecorationsClassName:b,minimap:{position:monaco.editor.MinimapPosition.Inline,color:k}}})}let o=this.main.getCurrentlyEditedModule().model;monaco.editor.setModelMarkers(o,"test",i),this.oldErrorDecorations=o.deltaDecorations(this.oldErrorDecorations,r)}showTable(e){let t="select * from "+e+";";this.main.getDatabaseTool().executeQuery(t,i=>{this.presentResultsIntern(t,i)},i=>{})}showErrors(e){let t=this.$bottomDiv.find(".jo_errorsTab"),i=this.$bottomDiv.find(".jo_errorsTabheading");if(t.empty(),this.showErrorDecorations(e),e.length==0)return;let r=window.PointerEvent?"pointer":"mouse";i.trigger(r+"down");let o=y('<div class="jo_errorlist"></div>');t.append(o);for(let u of e){let h=u.statement.sql;h=h.replace(/\n/g," "),h=h.replace(/\s\s+/g," ");let b=y('<div class="jo_error-line" style="flex-direction:column; width: fit-content"></div>');o.append(b),b.on(r+"down",()=>{let P={startColumn:u.statement.from.column,startLineNumber:u.statement.from.line,endColumn:u.statement.to.column,endLineNumber:u.statement.to.line};this.main.getMonacoEditor().revealRangeInCenter(P),o.find(".jo_error-line").removeClass("jo_active"),b.addClass("jo_active")});let k=y('<div class="jo_sqlErrorStatement"></div>');b.append(k),monaco.editor.colorize(h,"vscSQL",{}).then(P=>{k.html(P)});let E=y('<div class="jo_sqlErrorMessage">'+u.message+"</div>");b.append(E)}this.$bottomDiv.find(".jo_tabheading").removeClass("jo_active"),i.addClass("jo_active"),t.addClass("jo_active")}isSelectStatement(e){return e.ast!=null&&e.ast.type==l.keywordSelect}isDDLStatement(e){return e.ast!=null&&[l.keywordCreate,l.keywordDrop,l.keywordAlter].indexOf(e.ast.type)>=0}isWriteStatement(e){return e.ast!=null&&[l.keywordInsert,l.keywordDelete,l.keywordUpdate].indexOf(e.ast.type)>=0}presentResultsIntern(e,t){let i=this.$bottomDiv.find(".jo_resultTabheading"),r=this.$bottomDiv.find(".jo_result-header"),o=window.PointerEvent?"pointer":"mouse";i.trigger(o+"down"),this.result=t.pop();let u=r;e=e.replace(/\n/g," "),e=e.replace(/\s\s+/g," "),e=e.replace(/limit 100000/g,""),monaco.editor.colorize(e,"vscSQL",{}).then(h=>{u.html(h)}),this.paginationAll=this.result?this.result.values.length:0,this.$infoDiv.find(".jo_pagination_all").html(`${this.paginationAll}`),this.paginationFrom=1,this.$paginationDiv.show(),this.activateButtons(),this.showResults()}clear(){this.$bottomDiv.find(".jo_result-body").empty(),this.$paginationDiv.hide()}showResults(){let e=this.$bottomDiv.find(".jo_result-body");if(this.result==null){this.$infoDiv.find(".jo_pagination_fromto").html("---"),e.html("Die Datenbank lieferte eine leere Ergebnistabelle.");return}let t=this,i=this.paginationAll==0?0:this.paginationFrom,r=this.paginationAll==0?0:Math.min(this.paginationFrom+this.paginationSize-1,this.paginationAll);if(this.$infoDiv.find(".jo_pagination_fromto").html(`${i}-${r}`),this.showResultsBusy){if(this.showResultPending)return;this.showResultPending=!0;let E=()=>{t.showResultsBusy?setTimeout(()=>{E()},200):(t.showResultPending=!1,t.showResults())};setTimeout(E,200);return}this.showResultsBusy=!0;let o=y("<table></table>"),u=y("<tr></tr>");o.append(u),this.result.columns.forEach(E=>{u.append(y(`<th><div>${E}</div></th>`))});let h=this.result.values.slice(this.paginationFrom-1,this.paginationFrom+this.paginationSize-1),b=0,k=()=>{if(b<h.length){for(let E=b;E<Math.min(b+200,h.length);E++){let P=h[E],L=y("<tr></tr>");o.append(L),P.forEach(H=>{L.append(y(`<td>${H}</td>`))})}b=Math.min(b+200,h.length),b<h.length?setTimeout(k,30):(e.empty().append(o),this.showResultsBusy=!1)}};k()}fetchSelectedStatements(){let e=this.main.getCurrentlyEditedModule();if(e==null)return null;let t=this.main.getMonacoEditor(),i=e.getSQLSTatementsAtSelection(t.getSelection());for(let r of i)r.sql=t.getModel().getValueInRange({startColumn:r.from.column,startLineNumber:r.from.line,endColumn:r.to.column,endLineNumber:r.to.line});return i}}w(Yi,"StatementDelimiter",`;

`);class Mo{constructor(e){w(this,"connection");w(this,"isOpen",!1);w(this,"workspace");w(this,"database");w(this,"unsentMessages",[]);w(this,"isPolling",!1);w(this,"counter",0);w(this,"isLongPolling",!1);w(this,"longPollCounter",0);this.main=e}connect(e){let t=this;this.workspace=e,this.database=e.database,this.isOpen&&this.connection.close(),ue("getWebSocketToken",{},i=>{let r=(window.location.protocol.startsWith("https")?"wss://":"ws://")+window.location.host+"/servlet/websocket";this.connection=new WebSocket(r),this.connection.onerror=o=>{this.onError(o)},this.connection.onclose=o=>{this.onClose(o)},this.connection.onmessage=o=>{this.onMessage(o)},this.connection.onopen=o=>{let u={command:1,token:i.token,workspaceId:e.id,databaseId:e.database.id,databaseVersion:e.database.version};this.isOpen=!0,this.sendIntern(JSON.stringify(u)),this.onOpen()},setTimeout(()=>{t.startLongPolling()},2e3)})}sendIntern(e){if(!this.isOpen)this.unsentMessages.push(e);else try{this.connection.send(e)}catch(t){console.log(t)}}onClose(e){this.isOpen=!1}disconnect(){let e={command:4};this.sendIntern(JSON.stringify(e)),this.connection.close(),this.workspace=null}onMessage(e){let t=this,i=JSON.parse(e.data);if(i.command!=null)switch(i.command){case 2:t.executeNewStatements(i.newStatements,i.firstNewStatementIndex,()=>{let r={command:2,databaseVersion:t.database.version};t.sendIntern(JSON.stringify(r))});break;case 3:this.isOpen=!1,this.database=null,this.workspace=null;break;case 4:break;case 5:this.database.version>i.new_version&&this.main.getHistoryViewer().rollbackLocal(i.new_version);break}}executeNewStatements(e,t,i,r=()=>{},o=!0){if(this.database==null)return;let u=this,h=t-(this.database.version+1);if(h>0){i(),r();return}else{h<0&&(e.splice(0,-h),t-=h);let b=e;b.length>0?this.main.resultsetPresenter.executeStatementsString(b,0,()=>{u.main.getHistoryViewer().appendStatements(b),u.database.statements=u.database.statements.concat(b),u.database.version=t+e.length-1,o&&u.main.databaseExplorer.refresh(),r()}):r()}}onError(e){}onOpen(){this.isOpen=!0,this.unsentMessages.length>0&&(this.unsentMessages.forEach(e=>this.sendIntern(e)),this.unsentMessages=[])}startPolling(){this.isPolling||(this.isPolling=!0,this.poll())}poll(){let e=this;setTimeout(()=>{e.poll()},6e3),!e.isOpen&&e.workspace!=null&&(this.getNewStatementsHttp(),e.counter++,e.counter==10&&(e.counter=0,e.connect(e.workspace)))}getNewStatementsHttp(){let e=this;if(this.workspace==null||this.database==null)return;let t={workspaceId:this.workspace.id,version_before:this.workspace.database.version};ue("getNewStatements",t,i=>{i.rollbackToVersion!=null?e.main.getHistoryViewer().rollbackLocal(i.rollbackToVersion):e.executeNewStatements(i.newStatements,i.firstNewStatementIndex,()=>{e.getNewStatementsHttp()})})}startLongPolling(){this.isLongPolling||(this.isLongPolling=!0,this.longPoll())}longPoll(){let e=this;if(!e.isOpen&&e.workspace!=null){let t={workspaceId:e.workspace.id};$.ajax({type:"POST",async:!0,data:JSON.stringify(t),contentType:"application/json",url:"servlet/registerLongPollingListener",success:function(i){var o;console.log(i);let r=typeof i=="string"?JSON.parse(i):i;i!=null&&!e.isOpen&&((o=e.workspace)==null?void 0:o.id)==t.workspaceId&&r.success&&(e.executeNewStatements(r.newStatements,r.firstNewStatementIndex,()=>{e.getNewStatementsHttp()}),e.longPollCounter++,e.longPollCounter==10&&(e.longPollCounter=0,e.connect(e.workspace)),setTimeout(()=>{e.longPoll()},2e3))},error:function(i,r){var o;!e.isOpen&&((o=e.workspace)==null?void 0:o.id)==t.workspaceId&&setTimeout(()=>{e.longPoll()},2e3)}})}else setTimeout(()=>{e.longPoll()},5e3)}}class kr{constructor(e){w(this,"visible",!1);w(this,"fadeOutPending",!1);w(this,"$bitteWartenText");w(this,"$bitteWartenProgress");this.$waitDiv=e,e.css("display","none"),this.$bitteWartenText=e.find(".bitteWartenText"),this.$bitteWartenProgress=e.find(".bitteWartenProgress")}show(e){this.fadeOutPending=!1,this.$bitteWartenText.html(e),this.$bitteWartenProgress.html(""),this.visible||(this.visible=!0,this.$waitDiv.css("display","flex"),this.$waitDiv.hide(),this.$waitDiv.fadeIn(400))}setProgress(e){this.$bitteWartenProgress.html(e)}hide(){this.visible&&(this.fadeOutPending=!0,setTimeout(()=>{this.fadeOutPending&&(this.fadeOutPending=!1,this.$waitDiv.fadeOut(200,()=>{this.$waitDiv.css("display","none")}),this.visible=!1)},50))}}class xr{constructor(e,t){w(this,"panelEntries",[]);this.main=e,this.$historyPanel=t}clear(){this.$historyPanel.empty(),this.main.getActionManager().setActive("rollback",!1),this.panelEntries=[]}clearAndShowStatements(e){this.clear(),this.appendStatements(e),this.main.getActionManager().setActive("rollback",e.length>0)}appendStatements(e){e.forEach(t=>{let i=this.makePanelEntry(t,this.panelEntries.length+1);this.$historyPanel.prepend(i.$div),this.panelEntries.unshift(i)}),e.length>0&&this.main.getActionManager().setActive("rollback",!0),this.makeLastButtonActive()}makeLastButtonActive(){this.panelEntries.forEach(e=>e.$rollbackButton.removeClass("jo_active")),this.panelEntries.length>0&&this.panelEntries[0].$rollbackButton.addClass("jo_active")}makePanelEntry(e,t){let i=y('<div class="jo_panelEntry"></div>'),r=y(`<div class="jo_panelEntryIndex">${t}.</div>`),o=y('<div class="jo_panelEntryText"></div>'),u=e.substring(0,Math.min(400,e.length));e.length>400&&(u+="..."),o.text(u);let h=y('<div class="img_copy jo_panelEntryCopyButton jo_active jo_button" title="In die Zwischenablage kopieren"></div>'),b=y('<div class="img_undo jo_panelEntryRollbackButton jo_button" title="Rollback"></div>');h.on("click",()=>{hr(e)});let k=window.PointerEvent?"pointer":"mouse";return b.on(k+"up",E=>{E.preventDefault(),et([{caption:"Abbrechen",callback:()=>{}},{caption:"Ich bin mir sicher: rollback!",color:"#ff6060",callback:()=>{this.rollback()}}],E.pageX+2,E.pageY+2),E.stopPropagation()}),i.append(r,o,h,b),{$div:i,statement:e,$rollbackButton:b}}rollback(){this.panelEntries.length!=0&&(this.main.isEmbedded()?(this.rollbackEmbedded(),this.main.getActionManager().setActive("rollback",this.panelEntries.length>0)):this.main.networkManager.rollback((t,i)=>{t==null&&i&&this.rollbackLocal()}))}rollbackLocal(e){let t=this.main.getCurrentWorkspace().database;for(e==null&&(e=t.version-1);t.version>e;)t.statements.pop(),t.version--;this.main.getDatabaseTool().initializeWorker(t.templateDump,t.statements,()=>{},()=>{this.main.getDatabaseExplorer().refreshAfterRetrievingDBStructure(),this.panelEntries.shift().$div.remove(),this.makeLastButtonActive(),this.main.getActionManager().setActive("rollback",this.panelEntries.length>0)})}rollbackEmbedded(){let e=this.main;e.writeQueryManager.rollback(),this.main.getDatabaseTool().initializeWorker(e.initialTemplateDump,e.initialStatements.concat(e.writeQueryManager.writtenStatements),()=>{},()=>{this.main.getDatabaseExplorer().refreshAfterRetrievingDBStructure(),this.panelEntries.shift().$div.remove(),this.makeLastButtonActive()})}}class bi{constructor(){w(this,"workspaceList",[]);w(this,"workspacesOwnerId");w(this,"editor");w(this,"currentWorkspace");w(this,"projectExplorer");w(this,"teacherExplorer");w(this,"networkManager");w(this,"actionManager");w(this,"mainMenu");w(this,"login");w(this,"compiler");w(this,"semicolonAngel");w(this,"bottomDiv");w(this,"startupComplete",2);w(this,"waitForGUICallback");w(this,"version",0);w(this,"timerHandle");w(this,"user");w(this,"userDataDirty",!1);w(this,"themeManager");w(this,"rightDiv");w(this,"viewModeController");w(this,"databaseTool");w(this,"databaseExplorer");w(this,"resultsetPresenter");w(this,"notifier");w(this,"waitOverlay",new kr(y(".bitteWarten")));w(this,"historyViewer",new xr(this,y(".jo_historyTab")))}isEmbedded(){return!1}getCurrentWorkspace(){return this.currentWorkspace}getMonacoEditor(){return this.editor.editor}getRightDiv(){return this.rightDiv}getBottomDiv(){return this.bottomDiv}getCurrentlyEditedModule(){return this.projectExplorer.getCurrentlyEditedModule()}getActionManager(){return this.actionManager}getCompiler(){return this.compiler}setModuleActive(e){this.projectExplorer.setModuleActive(e)}getSemicolonAngel(){return this.semicolonAngel}getDatabaseTool(){return this.databaseTool}getDatabaseExplorer(){return this.databaseExplorer}getResultsetPresenter(){return this.resultsetPresenter}getWaitOverlay(){return this.waitOverlay}getHistoryViewer(){return this.historyViewer}initGUI(){lo(),this.login=new Po(this),this.login.initGUI(),this.databaseTool=new Xe(this),this.databaseExplorer=new vr(this,y(".jo_db_tree")),this.actionManager=new dr(null,this),this.actionManager.init(),this.networkManager=new po(this,y("#bottomdiv-outer .jo_updateTimerDiv")),new Eo(this).initSliders(),this.mainMenu=new ko(this),this.projectExplorer=new So(this,y("#leftpanel>.jo_projectexplorer")),this.projectExplorer.initGUI(),this.bottomDiv=new Cr(this,y("#bottomdiv-outer>.jo_bottomdiv-inner"),y("body")),this.rightDiv=new br(this,y("#rightdiv-inner")),this.rightDiv.initGUI(),this.checkStartupComplete(),this.themeManager=new tr,this.viewModeController=new jo(y("#view-mode"),this),this.semicolonAngel=new wr(this),new yr(this,y("#controls")),this.resultsetPresenter=new Yi(this,y(".jo_bottomdiv-inner")),this.notifier=new Mo(this)}initEditor(){this.editor=new pr(this,!0,!1),new er().init(),this.editor.initGUI(y("#editor"));let e=this;y(window).on("resize",t=>{y("#bottomdiv-outer").css("height","450px"),y("#editor").css("height",window.innerHeight-450-30-2+"px"),e.editor.editor.layout(),y("#editor").css("height","")}),y(window).trigger("resize"),this.checkStartupComplete()}initTeacherExplorer(e){this.teacherExplorer=new Do(this,e),this.teacherExplorer.initGUI()}checkStartupComplete(){this.startupComplete--,this.startupComplete==0&&this.start()}start(){this.waitForGUICallback!=null&&this.waitForGUICallback();let e=this;setTimeout(()=>{e.getMonacoEditor().layout()},200),this.compiler=new ur(this),this.startTimer(),$(window).on("unload",function(){navigator.sendBeacon&&e.user!=null&&(e.networkManager.sendUpdates(null,!1),e.networkManager.sendUpdateUserSettings(()=>{}))})}startTimer(){this.timerHandle!=null&&clearInterval(this.timerHandle);let e=this;this.timerHandle=setInterval(()=>{e.compileIfDirty()},500)}compileIfDirty(){var e,t;if(this.currentWorkspace!=null&&this.currentWorkspace.moduleStore.isDirty()&&this.compiler.compilerStatus!=Gt.compiling)try{this.compiler.compile(this.currentWorkspace.moduleStore);let i=(t=(e=this.bottomDiv)==null?void 0:e.errorManager)==null?void 0:t.showErrors(this.currentWorkspace);this.projectExplorer.renderErrorCount(this.currentWorkspace,i),this.editor.onDidChangeCursorPosition(null),this.projectExplorer&&this.version++}catch(i){console.error(i),this.compiler.compilerStatus=Gt.error}}removeWorkspace(e){this.workspaceList.splice(this.workspaceList.indexOf(e),1)}restoreWorkspaces(e){this.workspaceList=[],this.currentWorkspace=null,this.getMonacoEditor().updateOptions({readOnly:!0});let t=null;for(let i of e.workspaces){let r=Dt.restoreFromData(i,this);this.workspaceList.push(r),i.id==this.user.currentWorkspace_id&&!i.isFolder&&(t=r)}if(this.projectExplorer.renderWorkspaces(this.workspaceList),t==null&&this.workspaceList.length>0){for(let i of this.workspaceList)if(!i.isFolder){t=this.workspaceList[0];break}}t!=null&&this.projectExplorer.setWorkspaceActive(t,null,!0),this.workspaceList.length==0&&tt.showHelper("newDatabaseHelper",this,this.projectExplorer.workspaceListPanel.$captionElement)}createNewWorkspace(e,t){return new Dt(e,this,t)}}class Io{constructor(e,t,i){w(this,"oldDecorations",[]);w(this,"oldErrorDecorations",[]);w(this,"$errorDiv");w(this,"$bracket_warning");w(this,"minimapColor",{});w(this,"lightBulbOnClickFunctionList",[]);this.main=e,this.$bottomDiv=t,this.$mainDiv=i,this.minimapColor.error="#bc1616",this.minimapColor.warning="#cca700",this.minimapColor.info="#75beff",this.$bracket_warning=i.find(".jo_parenthesis_warning"),this.$bracket_warning.attr("title","Klammeralarm!"),this.$bracket_warning.children().attr("title","Klammeralarm!");let r=this;i.find(".jo_pw_undo").on("click",()=>{r.main.getMonacoEditor().trigger(".","undo",{})}).attr("title","Undo")}showParenthesisWarning(e){e!=null?(this.$bracket_warning.css("visibility","visible"),this.$bracket_warning.find(".jo_pw_heading").text(e)):this.$bracket_warning.css("visibility","hidden")}showErrors(e){this.lightBulbOnClickFunctionList=[];let t=new Map;this.$errorDiv=this.$bottomDiv.find(".jo_tabs>.jo_errorsTab"),this.$errorDiv.empty();let i=!1,r=e.moduleStore,o=this.main.getMonacoEditor();for(let u of r.getModules(!1)){let h=[],b=[],k=[],E=u.getSortedAndFilteredErrors();t.set(u,u.getErrorCount());for(let P of E){let L,H,z=this.minimapColor[P.level];switch(P.level){case"error":L="jo_revealErrorLine",H="jo_borderLeftError";break;case"warning":L="jo_revealWarningLine",H="jo_borderLeftWarning";break;case"info":L="jo_revealInfoLine",H="jo_borderLeftInfo";break}if(P.quickFix!=null){let K=P.quickFix,W="lb_"+Math.trunc(Math.random()*1e6);L="jo_yellowLightBulb "+H+" "+W,this.lightBulbOnClickFunctionList.push({class:"."+W,onClickFunction:()=>{let he=K.editsProvider(u.model.uri);o.executeEdits("",he.map(ve=>{let me=ve.edit.range;return{range:new monaco.Range(me.startLineNumber,me.startColumn,me.endLineNumber,me.endColumn),text:ve.edit.text,forceMoveMarkers:!0}}))},title:K.title})}this.processError(P,u,k);let A;switch(P.level){case"error":A=monaco.MarkerSeverity.Error;break;case"warning":A=monaco.MarkerSeverity.Warning;break;case"info":A=monaco.MarkerSeverity.Info;break}h.push({startLineNumber:P.position.line,startColumn:P.position.column,endLineNumber:P.position.line,endColumn:P.position.column+P.position.length,message:P.text,severity:A,relatedInformation:P.quickFix}),b.push({range:{startLineNumber:P.position.line,startColumn:P.position.column,endLineNumber:P.position.line,endColumn:P.position.column+P.position.length},options:{linesDecorationsClassName:L,minimap:{position:monaco.editor.MinimapPosition.Inline,color:z}}})}if(monaco.editor.setModelMarkers(u.model,"test",h),u.oldErrorDecorations=u.model.deltaDecorations(u.oldErrorDecorations,b),this.oldDecorations=this.main.getMonacoEditor().deltaDecorations(this.oldDecorations,[]),k.length>0&&this.$errorDiv.length>0){i=!0;let P=y('<div class="jo_error-filename">'+u.file.name+"&nbsp;</div>");this.$errorDiv.append(P);for(let L of k)this.$errorDiv.append(L)}}return!i&&this.$errorDiv.length>0&&this.$errorDiv.append(y('<div class="jo_noErrorMessage">Keine Fehler gefunden :-)</div>')),this.registerLightbulbOnClickFunctions(),t}registerLightbulbOnClickFunctions(){let e=this;setTimeout(()=>{for(let t of e.lightBulbOnClickFunctionList)y(t.class).off("click",t.onClickFunction),y(t.class).on("click",t.onClickFunction).attr("title",t.title)},500)}processError(e,t,i){let r=y('<div class="jo_error-line"></div>'),o=y('<span class="jo_error-position">[Z&nbsp;<span class="jo_linecolumn">'+e.position.line+'</span> Sp&nbsp;<span class="jo_linecolumn">'+e.position.column+"</span>]</span>:&nbsp;"),u="";switch(e.level){case"error":break;case"warning":u='<span class="jo_warning_category">Warnung: </span>';break;case"info":u='<span class="jo_info_category">Info: </span>';break}let h=y('<div class="jo_error-text">'+u+e.text+"</div>");r.append(o).append(h);let b=this;r.on("mousedown",k=>{this.$errorDiv.find(".jo_error-line").removeClass("jo_active"),r.addClass("jo_active"),b.showError(t,e)}),i.push(r)}showError(e,t){this.main instanceof bi&&e!=this.main.projectExplorer.getCurrentlyEditedModule()&&this.main.projectExplorer.setModuleActive(e);let i=t.position,r={startColumn:i.column,startLineNumber:i.line,endColumn:i.column+i.length,endLineNumber:i.line};this.main.getMonacoEditor().revealRangeInCenter(r);let o="";switch(t.level){case"error":o="jo_revealError";break;case"warning":o="jo_revealWarning";break;case"info":o="jo_revealInfo";break}this.oldDecorations=this.main.getMonacoEditor().deltaDecorations(this.oldDecorations,[{range:r,options:{className:o}}])}}class Ao{constructor(e,t){w(this,"$homeworkTab");w(this,"$homeworkTabLeft");w(this,"$homeworkTabRight");w(this,"$showRevisionButton");w(this,"showRevisionActive",!1);w(this,"diffEditor");this.main=e,this.$bottomDiv=t,this.$homeworkTab=t.find(".jo_tabs>.jo_homeworkTab")}initGUI(){let e=this;this.$homeworkTab.append(this.$homeworkTabLeft=xt("","jo_homeworkTabLeft jo_scrollable")),this.$homeworkTab.append(this.$homeworkTabRight=xt("","jo_homeworkTabRight jo_scrollable")),y("#view-mode").prepend(this.$showRevisionButton=xt("","jo_button jo_active jo_homeworkRevisionButton","")),this.$showRevisionButton.on("click",()=>{this.showRevisionActive?this.hideRevision():this.showRevision(e.main.getCurrentlyEditedModule())}),this.$showRevisionButton.hide(),y("#diffEditor").hide()}showHomeWorkRevisionButton(){this.$showRevisionButton.text(this.showRevisionActive?"Normalansicht":"Korrekturen zeigen"),this.$showRevisionButton.show()}hideHomeworkRevisionButton(){this.$showRevisionButton.hide()}showRevision(e){e.file.text=e.getProgramTextFromMonacoModel();let t=e.file;y("#editor").hide(),y("#diffEditor").show();var i=monaco.editor.createModel(t.text_before_revision,"myJava"),r=monaco.editor.createModel(t.text,"myJava");this.diffEditor=monaco.editor.createDiffEditor(document.getElementById("diffEditor"),{enableSplitViewResizing:!0,originalEditable:!1,readOnly:!0,renderSideBySide:!0}),this.diffEditor.setModel({original:i,modified:r}),this.showRevisionActive=!0,this.showHomeWorkRevisionButton()}hideRevision(){this.showRevisionActive&&(y("#diffEditor").hide(),this.diffEditor.dispose(),this.diffEditor=null,y("#editor").show(),this.showRevisionActive=!1,this.showHomeWorkRevisionButton())}attachToWorkspaces(e){let t=[],i={};e.forEach(u=>{u.moduleStore.getModules(!1).forEach(h=>{let b=h.file.submitted_date;if(b!=null){let k=to(b),E=eo(k),P=i[E];P==null&&(P={date:k,day:E,modules:[]},i[E]=P,t.push(P)),P.modules.push({module:h,workspace:u})}})}),this.$homeworkTabLeft.empty(),this.$homeworkTabRight.empty();let r=this;this.$homeworkTabLeft.append(xt("","jo_homeworkHeading","Abgabetage:")),t.sort((u,h)=>u.date.getFullYear()!=h.date.getFullYear()?-Math.sign(u.date.getFullYear()-h.date.getFullYear()):u.date.getMonth()!=h.date.getMonth()?-Math.sign(u.date.getMonth()-h.date.getMonth()):u.date.getDate()!=h.date.getDate()?-Math.sign(u.date.getDate()-h.date.getDate()):0);let o=!0;t.forEach(u=>{u.modules.sort((b,k)=>b.module.file.name.localeCompare(k.module.file.name));let h=xt("","jo_homeworkDate",u.day);this.$homeworkTabLeft.append(h),h.on("click",b=>{this.$homeworkTabLeft.find(".jo_homeworkDate").removeClass("active"),h.addClass("jo_active"),r.select(u)}),o&&(o=!1,h.addClass("jo_active"),r.select(u))})}select(e){this.$homeworkTabRight.empty(),this.$homeworkTabRight.append(xt("","jo_homeworkHeading","Abgegebene Dateien:"));let t=this;e.modules.forEach(i=>{let r=y(`<div class="jo_homeworkEntry">Workspace <span class="jo_homework-workspace">
                    ${i.workspace.name}</span>, Datei <span class="jo_homework-file">
                    ${i.module.file.name}</span> (Abgabe: ${i.module.file.submitted_date} )</div>`);t.$homeworkTabRight.append(r),r.on("click",()=>{t.main.projectExplorer.setWorkspaceActive(i.workspace),t.main.projectExplorer.setModuleActive(i.module),t.main.projectExplorer.fileListPanel.select(i.module,!1)})})}}class Cr{constructor(e,t,i){w(this,"errorManager");w(this,"homeworkManager");this.main=e,this.$bottomDiv=t,this.$mainDiv=i,this.$bottomDiv.find(".jo_tabheadings>.jo_homeworkTabheading").length>0&&(this.homeworkManager=new Ao(e,t)),this.errorManager=new Io(e,t,i)}initGUI(){Qt(this.$bottomDiv),this.homeworkManager!=null&&this.homeworkManager.initGUI(),this.$bottomDiv.find(".jo_tabs").children().first().trigger("click")}showHomeworkTab(){y(".jo_homeworkTabheading").css("visibility","visible"),y(".jo_homeworkTabheading").trigger("mousedown")}hideHomeworkTab(){y(".jo_homeworkTabheading").css("visibility","hidden"),y(".jo_tabheadings").children().first().trigger("mousedown")}}class Ui{constructor(e,t,i,r,o){w(this,"$sliderDiv");this.$container=e,this.firstLast=t,this.horVert=i,this.callback=r,this.$otherDiv=o,this.initSlider()}initSlider(){let e=this;this.$otherDiv==null&&this.$container.parent().children().each((t,i)=>{i!=this.$container[0]&&(e.$otherDiv=y(i))}),this.$sliderDiv=y('<div class="joe_slider"></div>'),this.$sliderDiv.css({width:this.horVert?"100%":"4px",height:this.horVert?"4px":"100%",cursor:this.horVert?"row-resize":"col-resize"}),this.firstLast?this.$sliderDiv.css({top:"0px",left:"0px"}):this.horVert?this.$sliderDiv.css({bottom:"0px",left:"0px"}):this.$sliderDiv.css({top:"0px",right:"0px"}),this.$container.append(this.$sliderDiv),this.$sliderDiv.on("mousedown",t=>{let i=t.clientX,r=t.clientY;y(document).on("mousemove.slider",o=>{let u=o.clientX-i,h=o.clientY-r;e.slide(u,h),i=o.clientX,r=o.clientY}),y(document).on("mouseup.slider",()=>{y(document).off("mousemove.slider"),y(document).off("mouseup.slider")})}),setTimeout(()=>{e.slide(1,1)},600)}setColor(e){this.$sliderDiv.css("background-color",e)}slide(e,t){if(this.horVert){let i=Number.parseInt(this.$container.css("height").replace("px","")),r=Number.parseInt(this.$otherDiv.css("height").replace("px","")),o=this.firstLast?i-=t:i+=t,u=this.firstLast?r+=t:r-=t;this.$container.css("height",o+"px"),this.$otherDiv.css("height",u+"px"),this.callback(o)}else{let i=Number.parseInt(this.$container.css("width").replace("px","")),r=Number.parseInt(this.$otherDiv.css("width").replace("px","")),o=this.firstLast?i-=e:i+=e,u=this.firstLast?r+=e:r-=e;this.$container.css("width",o+"px"),this.$otherDiv.css("width",u+"px"),this.callback(o)}this.$container.css("flex","0 1 auto")}}class $o{constructor(e,t,i){w(this,"currentFile");w(this,"files",[]);this.moduleStore=e,this.$fileListDiv=t,this.main=i;let r=this;for(let h of e.getModules(!1))this.addModule(h);let o=t.parent(),u=y('<div class="joe_addFileButton jo_button img_add-dark jo_active" title="Datei hinzufügen"></div>');o.append(u),u.on("click",()=>{let h=this.main.addModule({text:"",title:"Neue Datei.java",type:"sql"}),b=this.addModule(h);this.renameElement(b,()=>{r.currentFile!=b&&r.selectFile(b)})})}removeAllFiles(){this.files.forEach(e=>this.removeFile(e))}addHint(e){let t=this,i=y('<div class="jo_file jo_hint" ><div class="jo_fileimage"></div><div class="jo_filename" style="line-height: 22px">'+e.title+'</div><div class="jo_additionalButtons"></div></div></div>');this.$fileListDiv.append(i);let r={module:null,$fileDiv:i,type:"hint",hint:e.text};this.files.push(r),i.on("click",o=>{t.selectFile(r)})}addModule(e){let t=this,i=y(`<div class="jo_file jo_java" >
        <div class="jo_fileimage"></div>
        <div class="jo_filename" style="line-height: 22px">${e.file.name}</div>
        <div class="jo_additionalButtonStart"></div>
        <div class="jo_delete img_delete jo_button jo_active" title="Datei löschen"></div></div></div>`);this.$fileListDiv.append(i);let r={module:e,$fileDiv:i,type:"sql"};return this.files.push(r),e.file.panelElement={name:e.file.name,$htmlFirstLine:i,isFolder:!1,path:[]},i.find(".jo_delete").on("mousedown",o=>{t.onDelete(r,o)}),i.find(".jo_delete").on("click",o=>{o.preventDefault(),o.stopPropagation()}),i.on("click",o=>{t.selectFile(r)}),i[0].addEventListener("contextmenu",function(o){o.preventDefault(),et([{caption:"Umbenennen",callback:()=>{t.renameElement(r,()=>{})}}],o.pageX,o.pageY)},!1),r}onDelete(e,t){t.preventDefault(),t.stopPropagation();let i=this;et([{caption:"Abbrechen",callback:()=>{}},{caption:"Ich bin mir sicher: löschen!",color:"#ff6060",callback:()=>{i.removeFile(e)}}],t.pageX+2,t.pageY+2)}removeFile(e){e.$fileDiv.remove(),this.main.removeModule(e.module),this.files=this.files.filter(t=>t!=e),this.currentFile==e&&(this.files.length>0?this.selectFile(this.files[0]):(this.main.getMonacoEditor().setValue("Keine Datei vorhanden."),this.main.getMonacoEditor().updateOptions({readOnly:!0}))),this.files.forEach(t=>{t.module!=null&&(t.module.file.saved=!1)})}removeModule(e){for(let t of this.files)t.module==e&&this.removeFile(t)}renameElement(e,t){let i=e.$fileDiv.find(".jo_filename"),r=e.module.file.name.indexOf("."),o=r==null?null:{start:0,end:r};cr(i,i,u=>{e.module.file.name=u,i.html(u),t!=null&&t()},o)}setFirstFileActive(){this.files.length>0&&this.selectFile(this.files[0])}selectFile(e){if(e!=null)switch(e.type){case"sql":this.main.$hintDiv.hide(),this.main.$monacoDiv.show(),this.main.setModuleActive(e.module),this.main.getMonacoEditor().focus();break;case"hint":this.main.$monacoDiv.hide(),this.main.$hintDiv.show();let t={},i=[],r=window.markdownit({highlight:function(o,u){return i.push(o),""}});r.renderer.rules.code_inline=function(o,u,h,b,k){var E=o[u];return i.push(E.content),""},r.render(e.hint),this.colorize(i,t,()=>{let o=window.markdownit({highlight:function(h,b){return t[h]}});o.renderer.rules.code_inline=function(h,b,k,E,P){var L=h[b];return t[L.content].replace("<br/>","")};let u=o.render(e.hint);this.main.$hintDiv.html(u)}),this.$fileListDiv.find(".jo_file").removeClass("jo_active"),e.$fileDiv.addClass("jo_active");break}}colorize(e,t,i){let r=this;if(e.length>0){let o=e.pop();monaco.editor.colorize(o,"myJava",{tabSize:3}).then(u=>{t[o]=u,r.colorize(e,t,i)})}else i()}markFile(e){this.$fileListDiv.find(".jo_file").removeClass("jo_active"),this.currentFile=this.files.find(t=>t.module==e),this.currentFile!=null&&this.currentFile.$fileDiv.addClass("jo_active")}}class Oo{constructor(e){w(this,"db");this.databaseIdentifier=e}open(e){if(window.indexedDB){let t=window.indexedDB.open(this.databaseIdentifier,1),i=this;t.onerror=function(r){console.log("Couldn't open IndexedDB: "+r.type)},t.onsuccess=function(r){i.db=t.result,i.db.onerror=function(o){console.log("Datenbankfehler: "+o.target.error.message)},e()},t.onupgradeneeded=function(r){i.db=r.target.result;let o=i.db.createObjectStore("scripts",{keyPath:"scriptId",autoIncrement:!1});o.transaction.oncomplete=function(u){},i.db.createObjectStore("databases",{keyPath:"databaseId",autoIncrement:!1}),o.transaction.oncomplete=function(u){}}}else console.log("IndexedDB not available.")}writeScript(e,t){this.db.transaction("scripts","readwrite").objectStore("scripts").put({scriptId:e,script:t})}removeScript(e){this.db.transaction("scripts","readwrite").objectStore("scripts").delete(e)}getScript(e,t){let r=this.db.transaction("scripts","readwrite").objectStore("scripts").get(e);r.onerror=o=>{t(null)},r.onsuccess=o=>{r.result==null?t(null):t(r.result.script)}}writeDatabase(e,t){this.db.transaction("databases","readwrite").objectStore("databases").put({databaseId:e,database:t})}removeDatabase(e){this.db.transaction("databases","readwrite").objectStore("databases").delete(e)}getDatabase(e,t){let r=this.db.transaction("databases","readwrite").objectStore("databases").get(e);r.onerror=o=>{t(null)},r.onsuccess=o=>{r.result==null?t(null):t(r.result.database)}}}class No{constructor(e,t){w(this,"indexedDB");w(this,"databaseTool");w(this,"statementsToExecute",[]);w(this,"writtenStatements",[]);w(this,"statementsToWrite",[]);w(this,"atLeastOneExecuted",!1);w(this,"count");this.main=e,this.databaseIdentifier=t}indexedDBReady(e){this.indexedDB=e,this.indexedDB.getDatabase(this.databaseIdentifier,t=>{t!=null&&(this.writtenStatements=JSON.parse(t),this.statementsToExecute=this.writtenStatements.slice(),this.main.historyViewer.clear(),this.main.historyViewer.appendStatements(this.statementsToExecute),this.executeStatements(),this.writeStatementsIfNecessary())})}reset(){this.statementsToWrite=[],this.writtenStatements=[],this.statementsToExecute=[],this.main.historyViewer.clear(),this.forceWriteStatements()}writeStatementsIfNecessary(){this.indexedDB!=null&&this.statementsToWrite.length>0&&this.forceWriteStatements()}forceWriteStatements(){this.writtenStatements=this.writtenStatements.concat(this.statementsToWrite),this.statementsToWrite=[],this.indexedDB.writeDatabase(this.databaseIdentifier,JSON.stringify(this.writtenStatements))}executeStatements(){if(this.databaseTool!=null&&this.statementsToExecute.length>0){this.atLeastOneExecuted||(this.main.$databaseResetButton.fadeIn(200),this.count=this.statementsToExecute.length,this.main.waitOverlay.show("Schreibe lokale Datenbankänderungen ...")),this.main.waitOverlay.setProgress(Math.round(100*(1-this.statementsToExecute.length/this.count))+" %");let e=this.statementsToExecute.shift();this.atLeastOneExecuted=!0,this.databaseTool.executeQuery(e,()=>{this.executeStatements()},()=>{this.executeStatements()})}else this.atLeastOneExecuted&&(this.main.databaseExplorer.refresh(),this.atLeastOneExecuted=!1,this.main.waitOverlay.hide())}notify(e){this.main.$databaseResetButton.fadeIn(200);let t=e.map(i=>i.sqlCleaned==null?i.sql:i.sqlCleaned);this.statementsToWrite=this.statementsToWrite.concat(t),this.main.historyViewer.appendStatements(t),this.writeStatementsIfNecessary()}databaseReady(e){this.databaseTool=e,this.executeStatements()}rollback(){this.writeStatementsIfNecessary(),this.writtenStatements.pop(),this.forceWriteStatements()}}class Bo{constructor(e){this.main=e}async load(e){let t=e.replace("https://","").replace("http://","").toLocaleLowerCase(),i=t.toLocaleLowerCase(),r=await this.fetchTemplateFromCache(t);if(r!=null)return Xe.getDumpType(r)=="binaryCompressed"&&(r=pako.inflate(r)),{binDump:r};let o;return i.endsWith(".sqlite")?o=await this.loadSqLiteDump(e,t):(i.endsWith(".zip")||i.endsWith(".sql"))&&(o=await this.loadMySql(e,t)),this.saveDatabaseToCache(t,o.binDump),o}loadMySql(e,t){return new gr(this.main).loadFromUrl(e)}async loadSqLiteDump(e,t){return new Promise((i,r)=>{y.ajax({type:"GET",async:!0,url:e,xhrFields:{responseType:"arraybuffer"},success:function(o){let u=new Uint8Array(o);Xe.getDumpType(u)=="binaryCompressed"&&(u=pako.inflate(u)),i({binDump:u})},error:function(o,u){r(u)}})})}cutSqlToStatements(e){e=e.replace(/\r\n/g,`
`);let t=[];return e.indexOf("~@~")>=0?t=e.split("~@~"):t=e.split(`;
`),t}async fetchTemplateFromCache(e){if(e==null||!this.cacheAvailable())return null;let i=await(await caches.open("my-cache")).match(e);if(i==null)return null;let r=await i.arrayBuffer();return new Uint8Array(r)}async saveDatabaseToCache(e,t){if(!this.cacheAvailable())return;(await caches.open("my-cache")).put(e,new Response(t))}cacheAvailable(){return"caches"in self}}class Fo{constructor(e,t){w(this,"config");w(this,"editor");w(this,"programPointerDecoration",[]);w(this,"programPointerModule");w(this,"currentWorkspace");w(this,"actionManager");w(this,"compiler");w(this,"$dbTreeDiv");w(this,"$debuggerDiv");w(this,"bottomDiv");w(this,"$filesListDiv");w(this,"$hintDiv");w(this,"$monacoDiv");w(this,"$codeResetButton");w(this,"$databaseResetButton");w(this,"programIsExecutable",!1);w(this,"version",0);w(this,"timerHandle");w(this,"rightDiv");w(this,"$rightDivInner");w(this,"fileExplorer");w(this,"debounceDiagramDrawing");w(this,"indexedDB");w(this,"compileRunsAfterCodeReset",0);w(this,"semicolonAngel");w(this,"databaseTool");w(this,"databaseExplorer");w(this,"waitOverlay");w(this,"resultsetPresenter");w(this,"writeQueryManager");w(this,"historyViewer");w(this,"initialTemplateDump");w(this,"initialStatements");this.scriptList=t,this.readConfig(e),this.writeQueryManager=new No(this,(this.config.databaseURL==null?"Empty database":this.config.databaseURL)+this.config.id),this.initGUI(e),this.databaseExplorer=new vr(this,this.$dbTreeDiv),this.databaseTool=new Xe(this),this.config.databaseURL!=null?new Bo(this).load(this.config.databaseURL).then(i=>{this.initialTemplateDump=i.binDump,this.initialStatements=i.statements==null?[]:i.statements,this.initDatabase()}).catch(i=>{alert("Fehler beim Landen der Datenbank: "+i)}):this.initDatabase(),this.semicolonAngel=new wr(this)}isEmbedded(){return!0}getCompiler(){return this.compiler}getCurrentWorkspace(){return this.currentWorkspace}getMonacoEditor(){return this.editor.editor}getRightDiv(){return this.rightDiv}getBottomDiv(){return this.bottomDiv}getActionManager(){return this.actionManager}getCurrentlyEditedModule(){var e;return this.config.withFileList?(e=this.fileExplorer.currentFile)==null?void 0:e.module:this.currentWorkspace.moduleStore.getFirstModule()}getDatabaseTool(){return this.databaseTool}getDatabaseExplorer(){return this.databaseExplorer}getResultsetPresenter(){return this.resultsetPresenter}getWaitOverlay(){return this.waitOverlay}getHistoryViewer(){return this.historyViewer}initDatabase(){this.resetDatabase(()=>{this.initScripts(),this.indexedDB=new Oo("SQL-IDE"),this.indexedDB.open(()=>{this.config.id!=null&&(this.writeQueryManager.indexedDBReady(this.indexedDB),this.readScripts())})})}resetDatabase(e){this.databaseTool.initializeWorker(this.initialTemplateDump,this.initialStatements,()=>{},()=>{this.writeQueryManager.databaseReady(this.databaseTool),this.databaseExplorer.refreshAfterRetrievingDBStructure(),e()})}initScripts(){var e;(e=this.fileExplorer)==null||e.removeAllFiles(),this.initWorkspace(this.scriptList),this.config.withFileList?(this.fileExplorer=new $o(this.currentWorkspace.moduleStore,this.$filesListDiv,this),this.fileExplorer.setFirstFileActive(),this.scriptList.filter(t=>t.type=="hint").forEach(t=>this.fileExplorer.addHint(t))):this.setModuleActive(this.currentWorkspace.moduleStore.getFirstModule())}readConfig(e){let t=e.data("sql-online");t!=null&&typeof t=="string"?this.config=JSON.parse(t.split("'").join('"')):this.config={},this.config.withFileList==null&&(this.config.withFileList=!1),this.config.withOutput==null&&(this.config.withOutput=!0),this.config.withErrorList==null&&(this.config.withErrorList=!0),this.config.withBottomPanel==null&&(this.config.withBottomPanel=!0),this.config.withOutput||this.config.withFileList||this.config.withErrorList||(this.config.withBottomPanel=!1),this.config.withBottomPanel||(this.config.withFileList=!1,this.config.withOutput=!1,this.config.withErrorList=!1),this.config.databaseURL!=null&&["http:","https:"].forEach(i=>{this.config.databaseURL.startsWith(i)&&!this.config.databaseURL.startsWith(i+"://")&&(this.config.databaseURL=this.config.databaseURL.replace(i,i+"//"))})}setModuleActive(e){this.config.withFileList&&this.fileExplorer.currentFile!=null&&(this.fileExplorer.currentFile.module.editorState=this.getMonacoEditor().saveViewState()),this.config.withFileList&&this.fileExplorer.markFile(e),this.getMonacoEditor().updateOptions({readOnly:!1,lineNumbersMinChars:4}),this.editor.editor.setModel(e.model),e.editorState!=null&&this.getMonacoEditor().restoreViewState(e.editorState)}readScripts(){let e=this.currentWorkspace.moduleStore.getModules(!1),t=this;this.indexedDB.getScript(this.config.id,i=>{var r;if(i==null)setInterval(()=>{t.saveScripts()},1e3);else{let o=JSON.parse(i),u=o.length;for(let h of e)(r=t.fileExplorer)==null||r.removeModule(h),t.removeModule(h);for(let h of o){let b=this.config.id+h;this.indexedDB.getScript(b,k=>{var E,P;if(k!=null){let L=t.addModule({title:h,text:k,type:"sql"});(E=t.fileExplorer)==null||E.addModule(L),t.$codeResetButton.fadeIn(1e3)}if(u--,u==0&&(setInterval(()=>{t.saveScripts()},1e3),(P=t.fileExplorer)==null||P.setFirstFileActive(),t.fileExplorer==null)){let L=t.currentWorkspace.moduleStore.getModules(!1);L.length>0&&t.setModuleActive(L[0])}})}}})}saveScripts(){let e=this.currentWorkspace.moduleStore.getModules(!1),t=[],i=!1;if(e.forEach(r=>i=i||!r.file.saved),i){for(let r of e){t.push(r.file.name);let o=this.config.id+r.file.name;this.indexedDB.writeScript(o,r.getProgramTextFromMonacoModel()),r.file.saved=!0}this.indexedDB.writeScript(this.config.id,JSON.stringify(t))}}deleteScriptsInDB(){this.indexedDB.getScript(this.config.id,e=>{if(e!=null){let t=JSON.parse(e);for(let i of t){let r=this.config.id+i;this.indexedDB.removeScript(r)}this.indexedDB.removeScript(this.config.id)}})}initWorkspace(e){this.currentWorkspace=new Dt("Embedded-Workspace",this,0);for(let t of e)t.type=="sql"&&this.addModule(t)}addModule(e){let t=ze.restoreFromData({id:this.currentWorkspace.moduleStore.getModules(!0).length,name:e.title,text:e.text,text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:1,workspace_id:0,forceUpdate:!1,file_type:11},this);this.currentWorkspace.moduleStore.putModule(t);let i=this;return t.model.onDidChangeContent(()=>{i.considerShowingCodeResetButton()}),t}removeModule(e){this.currentWorkspace.moduleStore.removeModule(e)}initGUI(e){e.css({"background-image":"none","background-size":"100%"});let t=y('<div class="joe_centerDiv"></div>');e.append(t);let i=this.makeWaitDiv();e.append(i),this.waitOverlay=new kr(i);let r=this.makeCodeResetModalWindow(e),o=this.makeDatabaseResetModalWindow(e),u=this.makeRightDiv(),h=y('<div class="joe_editorDiv"></div>');this.$monacoDiv=y('<div class="joe_monacoDiv"></div>'),this.$hintDiv=y('<div class="joe_hintDiv jo_scrollable"></div>'),this.$codeResetButton=y('<div class="joe_codeResetButton jo_button jo_active" title="Code auf Ausgangszustand zurücksetzen">Code Reset</div>'),this.$databaseResetButton=y('<div class="joe_databaseResetButton jo_button jo_active" title="Datenbank auf Ausgangszustand zurücksetzen">Datenbank Reset</div>'),h.append(this.$monacoDiv,this.$hintDiv,this.$databaseResetButton),this.$monacoDiv.append(this.$codeResetButton);let b=this.makeBracketErrorDiv();h.append(b),this.$codeResetButton.hide(),this.$codeResetButton.on("click",()=>{r.show()}),this.$databaseResetButton.hide(),this.$databaseResetButton.on("click",()=>{o.show()}),this.$hintDiv.hide();let k=y('<div class="joe_controlsDiv"></div>'),E=y('<div class="joe_bottomDivInner"></div>'),P=y('<div class="joe_bottomDiv"></div>');if(this.makeBottomDiv(E,k),P.append(E),this.config.withFileList){let he=this.makeFilesDiv();P.prepend(he),new Ui(he,!1,!1,()=>{})}Qt(E),e.append(P),e.addClass("joe_javaOnlineDiv"),this.editor=new pr(this,!1,!0),this.editor.initGUI(this.$monacoDiv),this.$monacoDiv.find(".monaco-editor").css("z-index","10"),e.attr("tabindex")==null&&e.attr("tabindex","0"),this.actionManager=new dr(e,this),this.actionManager.init(),this.bottomDiv=new Cr(this,E,e),this.bottomDiv.initGUI(),this.rightDiv=new br(this,this.$rightDivInner),this.rightDiv.initGUI(),t.append(h,P),e.append(u);let L=y('<div class="jo_rightdiv-rightside-container"></div>'),H=y('<div class="jo_button jo_active img_ellipsis-dark" style="margin-right: 10px"></div>');k.append(H),this.$rightDivInner.append(L),new Ui(u,!0,!1,()=>{this.editor.editor.layout()},t),new Ui(P,!0,!0,()=>{this.editor.editor.layout()}),H.on("mouseup",he=>{he.preventDefault(),he.stopPropagation(),et([{caption:"Über die Online-IDE ...",link:"https://learnj.de",callback:()=>{}}],he.pageX+2,he.pageY+2)});let z=y('<label type="file" class="img_open-file jo_button jo_active"style="margin-right: 8px;" title="Datenbank-Dump aus Datei laden"><input type="file" style="display:none"></label>'),A=this,K=z.find("input");K.on("change",he=>{var ve=he.originalEvent.target.files;A.loadDatabaseFromFile(ve[0]).then(()=>{K.val(null)})});let W=y('<div class="img_save-dark jo_button jo_active"style="margin-right: 8px;" title="Datenbank-Dump in Datei speichern"></div>');W.on("click",()=>{A.saveDatabaseToFile()}),k.append(z,W),this.resultsetPresenter=new Yi(this,E),this.resultsetPresenter.addWriteQueryListener(this.writeQueryManager),new yr(this,k),this.historyViewer=new xr(this,e.find(".jo_historyTab")),setTimeout(()=>{this.editor.editor.layout(),this.compiler=new ur(this),this.startTimer()},200)}saveDatabaseToFile(){new gi().saveToFile(this.databaseTool)}async loadDatabaseFromFile(e){let i=await new gi().loadFromFile(e,this);if(i==null){alert("Es ist ein Fehler beim Import aufgetreten.");return}else this.databaseTool.initializeWorker(i.binDump,[],r=>{r.length>0&&(alert("Es sind Fehler beim Import aufgetreten. Ausführliche Fehlermeldungen sehen Sie in der Konsole (F12)."),console.log(r))},()=>{this.databaseExplorer.refreshAfterRetrievingDBStructure()})}makeWaitDiv(){let t=`
        <div class="bitteWarten">
        <div style="margin-bottom: 30px">
            <div class="bitteWartenText" style="font-size: 20px"></div>
        </div>
        <div>
            <img src="${(window.javaOnlineDir==null?"":window.javaOnlineDir)+"assets/graphics/grid.svg"}" alt="" style="height: 40px">
        </div>
        <div class="bitteWartenProgress" style="font-size: 20px"></div>
        </div>
        `;return y(t)}makeBracketErrorDiv(){return y(`
        <div class="jo_parenthesis_warning" title="Klammerwarnung!" style="bottom: 55px">
        <div class="jo_warning_light"></div>
        <div class="jo_pw_heading">{ }</div>
        <div title="Letzten Schritt rückgängig" 
            class="jo_pw_undo img_undo jo_button jo_active"></div>
        </div>
        `)}makeCodeResetModalWindow(e){let t=y(`
            <div class="joe_codeResetModal">
            <div style="flex: 1"></div>
            <div style="display: flex">
                <div style="flex: 1"></div>
                <div style="padding-left: 30px;">
                <div style="color: red; margin-bottom: 10px; font-weight: bold">Warnung:</div>
                <div>Soll der Code wirklich auf den Ausgangszustand zurückgesetzt werden?</div>
                <div>Alle von Dir gemachten Änderungen werden damit verworfen.</div>
                </div>
                <div style="flex: 1"></div>
            </div>
            <div class="joe_codeResetModalButtons">
            <div class="joe_codeResetModalCancel jo_button jo_active">Abbrechen</div>
            <div class="joe_codeResetModalOK jo_button jo_active">OK</div>
            </div>
            <div style="flex: 2"></div>
            </div>
        `);return t.hide(),e.append(t),e.find(".joe_codeResetModalCancel").on("click",()=>{t.hide()}),e.find(".joe_codeResetModalOK").on("click",()=>{this.initScripts(),this.deleteScriptsInDB(),t.hide(),this.$codeResetButton.hide(),this.compileRunsAfterCodeReset=1}),t}makeDatabaseResetModalWindow(e){let t=y(`
            <div class="joe_databaseResetModal">
            <div style="flex: 1"></div>
            <div style="display: flex">
                <div style="flex: 1"></div>
                <div style="padding-left: 30px;">
                <div style="color: red; margin-bottom: 10px; font-weight: bold">Warnung:</div>
                <div>Soll die Datenbank wirklich auf den Ausgangszustand zurückgesetzt werden?</div>
                <div>Alle bisher ausgeführten Anweisungen (siehe Tab Write History) werden dann rückgängig gemacht.</div>
                </div>
                <div style="flex: 1"></div>
            </div>
            <div class="joe_databaseResetModalButtons">
            <div class="joe_databaseResetModalCancel jo_button jo_active">Abbrechen</div>
            <div class="joe_databaseResetModalOK jo_button jo_active">OK</div>
            </div>
            <div style="flex: 2"></div>
            </div>
        `);return t.hide(),e.append(t),e.find(".joe_databaseResetModalCancel").on("click",()=>{t.hide()}),e.find(".joe_databaseResetModalOK").on("click",()=>{t.hide(),this.resetDatabase(()=>{this.writeQueryManager.reset()}),this.$databaseResetButton.hide(),this.compileRunsAfterCodeReset=1}),t}makeFilesDiv(){let e=y('<div class="joe_bottomDivFiles jo_scrollable"></div>'),t=y('<div class="joe_filesHeader jo_tabheading jo_active"  style="line-height: 24px">Dateien</div>');return this.$filesListDiv=y('<div class="joe_filesList jo_scrollable"></div>'),e.append(t,this.$filesListDiv),e}startTimer(){this.timerHandle!=null&&clearInterval(this.timerHandle);let e=this;this.timerHandle=setInterval(()=>{e.compileIfDirty()},500)}compileIfDirty(){var e,t;if(this.currentWorkspace!=null&&this.currentWorkspace.moduleStore.isDirty()&&this.compiler.compilerStatus!=Gt.compiling&&this.getDatabaseTool().databaseStructure!=null)try{this.compiler.compile(this.currentWorkspace.moduleStore);let i=(t=(e=this.bottomDiv)==null?void 0:e.errorManager)==null?void 0:t.showErrors(this.currentWorkspace);this.editor.onDidChangeCursorPosition(null),this.version++}catch(i){console.error(i),this.compiler.compilerStatus=Gt.error}}considerShowingCodeResetButton(){this.compileRunsAfterCodeReset++,this.compileRunsAfterCodeReset==3&&this.$codeResetButton.fadeIn(1e3)}makeBottomDiv(e,t){let i=y('<div class="jo_tabheadings"></div>');i.css("position","relative");let r=y('<div class="joe_tabheading-right jo_noHeading joe_controlsTabheading"></div>');if(r.append(t),i.append(r),this.config.withErrorList){let k=y('<div class="jo_tabheading jo_active" data-target="jo_errorsTab" style="line-height: 24px">Fehler</div>');i.append(k)}if(this.config.withOutput){let k=y('<div class="jo_tabheading jo_resultTabheading" data-target="jo_resultTab" style="line-height: 24px">Ausgabe</div>');i.append(k)}let o=y('<div class="jo_tabheading jo_historyTabheading" data-target="jo_historyTab" style="line-height: 24px">History</div>');i.append(o);let u=y('<div class="joe_tabheading-right jo_noHeading joe_paginationHeading"><div class="jo_pagination"></div></div>');i.append(u),e.append(i);let h=y('<div class="jo_tabs jo_scrollable"></div>');if(this.config.withErrorList){let k=y('<div class="jo_active jo_scrollable jo_errorsTab"></div>');h.append(k)}if(this.config.withOutput){let k=y(`<div class="jo_editorFontSize jo_resultTab">
            <div class="jo_result-inner">
                <div class="jo_result-header"></div>
                <div class="jo_scrollable jo_result-body"></div>
            </div>
            </div>
    `);h.append(k)}let b=y('<div class="jo_scrollable jo_historyTab"></div>');h.append(b),e.append(h)}makeRightDiv(){let e=y('<div class="joe_rightDiv"></div>');this.$rightDivInner=y('<div class="joe_rightDivInner"></div>'),e.append(this.$rightDivInner);let t=y('<div class="jo_tabheadings"></div>');t.css("position","relative");let i=y('<div class="jo_tabheading jo_active" data-target="jo_db_tree" style="line-height: 24px">DB (Baum)</div>');t.append(i),this.$rightDivInner.append(t);let r=y('<div class="jo_tabs jo_scrollable"></div>');return this.$dbTreeDiv=y('<div class="jo_tab jo_scrollable jo_editorFontSize jo_active jo_db_tree">DB-Baum</div>'),r.append(this.$dbTreeDiv),this.$rightDivInner.append(r),Qt(e),e}getSemicolonAngel(){return this.semicolonAngel}}class Ro{constructor(){w(this,"startupComplete",2);w(this,"themeManager");w(this,"mainEmbeddedList",[])}initGUI(){this.checkStartupComplete(),this.themeManager=new tr}initEditor(){new er().init(),this.checkStartupComplete()}checkStartupComplete(){this.startupComplete--,this.startupComplete==0&&this.start()}start(){this.initJavaOnlineDivs()}initJavaOnlineDivs(){y(".sql-online").each((e,t)=>{let i=y(t),r=[];i.find("script").each((o,u)=>{let h=y(u),b="sql";h.data("type")!=null&&(b=h.data("type"));let k={type:b,title:h.attr("title"),text:h.text().trim()};r.push(k)}),this.initDiv(i,r)})}initDiv(e,t){new Fo(e,t)}}y(function(){let f=new Ro,e="",t="lib/monaco-editor/dev/vs";window.javaOnlineDir!=null&&(e=window.javaOnlineDir),window.monacoEditorPath!=null&&(t=window.monacoEditorPath),window.require.config({paths:{vs:e+t}}),window.require.config({"vs/nls":{availableLanguages:{"*":"de"}},ignoreDuplicateModules:["vs/editor/editor.main"]}),window.require(["vs/editor/editor.main"],function(){f.initEditor(),f.initGUI()})});
//# sourceMappingURL=sql-ide-embedded.js.map
